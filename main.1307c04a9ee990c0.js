(self.webpackChunktreebase=self.webpackChunktreebase||[]).push([[179],{357:function(Dm){Dm.exports=function(){"use strict";var gc=function(P,z){var te={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},pe={on:function(ke,ze,tt){if(void 0===te[ke])throw new Error("Invalid event type: "+ke);te[ke].push({selector:ze,fn:tt})},render:function(ke){z.store.featureChanged(ke)}},Ee=function(ke,ze){for(var tt=te[ke],zt=tt.length;zt--;){var rn=tt[zt];if(rn.selector(ze)){rn.fn.call(pe,ze)||z.store.render(),z.ui.updateMapClasses();break}}};return P.start.call(pe),{render:P.render,stop:function(){P.stop&&P.stop()},trash:function(){P.trash&&(P.trash(),z.store.render())},combineFeatures:function(){P.combineFeatures&&P.combineFeatures()},uncombineFeatures:function(){P.uncombineFeatures&&P.uncombineFeatures()},drag:function(ke){Ee("drag",ke)},click:function(ke){Ee("click",ke)},mousemove:function(ke){Ee("mousemove",ke)},mousedown:function(ke){Ee("mousedown",ke)},mouseup:function(ke){Ee("mouseup",ke)},mouseout:function(ke){Ee("mouseout",ke)},keydown:function(ke){Ee("keydown",ke)},keyup:function(ke){Ee("keyup",ke)},touchstart:function(ke){Ee("touchstart",ke)},touchmove:function(ke){Ee("touchmove",ke)},touchend:function(ke){Ee("touchend",ke)},tap:function(ke){Ee("tap",ke)}}};function Zs(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}var Uu={},m={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function pt(P){var z=0;if(P&&P.length>0){z+=Math.abs(Xs(P[0]));for(var te=1;te<P.length;te++)z-=Math.abs(Xs(P[te]))}return z}function Xs(P){var z,te,pe,Ee,ke,ze,tt=0,zt=P.length;if(zt>2){for(ze=0;ze<zt;ze++)ze===zt-2?(pe=zt-2,Ee=zt-1,ke=0):ze===zt-1?(pe=zt-1,Ee=0,ke=1):(pe=ze,Ee=ze+1,ke=ze+2),z=P[pe],te=P[Ee],tt+=(ss(P[ke][0])-ss(z[0]))*Math.sin(ss(te[1]));tt=tt*m.RADIUS*m.RADIUS/2}return tt}function ss(P){return P*Math.PI/180}Uu.geometry=function P(z){var te,pe=0;switch(z.type){case"Polygon":return pt(z.coordinates);case"MultiPolygon":for(te=0;te<z.coordinates.length;te++)pe+=pt(z.coordinates[te]);return pe;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(te=0;te<z.geometries.length;te++)pe+=P(z.geometries[te]);return pe}},Uu.ring=Xs;var An={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Pn={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},di={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},hr={POLYGON:"polygon",LINE:"line_string",POINT:"point"},_n={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},ti={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Eo={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Ul={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},fr={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},rr={ACTIVE:"true",INACTIVE:"false"},Ho=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],ul=-85,dl=Object.freeze({__proto__:null,classes:An,sources:Pn,cursors:di,types:hr,geojsonTypes:_n,modes:ti,events:Eo,updateActions:Ul,meta:fr,activeStates:rr,interactions:Ho,LAT_MIN:-90,LAT_RENDERED_MIN:ul,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),Ys={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Gt(P,z){var te=Ys[P.geometry.type]-Ys[z.geometry.type];return 0===te&&P.geometry.type===_n.POLYGON?P.area-z.area:te}function Hd(P){return P.map(function(z){return z.geometry.type===_n.POLYGON&&(z.area=Uu.geometry({type:_n.FEATURE,property:{},geometry:z.geometry})),z}).sort(Gt).map(function(z){return delete z.area,z})}function Vl(P,z){return void 0===z&&(z=0),[[P.point.x-z,P.point.y-z],[P.point.x+z,P.point.y+z]]}function Nn(P){if(this._items={},this._nums={},this._length=P?P.length:0,P)for(var z=0,te=P.length;z<te;z++)this.add(P[z]),void 0!==P[z]&&("string"==typeof P[z]?this._items[P[z]]=z:this._nums[P[z]]=z)}Nn.prototype.add=function(P){return this.has(P)||(this._length++,"string"==typeof P?this._items[P]=this._length:this._nums[P]=this._length),this},Nn.prototype.delete=function(P){return!1===this.has(P)||(this._length--,delete this._items[P],delete this._nums[P]),this},Nn.prototype.has=function(P){return!("string"!=typeof P&&"number"!=typeof P||void 0===this._items[P]&&void 0===this._nums[P])},Nn.prototype.values=function(){var P=this,z=[];return Object.keys(this._items).forEach(function(te){z.push({k:te,v:P._items[te]})}),Object.keys(this._nums).forEach(function(te){z.push({k:JSON.parse(te),v:P._nums[te]})}),z.sort(function(te,pe){return te.v-pe.v}).map(function(te){return te.k})},Nn.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var _o=[fr.FEATURE,fr.MIDPOINT,fr.VERTEX],Na={click:function(P,z,te){return Vu(P,z,te,te.options.clickBuffer)},touch:function(P,z,te){return Vu(P,z,te,te.options.touchBuffer)}};function Vu(P,z,te,pe){if(null===te.map)return[];var Ee=P?Vl(P,pe):z,ke={};te.options.styles&&(ke.layers=te.options.styles.map(function(rn){return rn.id}));var ze=te.map.queryRenderedFeatures(Ee,ke).filter(function(rn){return-1!==_o.indexOf(rn.properties.meta)}),tt=new Nn,zt=[];return ze.forEach(function(rn){var on=rn.properties.id;tt.has(on)||(tt.add(on),zt.push(rn))}),Hd(zt)}function za(P,z){var te=Na.click(P,null,z),pe={mouse:di.NONE};return te[0]&&(pe.mouse=te[0].properties.active===rr.ACTIVE?di.MOVE:di.POINTER,pe.feature=te[0].properties.meta),-1!==z.events.currentModeName().indexOf("draw")&&(pe.mouse=di.ADD),z.ui.queueMapClasses(pe),z.ui.updateMapClasses(),te[0]}function Ts(P,z){var te=P.x-z.x,pe=P.y-z.y;return Math.sqrt(te*te+pe*pe)}function ni(P,z,te){void 0===te&&(te={});var pe=null!=te.fineTolerance?te.fineTolerance:4,Ee=null!=te.grossTolerance?te.grossTolerance:12,ke=null!=te.interval?te.interval:500;P.point=P.point||z.point,P.time=P.time||z.time;var ze=Ts(P.point,z.point);return ze<pe||ze<Ee&&z.time-P.time<ke}function hl(P,z,te){void 0===te&&(te={});var pe=null!=te.tolerance?te.tolerance:25,Ee=null!=te.interval?te.interval:250;return P.point=P.point||z.point,P.time=P.time||z.time,Ts(P.point,z.point)<pe&&z.time-P.time<Ee}var ii={exports:{}},Yr=ii.exports=function(P,z){if(z||(z=16),void 0===P&&(P=128),P<=0)return"0";for(var te=Math.log(Math.pow(2,P))/Math.log(z),pe=2;te===1/0;pe*=2)te=Math.log(Math.pow(2,P/pe))/Math.log(z)*pe;var Ee=te-Math.floor(te),ke="";for(pe=0;pe<Math.floor(te);pe++)ke=Math.floor(Math.random()*z).toString(z)+ke;if(Ee){var ze=Math.pow(z,Ee);ke=Math.floor(Math.random()*ze).toString(z)+ke}var tt=parseInt(ke,z);return tt!==1/0&&tt>=Math.pow(2,P)?Yr(P,z):ke};Yr.rack=function(P,z,te){var pe=function(ke){var ze=0;do{if(ze++>10){if(!te)throw new Error("too many ID collisions, use more bits");P+=te}var tt=Yr(P,z)}while(Object.hasOwnProperty.call(Ee,tt));return Ee[tt]=ke,tt},Ee=pe.hats={};return pe.get=function(ke){return pe.hats[ke]},pe.set=function(ke,ze){return pe.hats[ke]=ze,pe},pe.bits=P||128,pe.base=z||16,pe};var Ba=Zs(ii.exports),Ti=function(P,z){this.ctx=P,this.properties=z.properties||{},this.coordinates=z.geometry.coordinates,this.id=z.id||Ba(),this.type=z.geometry.type};Ti.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Ti.prototype.incomingCoords=function(P){this.setCoordinates(P)},Ti.prototype.setCoordinates=function(P){this.coordinates=P,this.changed()},Ti.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Ti.prototype.setProperty=function(P,z){this.properties[P]=z},Ti.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:_n.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Ti.prototype.internal=function(P){var z={id:this.id,meta:fr.FEATURE,"meta:type":this.type,active:rr.INACTIVE,mode:P};if(this.ctx.options.userProperties)for(var te in this.properties)z["user_"+te]=this.properties[te];return{type:_n.FEATURE,properties:z,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var as=function(P,z){Ti.call(this,P,z)};(as.prototype=Object.create(Ti.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},as.prototype.updateCoordinate=function(P,z,te){this.coordinates=3===arguments.length?[z,te]:[P,z],this.changed()},as.prototype.getCoordinate=function(){return this.getCoordinates()};var Yn=function(P,z){Ti.call(this,P,z)};(Yn.prototype=Object.create(Ti.prototype)).isValid=function(){return this.coordinates.length>1},Yn.prototype.addCoordinate=function(P,z,te){this.changed();var pe=parseInt(P,10);this.coordinates.splice(pe,0,[z,te])},Yn.prototype.getCoordinate=function(P){var z=parseInt(P,10);return JSON.parse(JSON.stringify(this.coordinates[z]))},Yn.prototype.removeCoordinate=function(P){this.changed(),this.coordinates.splice(parseInt(P,10),1)},Yn.prototype.updateCoordinate=function(P,z,te){var pe=parseInt(P,10);this.coordinates[pe]=[z,te],this.changed()};var io=function(P,z){Ti.call(this,P,z),this.coordinates=this.coordinates.map(function(te){return te.slice(0,-1)})};(io.prototype=Object.create(Ti.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(function(P){return P.length>2})},io.prototype.incomingCoords=function(P){this.coordinates=P.map(function(z){return z.slice(0,-1)}),this.changed()},io.prototype.setCoordinates=function(P){this.coordinates=P,this.changed()},io.prototype.addCoordinate=function(P,z,te){this.changed();var pe=P.split(".").map(function(Ee){return parseInt(Ee,10)});this.coordinates[pe[0]].splice(pe[1],0,[z,te])},io.prototype.removeCoordinate=function(P){this.changed();var z=P.split(".").map(function(pe){return parseInt(pe,10)}),te=this.coordinates[z[0]];te&&(te.splice(z[1],1),te.length<3&&this.coordinates.splice(z[0],1))},io.prototype.getCoordinate=function(P){var z=P.split(".").map(function(pe){return parseInt(pe,10)});return JSON.parse(JSON.stringify(this.coordinates[z[0]][z[1]]))},io.prototype.getCoordinates=function(){return this.coordinates.map(function(P){return P.concat([P[0]])})},io.prototype.updateCoordinate=function(P,z,te){this.changed();var pe=P.split("."),Ee=parseInt(pe[0],10),ke=parseInt(pe[1],10);void 0===this.coordinates[Ee]&&(this.coordinates[Ee]=[]),this.coordinates[Ee][ke]=[z,te]};var Kr={MultiPoint:as,MultiLineString:Yn,MultiPolygon:io},jl=function(P,z,te,pe,Ee){var ke=te.split("."),ze=parseInt(ke[0],10),tt=ke[1]?ke.slice(1).join("."):null;return P[ze][z](tt,pe,Ee)},hi=function(P,z){if(Ti.call(this,P,z),delete this.coordinates,this.model=Kr[z.geometry.type],void 0===this.model)throw new TypeError(z.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(z.geometry.coordinates)};function yn(P){this.map=P.map,this.drawConfig=JSON.parse(JSON.stringify(P.options||{})),this._ctx=P}(hi.prototype=Object.create(Ti.prototype))._coordinatesToFeatures=function(P){var z=this,te=this.model.bind(this);return P.map(function(pe){return new te(z.ctx,{id:Ba(),type:_n.FEATURE,properties:{},geometry:{coordinates:pe,type:z.type.replace("Multi","")}})})},hi.prototype.isValid=function(){return this.features.every(function(P){return P.isValid()})},hi.prototype.setCoordinates=function(P){this.features=this._coordinatesToFeatures(P),this.changed()},hi.prototype.getCoordinate=function(P){return jl(this.features,"getCoordinate",P)},hi.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(P){return P.type===_n.POLYGON?P.getCoordinates():P.coordinates})))},hi.prototype.updateCoordinate=function(P,z,te){jl(this.features,"updateCoordinate",P,z,te),this.changed()},hi.prototype.addCoordinate=function(P,z,te){jl(this.features,"addCoordinate",P,z,te),this.changed()},hi.prototype.removeCoordinate=function(P){jl(this.features,"removeCoordinate",P),this.changed()},hi.prototype.getFeatures=function(){return this.features},yn.prototype.setSelected=function(P){return this._ctx.store.setSelected(P)},yn.prototype.setSelectedCoordinates=function(P){var z=this;this._ctx.store.setSelectedCoordinates(P),P.reduce(function(te,pe){return void 0===te[pe.feature_id]&&(te[pe.feature_id]=!0,z._ctx.store.get(pe.feature_id).changed()),te},{})},yn.prototype.getSelected=function(){return this._ctx.store.getSelected()},yn.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},yn.prototype.isSelected=function(P){return this._ctx.store.isSelected(P)},yn.prototype.getFeature=function(P){return this._ctx.store.get(P)},yn.prototype.select=function(P){return this._ctx.store.select(P)},yn.prototype.deselect=function(P){return this._ctx.store.deselect(P)},yn.prototype.deleteFeature=function(P,z){return void 0===z&&(z={}),this._ctx.store.delete(P,z)},yn.prototype.addFeature=function(P){return this._ctx.store.add(P)},yn.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},yn.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},yn.prototype.setActionableState=function(P){return void 0===P&&(P={}),this._ctx.events.actionable({trash:P.trash||!1,combineFeatures:P.combineFeatures||!1,uncombineFeatures:P.uncombineFeatures||!1})},yn.prototype.changeMode=function(P,z,te){return void 0===z&&(z={}),void 0===te&&(te={}),this._ctx.events.changeMode(P,z,te)},yn.prototype.updateUIClasses=function(P){return this._ctx.ui.queueMapClasses(P)},yn.prototype.activateUIButton=function(P){return this._ctx.ui.setActiveButton(P)},yn.prototype.featuresAt=function(P,z,te){if(void 0===te&&(te="click"),"click"!==te&&"touch"!==te)throw new Error("invalid buffer type");return Na[te](P,z,this._ctx)},yn.prototype.newFeature=function(P){var z=P.geometry.type;return z===_n.POINT?new as(this._ctx,P):z===_n.LINE_STRING?new Yn(this._ctx,P):z===_n.POLYGON?new io(this._ctx,P):new hi(this._ctx,P)},yn.prototype.isInstanceOf=function(P,z){if(P===_n.POINT)return z instanceof as;if(P===_n.LINE_STRING)return z instanceof Yn;if(P===_n.POLYGON)return z instanceof io;if("MultiFeature"===P)return z instanceof hi;throw new Error("Unknown feature class: "+P)},yn.prototype.doRender=function(P){return this._ctx.store.featureChanged(P)},yn.prototype.onSetup=function(){},yn.prototype.onDrag=function(){},yn.prototype.onClick=function(){},yn.prototype.onMouseMove=function(){},yn.prototype.onMouseDown=function(){},yn.prototype.onMouseUp=function(){},yn.prototype.onMouseOut=function(){},yn.prototype.onKeyUp=function(){},yn.prototype.onKeyDown=function(){},yn.prototype.onTouchStart=function(){},yn.prototype.onTouchMove=function(){},yn.prototype.onTouchEnd=function(){},yn.prototype.onTap=function(){},yn.prototype.onStop=function(){},yn.prototype.onTrash=function(){},yn.prototype.onCombineFeature=function(){},yn.prototype.onUncombineFeature=function(){},yn.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var fi={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},pi=Object.keys(fi);function fl(P){return[].concat(P).filter(function(z){return void 0!==z})}function _r(){var P=this;if(!P.ctx.map||void 0===P.ctx.map.getSource(Pn.HOT))return zt();var z=P.ctx.events.currentModeName();P.ctx.ui.queueMapClasses({mode:z});var te=[],pe=[];P.isDirty?pe=P.getAllIds():(te=P.getChangedIds().filter(function(rn){return void 0!==P.get(rn)}),pe=P.sources.hot.filter(function(rn){return rn.properties.id&&-1===te.indexOf(rn.properties.id)&&void 0!==P.get(rn.properties.id)}).map(function(rn){return rn.properties.id})),P.sources.hot=[];var Ee=P.sources.cold.length;P.sources.cold=P.isDirty?[]:P.sources.cold.filter(function(rn){return-1===te.indexOf(rn.properties.id||rn.properties.parent)});var ke=Ee!==P.sources.cold.length||pe.length>0;function ze(rn,on){var Wt=P.get(rn).internal(z);P.ctx.events.currentModeRender(Wt,function($e){P.sources[on].push($e)})}if(te.forEach(function(rn){return ze(rn,"hot")}),pe.forEach(function(rn){return ze(rn,"cold")}),ke&&P.ctx.map.getSource(Pn.COLD).setData({type:_n.FEATURE_COLLECTION,features:P.sources.cold}),P.ctx.map.getSource(Pn.HOT).setData({type:_n.FEATURE_COLLECTION,features:P.sources.hot}),P._emitSelectionChange&&(P.ctx.map.fire(Eo.SELECTION_CHANGE,{features:P.getSelected().map(function(rn){return rn.toGeoJSON()}),points:P.getSelectedCoordinates().map(function(rn){return{type:_n.FEATURE,properties:{},geometry:{type:_n.POINT,coordinates:rn.coordinates}}})}),P._emitSelectionChange=!1),P._deletedFeaturesToEmit.length){var tt=P._deletedFeaturesToEmit.map(function(rn){return rn.toGeoJSON()});P._deletedFeaturesToEmit=[],P.ctx.map.fire(Eo.DELETE,{features:tt})}function zt(){P.isDirty=!1,P.clearChangedIds()}zt(),P.ctx.map.fire(Eo.RENDER,{})}function wi(P){var z,te=this;this._features={},this._featureIds=new Nn,this._selectedFeatureIds=new Nn,this._selectedCoordinates=[],this._changedFeatureIds=new Nn,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=P,this.sources={hot:[],cold:[]},this.render=function(){z||(z=requestAnimationFrame(function(){z=null,_r.call(te)}))},this.isDirty=!1}function Ua(P,z){var te=P._selectedCoordinates.filter(function(pe){return P._selectedFeatureIds.has(pe.feature_id)});P._selectedCoordinates.length===te.length||z.silent||(P._emitSelectionChange=!0),P._selectedCoordinates=te}wi.prototype.createRenderBatch=function(){var P=this,z=this.render,te=0;return this.render=function(){te++},function(){P.render=z,te>0&&P.render()}},wi.prototype.setDirty=function(){return this.isDirty=!0,this},wi.prototype.featureChanged=function(P){return this._changedFeatureIds.add(P),this},wi.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},wi.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},wi.prototype.getAllIds=function(){return this._featureIds.values()},wi.prototype.add=function(P){return this.featureChanged(P.id),this._features[P.id]=P,this._featureIds.add(P.id),this},wi.prototype.delete=function(P,z){var te=this;return void 0===z&&(z={}),fl(P).forEach(function(pe){te._featureIds.has(pe)&&(te._featureIds.delete(pe),te._selectedFeatureIds.delete(pe),z.silent||-1===te._deletedFeaturesToEmit.indexOf(te._features[pe])&&te._deletedFeaturesToEmit.push(te._features[pe]),delete te._features[pe],te.isDirty=!0)}),Ua(this,z),this},wi.prototype.get=function(P){return this._features[P]},wi.prototype.getAll=function(){var P=this;return Object.keys(this._features).map(function(z){return P._features[z]})},wi.prototype.select=function(P,z){var te=this;return void 0===z&&(z={}),fl(P).forEach(function(pe){te._selectedFeatureIds.has(pe)||(te._selectedFeatureIds.add(pe),te._changedFeatureIds.add(pe),z.silent||(te._emitSelectionChange=!0))}),this},wi.prototype.deselect=function(P,z){var te=this;return void 0===z&&(z={}),fl(P).forEach(function(pe){te._selectedFeatureIds.has(pe)&&(te._selectedFeatureIds.delete(pe),te._changedFeatureIds.add(pe),z.silent||(te._emitSelectionChange=!0))}),Ua(this,z),this},wi.prototype.clearSelected=function(P){return void 0===P&&(P={}),this.deselect(this._selectedFeatureIds.values(),{silent:P.silent}),this},wi.prototype.setSelected=function(P,z){var te=this;return void 0===z&&(z={}),P=fl(P),this.deselect(this._selectedFeatureIds.values().filter(function(pe){return-1===P.indexOf(pe)}),{silent:z.silent}),this.select(P.filter(function(pe){return!te._selectedFeatureIds.has(pe)}),{silent:z.silent}),this},wi.prototype.setSelectedCoordinates=function(P){return this._selectedCoordinates=P,this._emitSelectionChange=!0,this},wi.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},wi.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},wi.prototype.getSelected=function(){var P=this;return this._selectedFeatureIds.values().map(function(z){return P.get(z)})},wi.prototype.getSelectedCoordinates=function(){var P=this;return this._selectedCoordinates.map(function(z){return{coordinates:P.get(z.feature_id).getCoordinate(z.coord_path)}})},wi.prototype.isSelected=function(P){return this._selectedFeatureIds.has(P)},wi.prototype.setFeatureProperty=function(P,z,te){this.get(P).setProperty(z,te),this.featureChanged(P)},wi.prototype.storeMapConfig=function(){var P=this;Ho.forEach(function(z){P.ctx.map[z]&&(P._mapInitialConfig[z]=P.ctx.map[z].isEnabled())})},wi.prototype.restoreMapConfig=function(){var P=this;Object.keys(this._mapInitialConfig).forEach(function(z){P._mapInitialConfig[z]?P.ctx.map[z].enable():P.ctx.map[z].disable()})},wi.prototype.getInitialConfigValue=function(P){return void 0===this._mapInitialConfig[P]||this._mapInitialConfig[P]};var Ks=Object.prototype.hasOwnProperty,Ea=Zs(function(){for(var P=arguments,z={},te=0;te<arguments.length;te++){var pe=P[te];for(var Ee in pe)Ks.call(pe,Ee)&&(z[Ee]=pe[Ee])}return z}),ju=["mode","feature","mouse"];function Gd(P){var z=null,te=null,pe={onRemove:function(){return P.map.off("load",pe.connect),clearInterval(te),pe.removeLayers(),P.store.restoreMapConfig(),P.ui.removeButtons(),P.events.removeEventListeners(),P.ui.clearMapClasses(),P.boxZoomInitial&&P.map.boxZoom.enable(),P.map=null,P.container=null,P.store=null,z&&z.parentNode&&z.parentNode.removeChild(z),z=null,this},connect:function(){P.map.off("load",pe.connect),clearInterval(te),pe.addLayers(),P.store.storeMapConfig(),P.events.addEventListeners()},onAdd:function(Ee){var ke=Ee.fire;return Ee.fire=function(ze,tt){var zt=arguments;return 1===ke.length&&1!==arguments.length&&(zt=[Ea({},{type:ze},tt)]),ke.apply(Ee,zt)},P.map=Ee,P.events=function(ze){var tt=Object.keys(ze.options.modes).reduce(function(lt,xn){return lt[xn]=function Go(P){var z=Object.keys(P);return function(te,pe){void 0===pe&&(pe={});var Ee={},ke=z.reduce(function(ze,tt){return ze[tt]=P[tt],ze},new yn(te));return{start:function(){var ze=this;Ee=ke.onSetup(pe),pi.forEach(function(tt){var zt,rn=fi[tt],on=function(){return!1};P[rn]&&(on=function(){return!0}),ze.on(tt,on,(zt=rn,function(Wt){return ke[zt](Ee,Wt)}))})},stop:function(){ke.onStop(Ee)},trash:function(){ke.onTrash(Ee)},combineFeatures:function(){ke.onCombineFeatures(Ee)},uncombineFeatures:function(){ke.onUncombineFeatures(Ee)},render:function(ze,tt){ke.toDisplayFeatures(Ee,ze,tt)}}}}(ze.options.modes[xn]),lt},{}),zt={},rn={},on={},Wt=null,$e=null;on.drag=function(lt,xn){xn({point:lt.point,time:(new Date).getTime()})?(ze.ui.queueMapClasses({mouse:di.DRAG}),$e.drag(lt)):lt.originalEvent.stopPropagation()},on.mousedrag=function(lt){on.drag(lt,function(xn){return!ni(zt,xn)})},on.touchdrag=function(lt){on.drag(lt,function(xn){return!hl(rn,xn)})},on.mousemove=function(lt){if(1===(void 0!==lt.originalEvent.buttons?lt.originalEvent.buttons:lt.originalEvent.which))return on.mousedrag(lt);var xn=za(lt,ze);lt.featureTarget=xn,$e.mousemove(lt)},on.mousedown=function(lt){zt={time:(new Date).getTime(),point:lt.point};var xn=za(lt,ze);lt.featureTarget=xn,$e.mousedown(lt)},on.mouseup=function(lt){var xn=za(lt,ze);lt.featureTarget=xn,ni(zt,{point:lt.point,time:(new Date).getTime()})?$e.click(lt):$e.mouseup(lt)},on.mouseout=function(lt){$e.mouseout(lt)},on.touchstart=function(lt){if(lt.originalEvent.preventDefault(),ze.options.touchEnabled){rn={time:(new Date).getTime(),point:lt.point};var xn=Na.touch(lt,null,ze)[0];lt.featureTarget=xn,$e.touchstart(lt)}},on.touchmove=function(lt){if(lt.originalEvent.preventDefault(),ze.options.touchEnabled)return $e.touchmove(lt),on.touchdrag(lt)},on.touchend=function(lt){if(lt.originalEvent.preventDefault(),ze.options.touchEnabled){var xn=Na.touch(lt,null,ze)[0];lt.featureTarget=xn,hl(rn,{time:(new Date).getTime(),point:lt.point})?$e.tap(lt):$e.touchend(lt)}};var sr=function(lt){return!(8===lt||46===lt||lt>=48&&lt<=57)};function $t(lt,xn,Zi){void 0===Zi&&(Zi={}),$e.stop();var Li=tt[lt];if(void 0===Li)throw new Error(lt+" is not valid");Wt=lt;var si=Li(ze,xn);$e=gc(si,ze),Zi.silent||ze.map.fire(Eo.MODE_CHANGE,{mode:lt}),ze.store.setDirty(),ze.store.render()}on.keydown=function(lt){(lt.srcElement||lt.target).classList.contains("mapboxgl-canvas")&&(8!==lt.keyCode&&46!==lt.keyCode||!ze.options.controls.trash?sr(lt.keyCode)?$e.keydown(lt):49===lt.keyCode&&ze.options.controls.point?$t(ti.DRAW_POINT):50===lt.keyCode&&ze.options.controls.line_string?$t(ti.DRAW_LINE_STRING):51===lt.keyCode&&ze.options.controls.polygon&&$t(ti.DRAW_POLYGON):(lt.preventDefault(),$e.trash()))},on.keyup=function(lt){sr(lt.keyCode)&&$e.keyup(lt)},on.zoomend=function(){ze.store.changeZoom()},on.data=function(lt){if("style"===lt.dataType){var xn=ze.setup,Zi=ze.map,si=ze.store;ze.options.styles.some(function(Hh){return Zi.getLayer(Hh.id)})||(xn.addLayers(),si.setDirty(),si.render())}};var Cn={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){$e=gc(tt[Wt=ze.options.defaultMode](ze),ze)},changeMode:$t,actionable:function(lt){var xn=!1;Object.keys(lt).forEach(function(Zi){if(void 0===Cn[Zi])throw new Error("Invalid action type");Cn[Zi]!==lt[Zi]&&(xn=!0),Cn[Zi]=lt[Zi]}),xn&&ze.map.fire(Eo.ACTIONABLE,{actions:Cn})},currentModeName:function(){return Wt},currentModeRender:function(lt,xn){return $e.render(lt,xn)},fire:function(lt,xn){on[lt]&&on[lt](xn)},addEventListeners:function(){ze.map.on("mousemove",on.mousemove),ze.map.on("mousedown",on.mousedown),ze.map.on("mouseup",on.mouseup),ze.map.on("data",on.data),ze.map.on("touchmove",on.touchmove),ze.map.on("touchstart",on.touchstart),ze.map.on("touchend",on.touchend),ze.container.addEventListener("mouseout",on.mouseout),ze.options.keybindings&&(ze.container.addEventListener("keydown",on.keydown),ze.container.addEventListener("keyup",on.keyup))},removeEventListeners:function(){ze.map.off("mousemove",on.mousemove),ze.map.off("mousedown",on.mousedown),ze.map.off("mouseup",on.mouseup),ze.map.off("data",on.data),ze.map.off("touchmove",on.touchmove),ze.map.off("touchstart",on.touchstart),ze.map.off("touchend",on.touchend),ze.container.removeEventListener("mouseout",on.mouseout),ze.options.keybindings&&(ze.container.removeEventListener("keydown",on.keydown),ze.container.removeEventListener("keyup",on.keyup))},trash:function(lt){$e.trash(lt)},combineFeatures:function(){$e.combineFeatures()},uncombineFeatures:function(){$e.uncombineFeatures()},getMode:function(){return Wt}}}(P),P.ui=function(ze){var tt={},zt=null,rn={mode:null,feature:null,mouse:null},on={mode:null,feature:null,mouse:null};function Wt(lt){on=Ea(on,lt)}function $e(){var lt,xn;if(ze.container){var Zi=[],Li=[];ju.forEach(function(si){on[si]!==rn[si]&&(Zi.push(si+"-"+rn[si]),null!==on[si]&&Li.push(si+"-"+on[si]))}),Zi.length>0&&(lt=ze.container.classList).remove.apply(lt,Zi),Li.length>0&&(xn=ze.container.classList).add.apply(xn,Li),rn=Ea(rn,on)}}function sr(lt,xn){void 0===xn&&(xn={});var Zi=document.createElement("button");return Zi.className=An.CONTROL_BUTTON+" "+xn.className,Zi.setAttribute("title",xn.title),xn.container.appendChild(Zi),Zi.addEventListener("click",function(Li){if(Li.preventDefault(),Li.stopPropagation(),Li.target===zt)return $t(),void xn.onDeactivate();Cn(lt),xn.onActivate()},!0),Zi}function $t(){zt&&(zt.classList.remove(An.ACTIVE_BUTTON),zt=null)}function Cn(lt){$t();var xn=tt[lt];xn&&xn&&"trash"!==lt&&(xn.classList.add(An.ACTIVE_BUTTON),zt=xn)}return{setActiveButton:Cn,queueMapClasses:Wt,updateMapClasses:$e,clearMapClasses:function(){Wt({mode:null,feature:null,mouse:null}),$e()},addButtons:function(){var lt=ze.options.controls,xn=document.createElement("div");return xn.className=An.CONTROL_GROUP+" "+An.CONTROL_BASE,lt&&(lt[hr.LINE]&&(tt[hr.LINE]=sr(hr.LINE,{container:xn,className:An.CONTROL_BUTTON_LINE,title:"LineString tool "+(ze.options.keybindings?"(l)":""),onActivate:function(){return ze.events.changeMode(ti.DRAW_LINE_STRING)},onDeactivate:function(){return ze.events.trash()}})),lt[hr.POLYGON]&&(tt[hr.POLYGON]=sr(hr.POLYGON,{container:xn,className:An.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(ze.options.keybindings?"(p)":""),onActivate:function(){return ze.events.changeMode(ti.DRAW_POLYGON)},onDeactivate:function(){return ze.events.trash()}})),lt[hr.POINT]&&(tt[hr.POINT]=sr(hr.POINT,{container:xn,className:An.CONTROL_BUTTON_POINT,title:"Marker tool "+(ze.options.keybindings?"(m)":""),onActivate:function(){return ze.events.changeMode(ti.DRAW_POINT)},onDeactivate:function(){return ze.events.trash()}})),lt.trash&&(tt.trash=sr("trash",{container:xn,className:An.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){ze.events.trash()}})),lt.combine_features&&(tt.combine_features=sr("combineFeatures",{container:xn,className:An.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){ze.events.combineFeatures()}})),lt.uncombine_features&&(tt.uncombine_features=sr("uncombineFeatures",{container:xn,className:An.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){ze.events.uncombineFeatures()}}))),xn},removeButtons:function(){Object.keys(tt).forEach(function(lt){var xn=tt[lt];xn.parentNode&&xn.parentNode.removeChild(xn),delete tt[lt]})}}}(P),P.container=Ee.getContainer(),P.store=new wi(P),z=P.ui.addButtons(),P.options.boxSelect&&(P.boxZoomInitial=Ee.boxZoom.isEnabled(),Ee.boxZoom.disable(),Ee.dragPan.disable(),Ee.dragPan.enable()),Ee.loaded()?pe.connect():(Ee.on("load",pe.connect),te=setInterval(function(){Ee.loaded()&&pe.connect()},16)),P.events.start(),z},addLayers:function(){P.map.addSource(Pn.COLD,{data:{type:_n.FEATURE_COLLECTION,features:[]},type:"geojson"}),P.map.addSource(Pn.HOT,{data:{type:_n.FEATURE_COLLECTION,features:[]},type:"geojson"}),P.options.styles.forEach(function(Ee){P.map.addLayer(Ee)}),P.store.setDirty(!0),P.store.render()},removeLayers:function(){P.options.styles.forEach(function(Ee){P.map.getLayer(Ee.id)&&P.map.removeLayer(Ee.id)}),P.map.getSource(Pn.COLD)&&P.map.removeSource(Pn.COLD),P.map.getSource(Pn.HOT)&&P.map.removeSource(Pn.HOT)}};return P.setup=pe,pe}var ml=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Va(P){return function(z){var te=z.featureTarget;return!!te&&!!te.properties&&te.properties.meta===P}}function $u(P){return!!P.originalEvent&&!!P.originalEvent.shiftKey&&0===P.originalEvent.button}function Qs(P){return!!P.featureTarget&&!!P.featureTarget.properties&&P.featureTarget.properties.active===rr.ACTIVE&&P.featureTarget.properties.meta===fr.FEATURE}function ls(P){return!!P.featureTarget&&!!P.featureTarget.properties&&P.featureTarget.properties.active===rr.INACTIVE&&P.featureTarget.properties.meta===fr.FEATURE}function Ds(P){return void 0===P.featureTarget}function $l(P){return!!P.featureTarget&&!!P.featureTarget.properties&&P.featureTarget.properties.meta===fr.FEATURE}function Ca(P){var z=P.featureTarget;return!!z&&!!z.properties&&z.properties.meta===fr.VERTEX}function gl(P){return!!P.originalEvent&&!0===P.originalEvent.shiftKey}function Hl(P){return 27===P.keyCode}function Co(P){return 13===P.keyCode}var _l=Object.freeze({__proto__:null,isOfMetaType:Va,isShiftMousedown:$u,isActiveFeature:Qs,isInactiveFeature:ls,noTarget:Ds,isFeature:$l,isVertex:Ca,isShiftDown:gl,isEscapeKey:Hl,isEnterKey:Co,isTrue:function(){return!0}}),_c=Ss;function Ss(P,z){this.x=P,this.y=z}Ss.prototype={clone:function(){return new Ss(this.x,this.y)},add:function(P){return this.clone()._add(P)},sub:function(P){return this.clone()._sub(P)},multByPoint:function(P){return this.clone()._multByPoint(P)},divByPoint:function(P){return this.clone()._divByPoint(P)},mult:function(P){return this.clone()._mult(P)},div:function(P){return this.clone()._div(P)},rotate:function(P){return this.clone()._rotate(P)},rotateAround:function(P,z){return this.clone()._rotateAround(P,z)},matMult:function(P){return this.clone()._matMult(P)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(P){return this.x===P.x&&this.y===P.y},dist:function(P){return Math.sqrt(this.distSqr(P))},distSqr:function(P){var z=P.x-this.x,te=P.y-this.y;return z*z+te*te},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(P){return Math.atan2(this.y-P.y,this.x-P.x)},angleWith:function(P){return this.angleWithSep(P.x,P.y)},angleWithSep:function(P,z){return Math.atan2(this.x*z-this.y*P,this.x*P+this.y*z)},_matMult:function(P){var te=P[2]*this.x+P[3]*this.y;return this.x=P[0]*this.x+P[1]*this.y,this.y=te,this},_add:function(P){return this.x+=P.x,this.y+=P.y,this},_sub:function(P){return this.x-=P.x,this.y-=P.y,this},_mult:function(P){return this.x*=P,this.y*=P,this},_div:function(P){return this.x/=P,this.y/=P,this},_multByPoint:function(P){return this.x*=P.x,this.y*=P.y,this},_divByPoint:function(P){return this.x/=P.x,this.y/=P.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var P=this.y;return this.y=this.x,this.x=-P,this},_rotate:function(P){var z=Math.cos(P),te=Math.sin(P),Ee=te*this.x+z*this.y;return this.x=z*this.x-te*this.y,this.y=Ee,this},_rotateAround:function(P,z){var te=Math.cos(P),pe=Math.sin(P),ke=z.y+pe*(this.x-z.x)+te*(this.y-z.y);return this.x=z.x+te*(this.x-z.x)-pe*(this.y-z.y),this.y=ke,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ss.convert=function(P){return P instanceof Ss?P:Array.isArray(P)?new Ss(P[0],P[1]):P};var eu=Zs(_c);function tu(P,z){var te=z.getBoundingClientRect();return new eu(P.clientX-te.left-(z.clientLeft||0),P.clientY-te.top-(z.clientTop||0))}function ye(P,z,te,pe){return{type:_n.FEATURE,properties:{meta:fr.VERTEX,parent:P,coord_path:te,active:pe?rr.ACTIVE:rr.INACTIVE},geometry:{type:_n.POINT,coordinates:z}}}function K(P,z,te){var pe=z.geometry.coordinates,Ee=te.geometry.coordinates;if(pe[1]>85||pe[1]<ul||Ee[1]>85||Ee[1]<ul)return null;var ke={lng:(pe[0]+Ee[0])/2,lat:(pe[1]+Ee[1])/2};return{type:_n.FEATURE,properties:{meta:fr.MIDPOINT,parent:P,lng:ke.lng,lat:ke.lat,coord_path:te.properties.coord_path},geometry:{type:_n.POINT,coordinates:[ke.lng,ke.lat]}}}function ee(P,z,te){void 0===z&&(z={}),void 0===te&&(te=null);var pe,Ee=P.geometry,ke=Ee.type,ze=Ee.coordinates,tt=P.properties&&P.properties.id,zt=[];function rn(Wt,$e){var sr="",$t=null;Wt.forEach(function(Cn,lt){var xn=null!=$e?$e+"."+lt:String(lt),Zi=ye(tt,Cn,xn,on(xn));if(z.midpoints&&$t){var Li=K(tt,$t,Zi);Li&&zt.push(Li)}$t=Zi;var si=JSON.stringify(Cn);sr!==si&&zt.push(Zi),0===lt&&(sr=si)})}function on(Wt){return!!z.selectedPaths&&-1!==z.selectedPaths.indexOf(Wt)}return ke===_n.POINT?zt.push(ye(tt,ze,te,on(te))):ke===_n.POLYGON?ze.forEach(function(Wt,$e){rn(Wt,null!==te?te+"."+$e:String($e))}):ke===_n.LINE_STRING?rn(ze,te):0===ke.indexOf(_n.MULTI_PREFIX)&&(pe=ke.replace(_n.MULTI_PREFIX,""),ze.forEach(function(Wt,$e){zt=zt.concat(ee({type:_n.FEATURE,properties:P.properties,geometry:{type:pe,coordinates:Wt}},z,$e))})),zt}var me={enable:function(P){setTimeout(function(){P.map&&P.map.doubleClickZoom&&P._ctx&&P._ctx.store&&P._ctx.store.getInitialConfigValue&&P._ctx.store.getInitialConfigValue("doubleClickZoom")&&P.map.doubleClickZoom.enable()},0)},disable:function(P){setTimeout(function(){P.map&&P.map.doubleClickZoom&&P.map.doubleClickZoom.disable()},0)}},Me={exports:{}},Pe=function(P){if(!P||!P.type)return null;var z=Ve[P.type];return z?"geometry"===z?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:P}]}:"feature"===z?{type:"FeatureCollection",features:[P]}:"featurecollection"===z?P:void 0:null},Ve={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Ue=Zs(Pe),Oe=Object.freeze({__proto__:null,default:function P(z){switch(z&&z.type||null){case"FeatureCollection":return z.features=z.features.reduce(function(te,pe){return te.concat(P(pe))},[]),z;case"Feature":return z.geometry?P(z.geometry).map(function(te){var pe={type:"Feature",properties:JSON.parse(JSON.stringify(z.properties)),geometry:te};return void 0!==z.id&&(pe.id=z.id),pe}):[z];case"MultiPoint":return z.coordinates.map(function(te){return{type:"Point",coordinates:te}});case"MultiPolygon":return z.coordinates.map(function(te){return{type:"Polygon",coordinates:te}});case"MultiLineString":return z.coordinates.map(function(te){return{type:"LineString",coordinates:te}});case"GeometryCollection":return z.geometries.map(P).reduce(function(te,pe){return te.concat(pe)},[]);case"Point":case"Polygon":case"LineString":return[z]}}}),Ke=Pe,St=function Ri(P){if(P.__esModule)return P;var z=P.default;if("function"==typeof z){var te=function pe(){if(this instanceof pe){var Ee=[null];return Ee.push.apply(Ee,arguments),new(Function.bind.apply(z,Ee))}return z.apply(this,arguments)};te.prototype=z.prototype}else te={};return Object.defineProperty(te,"__esModule",{value:!0}),Object.keys(P).forEach(function(pe){var Ee=Object.getOwnPropertyDescriptor(P,pe);Object.defineProperty(te,pe,Ee.get?Ee:{enumerable:!0,get:function(){return P[pe]}})}),te}(Oe);St instanceof Function||(St=St.default);var Tt={exports:{}},$n=Tt.exports=function(P){return new Fn(P)};function Fn(P){this.value=P}function Un(P,z,te){var pe=[],Ee=[],ke=!0;return function ze(tt){var zt=te?Kn(tt):tt,rn={},on=!0,Wt={node:zt,node_:tt,path:[].concat(pe),parent:Ee[Ee.length-1],parents:Ee,key:pe.slice(-1)[0],isRoot:0===pe.length,level:pe.length,circular:null,update:function($t,Cn){Wt.isRoot||(Wt.parent.node[Wt.key]=$t),Wt.node=$t,Cn&&(on=!1)},delete:function($t){delete Wt.parent.node[Wt.key],$t&&(on=!1)},remove:function($t){bi(Wt.parent.node)?Wt.parent.node.splice(Wt.key,1):delete Wt.parent.node[Wt.key],$t&&(on=!1)},keys:null,before:function($t){rn.before=$t},after:function($t){rn.after=$t},pre:function($t){rn.pre=$t},post:function($t){rn.post=$t},stop:function(){ke=!1},block:function(){on=!1}};if(!ke)return Wt;function $e(){if("object"==typeof Wt.node&&null!==Wt.node){Wt.keys&&Wt.node_===Wt.node||(Wt.keys=ri(Wt.node)),Wt.isLeaf=0==Wt.keys.length;for(var $t=0;$t<Ee.length;$t++)if(Ee[$t].node_===tt){Wt.circular=Ee[$t];break}}else Wt.isLeaf=!0,Wt.keys=null;Wt.notLeaf=!Wt.isLeaf,Wt.notRoot=!Wt.isRoot}$e();var sr=z.call(Wt,Wt.node);return void 0!==sr&&Wt.update&&Wt.update(sr),rn.before&&rn.before.call(Wt,Wt.node),on&&("object"!=typeof Wt.node||null===Wt.node||Wt.circular||(Ee.push(Wt),$e(),co(Wt.keys,function($t,Cn){pe.push($t),rn.pre&&rn.pre.call(Wt,Wt.node[$t],$t);var lt=ze(Wt.node[$t]);te&&Nr.call(Wt.node,$t)&&(Wt.node[$t]=lt.node),lt.isLast=Cn==Wt.keys.length-1,lt.isFirst=0==Cn,rn.post&&rn.post.call(Wt,lt),pe.pop()}),Ee.pop()),rn.after&&rn.after.call(Wt,Wt.node)),Wt}(P).node}function Kn(P){if("object"==typeof P&&null!==P){var z;if(bi(P))z=[];else if("[object Date]"===Wi(P))z=new Date(P.getTime?P.getTime():P);else if("[object RegExp]"===Wi(P))z=new RegExp(P);else if("[object Error]"===Wi(P))z={message:P.message};else if(function(Ee){return"[object Boolean]"===Wi(Ee)}(P))z=new Boolean(P);else if(function(Ee){return"[object Number]"===Wi(Ee)}(P))z=new Number(P);else if(function(Ee){return"[object String]"===Wi(Ee)}(P))z=new String(P);else if(Object.create&&Object.getPrototypeOf)z=Object.create(Object.getPrototypeOf(P));else if(P.constructor===Object)z={};else{var pe=function(){};pe.prototype=P.constructor&&P.constructor.prototype||P.__proto__||{},z=new pe}return co(ri(P),function(Ee){z[Ee]=P[Ee]}),z}return P}Fn.prototype.get=function(P){for(var z=this.value,te=0;te<P.length;te++){var pe=P[te];if(!z||!Nr.call(z,pe)){z=void 0;break}z=z[pe]}return z},Fn.prototype.has=function(P){for(var z=this.value,te=0;te<P.length;te++){var pe=P[te];if(!z||!Nr.call(z,pe))return!1;z=z[pe]}return!0},Fn.prototype.set=function(P,z){for(var te=this.value,pe=0;pe<P.length-1;pe++){var Ee=P[pe];Nr.call(te,Ee)||(te[Ee]={}),te=te[Ee]}return te[P[pe]]=z,z},Fn.prototype.map=function(P){return Un(this.value,P,!0)},Fn.prototype.forEach=function(P){return this.value=Un(this.value,P,!1),this.value},Fn.prototype.reduce=function(P,z){var te=1===arguments.length,pe=te?this.value:z;return this.forEach(function(Ee){this.isRoot&&te||(pe=P.call(this,pe,Ee))}),pe},Fn.prototype.paths=function(){var P=[];return this.forEach(function(z){P.push(this.path)}),P},Fn.prototype.nodes=function(){var P=[];return this.forEach(function(z){P.push(this.node)}),P},Fn.prototype.clone=function(){var P=[],z=[];return function te(pe){for(var Ee=0;Ee<P.length;Ee++)if(P[Ee]===pe)return z[Ee];if("object"==typeof pe&&null!==pe){var ke=Kn(pe);return P.push(pe),z.push(ke),co(ri(pe),function(ze){ke[ze]=te(pe[ze])}),P.pop(),z.pop(),ke}return pe}(this.value)};var ri=Object.keys||function(P){var z=[];for(var te in P)z.push(te);return z};function Wi(P){return Object.prototype.toString.call(P)}var bi=Array.isArray||function(P){return"[object Array]"===Object.prototype.toString.call(P)},co=function(P,z){if(P.forEach)return P.forEach(z);for(var te=0;te<P.length;te++)z(P[te],te,P)};co(ri(Fn.prototype),function(P){$n[P]=function(z){var te=[].slice.call(arguments,1),pe=new Fn(z);return pe[P].apply(pe,te)}});var Nr=Object.hasOwnProperty||function(P,z){return z in P},ja=Tt.exports,yo=er;function er(P){if(!(this instanceof er))return new er(P);this._bbox=P||[1/0,1/0,-1/0,-1/0],this._valid=!!P}er.prototype.include=function(P){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],P[0]),this._bbox[1]=Math.min(this._bbox[1],P[1]),this._bbox[2]=Math.max(this._bbox[2],P[0]),this._bbox[3]=Math.max(this._bbox[3],P[1]),this},er.prototype.equals=function(P){var z;return z=P instanceof er?P.bbox():P,this._bbox[0]==z[0]&&this._bbox[1]==z[1]&&this._bbox[2]==z[2]&&this._bbox[3]==z[3]},er.prototype.center=function(P){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},er.prototype.union=function(P){var z;return this._valid=!0,z=P instanceof er?P.bbox():P,this._bbox[0]=Math.min(this._bbox[0],z[0]),this._bbox[1]=Math.min(this._bbox[1],z[1]),this._bbox[2]=Math.max(this._bbox[2],z[2]),this._bbox[3]=Math.max(this._bbox[3],z[3]),this},er.prototype.bbox=function(){return this._valid?this._bbox:null},er.prototype.contains=function(P){if(!P)return this._fastContains();if(!this._valid)return null;var z=P[0],te=P[1];return this._bbox[0]<=z&&this._bbox[1]<=te&&this._bbox[2]>=z&&this._bbox[3]>=te},er.prototype.intersect=function(P){return this._valid?(z=P instanceof er?P.bbox():P,!(this._bbox[0]>z[2]||this._bbox[2]<z[0]||this._bbox[3]<z[1]||this._bbox[1]>z[3])):null;var z},er.prototype._fastContains=function(){return this._valid?new Function("ll","return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]"):new Function("return null;")},er.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var nu=function(P){if(!P)return[];var z=St(Ke(P)),te=[];return z.features.forEach(function(pe){pe.geometry&&(te=te.concat(function(P){return function z(te){return Array.isArray(te)&&te.length&&"number"==typeof te[0]?[te]:te.reduce(function(pe,Ee){return Array.isArray(Ee)&&Array.isArray(Ee[0])?pe.concat(z(Ee)):(pe.push(Ee),pe)},[])}(P)}(pe.geometry.coordinates)))}),te},Im=ja,$a=yo,Di={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},zr=Object.keys(Di);function Js(P){for(var z=$a(),te=nu(P),pe=0;pe<te.length;pe++)z.include(te[pe]);return z}Me.exports=function(P){return Js(P).bbox()},Me.exports.polygon=function(P){return Js(P).polygon()},Me.exports.bboxify=function(P){return Im(P).map(function(z){z&&zr.some(function(te){return!!z[te]&&-1!==Di[te].indexOf(z.type)})&&(z.bbox=Js(z).bbox(),this.update(z))})};var Is=Zs(Me.exports),iu=-90;function ea(P,z){var te=iu,pe=90,Ee=iu,ke=90,ze=270,tt=-270;P.forEach(function(rn){var on=Is(rn),Wt=on[1],$e=on[3],sr=on[0],$t=on[2];Wt>te&&(te=Wt),$e<pe&&(pe=$e),$e>Ee&&(Ee=$e),Wt<ke&&(ke=Wt),sr<ze&&(ze=sr),$t>tt&&(tt=$t)});var zt=z;return te+zt.lat>85&&(zt.lat=85-te),Ee+zt.lat>90&&(zt.lat=90-Ee),pe+zt.lat<-85&&(zt.lat=-85-pe),ke+zt.lat<iu&&(zt.lat=iu-ke),ze+zt.lng<=-270&&(zt.lng+=360*Math.ceil(Math.abs(zt.lng)/360)),tt+zt.lng>=270&&(zt.lng-=360*Math.ceil(Math.abs(zt.lng)/360)),zt}function ta(P,z){var te=ea(P.map(function(pe){return pe.toGeoJSON()}),z);P.forEach(function(pe){var Ee,ke=pe.getCoordinates(),ze=function(zt){var rn={lng:zt[0]+te.lng,lat:zt[1]+te.lat};return[rn.lng,rn.lat]},tt=function(zt){return zt.map(function(rn){return ze(rn)})};pe.type===_n.POINT?Ee=ze(ke):pe.type===_n.LINE_STRING||pe.type===_n.MULTI_POINT?Ee=ke.map(ze):pe.type===_n.POLYGON||pe.type===_n.MULTI_LINE_STRING?Ee=ke.map(tt):pe.type===_n.MULTI_POLYGON&&(Ee=ke.map(function(zt){return zt.map(function(rn){return tt(rn)})})),pe.incomingCoords(Ee)})}var Br={onSetup:function(P){var z=this,te={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:P.featureIds||[]};return this.setSelected(te.initiallySelectedFeatureIds.filter(function(pe){return void 0!==z.getFeature(pe)})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),te},fireUpdate:function(){this.map.fire(Eo.UPDATE,{action:Ul.MOVE,features:this.getSelected().map(function(P){return P.toGeoJSON()})})},fireActionable:function(){var P=this,z=this.getSelected(),te=z.filter(function(tt){return P.isInstanceOf("MultiFeature",tt)}),pe=!1;if(z.length>1){pe=!0;var Ee=z[0].type.replace("Multi","");z.forEach(function(tt){tt.type.replace("Multi","")!==Ee&&(pe=!1)})}this.setActionableState({combineFeatures:pe,uncombineFeatures:te.length>0,trash:z.length>0})},getUniqueIds:function(P){return P.length?P.map(function(z){return z.properties.id}).filter(function(z){return void 0!==z}).reduce(function(z,te){return z.add(te),z},new Nn).values():[]},stopExtendedInteractions:function(P){P.boxSelectElement&&(P.boxSelectElement.parentNode&&P.boxSelectElement.parentNode.removeChild(P.boxSelectElement),P.boxSelectElement=null),this.map.dragPan.enable(),P.boxSelecting=!1,P.canBoxSelect=!1,P.dragMoving=!1,P.canDragMove=!1},onStop:function(){me.enable(this)},onMouseMove:function(P,z){return $l(z)&&P.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(P),!0},onMouseOut:function(P){return!P.dragMoving||this.fireUpdate()}};Br.onTap=Br.onClick=function(P,z){return Ds(z)?this.clickAnywhere(P,z):Va(fr.VERTEX)(z)?this.clickOnVertex(P,z):$l(z)?this.clickOnFeature(P,z):void 0},Br.clickAnywhere=function(P){var z=this,te=this.getSelectedIds();te.length&&(this.clearSelectedFeatures(),te.forEach(function(pe){return z.doRender(pe)})),me.enable(this),this.stopExtendedInteractions(P)},Br.clickOnVertex=function(P,z){this.changeMode(ti.DIRECT_SELECT,{featureId:z.featureTarget.properties.parent,coordPath:z.featureTarget.properties.coord_path,startPos:z.lngLat}),this.updateUIClasses({mouse:di.MOVE})},Br.startOnActiveFeature=function(P,z){this.stopExtendedInteractions(P),this.map.dragPan.disable(),this.doRender(z.featureTarget.properties.id),P.canDragMove=!0,P.dragMoveLocation=z.lngLat},Br.clickOnFeature=function(P,z){var te=this;me.disable(this),this.stopExtendedInteractions(P);var pe=gl(z),Ee=this.getSelectedIds(),ke=z.featureTarget.properties.id,ze=this.isSelected(ke);if(!pe&&ze&&this.getFeature(ke).type!==_n.POINT)return this.changeMode(ti.DIRECT_SELECT,{featureId:ke});ze&&pe?(this.deselect(ke),this.updateUIClasses({mouse:di.POINTER}),1===Ee.length&&me.enable(this)):!ze&&pe?(this.select(ke),this.updateUIClasses({mouse:di.MOVE})):ze||pe||(Ee.forEach(function(tt){return te.doRender(tt)}),this.setSelected(ke),this.updateUIClasses({mouse:di.MOVE})),this.doRender(ke)},Br.onMouseDown=function(P,z){return Qs(z)?this.startOnActiveFeature(P,z):this.drawConfig.boxSelect&&$u(z)?this.startBoxSelect(P,z):void 0},Br.startBoxSelect=function(P,z){this.stopExtendedInteractions(P),this.map.dragPan.disable(),P.boxSelectStartLocation=tu(z.originalEvent,this.map.getContainer()),P.canBoxSelect=!0},Br.onTouchStart=function(P,z){if(Qs(z))return this.startOnActiveFeature(P,z)},Br.onDrag=function(P,z){return P.canDragMove?this.dragMove(P,z):this.drawConfig.boxSelect&&P.canBoxSelect?this.whileBoxSelect(P,z):void 0},Br.whileBoxSelect=function(P,z){P.boxSelecting=!0,this.updateUIClasses({mouse:di.ADD}),P.boxSelectElement||(P.boxSelectElement=document.createElement("div"),P.boxSelectElement.classList.add(An.BOX_SELECT),this.map.getContainer().appendChild(P.boxSelectElement));var te=tu(z.originalEvent,this.map.getContainer()),pe=Math.min(P.boxSelectStartLocation.x,te.x),Ee=Math.max(P.boxSelectStartLocation.x,te.x),ke=Math.min(P.boxSelectStartLocation.y,te.y),ze=Math.max(P.boxSelectStartLocation.y,te.y),tt="translate("+pe+"px, "+ke+"px)";P.boxSelectElement.style.transform=tt,P.boxSelectElement.style.WebkitTransform=tt,P.boxSelectElement.style.width=Ee-pe+"px",P.boxSelectElement.style.height=ze-ke+"px"},Br.dragMove=function(P,z){P.dragMoving=!0,z.originalEvent.stopPropagation();var te={lng:z.lngLat.lng-P.dragMoveLocation.lng,lat:z.lngLat.lat-P.dragMoveLocation.lat};ta(this.getSelected(),te),P.dragMoveLocation=z.lngLat},Br.onTouchEnd=Br.onMouseUp=function(P,z){var te=this;if(P.dragMoving)this.fireUpdate();else if(P.boxSelecting){var pe=[P.boxSelectStartLocation,tu(z.originalEvent,this.map.getContainer())],Ee=this.featuresAt(null,pe,"click"),ke=this.getUniqueIds(Ee).filter(function(ze){return!te.isSelected(ze)});ke.length&&(this.select(ke),ke.forEach(function(ze){return te.doRender(ze)}),this.updateUIClasses({mouse:di.MOVE}))}this.stopExtendedInteractions(P)},Br.toDisplayFeatures=function(P,z,te){z.properties.active=this.isSelected(z.properties.id)?rr.ACTIVE:rr.INACTIVE,te(z),this.fireActionable(),z.properties.active===rr.ACTIVE&&z.geometry.type!==_n.POINT&&ee(z).forEach(te)},Br.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Br.onCombineFeatures=function(){var P=this.getSelected();if(!(0===P.length||P.length<2)){for(var z=[],te=[],pe=P[0].type.replace("Multi",""),Ee=0;Ee<P.length;Ee++){var ke=P[Ee];if(ke.type.replace("Multi","")!==pe)return;ke.type.includes("Multi")?ke.getCoordinates().forEach(function(tt){z.push(tt)}):z.push(ke.getCoordinates()),te.push(ke.toGeoJSON())}if(te.length>1){var ze=this.newFeature({type:_n.FEATURE,properties:te[0].properties,geometry:{type:"Multi"+pe,coordinates:z}});this.addFeature(ze),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([ze.id]),this.map.fire(Eo.COMBINE_FEATURES,{createdFeatures:[ze.toGeoJSON()],deletedFeatures:te})}this.fireActionable()}},Br.onUncombineFeatures=function(){var P=this,z=this.getSelected();if(0!==z.length){for(var te=[],pe=[],Ee=function(ze){var tt=z[ze];P.isInstanceOf("MultiFeature",tt)&&(tt.getFeatures().forEach(function(zt){P.addFeature(zt),zt.properties=tt.properties,te.push(zt.toGeoJSON()),P.select([zt.id])}),P.deleteFeature(tt.id,{silent:!0}),pe.push(tt.toGeoJSON()))},ke=0;ke<z.length;ke++)Ee(ke);te.length>1&&this.map.fire(Eo.UNCOMBINE_FEATURES,{createdFeatures:te,deletedFeatures:pe}),this.fireActionable()}};var Hu=Va(fr.VERTEX),na=Va(fr.MIDPOINT),Oo={fireUpdate:function(){this.map.fire(Eo.UPDATE,{action:Ul.CHANGE_COORDINATES,features:this.getSelected().map(function(P){return P.toGeoJSON()})})},fireActionable:function(P){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:P.selectedCoordPaths.length>0})},startDragging:function(P,z){this.map.dragPan.disable(),P.canDragMove=!0,P.dragMoveLocation=z.lngLat},stopDragging:function(P){this.map.dragPan.enable(),P.dragMoving=!1,P.canDragMove=!1,P.dragMoveLocation=null},onVertex:function(P,z){this.startDragging(P,z);var te=z.featureTarget.properties,pe=P.selectedCoordPaths.indexOf(te.coord_path);gl(z)||-1!==pe?gl(z)&&-1===pe&&P.selectedCoordPaths.push(te.coord_path):P.selectedCoordPaths=[te.coord_path];var Ee=this.pathsToCoordinates(P.featureId,P.selectedCoordPaths);this.setSelectedCoordinates(Ee)},onMidpoint:function(P,z){this.startDragging(P,z);var te=z.featureTarget.properties;P.feature.addCoordinate(te.coord_path,te.lng,te.lat),this.fireUpdate(),P.selectedCoordPaths=[te.coord_path]},pathsToCoordinates:function(P,z){return z.map(function(te){return{feature_id:P,coord_path:te}})},onFeature:function(P,z){0===P.selectedCoordPaths.length?this.startDragging(P,z):this.stopDragging(P)},dragFeature:function(P,z,te){ta(this.getSelected(),te),P.dragMoveLocation=z.lngLat},dragVertex:function(P,z,te){for(var pe=P.selectedCoordPaths.map(function(tt){return P.feature.getCoordinate(tt)}),Ee=ea(pe.map(function(tt){return{type:_n.FEATURE,properties:{},geometry:{type:_n.POINT,coordinates:tt}}}),te),ke=0;ke<pe.length;ke++){var ze=pe[ke];P.feature.updateCoordinate(P.selectedCoordPaths[ke],ze[0]+Ee.lng,ze[1]+Ee.lat)}},clickNoTarget:function(){this.changeMode(ti.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(ti.SIMPLE_SELECT)},clickActiveFeature:function(P){P.selectedCoordPaths=[],this.clearSelectedCoordinates(),P.feature.changed()},onSetup:function(P){var z=P.featureId,te=this.getFeature(z);if(!te)throw new Error("You must provide a featureId to enter direct_select mode");if(te.type===_n.POINT)throw new TypeError("direct_select mode doesn't handle point features");var pe={featureId:z,feature:te,dragMoveLocation:P.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:P.coordPath?[P.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(z,pe.selectedCoordPaths)),this.setSelected(z),me.disable(this),this.setActionableState({trash:!0}),pe},onStop:function(){me.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(P,z,te){P.featureId===z.properties.id?(z.properties.active=rr.ACTIVE,te(z),ee(z,{map:this.map,midpoints:!0,selectedPaths:P.selectedCoordPaths}).forEach(te)):(z.properties.active=rr.INACTIVE,te(z)),this.fireActionable(P)},onTrash:function(P){P.selectedCoordPaths.sort(function(z,te){return te.localeCompare(z,"en",{numeric:!0})}).forEach(function(z){return P.feature.removeCoordinate(z)}),this.fireUpdate(),P.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(P),!1===P.feature.isValid()&&(this.deleteFeature([P.featureId]),this.changeMode(ti.SIMPLE_SELECT,{}))},onMouseMove:function(P,z){var te=Qs(z),pe=Hu(z),Ee=na(z),ke=0===P.selectedCoordPaths.length;return this.updateUIClasses(te&&ke||pe&&!ke?{mouse:di.MOVE}:{mouse:di.NONE}),(pe||te||Ee)&&P.dragMoving&&this.fireUpdate(),this.stopDragging(P),!0},onMouseOut:function(P){return P.dragMoving&&this.fireUpdate(),!0}};Oo.onTouchStart=Oo.onMouseDown=function(P,z){return Hu(z)?this.onVertex(P,z):Qs(z)?this.onFeature(P,z):na(z)?this.onMidpoint(P,z):void 0},Oo.onDrag=function(P,z){if(!0===P.canDragMove){P.dragMoving=!0,z.originalEvent.stopPropagation();var te={lng:z.lngLat.lng-P.dragMoveLocation.lng,lat:z.lngLat.lat-P.dragMoveLocation.lat};P.selectedCoordPaths.length>0?this.dragVertex(P,z,te):this.dragFeature(P,z,te),P.dragMoveLocation=z.lngLat}},Oo.onClick=function(P,z){return Ds(z)?this.clickNoTarget(P,z):Qs(z)?this.clickActiveFeature(P,z):ls(z)?this.clickInactive(P,z):void this.stopDragging(P)},Oo.onTap=function(P,z){return Ds(z)?this.clickNoTarget(P,z):Qs(z)?this.clickActiveFeature(P,z):ls(z)?this.clickInactive(P,z):void 0},Oo.onTouchEnd=Oo.onMouseUp=function(P){P.dragMoving&&this.fireUpdate(),this.stopDragging(P)};var qo={};function nt(P,z){return!!P.lngLat&&P.lngLat.lng===z[0]&&P.lngLat.lat===z[1]}qo.onSetup=function(){var P=this.newFeature({type:_n.FEATURE,properties:{},geometry:{type:_n.POINT,coordinates:[]}});return this.addFeature(P),this.clearSelectedFeatures(),this.updateUIClasses({mouse:di.ADD}),this.activateUIButton(hr.POINT),this.setActionableState({trash:!0}),{point:P}},qo.stopDrawingAndRemove=function(P){this.deleteFeature([P.point.id],{silent:!0}),this.changeMode(ti.SIMPLE_SELECT)},qo.onTap=qo.onClick=function(P,z){this.updateUIClasses({mouse:di.MOVE}),P.point.updateCoordinate("",z.lngLat.lng,z.lngLat.lat),this.map.fire(Eo.CREATE,{features:[P.point.toGeoJSON()]}),this.changeMode(ti.SIMPLE_SELECT,{featureIds:[P.point.id]})},qo.onStop=function(P){this.activateUIButton(),P.point.getCoordinate().length||this.deleteFeature([P.point.id],{silent:!0})},qo.toDisplayFeatures=function(P,z,te){var pe=z.properties.id===P.point.id;if(z.properties.active=pe?rr.ACTIVE:rr.INACTIVE,!pe)return te(z)},qo.onTrash=qo.stopDrawingAndRemove,qo.onKeyUp=function(P,z){if(Hl(z)||Co(z))return this.stopDrawingAndRemove(P,z)};var Wo={onSetup:function(){var P=this.newFeature({type:_n.FEATURE,properties:{},geometry:{type:_n.POLYGON,coordinates:[[]]}});return this.addFeature(P),this.clearSelectedFeatures(),me.disable(this),this.updateUIClasses({mouse:di.ADD}),this.activateUIButton(hr.POLYGON),this.setActionableState({trash:!0}),{polygon:P,currentVertexPosition:0}},clickAnywhere:function(P,z){if(P.currentVertexPosition>0&&nt(z,P.polygon.coordinates[0][P.currentVertexPosition-1]))return this.changeMode(ti.SIMPLE_SELECT,{featureIds:[P.polygon.id]});this.updateUIClasses({mouse:di.ADD}),P.polygon.updateCoordinate("0."+P.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),P.currentVertexPosition++,P.polygon.updateCoordinate("0."+P.currentVertexPosition,z.lngLat.lng,z.lngLat.lat)},clickOnVertex:function(P){return this.changeMode(ti.SIMPLE_SELECT,{featureIds:[P.polygon.id]})},onMouseMove:function(P,z){P.polygon.updateCoordinate("0."+P.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),Ca(z)&&this.updateUIClasses({mouse:di.POINTER})}};Wo.onTap=Wo.onClick=function(P,z){return Ca(z)?this.clickOnVertex(P,z):this.clickAnywhere(P,z)},Wo.onKeyUp=function(P,z){Hl(z)?(this.deleteFeature([P.polygon.id],{silent:!0}),this.changeMode(ti.SIMPLE_SELECT)):Co(z)&&this.changeMode(ti.SIMPLE_SELECT,{featureIds:[P.polygon.id]})},Wo.onStop=function(P){this.updateUIClasses({mouse:di.NONE}),me.enable(this),this.activateUIButton(),void 0!==this.getFeature(P.polygon.id)&&(P.polygon.removeCoordinate("0."+P.currentVertexPosition),P.polygon.isValid()?this.map.fire(Eo.CREATE,{features:[P.polygon.toGeoJSON()]}):(this.deleteFeature([P.polygon.id],{silent:!0}),this.changeMode(ti.SIMPLE_SELECT,{},{silent:!0})))},Wo.toDisplayFeatures=function(P,z,te){var pe=z.properties.id===P.polygon.id;if(z.properties.active=pe?rr.ACTIVE:rr.INACTIVE,!pe)return te(z);if(0!==z.geometry.coordinates.length){var Ee=z.geometry.coordinates[0].length;if(!(Ee<3)){if(z.properties.meta=fr.FEATURE,te(ye(P.polygon.id,z.geometry.coordinates[0][0],"0.0",!1)),Ee>3){var ke=z.geometry.coordinates[0].length-3;te(ye(P.polygon.id,z.geometry.coordinates[0][ke],"0."+ke,!1))}if(Ee<=4&&(te({type:_n.FEATURE,properties:z.properties,geometry:{coordinates:[[z.geometry.coordinates[0][0][0],z.geometry.coordinates[0][0][1]],[z.geometry.coordinates[0][1][0],z.geometry.coordinates[0][1][1]]],type:_n.LINE_STRING}}),3===Ee))return;return te(z)}}},Wo.onTrash=function(P){this.deleteFeature([P.polygon.id],{silent:!0}),this.changeMode(ti.SIMPLE_SELECT)};var yr={onSetup:function(P){var z,te,pe=(P=P||{}).featureId,Ee="forward";if(pe){if(!(z=this.getFeature(pe)))throw new Error("Could not find a feature with the provided featureId");var ke=P.from;if(ke&&"Feature"===ke.type&&ke.geometry&&"Point"===ke.geometry.type&&(ke=ke.geometry),ke&&"Point"===ke.type&&ke.coordinates&&2===ke.coordinates.length&&(ke=ke.coordinates),!ke||!Array.isArray(ke))throw new Error("Please use the `from` property to indicate which point to continue the line from");var ze=z.coordinates.length-1;if(z.coordinates[ze][0]===ke[0]&&z.coordinates[ze][1]===ke[1])z.addCoordinate.apply(z,[te=ze+1].concat(z.coordinates[ze]));else{if(z.coordinates[0][0]!==ke[0]||z.coordinates[0][1]!==ke[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");Ee="backwards",z.addCoordinate.apply(z,[te=0].concat(z.coordinates[0]))}}else z=this.newFeature({type:_n.FEATURE,properties:{},geometry:{type:_n.LINE_STRING,coordinates:[]}}),te=0,this.addFeature(z);return this.clearSelectedFeatures(),me.disable(this),this.updateUIClasses({mouse:di.ADD}),this.activateUIButton(hr.LINE),this.setActionableState({trash:!0}),{line:z,currentVertexPosition:te,direction:Ee}},clickAnywhere:function(P,z){if(P.currentVertexPosition>0&&nt(z,P.line.coordinates[P.currentVertexPosition-1])||"backwards"===P.direction&&nt(z,P.line.coordinates[P.currentVertexPosition+1]))return this.changeMode(ti.SIMPLE_SELECT,{featureIds:[P.line.id]});this.updateUIClasses({mouse:di.ADD}),P.line.updateCoordinate(P.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),"forward"===P.direction?(P.currentVertexPosition++,P.line.updateCoordinate(P.currentVertexPosition,z.lngLat.lng,z.lngLat.lat)):P.line.addCoordinate(0,z.lngLat.lng,z.lngLat.lat)},clickOnVertex:function(P){return this.changeMode(ti.SIMPLE_SELECT,{featureIds:[P.line.id]})},onMouseMove:function(P,z){P.line.updateCoordinate(P.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),Ca(z)&&this.updateUIClasses({mouse:di.POINTER})}};yr.onTap=yr.onClick=function(P,z){if(Ca(z))return this.clickOnVertex(P,z);this.clickAnywhere(P,z)},yr.onKeyUp=function(P,z){Co(z)?this.changeMode(ti.SIMPLE_SELECT,{featureIds:[P.line.id]}):Hl(z)&&(this.deleteFeature([P.line.id],{silent:!0}),this.changeMode(ti.SIMPLE_SELECT))},yr.onStop=function(P){me.enable(this),this.activateUIButton(),void 0!==this.getFeature(P.line.id)&&(P.line.removeCoordinate(""+P.currentVertexPosition),P.line.isValid()?this.map.fire(Eo.CREATE,{features:[P.line.toGeoJSON()]}):(this.deleteFeature([P.line.id],{silent:!0}),this.changeMode(ti.SIMPLE_SELECT,{},{silent:!0})))},yr.onTrash=function(P){this.deleteFeature([P.line.id],{silent:!0}),this.changeMode(ti.SIMPLE_SELECT)},yr.toDisplayFeatures=function(P,z,te){var pe=z.properties.id===P.line.id;if(z.properties.active=pe?rr.ACTIVE:rr.INACTIVE,!pe)return te(z);z.geometry.coordinates.length<2||(z.properties.meta=fr.FEATURE,te(ye(P.line.id,z.geometry.coordinates["forward"===P.direction?z.geometry.coordinates.length-2:1],""+("forward"===P.direction?z.geometry.coordinates.length-2:1),!1)),te(z))};var uo={simple_select:Br,direct_select:Oo,draw_point:qo,draw_polygon:Wo,draw_line_string:yr},op={defaultMode:ti.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:ml,modes:uo,controls:{},userProperties:!1},Ma={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},jh={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function $h(P,z){return P.map(function(te){return te.source?te:Ea(te,{id:te.id+"."+z,source:"hot"===z?Pn.HOT:Pn.COLD})})}var or={exports:{}};!function(P,z){var te="__lodash_hash_undefined__",pe=9007199254740991,Ee="[object Arguments]",ke="[object Array]",ze="[object Boolean]",tt="[object Date]",zt="[object Error]",rn="[object Function]",on="[object Map]",Wt="[object Number]",$e="[object Object]",sr="[object Promise]",$t="[object RegExp]",Cn="[object Set]",lt="[object String]",Zi="[object WeakMap]",Li="[object ArrayBuffer]",si="[object DataView]",Hh=/^\[object .+?Constructor\]$/,Gu=/^(?:0|[1-9]\d*)$/,Qn={};Qn["[object Float32Array]"]=Qn["[object Float64Array]"]=Qn["[object Int8Array]"]=Qn["[object Int16Array]"]=Qn["[object Int32Array]"]=Qn["[object Uint8Array]"]=Qn["[object Uint8ClampedArray]"]=Qn["[object Uint16Array]"]=Qn["[object Uint32Array]"]=!0,Qn[Ee]=Qn[ke]=Qn[Li]=Qn[ze]=Qn[si]=Qn[tt]=Qn[zt]=Qn[rn]=Qn[on]=Qn[Wt]=Qn[$e]=Qn[$t]=Qn[Cn]=Qn[lt]=Qn[Zi]=!1;var As="object"==typeof global&&global&&global.Object===Object&&global,sp="object"==typeof self&&self&&self.Object===Object&&self,cs=As||sp||Function("return this")(),Mo=z&&!z.nodeType&&z,Gh=Mo&&P&&!P.nodeType&&P,qd=Gh&&Gh.exports===Mo,Ha=qd&&As.process,yl=function(){try{return Ha&&Ha.binding&&Ha.binding("util")}catch{}}(),Wd=yl&&yl.isTypedArray;function ia(Be,ot){for(var nn=-1,mn=null==Be?0:Be.length;++nn<mn;)if(ot(Be[nn],nn,Be))return!0;return!1}function $i(Be){var ot=-1,nn=Array(Be.size);return Be.forEach(function(mn,Or){nn[++ot]=[Or,mn]}),nn}function qu(Be){var ot=-1,nn=Array(Be.size);return Be.forEach(function(mn){nn[++ot]=mn}),nn}var Ga,qh,Zt,Gl=Array.prototype,Xo=Object.prototype,ru=cs["__core-js_shared__"],ql=Function.prototype.toString,us=Xo.hasOwnProperty,Zd=(Ga=/[^.]+$/.exec(ru&&ru.keys&&ru.keys.IE_PROTO||""))?"Symbol(src)_1."+Ga:"",Wl=Xo.toString,Wu=RegExp("^"+ql.call(us).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Zu=qd?cs.Buffer:void 0,vl=cs.Symbol,en=cs.Uint8Array,Xd=Xo.propertyIsEnumerable,Yd=Gl.splice,Qr=vl?vl.toStringTag:void 0,Xu=Object.getOwnPropertySymbols,Am=Zu?Zu.isBuffer:void 0,ar=(qh=Object.keys,Zt=Object,function(Be){return qh(Zt(Be))}),yc=Wa(cs,"DataView"),vc=Wa(cs,"Map"),bc=Wa(cs,"Promise"),Yo=Wa(cs,"Set"),Ta=Wa(cs,"WeakMap"),Da=Wa(Object,"create"),ap=Do(yc),Yu=Do(vc),Wh=Do(bc),Kd=Do(Yo),bl=Do(Ta),Ku=vl?vl.prototype:void 0,ra=Ku?Ku.valueOf:void 0;function ai(Be){var ot=-1,nn=null==Be?0:Be.length;for(this.clear();++ot<nn;){var mn=Be[ot];this.set(mn[0],mn[1])}}function et(Be){var ot=-1,nn=null==Be?0:Be.length;for(this.clear();++ot<nn;){var mn=Be[ot];this.set(mn[0],mn[1])}}function xl(Be){var ot=-1,nn=null==Be?0:Be.length;for(this.clear();++ot<nn;){var mn=Be[ot];this.set(mn[0],mn[1])}}function tn(Be){var ot=-1,nn=null==Be?0:Be.length;for(this.__data__=new xl;++ot<nn;)this.add(Be[ot])}function oa(Be){var ot=this.__data__=new et(Be);this.size=ot.size}function qa(Be,ot){for(var nn=Be.length;nn--;)if(Za(Be[nn][0],ot))return nn;return-1}function Qu(Be){return null==Be?void 0===Be?"[object Undefined]":"[object Null]":Qr&&Qr in Object(Be)?function(ot){var nn=us.call(ot,Qr),mn=ot[Qr];try{ot[Qr]=void 0;var Or=!0}catch{}var gi=Wl.call(ot);return Or&&(nn?ot[Qr]=mn:delete ot[Qr]),gi}(Be):Wl.call(Be)}function lp(Be){return Xl(Be)&&Qu(Be)==Ee}function cp(Be,ot,nn,mn,Or){return Be===ot||(null==Be||null==ot||!Xl(Be)&&!Xl(ot)?Be!=Be&&ot!=ot:function(gi,Ur,Lr,aa,Wr,Jr){var Qo=hs(gi),El=hs(Ur),Jo=Qo?ke:Ko(gi),Ni=El?ke:Ko(Ur),su=(Jo=Jo==Ee?$e:Jo)==$e,Jd=(Ni=Ni==Ee?$e:Ni)==$e,Ec=Jo==Ni;if(Ec&&Zl(gi)){if(!Zl(Ur))return!1;Qo=!0,su=!1}if(Ec&&!su)return Jr||(Jr=new oa),Qo||Xh(gi)?To(gi,Ur,Lr,aa,Wr,Jr):function(Hn,Mn,tr,kr,Cl,nr,es){switch(tr){case si:if(Hn.byteLength!=Mn.byteLength||Hn.byteOffset!=Mn.byteOffset)return!1;Hn=Hn.buffer,Mn=Mn.buffer;case Li:return!(Hn.byteLength!=Mn.byteLength||!nr(new en(Hn),new en(Mn)));case ze:case tt:case Wt:return Za(+Hn,+Mn);case zt:return Hn.name==Mn.name&&Hn.message==Mn.message;case $t:case lt:return Hn==Mn+"";case on:var la=$i;case Cn:if(la||(la=qu),Hn.size!=Mn.size&&!(1&kr))return!1;var _i=es.get(Hn);if(_i)return _i==Mn;kr|=2,es.set(Hn,Mn);var Xa=To(la(Hn),la(Mn),kr,Cl,nr,es);return es.delete(Hn),Xa;case"[object Symbol]":if(ra)return ra.call(Hn)==ra.call(Mn)}return!1}(gi,Ur,Jo,Lr,aa,Wr,Jr);if(!(1&Lr)){var pr=su&&us.call(gi,"__wrapped__"),Cc=Jd&&us.call(Ur,"__wrapped__");if(pr||Cc){var Kh=pr?gi.value():gi,Cr=Cc?Ur.value():Ur;return Jr||(Jr=new oa),Wr(Kh,Cr,Lr,aa,Jr)}}return!!Ec&&(Jr||(Jr=new oa),function(Hn,Mn,tr,kr,Cl,nr){var es=1&tr,la=ds(Hn),Ia=la.length;if(Ia!=ds(Mn).length&&!es)return!1;for(var Xa=Ia;Xa--;){var Mr=la[Xa];if(!(es?Mr in Mn:us.call(Mn,Mr)))return!1}var dn=nr.get(Hn);if(dn&&nr.get(Mn))return dn==Mn;var Bn=!0;nr.set(Hn,Mn),nr.set(Mn,Hn);for(var Tr=es;++Xa<Ia;){var So=Hn[Mr=la[Xa]],ko=Mn[Mr];if(kr)var vo=es?kr(ko,So,Mr,Mn,Hn,nr):kr(So,ko,Mr,Hn,Mn,nr);if(!(void 0===vo?So===ko||Cl(So,ko,tr,kr,nr):vo)){Bn=!1;break}Tr||(Tr="constructor"==Mr)}if(Bn&&!Tr){var ca=Hn.constructor,mr=Mn.constructor;ca==mr||!("constructor"in Hn)||!("constructor"in Mn)||"function"==typeof ca&&ca instanceof ca&&"function"==typeof mr&&mr instanceof mr||(Bn=!1)}return nr.delete(Hn),nr.delete(Mn),Bn}(gi,Ur,Lr,aa,Wr,Jr))}(Be,ot,nn,mn,cp,Or))}function To(Be,ot,nn,mn,Or,gi){var Ur=1&nn,Lr=Be.length,aa=ot.length;if(Lr!=aa&&!(Ur&&aa>Lr))return!1;var Wr=gi.get(Be);if(Wr&&gi.get(ot))return Wr==ot;var Jr=-1,Qo=!0,El=2&nn?new tn:void 0;for(gi.set(Be,ot),gi.set(ot,Be);++Jr<Lr;){var Jo=Be[Jr],Ni=ot[Jr];if(mn)var su=Ur?mn(Ni,Jo,Jr,ot,Be,gi):mn(Jo,Ni,Jr,Be,ot,gi);if(void 0!==su){if(su)continue;Qo=!1;break}if(El){if(!ia(ot,function(Jd,Ec){if(!El.has(Ec)&&(Jo===Jd||Or(Jo,Jd,nn,mn,gi)))return El.push(Ec)})){Qo=!1;break}}else if(Jo!==Ni&&!Or(Jo,Ni,nn,mn,gi)){Qo=!1;break}}return gi.delete(Be),gi.delete(ot),Qo}function ds(Be){return mn=Zh,Or=function Yh(Be){return null!=(ot=Be)&&ou(ot.length)&&!Ju(ot)?function wl(Be,ot){var nn=hs(Be),mn=!nn&&Qd(Be),Or=!nn&&!mn&&Zl(Be),gi=!nn&&!mn&&!Or&&Xh(Be),Ur=nn||mn||Or||gi,Lr=Ur?function(Jr,Qo){for(var El=-1,Jo=Array(Jr);++El<Jr;)Jo[El]=Qo(El);return Jo}(Be.length,String):[],aa=Lr.length;for(var Wr in Be)!ot&&!us.call(Be,Wr)||Ur&&("length"==Wr||Or&&("offset"==Wr||"parent"==Wr)||gi&&("buffer"==Wr||"byteLength"==Wr||"byteOffset"==Wr)||xc(Wr,aa))||Lr.push(Wr);return Lr}(Be):function sa(Be){if(nn=(ot=Be)&&ot.constructor,ot!==("function"==typeof nn&&nn.prototype||Xo))return ar(Be);var ot,nn,Or=[];for(var gi in Object(Be))us.call(Be,gi)&&"constructor"!=gi&&Or.push(gi);return Or}(Be);var ot}(ot=Be),hs(ot)?Or:function(gi,Ur){for(var Lr=-1,aa=Ur.length,Wr=gi.length;++Lr<aa;)gi[Wr+Lr]=Ur[Lr];return gi}(Or,mn(ot));var ot,mn,Or}function Ei(Be,ot){var nn,mn,Or=Be.__data__;return("string"==(mn=typeof(nn=ot))||"number"==mn||"symbol"==mn||"boolean"==mn?"__proto__"!==nn:null===nn)?Or["string"==typeof ot?"string":"hash"]:Or.map}function Wa(Be,ot){var mn,Or,nn=(mn=Be,Or=ot,mn?.[Or]);return function Sa(Be){return!(!wc(Be)||(ot=Be,Zd&&Zd in ot))&&(Ju(Be)?Wu:Hh).test(Do(Be));var ot}(nn)?nn:void 0}ai.prototype.clear=function(){this.__data__=Da?Da(null):{},this.size=0},ai.prototype.delete=function(Be){var ot=this.has(Be)&&delete this.__data__[Be];return this.size-=ot?1:0,ot},ai.prototype.get=function(Be){var ot=this.__data__;if(Da){var nn=ot[Be];return nn===te?void 0:nn}return us.call(ot,Be)?ot[Be]:void 0},ai.prototype.has=function(Be){var ot=this.__data__;return Da?void 0!==ot[Be]:us.call(ot,Be)},ai.prototype.set=function(Be,ot){var nn=this.__data__;return this.size+=this.has(Be)?0:1,nn[Be]=Da&&void 0===ot?te:ot,this},et.prototype.clear=function(){this.__data__=[],this.size=0},et.prototype.delete=function(Be){var ot=this.__data__,nn=qa(ot,Be);return!(nn<0||(nn==ot.length-1?ot.pop():Yd.call(ot,nn,1),--this.size,0))},et.prototype.get=function(Be){var ot=this.__data__,nn=qa(ot,Be);return nn<0?void 0:ot[nn][1]},et.prototype.has=function(Be){return qa(this.__data__,Be)>-1},et.prototype.set=function(Be,ot){var nn=this.__data__,mn=qa(nn,Be);return mn<0?(++this.size,nn.push([Be,ot])):nn[mn][1]=ot,this},xl.prototype.clear=function(){this.size=0,this.__data__={hash:new ai,map:new(vc||et),string:new ai}},xl.prototype.delete=function(Be){var ot=Ei(this,Be).delete(Be);return this.size-=ot?1:0,ot},xl.prototype.get=function(Be){return Ei(this,Be).get(Be)},xl.prototype.has=function(Be){return Ei(this,Be).has(Be)},xl.prototype.set=function(Be,ot){var nn=Ei(this,Be),mn=nn.size;return nn.set(Be,ot),this.size+=nn.size==mn?0:1,this},tn.prototype.add=tn.prototype.push=function(Be){return this.__data__.set(Be,te),this},tn.prototype.has=function(Be){return this.__data__.has(Be)},oa.prototype.clear=function(){this.__data__=new et,this.size=0},oa.prototype.delete=function(Be){var ot=this.__data__,nn=ot.delete(Be);return this.size=ot.size,nn},oa.prototype.get=function(Be){return this.__data__.get(Be)},oa.prototype.has=function(Be){return this.__data__.has(Be)},oa.prototype.set=function(Be,ot){var nn=this.__data__;if(nn instanceof et){var mn=nn.__data__;if(!vc||mn.length<199)return mn.push([Be,ot]),this.size=++nn.size,this;nn=this.__data__=new xl(mn)}return nn.set(Be,ot),this.size=nn.size,this};var Zh=Xu?function(Be){return null==Be?[]:(Be=Object(Be),function(ot,nn){for(var mn=-1,Or=null==ot?0:ot.length,gi=0,Ur=[];++mn<Or;){var Lr=ot[mn];nn(Lr)&&(Ur[gi++]=Lr)}return Ur}(Xu(Be),function(ot){return Xd.call(Be,ot)}))}:function(){return[]},Ko=Qu;function xc(Be,ot){return!!(ot=ot??pe)&&("number"==typeof Be||Gu.test(Be))&&Be>-1&&Be%1==0&&Be<ot}function Do(Be){if(null!=Be){try{return ql.call(Be)}catch{}try{return Be+""}catch{}}return""}function Za(Be,ot){return Be===ot||Be!=Be&&ot!=ot}(yc&&Ko(new yc(new ArrayBuffer(1)))!=si||vc&&Ko(new vc)!=on||bc&&Ko(bc.resolve())!=sr||Yo&&Ko(new Yo)!=Cn||Ta&&Ko(new Ta)!=Zi)&&(Ko=function(Be){var ot=Qu(Be),nn=ot==$e?Be.constructor:void 0,mn=nn?Do(nn):"";if(mn)switch(mn){case ap:return si;case Yu:return on;case Wh:return sr;case Kd:return Cn;case bl:return Zi}return ot});var Qd=lp(function(){return arguments}())?lp:function(Be){return Xl(Be)&&us.call(Be,"callee")&&!Xd.call(Be,"callee")},hs=Array.isArray,Zl=Am||function(){return!1};function Ju(Be){if(!wc(Be))return!1;var ot=Qu(Be);return ot==rn||"[object GeneratorFunction]"==ot||"[object AsyncFunction]"==ot||"[object Proxy]"==ot}function ou(Be){return"number"==typeof Be&&Be>-1&&Be%1==0&&Be<=pe}function wc(Be){var ot=typeof Be;return null!=Be&&("object"==ot||"function"==ot)}function Xl(Be){return null!=Be&&"object"==typeof Be}var Be,Xh=Wd?(Be=Wd,function(ot){return Be(ot)}):function(Be){return Xl(Be)&&ou(Be.length)&&!!Qn[Qu(Be)]};P.exports=function(Be,ot){return cp(Be,ot)}}(or,or.exports);var Kt=Zs(or.exports);function qt(P,z){return P.length===z.length&&JSON.stringify(P.map(function(te){return te}).sort())===JSON.stringify(z.map(function(te){return te}).sort())}var oi={Polygon:io,LineString:Yn,Point:as,MultiPolygon:hi,MultiLineString:hi,MultiPoint:hi},Zo=Object.freeze({__proto__:null,CommonSelectors:_l,constrainFeatureMovement:ea,createMidPoint:K,createSupplementaryPoints:ee,createVertex:ye,doubleClickZoom:me,euclideanDistance:Ts,featuresAt:Na,getFeatureAtAndSetCursors:za,isClick:ni,isEventAtCoordinates:nt,isTap:hl,mapEventToBoundingBox:Vl,ModeHandler:gc,moveFeatures:ta,sortFeatures:Hd,stringSetsAreEqual:qt,StringSet:Nn,theme:ml,toDenseArray:fl});function Vn(P){!function(P,z){var Ee,ke,te={options:P=function(Ee){void 0===Ee&&(Ee={});var ke=Ea(Ee);return Ee.controls||(ke.controls={}),ke.controls=Ea(!1===Ee.displayControlsDefault?jh:Ma,Ee.controls),(ke=Ea(op,ke)).styles=$h(ke.styles,"cold").concat($h(ke.styles,"hot")),ke}(P)};Ee=te,(ke=z).modes=ti,ke.getFeatureIdsAt=function(ze){return Na.click({point:ze},null,Ee).map(function(tt){return tt.properties.id})},ke.getSelectedIds=function(){return Ee.store.getSelectedIds()},ke.getSelected=function(){return{type:_n.FEATURE_COLLECTION,features:Ee.store.getSelectedIds().map(function(ze){return Ee.store.get(ze)}).map(function(ze){return ze.toGeoJSON()})}},ke.getSelectedPoints=function(){return{type:_n.FEATURE_COLLECTION,features:Ee.store.getSelectedCoordinates().map(function(ze){return{type:_n.FEATURE,properties:{},geometry:{type:_n.POINT,coordinates:ze.coordinates}}})}},ke.set=function(ze){if(void 0===ze.type||ze.type!==_n.FEATURE_COLLECTION||!Array.isArray(ze.features))throw new Error("Invalid FeatureCollection");var tt=Ee.store.createRenderBatch(),zt=Ee.store.getAllIds().slice(),rn=ke.add(ze),on=new Nn(rn);return(zt=zt.filter(function(Wt){return!on.has(Wt)})).length&&ke.delete(zt),tt(),rn},ke.add=function(ze){var tt=JSON.parse(JSON.stringify(Ue(ze))).features.map(function(zt){if(zt.id=zt.id||Ba(),null===zt.geometry)throw new Error("Invalid geometry: null");if(void 0===Ee.store.get(zt.id)||Ee.store.get(zt.id).type!==zt.geometry.type){var rn=oi[zt.geometry.type];if(void 0===rn)throw new Error("Invalid geometry type: "+zt.geometry.type+".");var on=new rn(Ee,zt);Ee.store.add(on)}else{var Wt=Ee.store.get(zt.id);Wt.properties=zt.properties,Kt(Wt.getCoordinates(),zt.geometry.coordinates)||Wt.incomingCoords(zt.geometry.coordinates)}return zt.id});return Ee.store.render(),tt},ke.get=function(ze){var tt=Ee.store.get(ze);if(tt)return tt.toGeoJSON()},ke.getAll=function(){return{type:_n.FEATURE_COLLECTION,features:Ee.store.getAll().map(function(ze){return ze.toGeoJSON()})}},ke.delete=function(ze){return Ee.store.delete(ze,{silent:!0}),ke.getMode()!==ti.DIRECT_SELECT||Ee.store.getSelectedIds().length?Ee.store.render():Ee.events.changeMode(ti.SIMPLE_SELECT,void 0,{silent:!0}),ke},ke.deleteAll=function(){return Ee.store.delete(Ee.store.getAllIds(),{silent:!0}),ke.getMode()===ti.DIRECT_SELECT?Ee.events.changeMode(ti.SIMPLE_SELECT,void 0,{silent:!0}):Ee.store.render(),ke},ke.changeMode=function(ze,tt){return void 0===tt&&(tt={}),ze===ti.SIMPLE_SELECT&&ke.getMode()===ti.SIMPLE_SELECT?(qt(tt.featureIds||[],Ee.store.getSelectedIds())||(Ee.store.setSelected(tt.featureIds,{silent:!0}),Ee.store.render()),ke):(ze===ti.DIRECT_SELECT&&ke.getMode()===ti.DIRECT_SELECT&&tt.featureId===Ee.store.getSelectedIds()[0]||Ee.events.changeMode(ze,tt,{silent:!0}),ke)},ke.getMode=function(){return Ee.events.getMode()},ke.trash=function(){return Ee.events.trash({silent:!0}),ke},ke.combineFeatures=function(){return Ee.events.combineFeatures({silent:!0}),ke},ke.uncombineFeatures=function(){return Ee.events.uncombineFeatures({silent:!0}),ke},ke.setFeatureProperty=function(ze,tt,zt){return Ee.store.setFeatureProperty(ze,tt,zt),ke},te.api=z=ke;var pe=Gd(te);z.onAdd=pe.onAdd,z.onRemove=pe.onRemove,z.types=hr,z.options=P}(P,this)}return Vn.modes=uo,Vn.constants=dl,Vn.lib=Zo,Vn}()},13:(Dm,gc,Zs)=>{"use strict";function Ri(e){return"function"==typeof e}function Uu(e){const n=e(i=>{Error.call(i),i.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Sm=Uu(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function m(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class pt{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const s of n)s.remove(this);else n.remove(this);const{initialTeardown:i}=this;if(Ri(i))try{i()}catch(s){t=s instanceof Sm?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{An(s)}catch(u){t=t??[],u instanceof Sm?t=[...t,...u.errors]:t.push(u)}}if(t)throw new Sm(t)}}add(t){var n;if(t&&t!==this)if(this.closed)An(t);else{if(t instanceof pt){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&m(n,t)}remove(t){const{_finalizers:n}=this;n&&m(n,t),t instanceof pt&&t._removeParent(this)}}pt.EMPTY=(()=>{const e=new pt;return e.closed=!0,e})();const Xs=pt.EMPTY;function ss(e){return e instanceof pt||e&&"closed"in e&&Ri(e.remove)&&Ri(e.add)&&Ri(e.unsubscribe)}function An(e){Ri(e)?e():e.unsubscribe()}const Pn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},di={setTimeout(e,t,...n){const{delegate:i}=di;return i?.setTimeout?i.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=di;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function hr(e){di.setTimeout(()=>{const{onUnhandledError:t}=Pn;if(!t)throw e;t(e)})}function _n(){}const ti=fr("C",void 0,void 0);function fr(e,t,n){return{kind:e,value:t,error:n}}let rr=null;function Ho(e){if(Pn.useDeprecatedSynchronousErrorHandling){const t=!rr;if(t&&(rr={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:i}=rr;if(rr=null,n)throw i}}else e()}class dl extends pt{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,ss(t)&&t.add(this)):this.destination=Vu}static create(t,n,i){return new Vl(t,n,i)}next(t){this.isStopped?Na(function Ul(e){return fr("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Na(function Eo(e){return fr("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Na(ti,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Ys=Function.prototype.bind;function Gt(e,t){return Ys.call(e,t)}class Hd{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(i){Nn(i)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(i){Nn(i)}else Nn(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){Nn(n)}}}class Vl extends dl{constructor(t,n,i){let r;if(super(),Ri(t)||!t)r={next:t??void 0,error:n??void 0,complete:i??void 0};else{let s;this&&Pn.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&Gt(t.next,s),error:t.error&&Gt(t.error,s),complete:t.complete&&Gt(t.complete,s)}):r=t}this.destination=new Hd(r)}}function Nn(e){Pn.useDeprecatedSynchronousErrorHandling?function ul(e){Pn.useDeprecatedSynchronousErrorHandling&&rr&&(rr.errorThrown=!0,rr.error=e)}(e):hr(e)}function Na(e,t){const{onStoppedNotification:n}=Pn;n&&di.setTimeout(()=>n(e,t))}const Vu={closed:!0,next:_n,error:function _o(e){throw e},complete:_n},za="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ts(e){return e}function hl(e){return 0===e.length?Ts:1===e.length?e[0]:function(n){return e.reduce((i,r)=>r(i),n)}}let ii=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const i=new e;return i.source=this,i.operator=n,i}subscribe(n,i,r){const s=function Ti(e){return e&&e instanceof dl||function Ba(e){return e&&Ri(e.next)&&Ri(e.error)&&Ri(e.complete)}(e)&&ss(e)}(n)?n:new Vl(n,i,r);return Ho(()=>{const{operator:u,source:h}=this;s.add(u?u.call(s,h):h?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return new(i=Yr(i))((r,s)=>{const u=new Vl({next:h=>{try{n(h)}catch(g){s(g),u.unsubscribe()}},error:s,complete:r});this.subscribe(u)})}_subscribe(n){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(n)}[za](){return this}pipe(...n){return hl(n)(this)}toPromise(n){return new(n=Yr(n))((i,r)=>{let s;this.subscribe(u=>s=u,u=>r(u),()=>i(s))})}}return e.create=t=>new e(t),e})();function Yr(e){var t;return null!==(t=e??Pn.Promise)&&void 0!==t?t:Promise}const as=Uu(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Yn=(()=>{class e extends ii{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const i=new io(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new as}next(n){Ho(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(n)}})}error(n){Ho(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){Ho(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Xs:(this.currentObservers=null,s.push(n),new pt(()=>{this.currentObservers=null,m(s,n)}))}_checkFinalizedStatuses(n){const{hasError:i,thrownError:r,isStopped:s}=this;i?n.error(r):s&&n.complete()}asObservable(){const n=new ii;return n.source=this,n}}return e.create=(t,n)=>new io(t,n),e})();class io extends Yn{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===i||i.call(n,t)}error(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===i||i.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,i;return null!==(i=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==i?i:Xs}}class Kr extends Yn{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:i}=this;if(t)throw n;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}function jl(e){return Ri(e?.lift)}function hi(e){return t=>{if(jl(t))return t.lift(function(n){try{return e(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function yn(e,t,n,i,r){return new fi(e,t,n,i,r)}class fi extends dl{constructor(t,n,i,r,s,u){super(t),this.onFinalize=s,this.shouldUnsubscribe=u,this._next=n?function(h){try{n(h)}catch(g){t.error(g)}}:super._next,this._error=r?function(h){try{r(h)}catch(g){t.error(g)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(h){t.error(h)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function pi(e,t){return hi((n,i)=>{let r=0;n.subscribe(yn(i,s=>{i.next(e.call(t,s,r++))}))})}function Ua(e,t,n,i){var u,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var h=e.length-1;h>=0;h--)(u=e[h])&&(s=(r<3?u(s):r>3?u(t,n,s):u(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s}function Co(e){return this instanceof Co?(this.v=e,this):new Co(e)}function Ss(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function Ds(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=e[s]&&function(u){return new Promise(function(h,g){!function r(s,u,h,g){Promise.resolve(g).then(function(x){s({value:x,done:h})},u)}(h,g,(u=e[s](u)).done,u.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Ke=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function St(e){return Ri(e?.then)}function Vt(e){return Ri(e[za])}function Tt(e){return Symbol.asyncIterator&&Ri(e?.[Symbol.asyncIterator])}function $n(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Un=function Fn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Kn(e){return Ri(e?.[Un])}function ri(e){return function _l(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},u("next"),u("throw"),u("return"),r[Symbol.asyncIterator]=function(){return this},r;function u(O){i[O]&&(r[O]=function(F){return new Promise(function($,G){s.push([O,F,$,G])>1||h(O,F)})})}function h(O,F){try{!function g(O){O.value instanceof Co?Promise.resolve(O.value.v).then(x,C):S(s[0][2],O)}(i[O](F))}catch($){S(s[0][3],$)}}function x(O){h("next",O)}function C(O){h("throw",O)}function S(O,F){O(F),s.shift(),s.length&&h(s[0][0],s[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:i,done:r}=yield Co(n.read());if(r)return yield Co(void 0);yield yield Co(i)}}finally{n.releaseLock()}})}function Wi(e){return Ri(e?.getReader)}function bi(e){if(e instanceof ii)return e;if(null!=e){if(Vt(e))return function co(e){return new ii(t=>{const n=e[za]();if(Ri(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Ke(e))return function Nr(e){return new ii(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(St(e))return function ja(e){return new ii(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,hr)})}(e);if(Tt(e))return er(e);if(Kn(e))return function yo(e){return new ii(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Wi(e))return function nu(e){return er(ri(e))}(e)}throw $n(e)}function er(e){return new ii(t=>{(function Im(e,t){var n,i,r,s;return function Va(e,t,n,i){return new(n||(n=Promise))(function(s,u){function h(C){try{x(i.next(C))}catch(S){u(S)}}function g(C){try{x(i.throw(C))}catch(S){u(S)}}function x(C){C.done?s(C.value):function r(s){return s instanceof n?s:new n(function(u){u(s)})}(C.value).then(h,g)}x((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Ss(e);!(i=yield n.next()).done;)if(t.next(i.value),t.closed)return}catch(u){r={error:u}}finally{try{i&&!i.done&&(s=n.return)&&(yield s.call(n))}finally{if(r)throw r.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function $a(e,t,n,i=0,r=!1){const s=t.schedule(function(){n(),r?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(s),!r)return s}function zr(e,t,n=1/0){return Ri(t)?zr((i,r)=>pi((s,u)=>t(i,s,r,u))(bi(e(i,r))),n):("number"==typeof t&&(n=t),hi((i,r)=>function Di(e,t,n,i,r,s,u,h){const g=[];let x=0,C=0,S=!1;const O=()=>{S&&!g.length&&!x&&t.complete()},F=G=>x<i?$(G):g.push(G),$=G=>{s&&t.next(G),x++;let Y=!1;bi(n(G,C++)).subscribe(yn(t,J=>{r?.(J),s?F(J):t.next(J)},()=>{Y=!0},void 0,()=>{if(Y)try{for(x--;g.length&&x<i;){const J=g.shift();u?$a(t,u,()=>$(J)):$(J)}O()}catch(J){t.error(J)}}))};return e.subscribe(yn(t,F,()=>{S=!0,O()})),()=>{h?.()}}(i,r,e,n)))}function Js(e=1/0){return zr(Ts,e)}const Is=new ii(e=>e.complete());function ta(e){return e&&Ri(e.schedule)}function Br(e){return e[e.length-1]}function Hu(e){return Ri(Br(e))?e.pop():void 0}function na(e){return ta(Br(e))?e.pop():void 0}function qo(e,t=0){return hi((n,i)=>{n.subscribe(yn(i,r=>$a(i,e,()=>i.next(r),t),()=>$a(i,e,()=>i.complete(),t),r=>$a(i,e,()=>i.error(r),t)))})}function nt(e,t=0){return hi((n,i)=>{i.add(e.schedule(()=>n.subscribe(i),t))})}function Ma(e,t){if(!e)throw new Error("Iterable cannot be null");return new ii(n=>{$a(n,t,()=>{const i=e[Symbol.asyncIterator]();$a(n,t,()=>{i.next().then(r=>{r.done?n.complete():n.next(r.value)})},0,!0)})})}function or(e,t){return t?function $h(e,t){if(null!=e){if(Vt(e))return function Wo(e,t){return bi(e).pipe(nt(t),qo(t))}(e,t);if(Ke(e))return function uo(e,t){return new ii(n=>{let i=0;return t.schedule(function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())})})}(e,t);if(St(e))return function yr(e,t){return bi(e).pipe(nt(t),qo(t))}(e,t);if(Tt(e))return Ma(e,t);if(Kn(e))return function op(e,t){return new ii(n=>{let i;return $a(n,t,()=>{i=e[Un](),$a(n,t,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(u){return void n.error(u)}s?n.complete():n.next(r)},0,!0)}),()=>Ri(i?.return)&&i.return()})}(e,t);if(Wi(e))return function jh(e,t){return Ma(ri(e),t)}(e,t)}throw $n(e)}(e,t):bi(e)}function Kt(...e){const t=na(e),n=function Oo(e,t){return"number"==typeof Br(e)?e.pop():t}(e,1/0),i=e;return i.length?1===i.length?bi(i[0]):Js(n)(or(i,t)):Is}function qt(...e){return or(e,na(e))}function oi(e={}){const{connector:t=(()=>new Yn),resetOnError:n=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=e;return s=>{let u,h,g,x=0,C=!1,S=!1;const O=()=>{h?.unsubscribe(),h=void 0},F=()=>{O(),u=g=void 0,C=S=!1},$=()=>{const G=u;F(),G?.unsubscribe()};return hi((G,Y)=>{x++,!S&&!C&&O();const J=g=g??t();Y.add(()=>{x--,0===x&&!S&&!C&&(h=Zo($,r))}),J.subscribe(Y),!u&&x>0&&(u=new Vl({next:Q=>J.next(Q),error:Q=>{S=!0,O(),h=Zo(F,n,Q),J.error(Q)},complete:()=>{C=!0,O(),h=Zo(F,i),J.complete()}}),bi(G).subscribe(u))})(s)}}function Zo(e,t,...n){if(!0===t)return void e();if(!1===t)return;const i=new Vl({next:()=>{i.unsubscribe(),e()}});return bi(t(...n)).subscribe(i)}function qr(e,t){return hi((n,i)=>{let r=null,s=0,u=!1;const h=()=>u&&!r&&i.complete();n.subscribe(yn(i,g=>{r?.unsubscribe();let x=0;const C=s++;bi(e(g,C)).subscribe(r=yn(i,S=>i.next(t?t(g,S,C,x++):S),()=>{r=null,h()}))},()=>{u=!0,h()}))})}function Vn(e,t=Ts){return e=e??P,hi((n,i)=>{let r,s=!0;n.subscribe(yn(i,u=>{const h=t(u);(s||!e(r,h))&&(s=!1,r=h,i.next(u))}))})}function P(e,t){return e===t}function z(e){for(let t in e)if(e[t]===z)return t;throw Error("Could not find renamed property on target object.")}function te(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function pe(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(pe).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Ee(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const ke=z({__forward_ref__:z});function ze(e){return e.__forward_ref__=ze,e.toString=function(){return pe(this())},e}function tt(e){return zt(e)?e():e}function zt(e){return"function"==typeof e&&e.hasOwnProperty(ke)&&e.__forward_ref__===ze}function rn(e){return e&&!!e.\u0275providers}const Wt="https://g.co/ng/security#xss";class $e extends Error{constructor(t,n){super(function sr(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function $t(e){return"string"==typeof e?e:null==e?"":String(e)}function Li(e,t){throw new $e(-201,!1)}function ia(e,t){null==e&&function $i(e,t,n,i){throw new Error(`ASSERTION ERROR: ${e}`+(null==i?"":` [Expected=> ${n} ${i} ${t} <=Actual]`))}(t,e,null,"!=")}function Zt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Er(e){return{providers:e.providers||[],imports:e.imports||[]}}function Xo(e){return ql(e,Wl)||ql(e,Zu)}function ql(e,t){return e.hasOwnProperty(t)?e[t]:null}function Zd(e){return e&&(e.hasOwnProperty(Wu)||e.hasOwnProperty(vl))?e[Wu]:null}const Wl=z({\u0275prov:z}),Wu=z({\u0275inj:z}),Zu=z({ngInjectableDef:z}),vl=z({ngInjectorDef:z});var en=(()=>((en=en||{})[en.Default=0]="Default",en[en.Host=1]="Host",en[en.Self=2]="Self",en[en.SkipSelf=4]="SkipSelf",en[en.Optional=8]="Optional",en))();let Xd;function Qr(e){const t=Xd;return Xd=e,t}function Xu(e,t,n){const i=Xo(e);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&en.Optional?null:void 0!==t?t:void Li(pe(e))}const ar=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Yo={},Ta="__NG_DI_FLAG__",Da="ngTempTokenPath",Yu=/\n/gm,Kd="__source";let bl;function ra(e){const t=bl;return bl=e,t}function ai(e,t=en.Default){if(void 0===bl)throw new $e(-203,!1);return null===bl?Xu(e,void 0,t):bl.get(e,t&en.Optional?null:void 0,t)}function et(e,t=en.Default){return(function Yd(){return Xd}()||ai)(tt(e),t)}function tn(e,t=en.Default){return et(e,oa(t))}function oa(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function wl(e){const t=[];for(let n=0;n<e.length;n++){const i=tt(e[n]);if(Array.isArray(i)){if(0===i.length)throw new $e(900,!1);let r,s=en.Default;for(let u=0;u<i.length;u++){const h=i[u],g=Qu(h);"number"==typeof g?-1===g?r=h.token:s|=g:r=h}t.push(et(r,s))}else t.push(et(i))}return t}function qa(e,t){return e[Ta]=t,e.prototype[Ta]=t,e}function Qu(e){return e[Ta]}function Sa(e){return{toString:e}.toString()}var sa=(()=>((sa=sa||{})[sa.OnPush=0]="OnPush",sa[sa.Default=1]="Default",sa))(),To=(()=>{return(e=To||(To={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",To;var e})();const ds={},Ei=[],Wa=z({\u0275cmp:z}),Zh=z({\u0275dir:z}),Ko=z({\u0275pipe:z}),xc=z({\u0275mod:z}),Do=z({\u0275fac:z}),Za=z({__NG_ELEMENT_ID__:z}),Qd=z({__NG_ENV_ID__:z});function hs(e,t,n){let i=e.length;for(;;){const r=e.indexOf(t,n);if(-1===r)return r;if(0===r||e.charCodeAt(r-1)<=32){const s=t.length;if(r+s===i||e.charCodeAt(r+s)<=32)return r}n=r+1}}function Zl(e,t,n){let i=0;for(;i<n.length;){const r=n[i];if("number"==typeof r){if(0!==r)break;i++;const s=n[i++],u=n[i++],h=n[i++];e.setAttribute(t,u,h,s)}else{const s=r,u=n[++i];ou(s)?e.setProperty(t,s,u):e.setAttribute(t,s,u),i++}}return i}function Ju(e){return 3===e||4===e||6===e}function ou(e){return 64===e.charCodeAt(0)}function wc(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?n=r:0===n||Xl(e,n,r,null,-1===n||2===n?t[++i]:null)}}return e}function Xl(e,t,n,i,r){let s=0,u=e.length;if(-1===t)u=-1;else for(;s<e.length;){const h=e[s++];if("number"==typeof h){if(h===t){u=-1;break}if(h>t){u=s-1;break}}}for(;s<e.length;){const h=e[s];if("number"==typeof h)break;if(h===n){if(null===i)return void(null!==r&&(e[s+1]=r));if(i===e[s+1])return void(e[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==u&&(e.splice(u,0,t),s=u+1),e.splice(s++,0,n),null!==i&&e.splice(s++,0,i),null!==r&&e.splice(s++,0,r)}const Xh="ng-template";function Yh(e,t,n){let i=0,r=!0;for(;i<e.length;){let s=e[i++];if("string"==typeof s&&r){const u=e[i++];if(n&&"class"===s&&-1!==hs(u.toLowerCase(),t,0))return!0}else{if(1===s){for(;i<e.length&&"string"==typeof(s=e[i++]);)if(s.toLowerCase()===t)return!0;return!1}"number"==typeof s&&(r=!1)}}return!1}function Be(e){return 4===e.type&&e.value!==Xh}function ot(e,t,n){return t===(4!==e.type||n?e.value:Xh)}function nn(e,t,n){let i=4;const r=e.attrs||[],s=function Lr(e){for(let t=0;t<e.length;t++)if(Ju(e[t]))return t;return e.length}(r);let u=!1;for(let h=0;h<t.length;h++){const g=t[h];if("number"!=typeof g){if(!u)if(4&i){if(i=2|1&i,""!==g&&!ot(e,g,n)||""===g&&1===t.length){if(mn(i))return!1;u=!0}}else{const x=8&i?g:t[++h];if(8&i&&null!==e.attrs){if(!Yh(e.attrs,x,n)){if(mn(i))return!1;u=!0}continue}const S=Or(8&i?"class":g,r,Be(e),n);if(-1===S){if(mn(i))return!1;u=!0;continue}if(""!==x){let O;O=S>s?"":r[S+1].toLowerCase();const F=8&i?O:null;if(F&&-1!==hs(F,x,0)||2&i&&x!==O){if(mn(i))return!1;u=!0}}}}else{if(!u&&!mn(i)&&!mn(g))return!1;if(u&&mn(g))continue;u=!1,i=g|1&i}}return mn(i)||u}function mn(e){return 0==(1&e)}function Or(e,t,n,i){if(null===t)return-1;let r=0;if(i||!n){let s=!1;for(;r<t.length;){const u=t[r];if(u===e)return r;if(3===u||6===u)s=!0;else{if(1===u||2===u){let h=t[++r];for(;"string"==typeof h;)h=t[++r];continue}if(4===u)break;if(0===u){r+=4;continue}}r+=s?1:2}return-1}return function aa(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const i=e[n];if("number"==typeof i)return-1;if(i===t)return n;n++}return-1}(t,e)}function gi(e,t,n=!1){for(let i=0;i<t.length;i++)if(nn(e,t[i],n))return!0;return!1}function Wr(e,t){e:for(let n=0;n<t.length;n++){const i=t[n];if(e.length===i.length){for(let r=0;r<e.length;r++)if(e[r]!==i[r])continue e;return!0}}return!1}function Jr(e,t){return e?":not("+t.trim()+")":t}function Qo(e){let t=e[0],n=1,i=2,r="",s=!1;for(;n<e.length;){let u=e[n];if("string"==typeof u)if(2&i){const h=e[++n];r+="["+u+(h.length>0?'="'+h+'"':"")+"]"}else 8&i?r+="."+u:4&i&&(r+=" "+u);else""!==r&&!mn(u)&&(t+=Jr(s,r),r=""),i=u,s=s||!mn(i);n++}return""!==r&&(t+=Jr(s,r)),t}function Ni(e){return Sa(()=>{const t=es(e),n={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===sa.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||To.Emulated,styles:e.styles||Ei,_:null,schemas:e.schemas||null,tView:null,id:""};la(n);const i=e.dependencies;return n.directiveDefs=Ia(i,!1),n.pipeDefs=Ia(i,!0),n.id=function Xa(e){let t=0;const n=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const r of n)t=Math.imul(31,t)+r.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(n),n})}function Jd(e){return Mn(e)||tr(e)}function Ec(e){return null!==e}function pr(e){return Sa(()=>({type:e.type,bootstrap:e.bootstrap||Ei,declarations:e.declarations||Ei,imports:e.imports||Ei,exports:e.exports||Ei,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Kh(e,t){if(null==e)return ds;const n={};for(const i in e)if(e.hasOwnProperty(i)){let r=e[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),n[r]=i,t&&(t[r]=s)}return n}function Cr(e){return Sa(()=>{const t=es(e);return la(t),t})}function Hn(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function Mn(e){return e[Wa]||null}function tr(e){return e[Zh]||null}function kr(e){return e[Ko]||null}function nr(e,t){const n=e[xc]||null;if(!n&&!0===t)throw new Error(`Type ${pe(e)} does not have '\u0275mod' property.`);return n}function es(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||ds,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||Ei,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Kh(e.inputs,t),outputs:Kh(e.outputs)}}function la(e){e.features?.forEach(t=>t(e))}function Ia(e,t){if(!e)return null;const n=t?kr:Jd;return()=>("function"==typeof e?e():e).map(i=>n(i)).filter(Ec)}const Mr=0,dn=1,Bn=2,Tr=3,So=4,ko=5,vo=6,ca=7,mr=8,Ml=9,Mc=10,Jn=11,Tc=12,Qh=13,Dc=14,Ft=15,Ps=16,ed=17,ua=18,Sc=19,Io=20,Ya=21,Ka=22,eh=23,td=24,Si=25,au=1,up=2,Yl=7,Tl=9,Ro=11;function fs(e){return Array.isArray(e)&&"object"==typeof e[au]}function Lo(e){return Array.isArray(e)&&!0===e[au]}function id(e){return 0!=(4&e.flags)}function Ic(e){return e.componentOffset>-1}function ef(e){return 1==(1&e.flags)}function Aa(e){return!!e.template}function dp(e){return 0!=(512&e[Bn])}function Ac(e,t){return e.hasOwnProperty(Do)?e[Do]:null}let __=ar.WeakRef??class G0{constructor(t){this.ref=t}deref(){return this.ref}},y_=0,Ql=null,fp=!1;function bo(e){const t=Ql;return Ql=e,t}class pp{constructor(){this.id=y_++,this.ref=function km(e){return new __(e)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[t,n]of this.producers){const i=n.producerNode.deref();if(void 0!==i&&n.atTrackingVersion===this.trackingVersion){if(i.producerPollStatus(n.seenValueVersion))return!0}else this.producers.delete(t),i?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const t=fp;fp=!0;try{for(const[n,i]of this.consumers){const r=i.consumerNode.deref();void 0!==r&&r.trackingVersion===i.atTrackingVersion?r.onConsumerDependencyMayHaveChanged():(this.consumers.delete(n),r?.producers.delete(this.id))}}finally{fp=t}}producerAccessed(){if(fp)throw new Error("");if(null===Ql)return;let t=Ql.producers.get(this.id);void 0===t?(t={consumerNode:Ql.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:Ql.trackingVersion},Ql.producers.set(this.id,t),this.consumers.set(Ql.id,t)):(t.seenValueVersion=this.valueVersion,t.atTrackingVersion=Ql.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==Ql?.consumerAllowSignalWrites}producerPollStatus(t){return this.valueVersion!==t||(this.onProducerUpdateValueVersion(),this.valueVersion!==t)}}let w=null;const ne=()=>{};class oe extends pp{constructor(t,n,i){super(),this.watch=t,this.schedule=n,this.dirty=!1,this.cleanupFn=ne,this.registerOnCleanup=r=>{this.cleanupFn=r},this.consumerAllowSignalWrites=i}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const t=bo(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=ne,this.watch(this.registerOnCleanup)}finally{bo(t)}}cleanup(){this.cleanupFn()}}class ae{constructor(t,n,i){this.previousValue=t,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function se(){return le}function le(e){return e.type.prototype.ngOnChanges&&(e.setInput=re),W}function W(){const e=_e(this),t=e?.current;if(t){const n=e.previous;if(n===ds)e.previous=t;else for(let i in t)n[i]=t[i];e.current=null,this.ngOnChanges(t)}}function re(e,t,n,i){const r=this.declaredInputs[n],s=_e(e)||function Te(e,t){return e[fe]=t}(e,{previous:ds,current:null}),u=s.current||(s.current={}),h=s.previous,g=h[r];u[r]=new ae(g&&g.currentValue,t,h===ds),e[i]=t}se.ngInherit=!0;const fe="__ngSimpleChanges__";function _e(e){return e[fe]||null}const Le=function(e,t,n){};function ht(e){for(;Array.isArray(e);)e=e[Mr];return e}function dt(e,t){return ht(t[e])}function He(e,t){return ht(t[e.index])}function qe(e,t){return e.data[t]}function _t(e,t){const n=t[e];return fs(n)?n:n[Mr]}function kn(e,t){return null==t?null:e[t]}function ln(e){e[ed]=0}function Sn(e){1024&e[Bn]||(e[Bn]|=1024,li(e,1))}function ui(e){1024&e[Bn]&&(e[Bn]&=-1025,li(e,-1))}function li(e,t){let n=e[Tr];if(null===n)return;n[ko]+=t;let i=n;for(n=n[Tr];null!==n&&(1===t&&1===i[ko]||-1===t&&0===i[ko]);)n[ko]+=t,i=n,n=n[Tr]}const cn={lFrame:ad(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Il(){return cn.bindingsEnabled}function cr(){return null!==cn.skipHydrationRootTNode}function vt(){return cn.lFrame.lView}function Ii(){return cn.lFrame.tView}function Rs(e){return cn.lFrame.contextLView=e,e[mr]}function Pa(e){return cn.lFrame.contextLView=null,e}function Vr(){let e=Pc();for(;null!==e&&64===e.type;)e=e.parent;return e}function Pc(){return cn.lFrame.currentTNode}function Oa(e,t){const n=cn.lFrame;n.currentTNode=e,n.isParent=t}function od(){return cn.lFrame.isParent}function tf(){cn.lFrame.isParent=!1}function Ls(){const e=cn.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function nh(){return cn.lFrame.bindingIndex++}function ec(e){const t=cn.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function F1(e,t){const n=cn.lFrame;n.bindingIndex=n.bindingRootIndex=e,Z0(t)}function Z0(e){cn.lFrame.currentDirectiveIndex=e}function X0(e){const t=cn.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}function z1(){return cn.lFrame.currentQueryIndex}function Lm(e){cn.lFrame.currentQueryIndex=e}function Fm(e){const t=e[dn];return 2===t.type?t.declTNode:1===t.type?e[vo]:null}function nf(e,t,n){if(n&en.SkipSelf){let r=t,s=e;for(;!(r=r.parent,null!==r||n&en.Host||(r=Fm(s),null===r||(s=s[Dc],10&r.type))););if(null===r)return!1;t=r,e=s}const i=cn.lFrame=tc();return i.currentTNode=t,i.lView=e,!0}function Oc(e){const t=tc(),n=e[dn];cn.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function tc(){const e=cn.lFrame,t=null===e?null:e.child;return null===t?ad(e):t}function ad(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function ld(){const e=cn.lFrame;return cn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const ih=ld;function Y0(){const e=ld();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function ka(){return cn.lFrame.selectedIndex}function rh(e){cn.lFrame.selectedIndex=e}function ro(){const e=cn.lFrame;return qe(e.tView,e.selectedIndex)}let cd=!0;function rf(){return cd}function Ao(e){cd=e}function Nm(e,t){for(let n=t.directiveStart,i=t.directiveEnd;n<i;n++){const s=e.data[n].type.prototype,{ngAfterContentInit:u,ngAfterContentChecked:h,ngAfterViewInit:g,ngAfterViewChecked:x,ngOnDestroy:C}=s;u&&(e.contentHooks??=[]).push(-n,u),h&&((e.contentHooks??=[]).push(n,h),(e.contentCheckHooks??=[]).push(n,h)),g&&(e.viewHooks??=[]).push(-n,g),x&&((e.viewHooks??=[]).push(n,x),(e.viewCheckHooks??=[]).push(n,x)),null!=C&&(e.destroyHooks??=[]).push(n,C)}}function Ja(e,t,n){gp(e,t,3,n)}function mp(e,t,n,i){(3&e[Bn])===n&&gp(e,t,n,i)}function ud(e,t){let n=e[Bn];(3&n)===t&&(n&=8191,n+=1,e[Bn]=n)}function gp(e,t,n,i){const s=i??-1,u=t.length-1;let h=0;for(let g=void 0!==i?65535&e[ed]:0;g<u;g++)if("number"==typeof t[g+1]){if(h=t[g],null!=i&&h>=i)break}else t[g]<0&&(e[ed]+=65536),(h<s||-1==s)&&(K0(e,n,t,g),e[ed]=(4294901760&e[ed])+g+2),g++}function oh(e,t){Le(4,e,t);const n=bo(null);try{t.call(e)}finally{bo(n),Le(5,e,t)}}function K0(e,t,n,i){const r=n[i]<0,s=n[i+1],h=e[r?-n[i]:n[i]];r?e[Bn]>>13<e[ed]>>16&&(3&e[Bn])===t&&(e[Bn]+=8192,oh(h,s)):oh(h,s)}const dd=-1;class _p{constructor(t,n,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}}function Q0(e){return e!==dd}function ah(e){return 32767&e}function da(e,t){let n=function Um(e){return e>>16}(e),i=t;for(;n>0;)i=i[Dc],n--;return i}let sf=!0;function ts(e){const t=sf;return sf=e,t}const b_=255,eo=5;let j1=0;const el={};function x_(e,t){const n=ev(e,t);if(-1!==n)return n;const i=t[dn];i.firstCreatePass&&(e.injectorIndex=t.length,J0(i.data,e),J0(t,null),J0(i.blueprint,null));const r=w_(e,t),s=e.injectorIndex;if(Q0(r)){const u=ah(r),h=da(r,t),g=h[dn].data;for(let x=0;x<8;x++)t[s+x]=h[u+x]|g[u+x]}return t[s+8]=r,s}function J0(e,t){e.push(0,0,0,0,0,0,0,0,t)}function ev(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function w_(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,i=null,r=t;for(;null!==r;){if(i=G1(r),null===i)return dd;if(n++,r=r[Dc],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return dd}function hd(e,t,n){!function Lc(e,t,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(Za)&&(i=n[Za]),null==i&&(i=n[Za]=j1++);const r=i&b_;t.data[e+(r>>eo)]|=1<<r}(e,t,n)}function tv(e,t,n){if(n&en.Optional||void 0!==e)return e;Li()}function nv(e,t,n,i){if(n&en.Optional&&void 0===i&&(i=null),!(n&(en.Self|en.Host))){const r=e[Ml],s=Qr(void 0);try{return r?r.get(t,i,n&en.Optional):Xu(t,i,n&en.Optional)}finally{Qr(s)}}return tv(i,0,n)}function iv(e,t,n,i=en.Default,r){if(null!==e){if(2048&t[Bn]&&!(i&en.Self)){const u=function du(e,t,n,i,r){let s=e,u=t;for(;null!==s&&null!==u&&2048&u[Bn]&&!(512&u[Bn]);){const h=H1(s,u,n,i|en.Self,el);if(h!==el)return h;let g=s.parent;if(!g){const x=u[Io];if(x){const C=x.get(n,el,i);if(C!==el)return C}g=G1(u),u=u[Dc]}s=g}return r}(e,t,n,i,el);if(u!==el)return u}const s=H1(e,t,n,i,el);if(s!==el)return s}return nv(t,n,i,r)}function H1(e,t,n,i,r){const s=function jm(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Za)?e[Za]:void 0;return"number"==typeof t?t>=0?t&b_:ha:t}(n);if("function"==typeof s){if(!nf(t,e,i))return i&en.Host?tv(r,0,i):nv(t,n,i,r);try{const u=s(i);if(null!=u||i&en.Optional)return u;Li()}finally{ih()}}else if("number"==typeof s){let u=null,h=ev(e,t),g=dd,x=i&en.Host?t[Ft][vo]:null;for((-1===h||i&en.SkipSelf)&&(g=-1===h?w_(e,t):t[h+8],g!==dd&&C_(i,!1)?(u=t[dn],h=ah(g),t=da(g,t)):h=-1);-1!==h;){const C=t[dn];if(E_(s,h,C.data)){const S=rD(h,t,n,u,i,x);if(S!==el)return S}g=t[h+8],g!==dd&&C_(i,t[dn].data[h+8]===x)&&E_(s,h,t)?(u=C,h=ah(g),t=da(g,t)):h=-1}}return r}function rD(e,t,n,i,r,s){const u=t[dn],h=u.data[e+8],C=Vm(h,u,n,null==i?Ic(h)&&sf:i!=u&&0!=(3&h.type),r&en.Host&&s===h);return null!==C?lh(t,u,C,h):el}function Vm(e,t,n,i,r){const s=e.providerIndexes,u=t.data,h=1048575&s,g=e.directiveStart,C=s>>20,O=r?h+C:e.directiveEnd;for(let F=i?h:h+C;F<O;F++){const $=u[F];if(F<g&&n===$||F>=g&&$.type===n)return F}if(r){const F=u[g];if(F&&Aa(F)&&F.type===n)return g}return null}function lh(e,t,n,i){let r=e[n];const s=t.data;if(function U1(e){return e instanceof _p}(r)){const u=r;u.resolving&&function lt(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new $e(-200,`Circular dependency in DI detected for ${e}${n}`)}(function Cn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():$t(e)}(s[n]));const h=ts(u.canSeeViewProviders);u.resolving=!0;const g=u.injectImpl?Qr(u.injectImpl):null;nf(e,i,en.Default);try{r=e[n]=u.factory(void 0,s,e,i),t.firstCreatePass&&n>=i.directiveStart&&function B1(e,t,n){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(i){const u=le(t);(n.preOrderHooks??=[]).push(e,u),(n.preOrderCheckHooks??=[]).push(e,u)}r&&(n.preOrderHooks??=[]).push(0-e,r),s&&((n.preOrderHooks??=[]).push(e,s),(n.preOrderCheckHooks??=[]).push(e,s))}(n,s[n],t)}finally{null!==g&&Qr(g),ts(h),u.resolving=!1,ih()}}return r}function E_(e,t,n){return!!(n[t+(e>>eo)]&1<<e)}function C_(e,t){return!(e&en.Self||e&en.Host&&t)}class ch{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,i){return iv(this._tNode,this._lView,t,oa(i),n)}}function ha(){return new ch(Vr(),vt())}function $m(e){return Sa(()=>{const t=e.prototype.constructor,n=t[Do]||M_(t),i=Object.prototype;let r=Object.getPrototypeOf(e.prototype).constructor;for(;r&&r!==i;){const s=r[Do]||M_(r);if(s&&s!==n)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function M_(e){return zt(e)?()=>{const t=M_(tt(e));return t&&t()}:Ac(e)}function G1(e){const t=e[dn],n=t.type;return 2===n?t.declTNode:1===n?e[vo]:null}const Fs="__parameters__";function af(e,t,n){return Sa(()=>{const i=function vp(e){return function(...n){if(e){const i=e(...n);for(const r in i)this[r]=i[r]}}}(t);function r(...s){if(this instanceof r)return i.apply(this,s),this;const u=new r(...s);return h.annotation=u,h;function h(g,x,C){const S=g.hasOwnProperty(Fs)?g[Fs]:Object.defineProperty(g,Fs,{value:[]})[Fs];for(;S.length<=C;)S.push(null);return(S[C]=S[C]||[]).push(u),g}}return n&&(r.prototype=Object.create(n.prototype)),r.prototype.ngMetadataName=e,r.annotationCls=r,r})}function wp(e,t){e.forEach(n=>Array.isArray(n)?wp(n,t):t(n))}function cf(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Wm(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function uf(e,t){const n=[];for(let i=0;i<e;i++)n.push(t);return n}function nl(e,t,n){let i=Bi(e,t);return i>=0?e[1|i]=n:(i=~i,function aD(e,t,n,i){let r=e.length;if(r==t)e.push(n,i);else if(1===r)e.push(i,e[0]),e[0]=n;else{for(r--,e.push(e[r-1],e[r]);r>t;)e[r]=e[r-2],r--;e[t]=n,e[t+1]=i}}(e,i,t,n)),i}function pu(e,t){const n=Bi(e,t);if(n>=0)return e[1|n]}function Bi(e,t){return function Fc(e,t,n){let i=0,r=e.length>>n;for(;r!==i;){const s=i+(r-i>>1),u=e[s<<n];if(t===u)return s<<n;u>t?r=s:i=s+1}return~(r<<n)}(e,t,1)}const Zm=qa(af("Optional"),8),I_=qa(af("SkipSelf"),4);function Ym(e){return 128==(128&e.flags)}var _s=(()=>((_s=_s||{})[_s.Important=1]="Important",_s[_s.DashCase=2]="DashCase",_s))();const yD=/^>|^->|<!--|-->|--!>|<!-$/g,vD=/(<|>)/,bD="\u200b$1\u200b";const yv=new Map;let xD=0;const Dp="__ngContext__";function ns(e,t){fs(t)?(e[Dp]=t[Sc],function vv(e){yv.set(e[Sc],e)}(t)):e[Dp]=t}let Jm;function Mv(e,t){return Jm(e,t)}function hf(e){const t=e[Tr];return Lo(t)?t[Tr]:t}function rw(e){return sw(e[Tc])}function ow(e){return sw(e[So])}function sw(e){for(;null!==e&&!Lo(e);)e=e[So];return e}function Sp(e,t,n,i,r){if(null!=i){let s,u=!1;Lo(i)?s=i:fs(i)&&(u=!0,i=i[Mr]);const h=ht(i);0===e&&null!==n?null==r?Ap(t,n,h):zc(t,n,h,r||null,!0):1===e&&null!==n?zc(t,n,h,r||null,!0):2===e?function og(e,t,n){const i=V_(e,t);i&&function ig(e,t,n,i){e.removeChild(t,n,i)}(e,i,t,n)}(t,h,u):3===e&&t.destroyNode(h),null!=s&&function fw(e,t,n,i,r){const s=n[Yl];s!==ht(n)&&Sp(t,e,i,s,r);for(let h=Ro;h<n.length;h++){const g=n[h];yu(g[dn],g,e,t,i,s)}}(t,e,s,n,r)}}function Dv(e,t){return e.createComment(function nw(e){return e.replace(yD,t=>t.replace(vD,bD))}(t))}function tg(e,t,n){return e.createElement(t,n)}function cw(e,t){const n=e[Tl],i=n.indexOf(t);ui(t),n.splice(i,1)}function Sv(e,t){if(e.length<=Ro)return;const n=Ro+t,i=e[n];if(i){const r=i[Ps];null!==r&&r!==e&&cw(r,i),t>0&&(e[n-1][So]=i[So]);const s=Wm(e,Ro+t);!function Ip(e,t){yu(e,t,t[Jn],2,null,null),t[Mr]=null,t[vo]=null}(i[dn],i);const u=s[ua];null!==u&&u.detachView(s[dn]),i[Tr]=null,i[So]=null,i[Bn]&=-129}return i}function uw(e,t){if(!(256&t[Bn])){const n=t[Jn];t[eh]?.destroy(),t[td]?.destroy(),n.destroyNode&&yu(e,t,n,3,null,null),function ID(e){let t=e[Tc];if(!t)return ng(e[dn],e);for(;t;){let n=null;if(fs(t))n=t[Tc];else{const i=t[Ro];i&&(n=i)}if(!n){for(;t&&!t[So]&&t!==e;)fs(t)&&ng(t[dn],t),t=t[Tr];null===t&&(t=e),fs(t)&&ng(t[dn],t),n=t&&t[So]}t=n}}(t)}}function ng(e,t){if(!(256&t[Bn])){t[Bn]&=-129,t[Bn]|=256,function U_(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let i=0;i<n.length;i+=2){const r=t[n[i]];if(!(r instanceof _p)){const s=n[i+1];if(Array.isArray(s))for(let u=0;u<s.length;u+=2){const h=r[s[u]],g=s[u+1];Le(4,h,g);try{g.call(h)}finally{Le(5,h,g)}}else{Le(4,r,s);try{s.call(r)}finally{Le(5,r,s)}}}}}(e,t),function B_(e,t){const n=e.cleanup,i=t[ca];if(null!==n)for(let s=0;s<n.length-1;s+=2)if("string"==typeof n[s]){const u=n[s+3];u>=0?i[u]():i[-u].unsubscribe(),s+=2}else n[s].call(i[n[s+1]]);null!==i&&(t[ca]=null);const r=t[Ya];if(null!==r){t[Ya]=null;for(let s=0;s<r.length;s++)(0,r[s])()}}(e,t),1===t[dn].type&&t[Jn].destroy();const n=t[Ps];if(null!==n&&Lo(t[Tr])){n!==t[Tr]&&cw(n,t);const i=t[ua];null!==i&&i.detachView(e)}!function Mp(e){yv.delete(e[Sc])}(t)}}function Iv(e,t,n){return function dw(e,t,n){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return n[Mr];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:s}=e.data[i.directiveStart+r];if(s===To.None||s===To.Emulated)return null}return He(i,n)}}(e,t.parent,n)}function zc(e,t,n,i,r){e.insertBefore(t,n,i,r)}function Ap(e,t,n){e.appendChild(t,n)}function Av(e,t,n,i,r){null!==i?zc(e,t,n,i,r):Ap(e,t,n)}function V_(e,t){return e.parentNode(t)}function Pv(e,t,n){return kv(e,t,n)}let j_,H_,zv,G_,kv=function Ov(e,t,n){return 40&e.type?He(e,n):null};function $_(e,t,n,i){const r=Iv(e,i,t),s=t[Jn],h=Pv(i.parent||t[vo],i,t);if(null!=r)if(Array.isArray(n))for(let g=0;g<n.length;g++)Av(s,r,n[g],h,!1);else Av(s,r,n,h,!1);void 0!==j_&&j_(s,i,t,n,r)}function rg(e,t){if(null!==t){const n=t.type;if(3&n)return He(t,e);if(4&n)return Pp(-1,e[t.index]);if(8&n){const i=t.child;if(null!==i)return rg(e,i);{const r=e[t.index];return Lo(r)?Pp(-1,r):ht(r)}}if(32&n)return Mv(t,e)()||ht(e[t.index]);{const i=Lv(e,t);return null!==i?Array.isArray(i)?i[0]:rg(hf(e[Ft]),i):rg(e,t.next)}}return null}function Lv(e,t){return null!==t?e[Ft][vo].projection[t.projection]:null}function Pp(e,t){const n=Ro+e+1;if(n<t.length){const i=t[n],r=i[dn].firstChild;if(null!==r)return rg(i,r)}return t[Yl]}function ff(e,t,n,i,r,s,u){for(;null!=n;){const h=i[n.index],g=n.type;if(u&&0===t&&(h&&ns(ht(h),i),n.flags|=2),32!=(32&n.flags))if(8&g)ff(e,t,n.child,i,r,s,!1),Sp(t,e,r,h,s);else if(32&g){const x=Mv(n,i);let C;for(;C=x();)Sp(t,e,r,C,s);Sp(t,e,r,h,s)}else 16&g?Fv(e,t,i,n,r,s):Sp(t,e,r,h,s);n=u?n.projectionNext:n.next}}function yu(e,t,n,i,r,s){ff(n,i,e.firstChild,t,r,s,!1)}function Fv(e,t,n,i,r,s){const u=n[Ft],g=u[vo].projection[i.projection];if(Array.isArray(g))for(let x=0;x<g.length;x++)Sp(t,e,r,g[x],s);else{let x=g;const C=u[Tr];Ym(i)&&(x.flags|=128),ff(e,t,x,C,r,s,!0)}}function pw(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function mw(e,t,n){const{mergedAttrs:i,classes:r,styles:s}=n;null!==i&&Zl(e,t,i),null!==r&&pw(e,t,r),null!==s&&function OD(e,t,n){e.setAttribute(t,"style",n)}(e,t,s)}function _d(e){return function Nv(){if(void 0===H_&&(H_=null,ar.trustedTypes))try{H_=ar.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return H_}()?.createHTML(e)||e}function ag(){if(void 0!==zv)return zv;if(typeof document<"u")return document;throw new $e(210,!1)}function Bv(){if(void 0===G_&&(G_=null,ar.trustedTypes))try{G_=ar.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return G_}function Uv(e){return Bv()?.createHTML(e)||e}function No(e){return Bv()?.createScriptURL(e)||e}class Us{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Wt})`}}class Vv extends Us{getTypeName(){return"HTML"}}class q_ extends Us{getTypeName(){return"Style"}}class Op extends Us{getTypeName(){return"Script"}}class FD extends Us{getTypeName(){return"URL"}}class ND extends Us{getTypeName(){return"ResourceURL"}}function Vs(e){return e instanceof Us?e.changingThisBreaksApplicationSecurity:e}function vu(e,t){const n=function zD(e){return e instanceof Us&&e.getTypeName()||null}(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see ${Wt})`)}return n===t}class ww{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const n=(new window.DOMParser).parseFromString(_d(t),"text/html").body;return null===n?this.inertDocumentHelper.getInertBodyElement(t):(n.removeChild(n.firstChild),n)}catch{return null}}}class yd{constructor(t){this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(t){const n=this.inertDocument.createElement("template");return n.innerHTML=_d(t),n}}const Ew=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function W_(e){return(e=String(e)).match(Ew)?e:"unsafe:"+e}function vd(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function lg(...e){const t={};for(const n of e)for(const i in n)n.hasOwnProperty(i)&&(t[i]=!0);return t}const Cw=vd("area,br,col,hr,img,wbr"),Mw=vd("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Tw=vd("rp,rt"),Rp=lg(Cw,lg(Mw,vd("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),lg(Tw,vd("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),lg(Tw,Mw)),hh=vd("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Z_=lg(hh,vd("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),vd("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),UD=vd("script,style,template");class VD{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let n=t.firstChild,i=!0;for(;n;)if(n.nodeType===Node.ELEMENT_NODE?i=this.startElement(n):n.nodeType===Node.TEXT_NODE?this.chars(n.nodeValue):this.sanitizedSomething=!0,i&&n.firstChild)n=n.firstChild;else for(;n;){n.nodeType===Node.ELEMENT_NODE&&this.endElement(n);let r=this.checkClobberedElement(n,n.nextSibling);if(r){n=r;break}n=this.checkClobberedElement(n,n.parentNode)}return this.buf.join("")}startElement(t){const n=t.nodeName.toLowerCase();if(!Rp.hasOwnProperty(n))return this.sanitizedSomething=!0,!UD.hasOwnProperty(n);this.buf.push("<"),this.buf.push(n);const i=t.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),u=s.name,h=u.toLowerCase();if(!Z_.hasOwnProperty(h)){this.sanitizedSomething=!0;continue}let g=s.value;hh[h]&&(g=W_(g)),this.buf.push(" ",u,'="',X_(g),'"')}return this.buf.push(">"),!0}endElement(t){const n=t.nodeName.toLowerCase();Rp.hasOwnProperty(n)&&!Cw.hasOwnProperty(n)&&(this.buf.push("</"),this.buf.push(n),this.buf.push(">"))}chars(t){this.buf.push(X_(t))}checkClobberedElement(t,n){if(n&&(t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return n}}const jD=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Dw=/([^\#-~ |!])/g;function X_(e){return e.replace(/&/g,"&amp;").replace(jD,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Dw,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let ys;function Y_(e,t){let n=null;try{ys=ys||function $v(e){const t=new yd(e);return function kp(){try{return!!(new window.DOMParser).parseFromString(_d(""),"text/html")}catch{return!1}}()?new ww(t):t}(e);let i=t?String(t):"";n=ys.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=n.innerHTML,n=ys.getInertBodyElement(i)}while(i!==s);return _d((new VD).sanitizeChildren(K_(n)||n))}finally{if(n){const i=K_(n)||n;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function K_(e){return"content"in e&&function Ol(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var jr=(()=>((jr=jr||{})[jr.NONE=0]="NONE",jr[jr.HTML=1]="HTML",jr[jr.STYLE=2]="STYLE",jr[jr.SCRIPT=3]="SCRIPT",jr[jr.URL=4]="URL",jr[jr.RESOURCE_URL=5]="RESOURCE_URL",jr))();function fh(e){const t=zp();return t?Uv(t.sanitize(jr.HTML,e)||""):vu(e,"HTML")?Uv(Vs(e)):Y_(ag(),$t(e))}function Fp(e){const t=zp();return t?t.sanitize(jr.URL,e)||"":vu(e,"URL")?Vs(e):W_($t(e))}function Np(e){const t=zp();if(t)return No(t.sanitize(jr.RESOURCE_URL,e)||"");if(vu(e,"ResourceURL"))return No(Vs(e));throw new $e(904,!1)}function zp(){const e=vt();return e&&e[Mc].sanitizer}class sn{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Zt({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Bp=new sn("ENVIRONMENT_INITIALIZER"),bu=new sn("INJECTOR",-1),qv=new sn("INJECTOR_DEF_TYPES");class Wv{get(t,n=Yo){if(n===Yo){const i=new Error(`NullInjectorError: No provider for ${pe(t)}!`);throw i.name="NullInjectorError",i}return n}}function Pw(...e){return{\u0275providers:Ow(0,e),\u0275fromNgModule:!0}}function Ow(e,...t){const n=[],i=new Set;let r;return wp(t,s=>{const u=s;J_(u,n,[],i)&&(r||=[],r.push(u))}),void 0!==r&&kw(r,n),n}function kw(e,t){for(let n=0;n<e.length;n++){const{providers:r}=e[n];pf(r,s=>{t.push(s)})}}function J_(e,t,n,i){if(!(e=tt(e)))return!1;let r=null,s=Zd(e);const u=!s&&Mn(e);if(s||u){if(u&&!u.standalone)return!1;r=e}else{const g=e.ngModule;if(s=Zd(g),!s)return!1;r=g}const h=i.has(r);if(u){if(h)return!1;if(i.add(r),u.dependencies){const g="function"==typeof u.dependencies?u.dependencies():u.dependencies;for(const x of g)J_(x,t,n,i)}}else{if(!s)return!1;{if(null!=s.imports&&!h){let x;i.add(r);try{wp(s.imports,C=>{J_(C,t,n,i)&&(x||=[],x.push(C))})}finally{}void 0!==x&&kw(x,t)}if(!h){const x=Ac(r)||(()=>new r);t.push({provide:r,useFactory:x,deps:Ei},{provide:qv,useValue:r,multi:!0},{provide:Bp,useValue:()=>et(r),multi:!0})}const g=s.providers;null==g||h||pf(g,C=>{t.push(C)})}}return r!==e&&void 0!==e.providers}function pf(e,t){for(let n of e)rn(n)&&(n=n.\u0275providers),Array.isArray(n)?pf(n,t):t(n)}const Rw=z({provide:String,useValue:z});function ey(e){return null!==e&&"object"==typeof e&&Rw in e}function rc(e){return"function"==typeof e}const ny=new sn("Set Injector scope."),mf={},Lw={};let Vp;function gf(){return void 0===Vp&&(Vp=new Wv),Vp}class xu{}class Zv extends xu{get destroyed(){return this._destroyed}constructor(t,n,i,r){super(),this.parent=n,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Kv(t,u=>this.processProvider(u)),this.records.set(bu,Bc(void 0,this)),r.has("environment")&&this.records.set(xu,Bc(void 0,this));const s=this.records.get(ny);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(qv.multi,Ei,en.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const n of t)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const n=ra(this),i=Qr(void 0);try{return t()}finally{ra(n),Qr(i)}}get(t,n=Yo,i=en.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(Qd))return t[Qd](this);i=oa(i);const r=ra(this),s=Qr(void 0);try{if(!(i&en.SkipSelf)){let h=this.records.get(t);if(void 0===h){const g=function Fw(e){return"function"==typeof e||"object"==typeof e&&e instanceof sn}(t)&&Xo(t);h=g&&this.injectableDefInScope(g)?Bc(Xv(t),mf):null,this.records.set(t,h)}if(null!=h)return this.hydrate(t,h)}return(i&en.Self?gf():this.parent).get(t,n=i&en.Optional&&n===Yo?null:n)}catch(u){if("NullInjectorError"===u.name){if((u[Da]=u[Da]||[]).unshift(pe(t)),r)throw u;return function lp(e,t,n,i){const r=e[Da];throw t[Kd]&&r.unshift(t[Kd]),e.message=function cp(e,t,n,i=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let r=pe(t);if(Array.isArray(t))r=t.map(pe).join(" -> ");else if("object"==typeof t){let s=[];for(let u in t)if(t.hasOwnProperty(u)){let h=t[u];s.push(u+":"+("string"==typeof h?JSON.stringify(h):pe(h)))}r=`{${s.join(", ")}}`}return`${n}${i?"("+i+")":""}[${r}]: ${e.replace(Yu,"\n  ")}`}("\n"+e.message,r,n,i),e.ngTokenPath=r,e[Da]=null,e}(u,t,"R3InjectorError",this.source)}throw u}finally{Qr(s),ra(r)}}resolveInjectorInitializers(){const t=ra(this),n=Qr(void 0);try{const i=this.get(Bp.multi,Ei,en.Self);for(const r of i)r()}finally{ra(t),Qr(n)}}toString(){const t=[],n=this.records;for(const i of n.keys())t.push(pe(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new $e(205,!1)}processProvider(t){let n=rc(t=tt(t))?t:tt(t&&t.provide);const i=function ZD(e){return ey(e)?Bc(void 0,e.useValue):Bc(function _f(e,t,n){let i;if(rc(e)){const r=tt(e);return Ac(r)||Xv(r)}if(ey(e))i=()=>tt(e.useValue);else if(function ty(e){return!(!e||!e.useFactory)}(e))i=()=>e.useFactory(...wl(e.deps||[]));else if(function ic(e){return!(!e||!e.useExisting)}(e))i=()=>et(tt(e.useExisting));else{const r=tt(e&&(e.useClass||e.provide));if(!function Yv(e){return!!e.deps}(e))return Ac(r)||Xv(r);i=()=>new r(...wl(e.deps))}return i}(e),mf)}(t);if(rc(t)||!0!==t.multi)this.records.get(n);else{let r=this.records.get(n);r||(r=Bc(void 0,mf,!0),r.factory=()=>wl(r.multi),this.records.set(n,r)),n=t,r.multi.push(t)}this.records.set(n,i)}hydrate(t,n){return n.value===mf&&(n.value=Lw,n.value=n.factory()),"object"==typeof n.value&&n.value&&function XD(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=tt(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){const n=this._onDestroyHooks.indexOf(t);-1!==n&&this._onDestroyHooks.splice(n,1)}}function Xv(e){const t=Xo(e),n=null!==t?t.factory:Ac(e);if(null!==n)return n;if(e instanceof sn)throw new $e(204,!1);if(e instanceof Function)return function WD(e){const t=e.length;if(t>0)throw uf(t,"?"),new $e(204,!1);const n=function us(e){return e&&(e[Wl]||e[Zu])||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new $e(204,!1)}function Bc(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Kv(e,t){for(const n of e)Array.isArray(n)?Kv(n,t):n&&rn(n)?Kv(n.\u0275providers,t):t(n)}const yf=new sn("AppId",{providedIn:"root",factory:()=>YD}),YD="ng",jp=new sn("Platform Initializer"),Ra=new sn("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),bd=new sn("AnimationModuleType"),$p=new sn("CSP nonce",{providedIn:"root",factory:()=>ag().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let zw=(e,t)=>null;function eb(e,t){return zw(e,t)}class iS{}class ay{}class rS{resolveComponentFactory(t){throw function jw(e){const t=Error(`No component factory found for ${pe(e)}.`);return t.ngComponent=e,t}(t)}}let qp=(()=>{class e{}return e.NULL=new rS,e})();function oS(){return mh(Vr(),vt())}function mh(e,t){return new vs(He(e,t))}let vs=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=oS,e})();function hg(e){return e instanceof vs?e.nativeElement:e}class fg{}let ly=(()=>{class e{constructor(){this.destroyNode=null}}return e.__NG_ELEMENT_ID__=()=>function $w(){const e=vt(),n=_t(Vr().index,e);return(fs(n)?n:e)[Jn]}(),e})(),sS=(()=>{class e{}return e.\u0275prov=Zt({token:e,providedIn:"root",factory:()=>null}),e})();class Ef{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const oc=new Ef("16.1.2"),sc={};function ac(e){for(;e;){e[Bn]|=64;const t=hf(e);if(dp(e)&&!t)return e;e=t}return null}function Wp(e){return e.ngOriginalError}class gh{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&Wp(t);for(;n&&Wp(n);)n=Wp(n);return n||null}}const cy=new sn("",{providedIn:"root",factory:()=>!1});function fa(e){return e instanceof Function?e():e}class jc extends pp{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(t){this._lView=t}onConsumerDependencyMayHaveChanged(){ac(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(t,n,i){const r=bo(this);this.trackingVersion++;try{t(n,i)}finally{bo(r)}}destroy(){this.trackingVersion++}}let Zp=null;function dy(){return Zp??=new jc,Zp}function lc(e,t){return e[t]??dy()}function _h(e,t){const n=dy();n.hasReadASignal&&(e[t]=Zp,n.lView=e,Zp=new jc)}const mi={};function xt(e){Xp(Ii(),vt(),ka()+e,!1)}function Xp(e,t,n,i){if(!i)if(3==(3&t[Bn])){const s=e.preOrderCheckHooks;null!==s&&Ja(t,s,n)}else{const s=e.preOrderHooks;null!==s&&mp(t,s,0,n)}rh(n)}function cb(e,t=null,n=null,i){const r=hy(e,t,n,i);return r.resolveInjectorInitializers(),r}function hy(e,t=null,n=null,i,r=new Set){const s=[n||Ei,Pw(e)];return i=i||("object"==typeof e?void 0:pe(e)),new Zv(s,t||gf(),i||null,r)}let bs=(()=>{class e{static create(n,i){if(Array.isArray(n))return cb({name:""},i,n,"");{const r=n.name??"";return cb({name:r},n.parent,n.providers,r)}}}return e.THROW_IF_NOT_FOUND=Yo,e.NULL=new Wv,e.\u0275prov=Zt({token:e,providedIn:"any",factory:()=>et(bu)}),e.__NG_ELEMENT_ID__=-1,e})();function Nt(e,t=en.Default){const n=vt();return null===n?et(e,t):iv(Vr(),n,tt(e),t)}function yh(){throw new Error("invalid")}function mg(e,t,n,i,r,s,u,h,g,x,C){const S=t.blueprint.slice();return S[Mr]=r,S[Bn]=140|i,(null!==x||e&&2048&e[Bn])&&(S[Bn]|=2048),ln(S),S[Tr]=S[Dc]=e,S[mr]=n,S[Mc]=u||e&&e[Mc],S[Jn]=h||e&&e[Jn],S[Ml]=g||e&&e[Ml]||null,S[vo]=s,S[Sc]=function wD(){return xD++}(),S[Ka]=C,S[Io]=x,S[Ft]=2==t.type?e[Ft]:S,S}function a(e,t,n,i,r){let s=e.data[t];if(null===s)s=function o(e,t,n,i,r){const s=Pc(),u=od(),g=e.data[t]=function ie(e,t,n,i,r,s){let u=t?t.injectorIndex:-1,h=0;return cr()&&(h|=128),{type:n,index:i,insertBeforeIndex:null,injectorIndex:u,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:h,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,u?s:s&&s.parent,n,t,i,r);return null===e.firstChild&&(e.firstChild=g),null!==s&&(u?null==s.child&&null!==g.parent&&(s.child=g):null===s.next&&(s.next=g,g.prev=s)),g}(e,t,n,i,r),function sd(){return cn.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=n,s.value=i,s.attrs=r;const u=function Al(){const e=cn.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();s.injectorIndex=null===u?-1:u.injectorIndex}return Oa(s,!0),s}function l(e,t,n,i){if(0===n)return-1;const r=t.length;for(let s=0;s<n;s++)t.push(i),e.blueprint.push(i),e.data.push(null);return r}function d(e,t,n,i,r){const s=lc(t,eh),u=ka(),h=2&i;try{if(rh(-1),h&&t.length>Si&&Xp(e,t,Si,!1),Le(h?2:0,r),h)s.runInContext(n,i,r);else{const x=bo(null);try{n(i,r)}finally{bo(x)}}}finally{h&&null===t[eh]&&_h(t,eh),rh(u),Le(h?3:1,r)}}function p(e,t,n){if(id(t)){const i=bo(null);try{const s=t.directiveEnd;for(let u=t.directiveStart;u<s;u++){const h=e.data[u];h.contentQueries&&h.contentQueries(1,n[u],u)}}finally{bo(i)}}}function y(e,t,n){Il()&&(function gt(e,t,n,i){const r=n.directiveStart,s=n.directiveEnd;Ic(n)&&function En(e,t,n){const i=He(t,e),r=E(n);let u=16;n.signals?u=4096:n.onPush&&(u=64);const h=Yi(e,mg(e,r,null,u,i,t,null,e[Mc].rendererFactory.createRenderer(i,n),null,null,null));e[t.index]=h}(t,n,e.data[r+n.componentOffset]),e.firstCreatePass||x_(n,t),ns(i,t);const u=n.initialInputs;for(let h=r;h<s;h++){const g=e.data[h],x=lh(t,e,h,n);ns(x,t),null!==u&&Wn(0,h-r,x,g,0,u),Aa(g)&&(_t(n.index,t)[mr]=lh(t,e,h,n))}}(e,t,n,He(n,t)),64==(64&n.flags)&&wt(e,t,n))}function b(e,t,n=He){const i=t.localNames;if(null!==i){let r=t.index+1;for(let s=0;s<i.length;s+=2){const u=i[s+1],h=-1===u?n(t,e):e[u];e[r++]=h}}}function E(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=T(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function T(e,t,n,i,r,s,u,h,g,x,C){const S=Si+i,O=S+r,F=function D(e,t){const n=[];for(let i=0;i<t;i++)n.push(i<e?null:mi);return n}(S,O),$="function"==typeof x?x():x;return F[dn]={type:e,blueprint:F,template:n,queries:null,viewQuery:h,declTNode:t,data:F.slice().fill(null,S),bindingStartIndex:S,expandoStartIndex:O,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof u?u():u,firstChild:null,schemas:g,consts:$,incompleteFirstPass:!1,ssrId:C}}let B=e=>null;function ce(e,t,n,i){for(let r in e)if(e.hasOwnProperty(r)){n=null===n?{}:n;const s=e[r];null===i?be(n,t,r,s):i.hasOwnProperty(r)&&be(n,t,i[r],s)}return n}function be(e,t,n,i){e.hasOwnProperty(n)?e[n].push(t,i):e[n]=[t,i]}function xe(e,t,n,i,r,s,u,h){const g=He(t,n);let C,x=t.inputs;!h&&null!=x&&(C=x[i])?(ir(e,n,C,i,r),Ic(t)&&function Ce(e,t){const n=_t(t,e);16&n[Bn]||(n[Bn]|=64)}(n,t.index)):3&t.type&&(i=function ve(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(i),r=null!=u?u(r,t.value||"",i):r,s.setProperty(g,i,r))}function st(e,t,n,i){if(Il()){const r=null===i?null:{"":-1},s=function rt(e,t){const n=e.directiveRegistry;let i=null,r=null;if(n)for(let s=0;s<n.length;s++){const u=n[s];if(gi(t,u.selectors,!1))if(i||(i=[]),Aa(u))if(null!==u.findHostDirectiveDefs){const h=[];r=r||new Map,u.findHostDirectiveDefs(u,h,r),i.unshift(...h,u),Xt(e,t,h.length)}else i.unshift(u),Xt(e,t,0);else r=r||new Map,u.findHostDirectiveDefs?.(u,i,r),i.push(u)}return null===i?null:[i,r]}(e,n);let u,h;null===s?u=h=null:[u,h]=s,null!==u&&Mt(e,t,n,u,r,h),r&&function un(e,t,n){if(t){const i=e.localNames=[];for(let r=0;r<t.length;r+=2){const s=n[t[r+1]];if(null==s)throw new $e(-301,!1);i.push(t[r],s)}}}(n,i,r)}n.mergedAttrs=wc(n.mergedAttrs,n.attrs)}function Mt(e,t,n,i,r,s){for(let x=0;x<i.length;x++)hd(x_(n,t),e,i[x].type);!function qn(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,i.length);for(let x=0;x<i.length;x++){const C=i[x];C.providersResolver&&C.providersResolver(C)}let u=!1,h=!1,g=l(e,t,i.length,null);for(let x=0;x<i.length;x++){const C=i[x];n.mergedAttrs=wc(n.mergedAttrs,C.hostAttrs),Ot(e,n,t,g,C),Jt(g,C,r),null!==C.contentQueries&&(n.flags|=4),(null!==C.hostBindings||null!==C.hostAttrs||0!==C.hostVars)&&(n.flags|=64);const S=C.type.prototype;!u&&(S.ngOnChanges||S.ngOnInit||S.ngDoCheck)&&((e.preOrderHooks??=[]).push(n.index),u=!0),!h&&(S.ngOnChanges||S.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(n.index),h=!0),g++}!function de(e,t,n){const r=t.directiveEnd,s=e.data,u=t.attrs,h=[];let g=null,x=null;for(let C=t.directiveStart;C<r;C++){const S=s[C],O=n?n.get(S):null,$=O?O.outputs:null;g=ce(S.inputs,C,g,O?O.inputs:null),x=ce(S.outputs,C,x,$);const G=null===g||null===u||Be(t)?null:Dr(g,C,u);h.push(G)}null!==g&&(g.hasOwnProperty("class")&&(t.flags|=8),g.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=h,t.inputs=g,t.outputs=x}(e,n,s)}function wt(e,t,n){const i=n.directiveStart,r=n.directiveEnd,s=n.index,u=function N1(){return cn.lFrame.currentDirectiveIndex}();try{rh(s);for(let h=i;h<r;h++){const g=e.data[h],x=t[h];Z0(h),(null!==g.hostBindings||0!==g.hostVars||null!==g.hostAttrs)&&Pt(g,x)}}finally{rh(-1),Z0(u)}}function Pt(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Xt(e,t,n){t.componentOffset=n,(e.components??=[]).push(t.index)}function Jt(e,t,n){if(n){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)n[t.exportAs[i]]=e;Aa(t)&&(n[""]=e)}}function Ot(e,t,n,i,r){e.data[i]=r;const s=r.factory||(r.factory=Ac(r.type)),u=new _p(s,Aa(r),Nt);e.blueprint[i]=u,n[i]=u,function Je(e,t,n,i,r){const s=r.hostBindings;if(s){let u=e.hostBindingOpCodes;null===u&&(u=e.hostBindingOpCodes=[]);const h=~t.index;(function mt(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(u)!=h&&u.push(h),u.push(n,i,s)}}(e,t,i,l(e,n,r.hostVars,mi),r)}function Ln(e,t,n,i,r,s){const u=He(e,t);!function Ci(e,t,n,i,r,s,u){if(null==s)e.removeAttribute(t,r,n);else{const h=null==u?$t(s):u(s,i||"",r);e.setAttribute(t,r,h,n)}}(t[Jn],u,s,e.value,n,i,r)}function Wn(e,t,n,i,r,s){const u=s[t];if(null!==u)for(let h=0;h<u.length;)On(i,n,u[h++],u[h++],u[h++])}function On(e,t,n,i,r){const s=bo(null);try{const u=e.inputTransforms;null!==u&&u.hasOwnProperty(i)&&(r=u[i].call(t,r)),null!==e.setInput?e.setInput(t,r,n,i):t[i]=r}finally{bo(s)}}function Dr(e,t,n){let i=null,r=0;for(;r<n.length;){const s=n[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(e.hasOwnProperty(s)){null===i&&(i=[]);const u=e[s];for(let h=0;h<u.length;h+=2)if(u[h]===t){i.push(s,u[h+1],n[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function Zn(e,t,n,i){return[e,!0,!1,t,null,0,i,n,null,null,null]}function Xn(e,t){const n=e.contentQueries;if(null!==n)for(let i=0;i<n.length;i+=2){const s=n[i+1];if(-1!==s){const u=e.data[s];Lm(n[i]),u.contentQueries(2,t[s],s)}}}function Yi(e,t){return e[Tc]?e[Qh][So]=t:e[Tc]=t,e[Qh]=t,t}function ur(e,t,n){Lm(0);const i=bo(null);try{t(e,n)}finally{bo(i)}}function dr(e){return e[ca]||(e[ca]=[])}function Fr(e){return e.cleanup||(e.cleanup=[])}function Zr(e,t,n){return(null===e||Aa(e))&&(n=function je(e){for(;Array.isArray(e);){if("object"==typeof e[au])return e;e=e[Mr]}return null}(n[t.index])),n[Jn]}function oo(e,t){const n=e[Ml],i=n?n.get(gh,null):null;i&&i.handleError(t)}function ir(e,t,n,i,r){for(let s=0;s<n.length;){const u=n[s++],h=n[s++];On(e.data[u],t[u],i,h,r)}}function Ir(e,t,n){const i=dt(t,e);!function eg(e,t,n){e.setValue(t,n)}(e[Jn],i,n)}function mo(e,t){const n=_t(t,e),i=n[dn];!function Xr(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(i,n);const r=n[Mr];null!==r&&null===n[Ka]&&(n[Ka]=eb(r,n[Ml])),Ai(i,n,n[mr])}function Ai(e,t,n){Oc(t);try{const i=e.viewQuery;null!==i&&ur(1,i,n);const r=e.template;null!==r&&d(e,t,r,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Xn(e,t),e.staticViewQueries&&ur(2,e.viewQuery,n);const s=e.components;null!==s&&function go(e,t){for(let n=0;n<t.length;n++)mo(e,t[n])}(t,s)}catch(i){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),i}finally{t[Bn]&=-5,Y0()}}let zo=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(n,i,r){const s=typeof Zone>"u"?null:Zone.current,u=new oe(n,x=>{this.all.has(x)&&this.queue.set(x,s)},r);let h;this.all.add(u),u.notify();const g=()=>{u.cleanup(),h?.(),this.all.delete(u),this.queue.delete(u)};return h=i?.onDestroy(g),{destroy:g}}flush(){if(0!==this.queue.size)for(const[n,i]of this.queue)this.queue.delete(n),i?i.run(()=>n.run()):n.run()}get isQueueEmpty(){return 0===this.queue.size}}return e.\u0275prov=Zt({token:e,providedIn:"root",factory:()=>new e}),e})();function is(e,t,n){let i=n?e.styles:null,r=n?e.classes:null,s=0;if(null!==t)for(let u=0;u<t.length;u++){const h=t[u];"number"==typeof h?s=h:1==s?r=Ee(r,h):2==s&&(i=Ee(i,h+": "+t[++u]+";"))}n?e.styles=i:e.stylesWithoutHost=i,n?e.classes=r:e.classesWithoutHost=r}function so(e,t,n,i,r=!1){for(;null!==n;){const s=t[n.index];if(null!==s&&i.push(ht(s)),Lo(s)){for(let h=Ro;h<s.length;h++){const g=s[h],x=g[dn].firstChild;null!==x&&so(g[dn],g,x,i)}s[Yl]!==s[Mr]&&i.push(s[Yl])}const u=n.type;if(8&u)so(e,t,n.child,i);else if(32&u){const h=Mv(n,t);let g;for(;g=h();)i.push(g)}else if(16&u){const h=Lv(t,n);if(Array.isArray(h))i.push(...h);else{const g=hf(t[Ft]);so(g[dn],g,h,i,!0)}}n=r?n.projectionNext:n.next}return i}function il(e,t,n,i=!0){const r=t[Mc].rendererFactory;r.begin&&r.begin();try{Yp(e,t,e.template,n)}catch(u){throw i&&oo(t,u),u}finally{r.end&&r.end(),t[Mc].effectManager?.flush()}}function Yp(e,t,n,i){const r=t[Bn];if(256!=(256&r)){t[Mc].effectManager?.flush(),Oc(t);try{ln(t),function W0(e){return cn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&d(e,t,n,2,i);const u=3==(3&r);if(u){const x=e.preOrderCheckHooks;null!==x&&Ja(t,x,null)}else{const x=e.preOrderHooks;null!==x&&mp(t,x,0,null),ud(t,0)}if(function tE(e){for(let t=rw(e);null!==t;t=ow(t)){if(!t[up])continue;const n=t[Tl];for(let i=0;i<n.length;i++){Sn(n[i])}}}(t),db(t,2),null!==e.contentQueries&&Xn(e,t),u){const x=e.contentCheckHooks;null!==x&&Ja(t,x)}else{const x=e.contentHooks;null!==x&&mp(t,x,1),ud(t,1)}!function ub(e,t){const n=e.hostBindingOpCodes;if(null===n)return;const i=lc(t,td);try{for(let r=0;r<n.length;r++){const s=n[r];if(s<0)rh(~s);else{const u=s,h=n[++r],g=n[++r];F1(h,u),i.runInContext(g,2,t[u])}}}finally{null===t[td]&&_h(t,td),rh(-1)}}(e,t);const h=e.components;null!==h&&fy(t,h,0);const g=e.viewQuery;if(null!==g&&ur(2,g,i),u){const x=e.viewCheckHooks;null!==x&&Ja(t,x)}else{const x=e.viewHooks;null!==x&&mp(t,x,2),ud(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[Bn]&=-73,ui(t)}finally{Y0()}}}function db(e,t){for(let n=rw(e);null!==n;n=ow(n))for(let i=Ro;i<n.length;i++)hb(n[i],t)}function nE(e,t,n){hb(_t(t,e),n)}function hb(e,t){if(!function It(e){return 128==(128&e[Bn])}(e))return;const n=e[dn];if(80&e[Bn]&&0===t||1024&e[Bn]||2===t)Yp(n,e,n.template,e[mr]);else if(e[ko]>0){db(e,1);const r=e[dn].components;null!==r&&fy(e,r,1)}}function fy(e,t,n){for(let i=0;i<t.length;i++)nE(e,t[i],n)}class Df{get rootNodes(){const t=this._lView,n=t[dn];return so(n,t,n.firstChild,[])}constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[mr]}set context(t){this._lView[mr]=t}get destroyed(){return 256==(256&this._lView[Bn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[Tr];if(Lo(t)){const n=t[8],i=n?n.indexOf(this):-1;i>-1&&(Sv(t,i),Wm(n,i))}this._attachedToViewContainer=!1}uw(this._lView[dn],this._lView)}onDestroy(t){!function gn(e,t){if(256==(256&e[Bn]))throw new $e(911,!1);null===e[Ya]&&(e[Ya]=[]),e[Ya].push(t)}(this._lView,t)}markForCheck(){ac(this._cdRefInjectingView||this._lView)}detach(){this._lView[Bn]&=-129}reattach(){this._lView[Bn]|=128}detectChanges(){il(this._lView[dn],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new $e(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function SD(e,t){yu(e,t,t[Jn],2,null,null)}(this._lView[dn],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new $e(902,!1);this._appRef=t}}class Cu extends Df{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;il(t[dn],t,t[mr],!1)}checkNoChanges(){}get context(){return null}}class fb extends qp{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=Mn(t);return new cc(n,this.ngModule)}}function vh(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class mb{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,i){i=oa(i);const r=this.injector.get(t,sc,i);return r!==sc||n===sc?r:this.parentInjector.get(t,n,i)}}class cc extends ay{get inputs(){return vh(this.componentDef.inputs)}get outputs(){return vh(this.componentDef.outputs)}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function El(e){return e.map(Qo).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}create(t,n,i,r){let s=(r=r||this.ngModule)instanceof xu?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const u=s?new mb(t,s):t,h=u.get(fg,null);if(null===h)throw new $e(407,!1);const C={rendererFactory:h,sanitizer:u.get(sS,null),effectManager:u.get(zo,null)},S=h.createRenderer(null,this.componentDef),O=this.componentDef.selectors[0][0]||"div",F=i?function R(e,t,n,i){const s=i.get(cy,!1)||n===To.ShadowDom,u=e.selectRootElement(t,s);return function N(e){B(e)}(u),u}(S,i,this.componentDef.encapsulation,u):tg(S,O,function pb(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(O)),Y=this.componentDef.signals?4608:this.componentDef.onPush?576:528,J=T(0,null,null,1,0,null,null,null,null,null,null),Q=mg(null,J,null,Y,null,null,C,S,u,null,null);let he,ue;Oc(Q);try{const we=this.componentDef;let Ie,Qe=null;we.findHostDirectiveDefs?(Ie=[],Qe=new Map,we.findHostDirectiveDefs(we,Ie,Qe),Ie.push(we)):Ie=[we];const ut=function rl(e,t){const n=e[dn],i=Si;return e[i]=t,a(n,i,2,"#host",null)}(Q,F),Ct=function ol(e,t,n,i,r,s,u){const h=r[dn];!function yg(e,t,n,i){for(const r of e)t.mergedAttrs=wc(t.mergedAttrs,r.hostAttrs);null!==t.mergedAttrs&&(is(t,t.mergedAttrs,!0),null!==n&&mw(i,n,t))}(i,e,t,u);let g=null;null!==t&&(g=eb(t,r[Ml]));const x=s.rendererFactory.createRenderer(t,n);let C=16;n.signals?C=4096:n.onPush&&(C=64);const S=mg(r,E(n),null,C,r[e.index],e,s,x,null,null,g);return h.firstCreatePass&&Xt(h,e,i.length-1),Yi(r,S),r[e.index]=S}(ut,F,we,Ie,Q,C,S);ue=qe(J,Si),F&&function iE(e,t,n,i){if(i)Zl(e,n,["ng-version",oc.full]);else{const{attrs:r,classes:s}=function Jo(e){const t=[],n=[];let i=1,r=2;for(;i<e.length;){let s=e[i];if("string"==typeof s)2===r?""!==s&&t.push(s,e[++i]):8===r&&n.push(s);else{if(!mn(r))break;r=s}i++}return{attrs:t,classes:n}}(t.selectors[0]);r&&Zl(e,n,r),s&&s.length>0&&pw(e,n,s.join(" "))}}(S,we,F,i),void 0!==n&&function Sf(e,t,n){const i=e.projection=[];for(let r=0;r<t.length;r++){const s=n[r];i.push(null!=s?Array.from(s):null)}}(ue,this.ngContentSelectors,n),he=function _b(e,t,n,i,r,s){const u=Vr(),h=r[dn],g=He(u,r);Mt(h,r,u,n,null,i);for(let C=0;C<n.length;C++)ns(lh(r,h,u.directiveStart+C,u),r);wt(h,r,u),g&&ns(g,r);const x=lh(r,h,u.directiveStart+u.componentOffset,u);if(e[mr]=r[mr]=x,null!==s)for(const C of s)C(x,t);return p(h,u,e),x}(Ct,we,Ie,Qe,Q,[k7]),Ai(J,Q,null)}finally{Y0()}return new gb(this.componentType,he,mh(ue,Q),Q,ue)}}class gb extends iS{constructor(t,n,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new Cu(r),this.componentType=t}setInput(t,n){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),n))return;const s=this._rootLView;ir(s[dn],s,r,t,n),this.previousInputValues.set(t,n),ac(_t(this._tNode.index,s))}}get injector(){return new ch(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function k7(){const e=Vr();Nm(vt()[dn],e)}function If(e){let t=function Vk(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const i=[e];for(;t;){let r;if(Aa(e))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new $e(903,!1);r=t.\u0275dir}if(r){if(n){i.push(r);const u=e;u.inputs=rE(e.inputs),u.inputTransforms=rE(e.inputTransforms),u.declaredInputs=rE(e.declaredInputs),u.outputs=rE(e.outputs);const h=r.hostBindings;h&&N7(e,h);const g=r.viewQuery,x=r.contentQueries;if(g&&L7(e,g),x&&F7(e,x),te(e.inputs,r.inputs),te(e.declaredInputs,r.declaredInputs),te(e.outputs,r.outputs),null!==r.inputTransforms&&(null===u.inputTransforms&&(u.inputTransforms={}),te(u.inputTransforms,r.inputTransforms)),Aa(r)&&r.data.animation){const C=e.data;C.animation=(C.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let u=0;u<s.length;u++){const h=s[u];h&&h.ngInherit&&h(e),h===If&&(n=!1)}}t=Object.getPrototypeOf(t)}!function R7(e){let t=0,n=null;for(let i=e.length-1;i>=0;i--){const r=e[i];r.hostVars=t+=r.hostVars,r.hostAttrs=wc(r.hostAttrs,n=wc(n,r.hostAttrs))}}(i)}function rE(e){return e===ds?{}:e===Ei?[]:e}function L7(e,t){const n=e.viewQuery;e.viewQuery=n?(i,r)=>{t(i,r),n(i,r)}:t}function F7(e,t){const n=e.contentQueries;e.contentQueries=n?(i,r,s)=>{t(i,r,s),n(i,r,s)}:t}function N7(e,t){const n=e.hostBindings;e.hostBindings=n?(i,r)=>{t(i,r),n(i,r)}:t}function Gk(e){const t=e.inputConfig,n={};for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];Array.isArray(r)&&r[2]&&(n[i]=r[2])}e.inputTransforms=n}function oE(e){return!!dS(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function dS(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function bh(e,t,n){return e[t]=n}function sl(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function vg(e,t,n,i){const r=sl(e,t,n);return sl(e,t+1,i)||r}function vb(e,t,n,i){const r=vt();return sl(r,nh(),t)&&(Ii(),Ln(ro(),r,e,t,n,i)),vb}function gy(e,t,n,i,r,s){const h=vg(e,function Jl(){return cn.lFrame.bindingIndex}(),n,r);return ec(2),h?t+$t(n)+i+$t(r)+s:mi}function jn(e,t,n,i,r,s,u,h){const g=vt(),x=Ii(),C=e+Si,S=x.firstCreatePass?function l9(e,t,n,i,r,s,u,h,g){const x=t.consts,C=a(t,e,4,u||null,kn(x,h));st(t,n,C,kn(x,g)),Nm(t,C);const S=C.tView=T(2,C,i,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,x,null);return null!==t.queries&&(t.queries.template(t,C),S.queries=t.queries.embeddedTView(C)),C}(C,x,g,t,n,i,r,s,u):x.data[C];Oa(S,!1);const O=rR(x,g,S,e);rf()&&$_(x,g,O,S),ns(O,g),Yi(g,g[C]=Zn(O,g,O,S)),ef(S)&&y(x,g,S),null!=u&&b(g,S,h)}let rR=function oR(e,t,n,i){return Ao(!0),t[Jn].createComment("")};function Ut(e,t,n){const i=vt();return sl(i,nh(),t)&&xe(Ii(),ro(),i,e,t,i[Jn],n,!1),Ut}function _S(e,t,n,i,r){const u=r?"class":"style";ir(e,n,t.inputs[u],u,i)}function Rt(e,t,n,i){const r=vt(),s=Ii(),u=Si+e,h=r[Jn],g=s.firstCreatePass?function f9(e,t,n,i,r,s){const u=t.consts,g=a(t,e,2,i,kn(u,r));return st(t,n,g,kn(u,s)),null!==g.attrs&&is(g,g.attrs,!1),null!==g.mergedAttrs&&is(g,g.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,g),g}(u,s,r,t,n,i):s.data[u],x=sR(s,r,g,h,t,e);r[u]=x;const C=ef(g);return Oa(g,!0),mw(h,x,g),32!=(32&g.flags)&&rf()&&$_(s,r,x,g),0===function ps(){return cn.lFrame.elementDepthCount}()&&ns(x,r),function Fo(){cn.lFrame.elementDepthCount++}(),C&&(y(s,r,g),p(s,g,r)),null!==i&&b(r,g),Rt}function kt(){let e=Vr();od()?tf():(e=e.parent,Oa(e,!1));const t=e;(function gr(e){return cn.skipHydrationRootTNode===e})(t)&&function Rr(){cn.skipHydrationRootTNode=null}(),function Qa(){cn.lFrame.elementDepthCount--}();const n=Ii();return n.firstCreatePass&&(Nm(n,e),id(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Bm(e){return 0!=(8&e.flags)}(t)&&_S(n,t,vt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function yp(e){return 0!=(16&e.flags)}(t)&&_S(n,t,vt(),t.stylesWithoutHost,!1),kt}function Hi(e,t,n,i){return Rt(e,t,n,i),kt(),Hi}let sR=(e,t,n,i,r,s)=>(Ao(!0),tg(i,r,function Tn(){return cn.lFrame.currentNamespace}()));function Af(e,t,n){const i=vt(),r=Ii(),s=e+Si,u=r.firstCreatePass?function g9(e,t,n,i,r){const s=t.consts,u=kn(s,i),h=a(t,e,8,"ng-container",u);return null!==u&&is(h,u,!0),st(t,n,h,kn(s,r)),null!==t.queries&&t.queries.elementStart(t,h),h}(s,r,i,t,n):r.data[s];Oa(u,!0);const h=lR(r,i,u,e);return i[s]=h,rf()&&$_(r,i,h,u),ns(h,i),ef(u)&&(y(r,i,u),p(r,u,i)),null!=n&&b(i,u),Af}function Pf(){let e=Vr();const t=Ii();return od()?tf():(e=e.parent,Oa(e,!1)),t.firstCreatePass&&(Nm(t,e),id(e)&&t.queries.elementEnd(e)),Pf}let lR=(e,t,n,i)=>(Ao(!0),Dv(t[Jn],""));function Kp(){return vt()}function uE(e){return!!e&&"function"==typeof e.then}function cR(e){return!!e&&"function"==typeof e.subscribe}function xs(e,t,n,i){const r=vt(),s=Ii(),u=Vr();return uR(s,r,r[Jn],u,e,t,i),xs}function yS(e,t){const n=Vr(),i=vt(),r=Ii();return uR(r,i,Zr(X0(r.data),n,i),n,e,t),yS}function uR(e,t,n,i,r,s,u){const h=ef(i),x=e.firstCreatePass&&Fr(e),C=t[mr],S=dr(t);let O=!0;if(3&i.type||u){const G=He(i,t),Y=u?u(G):G,J=S.length,Q=u?ue=>u(ht(ue[i.index])):i.index;let he=null;if(!u&&h&&(he=function v9(e,t,n,i){const r=e.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const u=r[s];if(u===n&&r[s+1]===i){const h=t[ca],g=r[s+2];return h.length>g?h[g]:null}"string"==typeof u&&(s+=2)}return null}(e,t,r,i.index)),null!==he)(he.__ngLastListenerFn__||he).__ngNextListenerFn__=s,he.__ngLastListenerFn__=s,O=!1;else{s=hR(i,t,C,s,!1);const ue=n.listen(Y,r,s);S.push(s,ue),x&&x.push(r,Q,J,J+1)}}else s=hR(i,t,C,s,!1);const F=i.outputs;let $;if(O&&null!==F&&($=F[r])){const G=$.length;if(G)for(let Y=0;Y<G;Y+=2){const we=t[$[Y]][$[Y+1]].subscribe(s),Ie=S.length;S.push(s,we),x&&x.push(r,i.index,Ie,-(Ie+1))}}}function dR(e,t,n,i){try{return Le(6,t,n),!1!==n(i)}catch(r){return oo(e,r),!1}finally{Le(7,t,n)}}function hR(e,t,n,i,r){return function s(u){if(u===Function)return i;ac(e.componentOffset>-1?_t(e.index,t):t);let g=dR(t,n,i,u),x=s.__ngNextListenerFn__;for(;x;)g=dR(t,n,x,u)&&g,x=x.__ngNextListenerFn__;return r&&!1===g&&u.preventDefault(),g}}function Rn(e=1){return function JT(e){return(cn.lFrame.contextLView=function eD(e,t){for(;e>0;)t=t[Dc],e--;return t}(e,cn.lFrame.contextLView))[mr]}(e)}function b9(e,t){let n=null;const i=function Ur(e){const t=e.attrs;if(null!=t){const n=t.indexOf(5);if(!(1&n))return t[n+1]}return null}(e);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===i?gi(e,s,!0):Wr(i,s))return r}else n=r}return n}function Eb(e){const t=vt()[Ft][vo];if(!t.projection){const i=t.projection=uf(e?e.length:1,null),r=i.slice();let s=t.child;for(;null!==s;){const u=e?b9(s,e):0;null!==u&&(r[u]?r[u].projectionNext=s:i[u]=s,r[u]=s),s=s.next}}}function bg(e,t=0,n){const i=vt(),r=Ii(),s=a(r,Si+e,16,null,n||null);null===s.projection&&(s.projection=t),tf(),(!i[Ka]||cr())&&32!=(32&s.flags)&&function sg(e,t,n){Fv(t[Jn],0,t,n,Iv(e,n,t),Pv(n.parent||t[vo],n,t))}(r,i,s)}function dE(e,t){return e<<17|t<<2}function Qp(e){return e>>17&32767}function bS(e){return 2|e}function xg(e){return(131068&e)>>2}function xS(e,t){return-131069&e|t<<2}function wS(e){return 1|e}function wR(e,t,n,i,r){const s=e[n+1],u=null===t;let h=i?Qp(s):xg(s),g=!1;for(;0!==h&&(!1===g||u);){const C=e[h+1];T9(e[h],t)&&(g=!0,e[h+1]=i?wS(C):bS(C)),h=i?Qp(C):xg(C)}g&&(e[n+1]=i?bS(s):wS(s))}function T9(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&Bi(e,t)>=0}const js={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function ER(e){return e.substring(js.key,js.keyEnd)}function CR(e,t){const n=js.textEnd;return n===t?-1:(t=js.keyEnd=function A9(e,t,n){for(;t<n&&e.charCodeAt(t)>32;)t++;return t}(e,js.key=t,n),Ey(e,t,n))}function Ey(e,t,n){for(;t<n&&e.charCodeAt(t)<=32;)t++;return t}function Cy(e,t,n){return Ed(e,t,n,!1),Cy}function kl(e,t){return Ed(e,t,null,!0),kl}function IR(e){!function Cd(e,t,n,i){const r=Ii(),s=ec(2);r.firstUpdatePass&&PR(r,null,s,i);const u=vt();if(n!==mi&&sl(u,s,n)){const h=r.data[ka()];if(LR(h,i)&&!AR(r,s)){let g=i?h.classesWithoutHost:h.stylesWithoutHost;null!==g&&(n=Ee(g,n||"")),_S(r,h,u,n,i)}else!function U9(e,t,n,i,r,s,u,h){r===mi&&(r=Ei);let g=0,x=0,C=0<r.length?r[0]:null,S=0<s.length?s[0]:null;for(;null!==C||null!==S;){const O=g<r.length?r[g+1]:void 0,F=x<s.length?s[x+1]:void 0;let G,$=null;C===S?(g+=2,x+=2,O!==F&&($=S,G=F)):null===S||null!==C&&C<S?(g+=2,$=C):(x+=2,$=S,G=F),null!==$&&kR(e,t,n,i,$,G,u,h),C=g<r.length?r[g]:null,S=x<s.length?s[x]:null}}(r,h,u,u[Jn],u[s+1],u[s+1]=function z9(e,t,n){if(null==n||""===n)return Ei;const i=[],r=Vs(n);if(Array.isArray(r))for(let s=0;s<r.length;s++)e(i,r[s],!0);else if("object"==typeof r)for(const s in r)r.hasOwnProperty(s)&&e(i,s,r[s]);else"string"==typeof r&&t(i,r);return i}(e,t,n),i,s)}}(B9,wh,e,!0)}function wh(e,t){for(let n=function S9(e){return function TR(e){js.key=0,js.keyEnd=0,js.value=0,js.valueEnd=0,js.textEnd=e.length}(e),CR(e,Ey(e,0,js.textEnd))}(t);n>=0;n=CR(t,n))nl(e,ER(t),!0)}function Ed(e,t,n,i){const r=vt(),s=Ii(),u=ec(2);s.firstUpdatePass&&PR(s,e,u,i),t!==mi&&sl(r,u,t)&&kR(s,s.data[ka()],r,r[Jn],e,r[u+1]=function V9(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=pe(Vs(e)))),e}(t,n),i,u)}function AR(e,t){return t>=e.expandoStartIndex}function PR(e,t,n,i){const r=e.data;if(null===r[n+1]){const s=r[ka()],u=AR(e,n);LR(s,i)&&null===t&&!u&&(t=!1),t=function R9(e,t,n,i){const r=X0(e);let s=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(n=Cb(n=ES(null,e,t,n,i),t.attrs,i),s=null);else{const u=t.directiveStylingLast;if(-1===u||e[u]!==r)if(n=ES(r,e,t,n,i),null===s){let g=function L9(e,t,n){const i=n?t.classBindings:t.styleBindings;if(0!==xg(i))return e[Qp(i)]}(e,t,i);void 0!==g&&Array.isArray(g)&&(g=ES(null,e,t,g[1],i),g=Cb(g,t.attrs,i),function F9(e,t,n,i){e[Qp(n?t.classBindings:t.styleBindings)]=i}(e,t,i,g))}else s=function N9(e,t,n){let i;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)i=Cb(i,e[s].hostAttrs,n);return Cb(i,t.attrs,n)}(e,t,i)}return void 0!==s&&(i?t.residualClasses=s:t.residualStyles=s),n}(r,s,t,i),function C9(e,t,n,i,r,s){let u=s?t.classBindings:t.styleBindings,h=Qp(u),g=xg(u);e[i]=n;let C,x=!1;if(Array.isArray(n)?(C=n[1],(null===C||Bi(n,C)>0)&&(x=!0)):C=n,r)if(0!==g){const O=Qp(e[h+1]);e[i+1]=dE(O,h),0!==O&&(e[O+1]=xS(e[O+1],i)),e[h+1]=function w9(e,t){return 131071&e|t<<17}(e[h+1],i)}else e[i+1]=dE(h,0),0!==h&&(e[h+1]=xS(e[h+1],i)),h=i;else e[i+1]=dE(g,0),0===h?h=i:e[g+1]=xS(e[g+1],i),g=i;x&&(e[i+1]=bS(e[i+1])),wR(e,C,i,!0),wR(e,C,i,!1),function M9(e,t,n,i,r){const s=r?e.residualClasses:e.residualStyles;null!=s&&"string"==typeof t&&Bi(s,t)>=0&&(n[i+1]=wS(n[i+1]))}(t,C,e,i,s),u=dE(h,g),s?t.classBindings=u:t.styleBindings=u}(r,s,t,n,u,i)}}function ES(e,t,n,i,r){let s=null;const u=n.directiveEnd;let h=n.directiveStylingLast;for(-1===h?h=n.directiveStart:h++;h<u&&(s=t[h],i=Cb(i,s.hostAttrs,r),s!==e);)h++;return null!==e&&(n.directiveStylingLast=h),i}function Cb(e,t,n){const i=n?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const u=t[s];"number"==typeof u?r=u:r===i&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),nl(e,u,!!n||t[++s]))}return void 0===e?null:e}function B9(e,t,n){const i=String(t);""!==i&&!i.includes(" ")&&nl(e,i,n)}function kR(e,t,n,i,r,s,u,h){if(!(3&t.type))return;const g=e.data,x=g[h+1],C=function E9(e){return 1==(1&e)}(x)?RR(g,t,n,r,xg(x),u):void 0;hE(C)||(hE(s)||function x9(e){return 2==(2&e)}(x)&&(s=RR(g,null,n,r,h,u)),function PD(e,t,n,i,r){if(t)r?e.addClass(n,i):e.removeClass(n,i);else{let s=-1===i.indexOf("-")?void 0:_s.DashCase;null==r?e.removeStyle(n,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=_s.Important),e.setStyle(n,i,r,s))}}(i,u,dt(ka(),n),r,s))}function RR(e,t,n,i,r,s){const u=null===t;let h;for(;r>0;){const g=e[r],x=Array.isArray(g),C=x?g[1]:g,S=null===C;let O=n[r+1];O===mi&&(O=S?Ei:void 0);let F=S?pu(O,i):C===i?O:void 0;if(x&&!hE(F)&&(F=pu(g,i)),hE(F)&&(h=F,u))return h;const $=e[r+1];r=u?Qp($):xg($)}if(null!==t){let g=s?t.residualClasses:t.residualStyles;null!=g&&(h=pu(g,i))}return h}function hE(e){return void 0!==e}function LR(e,t){return 0!=(e.flags&(t?8:16))}function In(e,t=""){const n=vt(),i=Ii(),r=e+Si,s=i.firstCreatePass?a(i,r,1,t,null):i.data[r],u=FR(i,n,s,t,e);n[r]=u,rf()&&$_(i,n,u,s),Oa(s,!1)}let FR=(e,t,n,i,r)=>(Ao(!0),function z_(e,t){return e.createText(t)}(t[Jn],i));function Ar(e){return Md("",e,""),Ar}function Md(e,t,n){const i=vt(),r=function my(e,t,n,i){return sl(e,nh(),n)?t+$t(n)+i:mi}(i,e,t,n);return r!==mi&&Ir(i,ka(),r),Md}function CS(e,t,n,i,r){const s=vt(),u=gy(s,e,t,n,i,r);return u!==mi&&Ir(s,ka(),u),CS}function MS(e,t,n){const i=vt();if(sl(i,nh(),t)){const s=Ii(),u=ro();xe(s,u,i,e,t,Zr(X0(s.data),u,i),n,!0)}return MS}const wg=void 0;var cH=["en",[["a","p"],["AM","PM"],wg],[["AM","PM"],wg,wg],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],wg,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],wg,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",wg,"{1} 'at' {0}",wg],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function lH(e){const n=Math.floor(Math.abs(e)),i=e.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===i?1:5}];let My={};function Rl(e){const t=function uH(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=tL(t);if(n)return n;const i=t.split("-")[0];if(n=tL(i),n)return n;if("en"===i)return cH;throw new $e(701,!1)}function tL(e){return e in My||(My[e]=ar.ng&&ar.ng.common&&ar.ng.common.locales&&ar.ng.common.locales[e]),My[e]}var vn=(()=>((vn=vn||{})[vn.LocaleId=0]="LocaleId",vn[vn.DayPeriodsFormat=1]="DayPeriodsFormat",vn[vn.DayPeriodsStandalone=2]="DayPeriodsStandalone",vn[vn.DaysFormat=3]="DaysFormat",vn[vn.DaysStandalone=4]="DaysStandalone",vn[vn.MonthsFormat=5]="MonthsFormat",vn[vn.MonthsStandalone=6]="MonthsStandalone",vn[vn.Eras=7]="Eras",vn[vn.FirstDayOfWeek=8]="FirstDayOfWeek",vn[vn.WeekendRange=9]="WeekendRange",vn[vn.DateFormat=10]="DateFormat",vn[vn.TimeFormat=11]="TimeFormat",vn[vn.DateTimeFormat=12]="DateTimeFormat",vn[vn.NumberSymbols=13]="NumberSymbols",vn[vn.NumberFormats=14]="NumberFormats",vn[vn.CurrencyCode=15]="CurrencyCode",vn[vn.CurrencySymbol=16]="CurrencySymbol",vn[vn.CurrencyName=17]="CurrencyName",vn[vn.Currencies=18]="Currencies",vn[vn.Directionality=19]="Directionality",vn[vn.PluralCase=20]="PluralCase",vn[vn.ExtraData=21]="ExtraData",vn))();const Ty="en-US";let nL=Ty;class Dy{}class SL{}class OS extends Dy{constructor(t,n,i){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new fb(this);const r=nr(t);this._bootstrapComponents=fa(r.bootstrap),this._r3Injector=hy(t,n,[{provide:Dy,useValue:this},{provide:qp,useValue:this.componentFactoryResolver},...i],pe(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class kS extends SL{constructor(t){super(),this.moduleType=t}create(t){return new OS(this.moduleType,t,[])}}class IL extends Dy{constructor(t){super(),this.componentFactoryResolver=new fb(this),this.instance=null;const n=new Zv([...t.providers,{provide:Dy,useValue:this},{provide:qp,useValue:this.componentFactoryResolver}],t.parent||gf(),t.debugName,new Set(["environment"]));this.injector=n,t.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function RS(e,t,n=null){return new IL({providers:e,parent:t,debugName:n,runEnvironmentInitializers:!0}).injector}let dG=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const i=Ow(0,n.type),r=i.length>0?RS([i],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,r)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=Zt({token:e,providedIn:"environment",factory:()=>new e(et(xu))}),e})();function AL(e){e.getStandaloneInjector=t=>t.get(dG).getOrCreateStandaloneInjector(e)}function Tu(e,t,n){const i=Ls()+e,r=vt();return r[i]===mi?bh(r,i,n?t.call(n):t()):function yb(e,t){return e[t]}(r,i)}function zL(e,t,n,i,r,s,u){const h=t+n;return vg(e,h,r,s)?bh(e,h+2,u?i.call(u,r,s):i(r,s)):function Ab(e,t){const n=e[t];return n===mi?void 0:n}(e,h+2)}function FS(e,t){const n=Ii();let i;const r=e+Si;n.firstCreatePass?(i=function IG(e,t){if(t)for(let n=t.length-1;n>=0;n--){const i=t[n];if(e===i.name)return i}}(t,n.pipeRegistry),n.data[r]=i,i.onDestroy&&(n.destroyHooks??=[]).push(r,i.onDestroy)):i=n.data[r];const s=i.factory||(i.factory=Ac(i.type)),u=Qr(Nt);try{const h=ts(!1),g=s();return ts(h),function d9(e,t,n,i){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=i}(n,vt(),r,g),g}finally{Qr(u)}}function NS(e,t,n,i){const r=e+Si,s=vt(),u=function ct(e,t){return e[t]}(s,r);return function Pb(e,t){return e[dn].data[t].pure}(s,r)?zL(s,Ls(),t,u.transform,n,i,u):u.transform(n,i)}function zS(e){return t=>{setTimeout(e,void 0,t)}}const ma=class RG extends Yn{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,i){let r=t,s=n||(()=>null),u=i;if(t&&"object"==typeof t){const g=t;r=g.next?.bind(g),s=g.error?.bind(g),u=g.complete?.bind(g)}this.__isAsync&&(s=zS(s),r&&(r=zS(r)),u&&(u=zS(u)));const h=super.subscribe({next:r,error:s,complete:u});return t instanceof pt&&t.add(h),h}};function LG(){return this._results[Symbol.iterator]()}class BS{get changes(){return this._changes||(this._changes=new ma)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=BS.prototype;n[Symbol.iterator]||(n[Symbol.iterator]=LG)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const i=this;i.dirty=!1;const r=function tl(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function qm(e,t,n){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],s=t[i];if(n&&(r=n(r),s=n(s)),s!==r)return!1}return!0}(i._results,r,n))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Eh=(()=>{class e{}return e.__NG_ELEMENT_ID__=zG,e})();const FG=Eh,NG=class extends FG{constructor(t,n,i){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n,null)}createEmbeddedViewImpl(t,n,i){const u=this._declarationTContainer.tView,h=mg(this._declarationLView,u,t,4096&this._declarationLView[Bn]?4096:16,null,u.declTNode,null,null,null,n||null,i||null);h[Ps]=this._declarationLView[this._declarationTContainer.index];const x=this._declarationLView[ua];return null!==x&&(h[ua]=x.createEmbeddedView(u)),Ai(u,h,t),new Df(h)}};function zG(){return _E(Vr(),vt())}function _E(e,t){return 4&e.type?new NG(t,e,mh(e,t)):null}let $c=(()=>{class e{}return e.__NG_ELEMENT_ID__=GG,e})();function GG(){return WL(Vr(),vt())}const qG=$c,GL=class extends qG{constructor(t,n,i){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=i}get element(){return mh(this._hostTNode,this._hostLView)}get injector(){return new ch(this._hostTNode,this._hostLView)}get parentInjector(){const t=w_(this._hostTNode,this._hostLView);if(Q0(t)){const n=da(t,this._hostLView),i=ah(t);return new ch(n[dn].data[i+8],n)}return new ch(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=qL(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-Ro}createEmbeddedView(t,n,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const h=t.createEmbeddedViewImpl(n||{},s,null);return this.insertImpl(h,r,false),h}createComponent(t,n,i,r,s){const u=t&&!function xp(e){return"function"==typeof e}(t);let h;if(u)h=n;else{const G=n||{};h=G.index,i=G.injector,r=G.projectableNodes,s=G.environmentInjector||G.ngModuleRef}const g=u?t:new cc(Mn(t)),x=i||this.parentInjector;if(!s&&null==g.ngModule){const Y=(u?x:this.parentInjector).get(xu,null);Y&&(s=Y)}Mn(g.componentType??{});const F=g.create(x,r,null,s);return this.insertImpl(F.hostView,h,false),F}insert(t,n){return this.insertImpl(t,n,!1)}insertImpl(t,n,i){const r=t._lView,s=r[dn];if(function wn(e){return Lo(e[Tr])}(r)){const g=this.indexOf(t);if(-1!==g)this.detach(g);else{const x=r[Tr],C=new GL(x,x[vo],x[Tr]);C.detach(C.indexOf(t))}}const u=this._adjustIndex(n),h=this._lContainer;if(function aw(e,t,n,i){const r=Ro+i,s=n.length;i>0&&(n[r-1][So]=t),i<s-Ro?(t[So]=n[r],cf(n,Ro+i,t)):(n.push(t),t[So]=null),t[Tr]=n;const u=t[Ps];null!==u&&n!==u&&function lw(e,t){const n=e[Tl];t[Ft]!==t[Tr][Tr][Ft]&&(e[up]=!0),null===n?e[Tl]=[t]:n.push(t)}(u,t);const h=t[ua];null!==h&&h.insertView(e),t[Bn]|=128}(s,r,h,u),!i){const g=Pp(u,h),x=r[Jn],C=V_(x,h[Yl]);null!==C&&function DD(e,t,n,i,r,s){i[Mr]=r,i[vo]=t,yu(e,i,n,1,r,s)}(s,h[vo],x,r,C,g)}return t.attachToViewContainerRef(),cf(VS(h),u,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=qL(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),i=Sv(this._lContainer,n);i&&(Wm(VS(this._lContainer),n),uw(i[dn],i))}detach(t){const n=this._adjustIndex(t,-1),i=Sv(this._lContainer,n);return i&&null!=Wm(VS(this._lContainer),n)?new Df(i):null}_adjustIndex(t,n=0){return t??this.length+n}};function qL(e){return e[8]}function VS(e){return e[8]||(e[8]=[])}function WL(e,t){let n;const i=t[e.index];return Lo(i)?n=i:(n=Zn(i,t,null,e),t[e.index]=n,Yi(t,n)),ZL(n,t,e,i),new GL(n,e,t)}let ZL=function XL(e,t,n,i){if(e[Yl])return;let r;r=8&n.type?ht(i):function WG(e,t){const n=e[Jn],i=n.createComment(""),r=He(t,e);return zc(n,V_(n,r),i,function hw(e,t){return e.nextSibling(t)}(n,r),!1),i}(t,n),e[Yl]=r};class jS{constructor(t){this.queryList=t,this.matches=null}clone(){return new jS(this.queryList)}setDirty(){this.queryList.setDirty()}}class $S{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const i=null!==t.contentQueries?t.contentQueries[0]:n.length,r=[];for(let s=0;s<i;s++){const u=n.getByIndex(s);r.push(this.queries[u.indexInDeclarationView].clone())}return new $S(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==tF(t,n).matches&&this.queries[n].setDirty()}}class YL{constructor(t,n,i=null){this.predicate=t,this.flags=n,this.read=i}}class HS{constructor(t=[]){this.queries=t}elementStart(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let i=0;i<this.length;i++){const r=null!==n?n.length:0,s=this.getByIndex(i).embeddedTView(t,r);s&&(s.indexInDeclarationView=i,null!==n?n.push(s):n=[s])}return null!==n?new HS(n):null}template(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class GS{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new GS(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==n;)i=i.parent;return n===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(t,n,YG(n,s)),this.matchTNodeWithReadOption(t,n,Vm(n,t,s,!1,!1))}else i===Eh?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,Vm(n,t,i,!1,!1))}matchTNodeWithReadOption(t,n,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===vs||r===$c||r===Eh&&4&n.type)this.addMatch(n.index,-2);else{const s=Vm(n,t,r,!1,!1);null!==s&&this.addMatch(n.index,s)}else this.addMatch(n.index,i)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function YG(e,t){const n=e.localNames;if(null!==n)for(let i=0;i<n.length;i+=2)if(n[i]===t)return n[i+1];return null}function QG(e,t,n,i){return-1===n?function KG(e,t){return 11&e.type?mh(e,t):4&e.type?_E(e,t):null}(t,e):-2===n?function JG(e,t,n){return n===vs?mh(t,e):n===Eh?_E(t,e):n===$c?WL(t,e):void 0}(e,t,i):lh(e,e[dn],n,t)}function KL(e,t,n,i){const r=t[ua].queries[i];if(null===r.matches){const s=e.data,u=n.matches,h=[];for(let g=0;g<u.length;g+=2){const x=u[g];h.push(x<0?null:QG(t,s[x],u[g+1],n.metadata.read))}r.matches=h}return r.matches}function qS(e,t,n,i){const r=e.queries.getByIndex(n),s=r.matches;if(null!==s){const u=KL(e,t,r,n);for(let h=0;h<s.length;h+=2){const g=s[h];if(g>0)i.push(u[h/2]);else{const x=s[h+1],C=t[-g];for(let S=Ro;S<C.length;S++){const O=C[S];O[Ps]===O[Tr]&&qS(O[dn],O,x,i)}if(null!==C[Tl]){const S=C[Tl];for(let O=0;O<S.length;O++){const F=S[O];qS(F[dn],F,x,i)}}}}}return i}function Jp(e){const t=vt(),n=Ii(),i=z1();Lm(i+1);const r=tF(n,i);if(e.dirty&&function yt(e){return 4==(4&e[Bn])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)e.reset([]);else{const s=r.crossesNgTemplate?qS(n,t,i,[]):KL(n,t,r,i);e.reset(s,hg),e.notifyOnChanges()}return!0}return!1}function Eg(e,t,n){const i=Ii();i.firstCreatePass&&(function eF(e,t,n){null===e.queries&&(e.queries=new HS),e.queries.track(new GS(t,n))}(i,new YL(e,t,n),-1),2==(2&t)&&(i.staticViewQueries=!0)),function JL(e,t,n){const i=new BS(4==(4&n));(function X(e,t,n,i){const r=dr(t);r.push(n),e.firstCreatePass&&Fr(e).push(i,r.length-1)})(e,t,i,i.destroy),null===t[ua]&&(t[ua]=new $S),t[ua].queries.push(new jS(i))}(i,vt(),t)}function em(){return function eq(e,t){return e[ua].queries[t].queryList}(vt(),z1())}function tF(e,t){return e.queries.getByIndex(t)}const QS=new sn("Application Initializer");let JS=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,i)=>{this.resolve=n,this.reject=i}),this.appInits=tn(QS,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const r of this.appInits){const s=r();if(uE(s))n.push(s);else if(cR(s)){const u=new Promise((h,g)=>{s.subscribe({complete:h,error:g})});n.push(u)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{i()}).catch(r=>{this.reject(r)}),0===n.length&&i(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),yF=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Ch=new sn("LocaleId",{providedIn:"root",factory:()=>tn(Ch,en.Optional|en.SkipSelf)||function Eq(){return typeof $localize<"u"&&$localize.locale||Ty}()});let vE=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Kr(!1)}add(){this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class Mq{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let vF=(()=>{class e{compileModuleSync(n){return new kS(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),s=fa(nr(n).declarations).reduce((u,h)=>{const g=Mn(h);return g&&u.push(new cc(g)),u},[]);return new Mq(i,s)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function wF(...e){}class Fi{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ma(!1),this.onMicrotaskEmpty=new ma(!1),this.onStable=new ma(!1),this.onError=new ma(!1),typeof Zone>"u")throw new $e(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&n,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function Sq(){let e=ar.requestAnimationFrame,t=ar.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function Pq(e){const t=()=>{!function Aq(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(ar,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,t2(e),e.isCheckStableRunning=!0,e2(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),t2(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,r,s,u,h)=>{try{return EF(e),n.invokeTask(r,s,u,h)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&t(),CF(e)}},onInvoke:(n,i,r,s,u,h,g)=>{try{return EF(e),n.invoke(r,s,u,h,g)}finally{e.shouldCoalesceRunChangeDetection&&t(),CF(e)}},onHasTask:(n,i,r,s)=>{n.hasTask(r,s),i===r&&("microTask"==s.change?(e._hasPendingMicrotasks=s.microTask,t2(e),e2(e)):"macroTask"==s.change&&(e.hasPendingMacrotasks=s.macroTask))},onHandleError:(n,i,r,s)=>(n.handleError(r,s),e.runOutsideAngular(()=>e.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Fi.isInAngularZone())throw new $e(909,!1)}static assertNotInAngularZone(){if(Fi.isInAngularZone())throw new $e(909,!1)}run(t,n,i){return this._inner.run(t,n,i)}runTask(t,n,i,r){const s=this._inner,u=s.scheduleEventTask("NgZoneEvent: "+r,t,Iq,wF,wF);try{return s.runTask(u,n,i)}finally{s.cancelTask(u)}}runGuarded(t,n,i){return this._inner.runGuarded(t,n,i)}runOutsideAngular(t){return this._outer.run(t)}}const Iq={};function e2(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function t2(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function EF(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function CF(e){e._nesting--,e2(e)}class Oq{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ma,this.onMicrotaskEmpty=new ma,this.onStable=new ma,this.onError=new ma}run(t,n,i){return t.apply(n,i)}runGuarded(t,n,i){return t.apply(n,i)}runOutsideAngular(t){return t()}runTask(t,n,i,r){return t.apply(n,i)}}const MF=new sn("",{providedIn:"root",factory:TF});function TF(){const e=tn(Fi);let t=!0;return Kt(new ii(r=>{t=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{r.next(t),r.complete()})}),new ii(r=>{let s;e.runOutsideAngular(()=>{s=e.onStable.subscribe(()=>{Fi.assertNotInAngularZone(),queueMicrotask(()=>{!t&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(t=!0,r.next(!0))})})});const u=e.onUnstable.subscribe(()=>{Fi.assertInAngularZone(),t&&(t=!1,e.runOutsideAngular(()=>{r.next(!1)}))});return()=>{s.unsubscribe(),u.unsubscribe()}}).pipe(oi()))}const DF=new sn(""),bE=new sn("");let o2,n2=(()=>{class e{constructor(n,i,r){this._ngZone=n,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,o2||(function kq(e){o2=e}(r),r.addToWindow(i)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Fi.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(n)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(u=>u.timeoutId!==s),n(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:n,timeoutId:s,updateCb:r})}whenStable(n,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,i,r){return[]}}return e.\u0275fac=function(n){return new(n||e)(et(Fi),et(r2),et(bE))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})(),r2=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,i){this._applications.set(n,i)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,i=!0){return o2?.findTestabilityInTree(this,n,i)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),tm=null;const SF=new sn("AllowMultipleToken"),s2=new sn("PlatformDestroyListeners"),a2=new sn("appBootstrapListener");class AF{constructor(t,n){this.name=t,this.token=n}}function OF(e,t,n=[]){const i=`Platform: ${t}`,r=new sn(i);return(s=[])=>{let u=l2();if(!u||u.injector.get(SF,!1)){const h=[...n,...s,{provide:r,useValue:!0}];e?e(h):function Fq(e){if(tm&&!tm.get(SF,!1))throw new $e(400,!1);(function IF(){!function I(e){w=e}(()=>{throw new $e(600,!1)})})(),tm=e;const t=e.get(RF);(function PF(e){e.get(jp,null)?.forEach(n=>n())})(e)}(function kF(e=[],t){return bs.create({name:t,providers:[{provide:ny,useValue:"platform"},{provide:s2,useValue:new Set([()=>tm=null])},...e]})}(h,i))}return function zq(e){const t=l2();if(!t)throw new $e(401,!1);return t}()}}function l2(){return tm?.get(RF)??null}let RF=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,i){const r=function Bq(e="zone.js",t){return"noop"===e?new Oq:"zone.js"===e?new Fi(t):e}(i?.ngZone,function LF(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return r.run(()=>{const s=function uG(e,t,n){return new OS(e,t,n)}(n.moduleType,this.injector,function UF(e){return[{provide:Fi,useFactory:e},{provide:Bp,multi:!0,useFactory:()=>{const t=tn(Vq,{optional:!0});return()=>t.initialize()}},{provide:BF,useFactory:Uq},{provide:MF,useFactory:TF}]}(()=>r)),u=s.injector.get(gh,null);return r.runOutsideAngular(()=>{const h=r.onError.subscribe({next:g=>{u.handleError(g)}});s.onDestroy(()=>{xE(this._modules,s),h.unsubscribe()})}),function FF(e,t,n){try{const i=n();return uE(i)?i.catch(r=>{throw t.runOutsideAngular(()=>e.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>e.handleError(i)),i}}(u,r,()=>{const h=s.injector.get(JS);return h.runInitializers(),h.donePromise.then(()=>(function iL(e){ia(e,"Expected localeId to be defined"),"string"==typeof e&&(nL=e.toLowerCase().replace(/_/g,"-"))}(s.injector.get(Ch,Ty)||Ty),this._moduleDoBootstrap(s),s))})})}bootstrapModule(n,i=[]){const r=NF({},i);return function Rq(e,t,n){const i=new kS(n);return Promise.resolve(i)}(0,0,n).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(n){const i=n.injector.get(nm);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!n.instance.ngDoBootstrap)throw new $e(-403,!1);n.instance.ngDoBootstrap(i)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new $e(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const n=this._injector.get(s2,null);n&&(n.forEach(i=>i()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(et(bs))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function NF(e,t){return Array.isArray(t)?t.reduce(NF,e):{...e,...t}}let nm=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=tn(BF),this.zoneIsStable=tn(MF),this.componentTypes=[],this.components=[],this.isStable=tn(vE).hasPendingTasks.pipe(qr(n=>n?qt(!1):this.zoneIsStable),Vn(),oi()),this._injector=tn(xu)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,i){const r=n instanceof ay;if(!this._injector.get(JS).done)throw!r&&function Cl(e){const t=Mn(e)||tr(e)||kr(e);return null!==t&&t.standalone}(n),new $e(405,!1);let u;u=r?n:this._injector.get(qp).resolveComponentFactory(n),this.componentTypes.push(u.componentType);const h=function Lq(e){return e.isBoundToModule}(u)?void 0:this._injector.get(Dy),x=u.create(bs.NULL,[],i||u.selector,h),C=x.location.nativeElement,S=x.injector.get(DF,null);return S?.registerApplication(C),x.onDestroy(()=>{this.detachView(x.hostView),xE(this.components,x),S?.unregisterApplication(C)}),this._loadComponent(x),x}tick(){if(this._runningTick)throw new $e(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this.internalErrorHandler(n)}finally{this._runningTick=!1}}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;xE(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const i=this._injector.get(a2,[]);i.push(...this._bootstrapListeners),i.forEach(r=>r(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>xE(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new $e(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function xE(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const BF=new sn("",{providedIn:"root",factory:()=>tn(gh).handleError.bind(void 0)});function Uq(){const e=tn(Fi),t=tn(gh);return n=>e.runOutsideAngular(()=>t.handleError(n))}let Vq=(()=>{class e{constructor(){this.zone=tn(Fi),this.applicationRef=tn(nm)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();let Ay=(()=>{class e{}return e.__NG_ELEMENT_ID__=$q,e})();function $q(e){return function Hq(e,t,n){if(Ic(e)&&!n){const i=_t(e.index,t);return new Df(i,i)}return 47&e.type?new Df(t[Ft],t):null}(Vr(),vt(),16==(16&e))}class HF{constructor(){}supports(t){return oE(t)}create(t){return new Yq(t)}}const Xq=(e,t)=>t;class Yq{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Xq}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,i=this._removalsHead,r=0,s=null;for(;n||i;){const u=!i||n&&n.currentIndex<qF(i,r,s)?n:i,h=qF(u,r,s),g=u.currentIndex;if(u===i)r--,i=i._nextRemoved;else if(n=n._next,null==u.previousIndex)r++;else{s||(s=[]);const x=h-r,C=g-r;if(x!=C){for(let O=0;O<x;O++){const F=O<s.length?s[O]:s[O]=0,$=F+O;C<=$&&$<x&&(s[O]=F+1)}s[u.previousIndex]=C-x}}h!==g&&t(u,h,g)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!oE(t))throw new $e(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,u,n=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let h=0;h<this.length;h++)s=t[h],u=this._trackByFn(h,s),null!==n&&Object.is(n.trackById,u)?(i&&(n=this._verifyReinsertion(n,s,u,h)),Object.is(n.item,s)||this._addIdentityChange(n,s)):(n=this._mismatch(n,s,u,h),i=!0),n=n._next}else r=0,function H7(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Symbol.iterator]();let i;for(;!(i=n.next()).done;)t(i.value)}}(t,h=>{u=this._trackByFn(r,h),null!==n&&Object.is(n.trackById,u)?(i&&(n=this._verifyReinsertion(n,h,u,r)),Object.is(n.item,h)||this._addIdentityChange(n,h)):(n=this._mismatch(n,h,u,r),i=!0),n=n._next,r++}),this.length=r;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,i,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,s,r)):t=this._addAfter(new Kq(n,i),s,r),t}_verifyReinsertion(t,n,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,n,i),this._addToMoves(t,i),t}_moveAfter(t,n,i){return this._unlink(t),this._insertAfter(t,n,i),this._addToMoves(t,i),t}_addAfter(t,n,i){return this._insertAfter(t,n,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,i){const r=null===n?this._itHead:n._next;return t._next=r,t._prev=n,null===r?this._itTail=t:r._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new GF),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,i=t._next;return null===n?this._itHead=i:n._next=i,null===i?this._itTail=n:i._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new GF),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Kq{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Qq{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===n||n<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const n=t._prevDup,i=t._nextDup;return null===n?this._head=i:n._nextDup=i,null===i?this._tail=n:i._prevDup=n,null===this._head}}class GF{constructor(){this.map=new Map}put(t){const n=t.trackById;let i=this.map.get(n);i||(i=new Qq,this.map.set(n,i)),i.add(t)}get(t,n){const r=this.map.get(t);return r?r.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function qF(e,t,n){const i=e.previousIndex;if(null===i)return i;let r=0;return n&&i<n.length&&(r=n[i]),i+t+r}class WF{constructor(){}supports(t){return t instanceof Map||dS(t)}create(){return new Jq}}class Jq{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let n;for(n=this._mapHead;null!==n;n=n._next)t(n)}forEachPreviousItem(t){let n;for(n=this._previousMapHead;null!==n;n=n._nextPrevious)t(n)}forEachChangedItem(t){let n;for(n=this._changesHead;null!==n;n=n._nextChanged)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}diff(t){if(t){if(!(t instanceof Map||dS(t)))throw new $e(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(n&&n.key===r)this._maybeAddToChanges(n,i),this._appendAfter=n,n=n._next;else{const s=this._getOrCreateRecordForKey(r,i);n=this._insertBeforeOrAppend(n,s)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let i=n;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,n){if(t){const i=t._prev;return n._next=t,n._prev=i,t._prev=n,i&&(i._next=n),t===this._mapHead&&(this._mapHead=n),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(t,n){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,n);const s=r._prev,u=r._next;return s&&(s._next=u),u&&(u._prev=s),r._next=null,r._prev=null,r}const i=new eW(t);return this._records.set(t,i),i.currentValue=n,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,n){Object.is(n,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=n,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,n){t instanceof Map?t.forEach(n):Object.keys(t).forEach(i=>n(t[i],i))}}class eW{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function ZF(){return new CE([new HF])}let CE=(()=>{class e{constructor(n){this.factories=n}static create(n,i){if(null!=i){const r=i.factories.slice();n=n.concat(r)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||ZF()),deps:[[e,new I_,new Zm]]}}find(n){const i=this.factories.find(r=>r.supports(n));if(null!=i)return i;throw new $e(901,!1)}}return e.\u0275prov=Zt({token:e,providedIn:"root",factory:ZF}),e})();function XF(){return new kb([new WF])}let kb=(()=>{class e{constructor(n){this.factories=n}static create(n,i){if(i){const r=i.factories.slice();n=n.concat(r)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||XF()),deps:[[e,new I_,new Zm]]}}find(n){const i=this.factories.find(r=>r.supports(n));if(i)return i;throw new $e(901,!1)}}return e.\u0275prov=Zt({token:e,providedIn:"root",factory:XF}),e})();const iW=OF(null,"core",[]);let rW=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(et(nm))},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({}),e})();function m2(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let g2=null;function Py(){return g2}class gW{}const Ki=new sn("DocumentToken");let _2=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:function(){return tn(yW)},providedIn:"platform"}),e})();const _W=new sn("Location Initialized");let yW=(()=>{class e extends _2{constructor(){super(),this._doc=tn(Ki),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Py().getBaseHref(this._doc)}onPopState(n){const i=Py().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=Py().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,i,r){this._history.pushState(n,i,r)}replaceState(n,i,r){this._history.replaceState(n,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:function(){return new e},providedIn:"platform"}),e})();function y2(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function n5(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Of(e){return e&&"?"!==e[0]?"?"+e:e}let Mg=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:function(){return tn(o5)},providedIn:"root"}),e})();const r5=new sn("appBaseHref");let o5=(()=>{class e extends Mg{constructor(n,i){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??tn(Ki).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return y2(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+Of(this._platformLocation.search),r=this._platformLocation.hash;return r&&n?`${i}${r}`:i}pushState(n,i,r,s){const u=this.prepareExternalUrl(r+Of(s));this._platformLocation.pushState(n,i,u)}replaceState(n,i,r,s){const u=this.prepareExternalUrl(r+Of(s));this._platformLocation.replaceState(n,i,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(et(_2),et(r5,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),vW=(()=>{class e extends Mg{constructor(n,i){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(n){const i=y2(this._baseHref,n);return i.length>0?"#"+i:i}pushState(n,i,r,s){let u=this.prepareExternalUrl(r+Of(s));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.pushState(n,i,u)}replaceState(n,i,r,s){let u=this.prepareExternalUrl(r+Of(s));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.replaceState(n,i,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(et(_2),et(r5,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})(),TE=(()=>{class e{constructor(n){this._subject=new ma,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const i=this._locationStrategy.getBaseHref();this._basePath=function wW(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(n5(s5(i))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+Of(i))}normalize(n){return e.stripTrailingSlash(function xW(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,s5(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,i="",r=null){this._locationStrategy.pushState(r,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Of(i)),r)}replaceState(n,i="",r=null){this._locationStrategy.replaceState(r,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Of(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(r=>r(n,i))}subscribe(n,i,r){return this._subject.subscribe({next:n,error:i,complete:r})}}return e.normalizeQueryParams=Of,e.joinWithSlash=y2,e.stripTrailingSlash=n5,e.\u0275fac=function(n){return new(n||e)(et(Mg))},e.\u0275prov=Zt({token:e,factory:function(){return function bW(){return new TE(et(Mg))}()},providedIn:"root"}),e})();function s5(e){return e.replace(/\/index.html$/,"")}var uc=(()=>((uc=uc||{})[uc.Decimal=0]="Decimal",uc[uc.Percent=1]="Percent",uc[uc.Currency=2]="Currency",uc[uc.Scientific=3]="Scientific",uc))(),ei=(()=>((ei=ei||{})[ei.Decimal=0]="Decimal",ei[ei.Group=1]="Group",ei[ei.List=2]="List",ei[ei.PercentSign=3]="PercentSign",ei[ei.PlusSign=4]="PlusSign",ei[ei.MinusSign=5]="MinusSign",ei[ei.Exponential=6]="Exponential",ei[ei.SuperscriptingExponent=7]="SuperscriptingExponent",ei[ei.PerMille=8]="PerMille",ei[ei.Infinity=9]="Infinity",ei[ei.NaN=10]="NaN",ei[ei.TimeSeparator=11]="TimeSeparator",ei[ei.CurrencyDecimal=12]="CurrencyDecimal",ei[ei.CurrencyGroup=13]="CurrencyGroup",ei))();function Du(e,t){const n=Rl(e),i=n[vn.NumberSymbols][t];if(typeof i>"u"){if(t===ei.CurrencyDecimal)return n[vn.NumberSymbols][ei.Decimal];if(t===ei.CurrencyGroup)return n[vn.NumberSymbols][ei.Group]}return i}const ZW=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function T2(e){const t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}function m5(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const i=n.indexOf("="),[r,s]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}const S2=/\s+/,g5=[];let _5=(()=>{class e{constructor(n,i,r,s){this._iterableDiffers=n,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this.initialClasses=g5,this.stateMap=new Map}set klass(n){this.initialClasses=null!=n?n.trim().split(S2):g5}set ngClass(n){this.rawClass="string"==typeof n?n.trim().split(S2):n}ngDoCheck(){for(const i of this.initialClasses)this._updateState(i,!0);const n=this.rawClass;if(Array.isArray(n)||n instanceof Set)for(const i of n)this._updateState(i,!0);else if(null!=n)for(const i of Object.keys(n))this._updateState(i,!!n[i]);this._applyStateDiff()}_updateState(n,i){const r=this.stateMap.get(n);void 0!==r?(r.enabled!==i&&(r.changed=!0,r.enabled=i),r.touched=!0):this.stateMap.set(n,{enabled:i,changed:!0,touched:!0})}_applyStateDiff(){for(const n of this.stateMap){const i=n[0],r=n[1];r.changed?(this._toggleClass(i,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(i,!1),this.stateMap.delete(i)),r.touched=!1}}_toggleClass(n,i){(n=n.trim()).length>0&&n.split(S2).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return e.\u0275fac=function(n){return new(n||e)(Nt(CE),Nt(kb),Nt(vs),Nt(ly))},e.\u0275dir=Cr({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),e})();class sZ{constructor(t,n,i,r){this.$implicit=t,this.ngForOf=n,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Tg=(()=>{class e{set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}constructor(n,i,r){this._viewContainer=n,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const i=this._viewContainer;n.forEachOperation((r,s,u)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new sZ(r.item,this._ngForOf,-1,-1),null===u?void 0:u);else if(null==u)i.remove(null===s?void 0:s);else if(null!==s){const h=i.get(s);i.move(h,u),v5(h,r)}});for(let r=0,s=i.length;r<s;r++){const h=i.get(r).context;h.index=r,h.count=s,h.ngForOf=this._ngForOf}n.forEachIdentityChange(r=>{v5(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(n,i){return!0}}return e.\u0275fac=function(n){return new(n||e)(Nt($c),Nt(Eh),Nt(CE))},e.\u0275dir=Cr({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),e})();function v5(e,t){e.context.$implicit=t.item}let dc=(()=>{class e{constructor(n,i){this._viewContainer=n,this._context=new aZ,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){b5("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){b5("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,i){return!0}}return e.\u0275fac=function(n){return new(n||e)(Nt($c),Nt(Eh))},e.\u0275dir=Cr({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),e})();class aZ{constructor(){this.$implicit=null,this.ngIf=null}}function b5(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${pe(t)}'.`)}let E5=(()=>{class e{constructor(n){this._locale=n}transform(n,i,r){if(!function P2(e){return!(null==e||""===e||e!=e)}(n))return null;r=r||this._locale;try{return function eZ(e,t,n){return function C2(e,t,n,i,r,s,u=!1){let h="",g=!1;if(isFinite(e)){let x=function nZ(e){let i,r,s,u,h,t=Math.abs(e)+"",n=0;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(s=t.search(/e/i))>0?(r<0&&(r=s),r+=+t.slice(s+1),t=t.substring(0,s)):r<0&&(r=t.length),s=0;"0"===t.charAt(s);s++);if(s===(h=t.length))i=[0],r=1;else{for(h--;"0"===t.charAt(h);)h--;for(r-=s,i=[],u=0;s<=h;s++,u++)i[u]=Number(t.charAt(s))}return r>22&&(i=i.splice(0,21),n=r-1,r=1),{digits:i,exponent:n,integerLen:r}}(e);u&&(x=function tZ(e){if(0===e.digits[0])return e;const t=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===t?e.digits.push(0,0):1===t&&e.digits.push(0),e.integerLen+=2),e}(x));let C=t.minInt,S=t.minFrac,O=t.maxFrac;if(s){const Q=s.match(ZW);if(null===Q)throw new Error(`${s} is not a valid digit info`);const he=Q[1],ue=Q[3],we=Q[5];null!=he&&(C=T2(he)),null!=ue&&(S=T2(ue)),null!=we?O=T2(we):null!=ue&&S>O&&(O=S)}!function iZ(e,t,n){if(t>n)throw new Error(`The minimum number of digits after fraction (${t}) is higher than the maximum (${n}).`);let i=e.digits,r=i.length-e.integerLen;const s=Math.min(Math.max(t,r),n);let u=s+e.integerLen,h=i[u];if(u>0){i.splice(Math.max(e.integerLen,u));for(let S=u;S<i.length;S++)i[S]=0}else{r=Math.max(0,r),e.integerLen=1,i.length=Math.max(1,u=s+1),i[0]=0;for(let S=1;S<u;S++)i[S]=0}if(h>=5)if(u-1<0){for(let S=0;S>u;S--)i.unshift(0),e.integerLen++;i.unshift(1),e.integerLen++}else i[u-1]++;for(;r<Math.max(0,s);r++)i.push(0);let g=0!==s;const x=t+e.integerLen,C=i.reduceRight(function(S,O,F,$){return $[F]=(O+=S)<10?O:O-10,g&&(0===$[F]&&F>=x?$.pop():g=!1),O>=10?1:0},0);C&&(i.unshift(C),e.integerLen++)}(x,S,O);let F=x.digits,$=x.integerLen;const G=x.exponent;let Y=[];for(g=F.every(Q=>!Q);$<C;$++)F.unshift(0);for(;$<0;$++)F.unshift(0);$>0?Y=F.splice($,F.length):(Y=F,F=[0]);const J=[];for(F.length>=t.lgSize&&J.unshift(F.splice(-t.lgSize,F.length).join(""));F.length>t.gSize;)J.unshift(F.splice(-t.gSize,F.length).join(""));F.length&&J.unshift(F.join("")),h=J.join(Du(n,i)),Y.length&&(h+=Du(n,r)+Y.join("")),G&&(h+=Du(n,ei.Exponential)+"+"+G)}else h=Du(n,ei.Infinity);return h=e<0&&!g?t.negPre+h+t.negSuf:t.posPre+h+t.posSuf,h}(e,function M2(e,t="-"){const n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=e.split(";"),r=i[0],s=i[1],u=-1!==r.indexOf(".")?r.split("."):[r.substring(0,r.lastIndexOf("0")+1),r.substring(r.lastIndexOf("0")+1)],h=u[0],g=u[1]||"";n.posPre=h.substring(0,h.indexOf("#"));for(let C=0;C<g.length;C++){const S=g.charAt(C);"0"===S?n.minFrac=n.maxFrac=C+1:"#"===S?n.maxFrac=C+1:n.posSuf+=S}const x=h.split(",");if(n.gSize=x[1]?x[1].length:0,n.lgSize=x[2]||x[1]?(x[2]||x[1]).length:0,s){const C=r.length-n.posPre.length-n.posSuf.length,S=s.indexOf("#");n.negPre=s.substring(0,S).replace(/'/g,""),n.negSuf=s.slice(S+C).replace(/'/g,"")}else n.negPre=t+n.posPre,n.negSuf=n.posSuf;return n}(function v2(e,t){return Rl(e)[vn.NumberFormats][t]}(t,uc.Decimal),Du(t,ei.MinusSign)),t,ei.Group,ei.Decimal,n)}(function O2(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}(n),r,i)}catch(s){throw function Sd(e,t){return new $e(2100,!1)}()}}}return e.\u0275fac=function(n){return new(n||e)(Nt(Ch,16))},e.\u0275pipe=Hn({name:"number",type:e,pure:!0,standalone:!0}),e})();let k2=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({}),e})();const C5="browser";function M5(e){return"server"===e}let LZ=(()=>{class e{}return e.\u0275prov=Zt({token:e,providedIn:"root",factory:()=>new FZ(et(Ki),window)}),e})();class FZ{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function NZ(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const i=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const u=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(u)return u}r=i.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),i=n.left+this.window.pageXOffset,r=n.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=T5(this.window.history)||T5(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function T5(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class D5{}class sX extends gW{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class F2 extends sX{static makeCurrent(){!function mW(e){g2||(g2=e)}(new F2)}onAndCancel(t,n,i){return t.addEventListener(n,i),()=>{t.removeEventListener(n,i)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function aX(){return Nb=Nb||document.querySelector("base"),Nb?Nb.getAttribute("href"):null}();return null==n?null:function lX(e){zE=zE||document.createElement("a"),zE.setAttribute("href",e);const t=zE.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){Nb=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return m5(document.cookie,t)}}let zE,Nb=null,uX=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();const N2=new sn("EventManagerPlugins");let O5=(()=>{class e{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(r=>{r.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,i,r){return this._findPluginFor(i).addEventListener(n,i,r)}getZone(){return this._zone}_findPluginFor(n){let i=this._eventNameToPlugin.get(n);if(i)return i;if(i=this._plugins.find(s=>s.supports(n)),!i)throw new $e(5101,!1);return this._eventNameToPlugin.set(n,i),i}}return e.\u0275fac=function(n){return new(n||e)(et(N2),et(Fi))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();class k5{constructor(t){this._doc=t}}const z2="ng-app-id";let R5=(()=>{class e{constructor(n,i,r,s={}){this.doc=n,this.appId=i,this.nonce=r,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=M5(s),this.resetHostNodes()}addStyles(n){for(const i of n)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(n){for(const i of n)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(i=>i.remove()),n.clear());for(const i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const i of this.getAllStyles())this.addStyleToHost(n,i)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const i of this.hostNodes)this.addStyleToHost(i,n)}onStyleRemoved(n){const i=this.styleRef;i.get(n)?.elements?.forEach(r=>r.remove()),i.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${z2}="${this.appId}"]`);if(n?.length){const i=new Map;return n.forEach(r=>{null!=r.textContent&&i.set(r.textContent,r)}),i}return null}changeUsageCount(n,i){const r=this.styleRef;if(r.has(n)){const s=r.get(n);return s.usage+=i,s.usage}return r.set(n,{usage:i,elements:[]}),i}getStyleElement(n,i){const r=this.styleNodesInDOM,s=r?.get(i);if(s?.parentNode===n)return r.delete(i),s.removeAttribute(z2),s;{const u=this.doc.createElement("style");return this.nonce&&u.setAttribute("nonce",this.nonce),u.textContent=i,this.platformIsServer&&u.setAttribute(z2,this.appId),u}}addStyleToHost(n,i){const r=this.getStyleElement(n,i);n.appendChild(r);const s=this.styleRef,u=s.get(i)?.elements;u?u.push(r):s.set(i,{elements:[r],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return e.\u0275fac=function(n){return new(n||e)(et(Ki),et(yf),et($p,8),et(Ra))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();const B2={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},U2=/%COMP%/g,pX=new sn("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function F5(e,t){return t.map(n=>n.replace(U2,e))}let V2=(()=>{class e{constructor(n,i,r,s,u,h,g,x=null){this.eventManager=n,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestory=s,this.doc=u,this.platformId=h,this.ngZone=g,this.nonce=x,this.rendererByCompId=new Map,this.platformIsServer=M5(h),this.defaultRenderer=new j2(n,u,g,this.platformIsServer)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===To.ShadowDom&&(i={...i,encapsulation:To.Emulated});const r=this.getOrCreateRenderer(n,i);return r instanceof z5?r.applyToHost(n):r instanceof $2&&r.applyStyles(),r}getOrCreateRenderer(n,i){const r=this.rendererByCompId;let s=r.get(i.id);if(!s){const u=this.doc,h=this.ngZone,g=this.eventManager,x=this.sharedStylesHost,C=this.removeStylesOnCompDestory,S=this.platformIsServer;switch(i.encapsulation){case To.Emulated:s=new z5(g,x,i,this.appId,C,u,h,S);break;case To.ShadowDom:return new yX(g,x,n,i,u,h,this.nonce,S);default:s=new $2(g,x,i,C,u,h,S)}s.onDestroy=()=>r.delete(i.id),r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}}return e.\u0275fac=function(n){return new(n||e)(et(O5),et(R5),et(yf),et(pX),et(Ki),et(Ra),et(Fi),et($p))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();class j2{constructor(t,n,i,r){this.eventManager=t,this.doc=n,this.ngZone=i,this.platformIsServer=r,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?this.doc.createElementNS(B2[n]||n,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,n){(N5(t)?t.content:t).appendChild(n)}insertBefore(t,n,i){t&&(N5(t)?t.content:t).insertBefore(n,i)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let i="string"==typeof t?this.doc.querySelector(t):t;if(!i)throw new $e(5104,!1);return n||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,i,r){if(r){n=r+":"+n;const s=B2[r];s?t.setAttributeNS(s,n,i):t.setAttribute(n,i)}else t.setAttribute(n,i)}removeAttribute(t,n,i){if(i){const r=B2[i];r?t.removeAttributeNS(r,n):t.removeAttribute(`${i}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,i,r){r&(_s.DashCase|_s.Important)?t.style.setProperty(n,i,r&_s.Important?"important":""):t.style[n]=i}removeStyle(t,n,i){i&_s.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,i){t[n]=i}setValue(t,n){t.nodeValue=n}listen(t,n,i){if("string"==typeof t&&!(t=Py().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${n}`);return this.eventManager.addEventListener(t,n,this.decoratePreventDefault(i))}decoratePreventDefault(t){return n=>{if("__ngUnwrap__"===n)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(n)):t(n))&&n.preventDefault()}}}function N5(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class yX extends j2{constructor(t,n,i,r,s,u,h,g){super(t,s,u,g),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const x=F5(r.id,r.styles);for(const C of x){const S=document.createElement("style");h&&S.setAttribute("nonce",h),S.textContent=C,this.shadowRoot.appendChild(S)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,i){return super.insertBefore(this.nodeOrShadowRoot(t),n,i)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class $2 extends j2{constructor(t,n,i,r,s,u,h,g){super(t,s,u,h),this.sharedStylesHost=n,this.removeStylesOnCompDestory=r,this.rendererUsageCount=0,this.styles=g?F5(g,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class z5 extends $2{constructor(t,n,i,r,s,u,h,g){const x=r+"-"+i.id;super(t,n,i,s,u,h,g,x),this.contentAttr=function mX(e){return"_ngcontent-%COMP%".replace(U2,e)}(x),this.hostAttr=function gX(e){return"_nghost-%COMP%".replace(U2,e)}(x)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const i=super.createElement(t,n);return super.setAttribute(i,this.contentAttr,""),i}}let vX=(()=>{class e extends k5{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,r){return n.addEventListener(i,r,!1),()=>this.removeEventListener(n,i,r)}removeEventListener(n,i,r){return n.removeEventListener(i,r)}}return e.\u0275fac=function(n){return new(n||e)(et(Ki))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();const B5=["alt","control","meta","shift"],bX={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},xX={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let wX=(()=>{class e extends k5{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,i,r){const s=e.parseEventName(i),u=e.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Py().onAndCancel(n,s.domEventName,u))}static parseEventName(n){const i=n.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=e._normalizeKey(i.pop());let u="",h=i.indexOf("code");if(h>-1&&(i.splice(h,1),u="code."),B5.forEach(x=>{const C=i.indexOf(x);C>-1&&(i.splice(C,1),u+=x+".")}),u+=s,0!=i.length||0===s.length)return null;const g={};return g.domEventName=r,g.fullKey=u,g}static matchEventFullKeyCode(n,i){let r=bX[n.key]||n.key,s="";return i.indexOf("code.")>-1&&(r=n.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),B5.forEach(u=>{u!==r&&(0,xX[u])(n)&&(s+=u+".")}),s+=r,s===i)}static eventCallback(n,i,r){return s=>{e.matchEventFullKeyCode(s,n)&&r.runGuarded(()=>i(s))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(et(Ki))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();const TX=OF(iW,"browser",[{provide:Ra,useValue:C5},{provide:jp,useValue:function EX(){F2.makeCurrent()},multi:!0},{provide:Ki,useFactory:function MX(){return function LD(e){zv=e}(document),document},deps:[]}]),DX=new sn(""),j5=[{provide:bE,useClass:class cX{addToWindow(t){ar.getAngularTestability=(i,r=!0)=>{const s=t.findTestabilityInTree(i,r);if(null==s)throw new $e(5103,!1);return s},ar.getAllAngularTestabilities=()=>t.getAllTestabilities(),ar.getAllAngularRootElements=()=>t.getAllRootElements(),ar.frameworkStabilizers||(ar.frameworkStabilizers=[]),ar.frameworkStabilizers.push(i=>{const r=ar.getAllAngularTestabilities();let s=r.length,u=!1;const h=function(g){u=u||g,s--,0==s&&i(u)};r.forEach(function(g){g.whenStable(h)})})}findTestabilityInTree(t,n,i){return null==n?null:t.getTestability(n)??(i?Py().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:DF,useClass:n2,deps:[Fi,r2,bE]},{provide:n2,useClass:n2,deps:[Fi,r2,bE]}],$5=[{provide:ny,useValue:"root"},{provide:gh,useFactory:function CX(){return new gh},deps:[]},{provide:N2,useClass:vX,multi:!0,deps:[Ki,Fi,Ra]},{provide:N2,useClass:wX,multi:!0,deps:[Ki]},V2,R5,O5,{provide:fg,useExisting:V2},{provide:D5,useClass:uX,deps:[]},[]];let H5=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:yf,useValue:n.appId}]}}}return e.\u0275fac=function(n){return new(n||e)(et(DX,12))},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({providers:[...$5,...j5],imports:[k2,rW]}),e})(),G5=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(et(Ki))},e.\u0275prov=Zt({token:e,factory:function(n){let i=null;return i=n?new n:function IX(){return new G5(et(Ki))}(),i},providedIn:"root"}),e})();typeof window<"u"&&window;let G2,Z5=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:function(n){let i=null;return i=n?new(n||e):et(X5),i},providedIn:"root"}),e})(),X5=(()=>{class e extends Z5{constructor(n){super(),this._doc=n}sanitize(n,i){if(null==i)return null;switch(n){case jr.NONE:return i;case jr.HTML:return vu(i,"HTML")?Vs(i):Y_(this._doc,String(i)).toString();case jr.STYLE:return vu(i,"Style")?Vs(i):i;case jr.SCRIPT:if(vu(i,"Script"))return Vs(i);throw new $e(5200,!1);case jr.URL:return vu(i,"URL")?Vs(i):W_(String(i));case jr.RESOURCE_URL:if(vu(i,"ResourceURL"))return Vs(i);throw new $e(5201,!1);default:throw new $e(5202,!1)}}bypassSecurityTrustHtml(n){return function vw(e){return new Vv(e)}(n)}bypassSecurityTrustStyle(n){return function bw(e){return new q_(e)}(n)}bypassSecurityTrustScript(n){return function xw(e){return new Op(e)}(n)}bypassSecurityTrustUrl(n){return function br(e){return new FD(e)}(n)}bypassSecurityTrustResourceUrl(n){return function jv(e){return new ND(e)}(n)}}return e.\u0275fac=function(n){return new(n||e)(et(Ki))},e.\u0275prov=Zt({token:e,factory:function(n){let i=null;return i=n?new n:function kX(e){return new X5(e.get(Ki))}(et(bs)),i},providedIn:"root"}),e})();function Hc(e){return hi((t,n)=>{bi(e).subscribe(yn(n,()=>n.complete(),_n)),!n.closed&&t.subscribe(n)})}function Iu(e){return e<=0?()=>Is:hi((t,n)=>{let i=0;t.subscribe(yn(n,r=>{++i<=e&&(n.next(r),e<=i&&n.complete())}))})}function BE(e){return null!=e&&"false"!=`${e}`}function K5(e,t=0){return function RX(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):t}function UE(e){return Array.isArray(e)?e:[e]}function Cs(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Oy(e){return e instanceof vs?e.nativeElement:e}try{G2=typeof Intl<"u"&&Intl.v8BreakIterator}catch{G2=!1}let zb,Dg,q2,Fl=(()=>{class e{constructor(n){this._platformId=n,this.isBrowser=this._platformId?function RZ(e){return e===C5}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!G2)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return e.\u0275fac=function(n){return new(n||e)(et(Ra))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Bb(e){return function jX(){if(null==zb&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>zb=!0}))}finally{zb=zb||!1}return zb}()?e:!!e.capture}function $X(){if(null==Dg){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Dg=!1,Dg;if("scrollBehavior"in document.documentElement.style)Dg=!0;else{const e=Element.prototype.scrollTo;Dg=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return Dg}function rm(e){return e.composedPath?e.composedPath()[0]:e.target}function W2(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function hc(e,t){return hi((n,i)=>{let r=0;n.subscribe(yn(i,s=>e.call(t,s,r++)&&i.next(s)))})}function J5(e){return hc((t,n)=>e<=n)}let qX=(()=>{class e{create(n){return typeof MutationObserver>"u"?null:new MutationObserver(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),WX=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({providers:[qX]}),e})();const{isArray:ZX}=Array,{getPrototypeOf:XX,prototype:YX,keys:KX}=Object;function eN(e){if(1===e.length){const t=e[0];if(ZX(t))return{args:t,keys:null};if(function QX(e){return e&&"object"==typeof e&&XX(e)===YX}(t)){const n=KX(t);return{args:n.map(i=>t[i]),keys:n}}}return{args:e,keys:null}}const{isArray:JX}=Array;function Z2(e){return pi(t=>function eY(e,t){return JX(t)?e(...t):e(t)}(e,t))}function tN(e,t){return e.reduce((n,i,r)=>(n[i]=t[r],n),{})}function jE(...e){const t=na(e),n=Hu(e),{args:i,keys:r}=eN(e);if(0===i.length)return or([],t);const s=new ii(function tY(e,t,n=Ts){return i=>{nN(t,()=>{const{length:r}=e,s=new Array(r);let u=r,h=r;for(let g=0;g<r;g++)nN(t,()=>{const x=or(e[g],t);let C=!1;x.subscribe(yn(i,S=>{s[g]=S,C||(C=!0,h--),h||i.next(n(s.slice()))},()=>{--u||i.complete()}))},i)},i)}}(i,t,r?u=>tN(r,u):Ts));return n?s.pipe(Z2(n)):s}function nN(e,t,n){e?$a(n,e,t):t()}function Ub(...e){return function nY(){return Js(1)}()(or(e,na(e)))}class iY extends pt{constructor(t,n){super()}schedule(t,n=0){return this}}const $E={setInterval(e,t,...n){const{delegate:i}=$E;return i?.setInterval?i.setInterval(e,t,...n):setInterval(e,t,...n)},clearInterval(e){const{delegate:t}=$E;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class X2 extends iY{constructor(t,n){super(t,n),this.scheduler=t,this.work=n,this.pending=!1}schedule(t,n=0){var i;if(this.closed)return this;this.state=t;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,n)),this.pending=!0,this.delay=n,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,n),this}requestAsyncId(t,n,i=0){return $E.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,n,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return n;null!=n&&$E.clearInterval(n)}execute(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,n);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,n){let r,i=!1;try{this.work(t)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:n}=this,{actions:i}=n;this.work=this.state=this.scheduler=null,this.pending=!1,m(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,super.unsubscribe()}}}const Y2={now:()=>(Y2.delegate||Date).now(),delegate:void 0};class Vb{constructor(t,n=Vb.now){this.schedulerActionCtor=t,this.now=n}schedule(t,n=0,i){return new this.schedulerActionCtor(this,t).schedule(i,n)}}Vb.now=Y2.now;class K2 extends Vb{constructor(t,n=Vb.now){super(t,n),this.actions=[],this._active=!1}flush(t){const{actions:n}=this;if(this._active)return void n.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}}}const HE=new K2(X2),rY=HE;function Q2(e,t=HE){return hi((n,i)=>{let r=null,s=null,u=null;const h=()=>{if(r){r.unsubscribe(),r=null;const x=s;s=null,i.next(x)}};function g(){const x=u+e,C=t.now();if(C<x)return r=this.schedule(void 0,x-C),void i.add(r);h()}n.subscribe(yn(i,x=>{s=x,u=t.now(),r||(r=t.schedule(g,e),i.add(r))},()=>{h(),i.complete()},void 0,()=>{s=r=null}))})}function iN(...e){const t=na(e);return hi((n,i)=>{(t?Ub(e,n,t):Ub(e,n)).subscribe(i)})}const rN=new Set;let Sg,oY=(()=>{class e{constructor(n,i){this._platform=n,this._nonce=i,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):aY}matchMedia(n){return(this._platform.WEBKIT||this._platform.BLINK)&&function sY(e,t){if(!rN.has(e))try{Sg||(Sg=document.createElement("style"),t&&(Sg.nonce=t),Sg.setAttribute("type","text/css"),document.head.appendChild(Sg)),Sg.sheet&&(Sg.sheet.insertRule(`@media ${e} {body{ }}`,0),rN.add(e))}catch(n){console.error(n)}}(n,this._nonce),this._matchMedia(n)}}return e.\u0275fac=function(n){return new(n||e)(et(Fl),et($p,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function aY(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let J2=(()=>{class e{constructor(n,i){this._mediaMatcher=n,this._zone=i,this._queries=new Map,this._destroySubject=new Yn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(n){return oN(UE(n)).some(r=>this._registerQuery(r).mql.matches)}observe(n){let s=jE(oN(UE(n)).map(u=>this._registerQuery(u).observable));return s=Ub(s.pipe(Iu(1)),s.pipe(J5(1),Q2(0))),s.pipe(pi(u=>{const h={matches:!1,breakpoints:{}};return u.forEach(({matches:g,query:x})=>{h.matches=h.matches||g,h.breakpoints[x]=g}),h}))}_registerQuery(n){if(this._queries.has(n))return this._queries.get(n);const i=this._mediaMatcher.matchMedia(n),s={observable:new ii(u=>{const h=g=>this._zone.run(()=>u.next(g));return i.addListener(h),()=>{i.removeListener(h)}}).pipe(iN(i),pi(({matches:u})=>({query:n,matches:u})),Hc(this._destroySubject)),mql:i};return this._queries.set(n,s),s}}return e.\u0275fac=function(n){return new(n||e)(et(oY),et(Fi))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function oN(e){return e.map(t=>t.split(",")).reduce((t,n)=>t.concat(n)).map(t=>t.trim())}function GE(e,t){return(e.getAttribute(t)||"").match(/\S+/g)||[]}const aN="cdk-describedby-message",qE="cdk-describedby-host";let eI=0,dY=(()=>{class e{constructor(n,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+eI++,this._document=n,this._id=tn(yf)+"-"+eI++}describe(n,i,r){if(!this._canBeDescribed(n,i))return;const s=tI(i,r);"string"!=typeof i?(lN(i,this._id),this._messageRegistry.set(s,{messageElement:i,referenceCount:0})):this._messageRegistry.has(s)||this._createMessageElement(i,r),this._isElementDescribedByMessage(n,s)||this._addMessageReference(n,s)}removeDescription(n,i,r){if(!i||!this._isElementNode(n))return;const s=tI(i,r);if(this._isElementDescribedByMessage(n,s)&&this._removeMessageReference(n,s),"string"==typeof i){const u=this._messageRegistry.get(s);u&&0===u.referenceCount&&this._deleteMessageElement(s)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const n=this._document.querySelectorAll(`[${qE}="${this._id}"]`);for(let i=0;i<n.length;i++)this._removeCdkDescribedByReferenceIds(n[i]),n[i].removeAttribute(qE);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(n,i){const r=this._document.createElement("div");lN(r,this._id),r.textContent=n,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(tI(n,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(n){this._messageRegistry.get(n)?.messageElement?.remove(),this._messageRegistry.delete(n)}_createMessagesContainer(){if(this._messagesContainer)return;const n="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${n}[platform="server"]`);for(let s=0;s<i.length;s++)i[s].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(n),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(n){const i=GE(n,"aria-describedby").filter(r=>0!=r.indexOf(aN));n.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(n,i){const r=this._messageRegistry.get(i);(function cY(e,t,n){const i=GE(e,t);i.some(r=>r.trim()==n.trim())||(i.push(n.trim()),e.setAttribute(t,i.join(" ")))})(n,"aria-describedby",r.messageElement.id),n.setAttribute(qE,this._id),r.referenceCount++}_removeMessageReference(n,i){const r=this._messageRegistry.get(i);r.referenceCount--,function uY(e,t,n){const r=GE(e,t).filter(s=>s!=n.trim());r.length?e.setAttribute(t,r.join(" ")):e.removeAttribute(t)}(n,"aria-describedby",r.messageElement.id),n.removeAttribute(qE)}_isElementDescribedByMessage(n,i){const r=GE(n,"aria-describedby"),s=this._messageRegistry.get(i),u=s&&s.messageElement.id;return!!u&&-1!=r.indexOf(u)}_canBeDescribed(n,i){if(!this._isElementNode(n))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),s=n.getAttribute("aria-label");return!(!r||s&&s.trim()===r)}_isElementNode(n){return n.nodeType===this._document.ELEMENT_NODE}}return e.\u0275fac=function(n){return new(n||e)(et(Ki),et(Fl))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function tI(e,t){return"string"==typeof e?`${t||""}/${e}`:e}function lN(e,t){e.id||(e.id=`${aN}-${t}-${eI++}`)}function uN(e){return 0===e.buttons||0===e.offsetX&&0===e.offsetY}function dN(e){const t=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}const _Y=new sn("cdk-input-modality-detector-options"),yY={ignoreKeys:[18,17,224,91,16]},Ry=Bb({passive:!0,capture:!0});let vY=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(n,i,r,s){this._platform=n,this._mostRecentTarget=null,this._modality=new Kr(null),this._lastTouchMs=0,this._onKeydown=u=>{this._options?.ignoreKeys?.some(h=>h===u.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=rm(u))},this._onMousedown=u=>{Date.now()-this._lastTouchMs<650||(this._modality.next(uN(u)?"keyboard":"mouse"),this._mostRecentTarget=rm(u))},this._onTouchstart=u=>{dN(u)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=rm(u))},this._options={...yY,...s},this.modalityDetected=this._modality.pipe(J5(1)),this.modalityChanged=this.modalityDetected.pipe(Vn()),n.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,Ry),r.addEventListener("mousedown",this._onMousedown,Ry),r.addEventListener("touchstart",this._onTouchstart,Ry)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Ry),document.removeEventListener("mousedown",this._onMousedown,Ry),document.removeEventListener("touchstart",this._onTouchstart,Ry))}}return e.\u0275fac=function(n){return new(n||e)(et(Fl),et(Fi),et(Ki),et(_Y,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const bY=new sn("liveAnnouncerElement",{providedIn:"root",factory:function xY(){return null}}),wY=new sn("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let EY=0,fN=(()=>{class e{constructor(n,i,r,s){this._ngZone=i,this._defaultOptions=s,this._document=r,this._liveElement=n||this._createLiveElement()}announce(n,...i){const r=this._defaultOptions;let s,u;return 1===i.length&&"number"==typeof i[0]?u=i[0]:[s,u]=i,this.clear(),clearTimeout(this._previousTimeout),s||(s=r&&r.politeness?r.politeness:"polite"),null==u&&r&&(u=r.duration),this._liveElement.setAttribute("aria-live",s),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(h=>this._currentResolve=h)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=n,"number"==typeof u&&(this._previousTimeout=setTimeout(()=>this.clear(),u)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const n="cdk-live-announcer-element",i=this._document.getElementsByClassName(n),r=this._document.createElement("div");for(let s=0;s<i.length;s++)i[s].remove();return r.classList.add(n),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),r.id="cdk-live-announcer-"+EY++,this._document.body.appendChild(r),r}_exposeAnnouncerToModals(n){const i=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let r=0;r<i.length;r++){const s=i[r],u=s.getAttribute("aria-owns");u?-1===u.indexOf(n)&&s.setAttribute("aria-owns",u+" "+n):s.setAttribute("aria-owns",n)}}}return e.\u0275fac=function(n){return new(n||e)(et(bY,8),et(Fi),et(Ki),et(wY,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const CY=new sn("cdk-focus-monitor-default-options"),WE=Bb({passive:!0,capture:!0});let pN=(()=>{class e{constructor(n,i,r,s,u){this._ngZone=n,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Yn,this._rootNodeFocusAndBlurListener=h=>{for(let x=rm(h);x;x=x.parentElement)"focus"===h.type?this._onFocus(h,x):this._onBlur(h,x)},this._document=s,this._detectionMode=u?.detectionMode||0}monitor(n,i=!1){const r=Oy(n);if(!this._platform.isBrowser||1!==r.nodeType)return qt();const s=function GX(e){if(function HX(){if(null==q2){const e=typeof document<"u"?document.head:null;q2=!(!e||!e.createShadowRoot&&!e.attachShadow)}return q2}()){const t=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),u=this._elementInfo.get(r);if(u)return i&&(u.checkChildren=!0),u.subject;const h={checkChildren:i,subject:new Yn,rootNode:s};return this._elementInfo.set(r,h),this._registerGlobalListeners(h),h.subject}stopMonitoring(n){const i=Oy(n),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(n,i,r){const s=Oy(n);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([h,g])=>this._originChanged(h,i,g)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((n,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(n){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(n)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:n&&this._isLastInteractionFromInputLabel(n)?"mouse":"program"}_shouldBeAttributedToTouch(n){return 1===this._detectionMode||!!n?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(n,i){n.classList.toggle("cdk-focused",!!i),n.classList.toggle("cdk-touch-focused","touch"===i),n.classList.toggle("cdk-keyboard-focused","keyboard"===i),n.classList.toggle("cdk-mouse-focused","mouse"===i),n.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(n,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=n,this._originFromTouchInteraction="touch"===n&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(n,i){const r=this._elementInfo.get(i),s=rm(n);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(n,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&n.relatedTarget instanceof Node&&i.contains(n.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(n,i){n.subject.observers.length&&this._ngZone.run(()=>n.subject.next(i))}_registerGlobalListeners(n){if(!this._platform.isBrowser)return;const i=n.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,WE),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,WE)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Hc(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(n){const i=n.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,WE),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,WE),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(n,i,r){this._setClasses(n,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(n){const i=[];return this._elementInfo.forEach((r,s)=>{(s===n||r.checkChildren&&s.contains(n))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(n){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===n||"INPUT"!==n.nodeName&&"TEXTAREA"!==n.nodeName||n.disabled)return!1;const s=n.labels;if(s)for(let u=0;u<s.length;u++)if(s[u].contains(i))return!0;return!1}}return e.\u0275fac=function(n){return new(n||e)(et(Fi),et(Fl),et(vY),et(Ki,8),et(CY,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const mN="cdk-high-contrast-black-on-white",gN="cdk-high-contrast-white-on-black",nI="cdk-high-contrast-active";let _N=(()=>{class e{constructor(n,i){this._platform=n,this._document=i,this._breakpointSubscription=tn(J2).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const n=this._document.createElement("div");n.style.backgroundColor="rgb(1,2,3)",n.style.position="absolute",this._document.body.appendChild(n);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(n):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(n.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const n=this._document.body.classList;n.remove(nI,mN,gN),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?n.add(nI,mN):2===i&&n.add(nI,gN)}}}return e.\u0275fac=function(n){return new(n||e)(et(Fl),et(Ki))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),MY=(()=>{class e{constructor(n){n._applyBodyHighContrastModeCssClasses()}}return e.\u0275fac=function(n){return new(n||e)(et(_N))},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({imports:[WX]}),e})();const TY=new sn("cdk-dir-doc",{providedIn:"root",factory:function DY(){return tn(Ki)}}),SY=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let yN=(()=>{class e{constructor(n){this.value="ltr",this.change=new ma,n&&(this.value=function IY(e){const t=e?.toLowerCase()||"";return"auto"===t&&typeof navigator<"u"&&navigator?.language?SY.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((n.body?n.body.dir:null)||(n.documentElement?n.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}}return e.\u0275fac=function(n){return new(n||e)(et(TY,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),jb=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({}),e})();const AY=["addListener","removeListener"],PY=["addEventListener","removeEventListener"],OY=["on","off"];function iI(e,t,n,i){if(Ri(n)&&(i=n,n=void 0),i)return iI(e,t,n).pipe(Z2(i));const[r,s]=function LY(e){return Ri(e.addEventListener)&&Ri(e.removeEventListener)}(e)?PY.map(u=>h=>e[u](t,h,n)):function kY(e){return Ri(e.addListener)&&Ri(e.removeListener)}(e)?AY.map(vN(e,t)):function RY(e){return Ri(e.on)&&Ri(e.off)}(e)?OY.map(vN(e,t)):[];if(!r&&Ke(e))return zr(u=>iI(u,t,n))(bi(e));if(!r)throw new TypeError("Invalid event target");return new ii(u=>{const h=(...g)=>u.next(1<g.length?g:g[0]);return r(h),()=>s(h)})}function vN(e,t){return n=>i=>e[n](t,i)}const $b={schedule(e){let t=requestAnimationFrame,n=cancelAnimationFrame;const{delegate:i}=$b;i&&(t=i.requestAnimationFrame,n=i.cancelAnimationFrame);const r=t(s=>{n=void 0,e(s)});return new pt(()=>n?.(r))},requestAnimationFrame(...e){const{delegate:t}=$b;return(t?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:t}=$b;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class NY extends K2{flush(t){this._active=!0;const n=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw r}}}(class FY extends X2{constructor(t,n){super(t,n),this.scheduler=t,this.work=n}requestAsyncId(t,n,i=0){return null!==i&&i>0?super.requestAsyncId(t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=$b.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,n,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,n,i);const{actions:s}=t;null!=n&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==n&&($b.cancelAnimationFrame(n),t._scheduled=void 0)}});let rI,BY=1;const ZE={};function bN(e){return e in ZE&&(delete ZE[e],!0)}const UY={setImmediate(e){const t=BY++;return ZE[t]=!0,rI||(rI=Promise.resolve()),rI.then(()=>bN(t)&&e()),t},clearImmediate(e){bN(e)}},{setImmediate:VY,clearImmediate:jY}=UY,XE={setImmediate(...e){const{delegate:t}=XE;return(t?.setImmediate||VY)(...e)},clearImmediate(e){const{delegate:t}=XE;return(t?.clearImmediate||jY)(e)},delegate:void 0};new class HY extends K2{flush(t){this._active=!0;const n=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw r}}}(class $Y extends X2{constructor(t,n){super(t,n),this.scheduler=t,this.work=n}requestAsyncId(t,n,i=0){return null!==i&&i>0?super.requestAsyncId(t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=XE.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,n,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,n,i);const{actions:s}=t;null!=n&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==n&&(XE.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))}});function Hb(e=0,t,n=rY){let i=-1;return null!=t&&(ta(t)?n=t:i=t),new ii(r=>{let s=function WY(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;s<0&&(s=0);let u=0;return n.schedule(function(){r.closed||(r.next(u++),0<=i?this.schedule(void 0,i):r.complete())},s)})}function xN(e,t=HE){return function qY(e){return hi((t,n)=>{let i=!1,r=null,s=null,u=!1;const h=()=>{if(s?.unsubscribe(),s=null,i){i=!1;const x=r;r=null,n.next(x)}u&&n.complete()},g=()=>{s=null,u&&n.complete()};t.subscribe(yn(n,x=>{i=!0,r=x,s||bi(e(x)).subscribe(s=yn(n,h,g))},()=>{u=!0,(!i||!s||s.closed)&&n.complete()}))})}(()=>Hb(e,t))}let wN=(()=>{class e{constructor(n,i,r){this._ngZone=n,this._platform=i,this._scrolled=new Yn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(n){this.scrollContainers.has(n)||this.scrollContainers.set(n,n.elementScrolled().subscribe(()=>this._scrolled.next(n)))}deregister(n){const i=this.scrollContainers.get(n);i&&(i.unsubscribe(),this.scrollContainers.delete(n))}scrolled(n=20){return this._platform.isBrowser?new ii(i=>{this._globalSubscription||this._addGlobalListener();const r=n>0?this._scrolled.pipe(xN(n)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):qt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((n,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(n,i){const r=this.getAncestorScrollContainers(n);return this.scrolled(i).pipe(hc(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(n){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,n)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(n,i){let r=Oy(i),s=n.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>iI(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return e.\u0275fac=function(n){return new(n||e)(et(Fi),et(Fl),et(Ki,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),EN=(()=>{class e{constructor(n,i,r){this._platform=n,this._change=new Yn,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(n.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const n=this._getWindow();n.removeEventListener("resize",this._changeListener),n.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const n={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),n}getViewportRect(){const n=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:n.top,left:n.left,bottom:n.top+r,right:n.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const n=this._document,i=this._getWindow(),r=n.documentElement,s=r.getBoundingClientRect();return{top:-s.top||n.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||n.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(n=20){return n>0?this._change.pipe(xN(n)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const n=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:n.innerWidth,height:n.innerHeight}:{width:0,height:0}}}return e.\u0275fac=function(n){return new(n||e)(et(Fl),et(Fi),et(Ki,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),oI=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({}),e})(),CN=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({imports:[jb,oI,jb,oI]}),e})();class sI{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class YE extends sI{constructor(t,n,i,r,s){super(),this.component=t,this.viewContainerRef=n,this.injector=i,this.componentFactoryResolver=r,this.projectableNodes=s}}class MN extends sI{constructor(t,n,i,r){super(),this.templateRef=t,this.viewContainerRef=n,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,n=this.context){return this.context=n,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class YY extends sI{constructor(t){super(),this.element=t instanceof vs?t.nativeElement:t}}class aI{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof YE?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof MN?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof YY?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class KY extends aI{constructor(t,n,i,r,s){super(),this.outletElement=t,this._componentFactoryResolver=n,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=u=>{const h=u.element,g=this._document.createComment("dom-portal");h.parentNode.insertBefore(g,h),this.outletElement.appendChild(h),this._attachedPortal=u,super.setDisposeFn(()=>{g.parentNode&&g.parentNode.replaceChild(h,g)})},this._document=s}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector,t.projectableNodes||void 0),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||bs.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let n=t.viewContainerRef,i=n.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=n.indexOf(i);-1!==r&&n.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let TN=(()=>{class e extends aI{constructor(n,i,r){super(),this._componentFactoryResolver=n,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new ma,this.attachDomPortal=s=>{const u=s.element,h=this._document.createComment("dom-portal");s.setAttachedHost(this),u.parentNode.insertBefore(h,u),this._getRootNode().appendChild(u),this._attachedPortal=s,super.setDisposeFn(()=>{h.parentNode&&h.parentNode.replaceChild(u,h)})},this._document=r}get portal(){return this._attachedPortal}set portal(n){this.hasAttached()&&!n&&!this._isInitialized||(this.hasAttached()&&super.detach(),n&&super.attach(n),this._attachedPortal=n||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(n){n.setAttachedHost(this);const i=null!=n.viewContainerRef?n.viewContainerRef:this._viewContainerRef,s=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component),u=i.createComponent(s,i.length,n.injector||i.injector,n.projectableNodes||void 0);return i!==this._viewContainerRef&&this._getRootNode().appendChild(u.hostView.rootNodes[0]),super.setDisposeFn(()=>u.destroy()),this._attachedPortal=n,this._attachedRef=u,this.attached.emit(u),u}attachTemplatePortal(n){n.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=n,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const n=this._viewContainerRef.element.nativeElement;return n.nodeType===n.ELEMENT_NODE?n:n.parentNode}}return e.\u0275fac=function(n){return new(n||e)(Nt(qp),Nt($c),Nt(Ki))},e.\u0275dir=Cr({type:e,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[If]}),e})(),DN=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({}),e})();const SN=$X();class QY{constructor(t,n){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=n}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=Cs(-this._previousScrollPosition.left),t.style.top=Cs(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,s=i.scrollBehavior||"",u=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),SN&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),SN&&(i.scrollBehavior=s,r.scrollBehavior=u)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const n=this._document.body,i=this._viewportRuler.getViewportSize();return n.scrollHeight>i.height||n.scrollWidth>i.width}}class JY{constructor(t,n,i,r){this._scrollDispatcher=t,this._ngZone=n,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0).pipe(hc(n=>!n||!this._overlayRef.overlayElement.contains(n.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const n=this._viewportRuler.getViewportScrollPosition().top;Math.abs(n-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class IN{enable(){}disable(){}attach(){}}function lI(e,t){return t.some(n=>e.bottom<n.top||e.top>n.bottom||e.right<n.left||e.left>n.right)}function AN(e,t){return t.some(n=>e.top<n.top||e.bottom>n.bottom||e.left<n.left||e.right>n.right)}class eK{constructor(t,n,i,r){this._scrollDispatcher=t,this._viewportRuler=n,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const n=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();lI(n,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let tK=(()=>{class e{constructor(n,i,r,s){this._scrollDispatcher=n,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new IN,this.close=u=>new JY(this._scrollDispatcher,this._ngZone,this._viewportRuler,u),this.block=()=>new QY(this._viewportRuler,this._document),this.reposition=u=>new eK(this._scrollDispatcher,this._viewportRuler,this._ngZone,u),this._document=s}}return e.\u0275fac=function(n){return new(n||e)(et(wN),et(EN),et(Fi),et(Ki))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class PN{constructor(t){if(this.scrollStrategy=new IN,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const n=Object.keys(t);for(const i of n)void 0!==t[i]&&(this[i]=t[i])}}}class nK{constructor(t,n){this.connectionPair=t,this.scrollableViewProperties=n}}let ON=(()=>{class e{constructor(n){this._attachedOverlays=[],this._document=n}ngOnDestroy(){this.detach()}add(n){this.remove(n),this._attachedOverlays.push(n)}remove(n){const i=this._attachedOverlays.indexOf(n);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return e.\u0275fac=function(n){return new(n||e)(et(Ki))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),iK=(()=>{class e extends ON{constructor(n,i){super(n),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let u=s.length-1;u>-1;u--)if(s[u]._keydownEvents.observers.length>0){const h=s[u]._keydownEvents;this._ngZone?this._ngZone.run(()=>h.next(r)):h.next(r);break}}}add(n){super.add(n),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return e.\u0275fac=function(n){return new(n||e)(et(Ki),et(Fi,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),rK=(()=>{class e extends ON{constructor(n,i,r){super(n),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=rm(s)},this._clickListener=s=>{const u=rm(s),h="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:u;this._pointerDownEventTarget=null;const g=this._attachedOverlays.slice();for(let x=g.length-1;x>-1;x--){const C=g[x];if(C._outsidePointerEvents.observers.length<1||!C.hasAttached())continue;if(C.overlayElement.contains(u)||C.overlayElement.contains(h))break;const S=C._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>S.next(s)):S.next(s)}}}add(n){if(super.add(n),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const n=this._document.body;n.removeEventListener("pointerdown",this._pointerDownListener,!0),n.removeEventListener("click",this._clickListener,!0),n.removeEventListener("auxclick",this._clickListener,!0),n.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(n.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(n){n.addEventListener("pointerdown",this._pointerDownListener,!0),n.addEventListener("click",this._clickListener,!0),n.addEventListener("auxclick",this._clickListener,!0),n.addEventListener("contextmenu",this._clickListener,!0)}}return e.\u0275fac=function(n){return new(n||e)(et(Ki),et(Fl),et(Fi,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),kN=(()=>{class e{constructor(n,i){this._platform=i,this._document=n}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const n="cdk-overlay-container";if(this._platform.isBrowser||W2()){const r=this._document.querySelectorAll(`.${n}[platform="server"], .${n}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(n),W2()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return e.\u0275fac=function(n){return new(n||e)(et(Ki),et(Fl))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class oK{constructor(t,n,i,r,s,u,h,g,x,C=!1){this._portalOutlet=t,this._host=n,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=u,this._document=h,this._location=g,this._outsideClickDispatcher=x,this._animationsDisabled=C,this._backdropElement=null,this._backdropClick=new Yn,this._attachments=new Yn,this._detachments=new Yn,this._locationChanges=pt.EMPTY,this._backdropClickHandler=S=>this._backdropClick.next(S),this._backdropTransitionendHandler=S=>{this._disposeBackdrop(S.target)},this._keydownEvents=new Yn,this._outsidePointerEvents=new Yn,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const n=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Iu(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof n?.onDestroy&&n.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),n}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config={...this._config,...t},this._updateElementSize()}setDirection(t){this._config={...this._config,direction:t},this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=Cs(this._config.width),t.height=Cs(this._config.height),t.minWidth=Cs(this._config.minWidth),t.minHeight=Cs(this._config.minHeight),t.maxWidth=Cs(this._config.maxWidth),t.maxHeight=Cs(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,n,i){const r=UE(n||[]).filter(s=>!!s);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Hc(Kt(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const RN="cdk-overlay-connected-position-bounding-box",sK=/([A-Za-z%]+)$/;class aK{get positions(){return this._preferredPositions}constructor(t,n,i,r,s){this._viewportRuler=n,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Yn,this._resizeSubscription=pt.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}attach(t){this._validatePositions(),t.hostElement.classList.add(RN),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,n=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let u;for(let h of this._preferredPositions){let g=this._getOriginPoint(t,r,h),x=this._getOverlayPoint(g,n,h),C=this._getOverlayFit(x,n,i,h);if(C.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(h,g);this._canFitWithFlexibleDimensions(C,x,i)?s.push({position:h,origin:g,overlayRect:n,boundingBoxRect:this._calculateBoundingBoxRect(g,h)}):(!u||u.overlayFit.visibleArea<C.visibleArea)&&(u={overlayFit:C,overlayPoint:x,originPoint:g,position:h,overlayRect:n})}if(s.length){let h=null,g=-1;for(const x of s){const C=x.boundingBoxRect.width*x.boundingBoxRect.height*(x.position.weight||1);C>g&&(g=C,h=x)}return this._isPushed=!1,void this._applyPosition(h.position,h.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(u.position,u.originPoint);this._applyPosition(u.position,u.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Ig(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(RN),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const n=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,n)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,n,i){let r,s;if("center"==i.originX)r=t.left+t.width/2;else{const u=this._isRtl()?t.right:t.left,h=this._isRtl()?t.left:t.right;r="start"==i.originX?u:h}return n.left<0&&(r-=n.left),s="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,n.top<0&&(s-=n.top),{x:r,y:s}}_getOverlayPoint(t,n,i){let r,s;return r="center"==i.overlayX?-n.width/2:"start"===i.overlayX?this._isRtl()?-n.width:0:this._isRtl()?0:-n.width,s="center"==i.overlayY?-n.height/2:"top"==i.overlayY?0:-n.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,n,i,r){const s=FN(n);let{x:u,y:h}=t,g=this._getOffset(r,"x"),x=this._getOffset(r,"y");g&&(u+=g),x&&(h+=x);let O=0-h,F=h+s.height-i.height,$=this._subtractOverflows(s.width,0-u,u+s.width-i.width),G=this._subtractOverflows(s.height,O,F),Y=$*G;return{visibleArea:Y,isCompletelyWithinViewport:s.width*s.height===Y,fitsInViewportVertically:G===s.height,fitsInViewportHorizontally:$==s.width}}_canFitWithFlexibleDimensions(t,n,i){if(this._hasFlexibleDimensions){const r=i.bottom-n.y,s=i.right-n.x,u=LN(this._overlayRef.getConfig().minHeight),h=LN(this._overlayRef.getConfig().minWidth);return(t.fitsInViewportVertically||null!=u&&u<=r)&&(t.fitsInViewportHorizontally||null!=h&&h<=s)}return!1}_pushOverlayOnScreen(t,n,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=FN(n),s=this._viewportRect,u=Math.max(t.x+r.width-s.width,0),h=Math.max(t.y+r.height-s.height,0),g=Math.max(s.top-i.top-t.y,0),x=Math.max(s.left-i.left-t.x,0);let C=0,S=0;return C=r.width<=s.width?x||-u:t.x<this._viewportMargin?s.left-i.left-t.x:0,S=r.height<=s.height?g||-h:t.y<this._viewportMargin?s.top-i.top-t.y:0,this._previousPushAmount={x:C,y:S},{x:t.x+C,y:t.y+S}}_applyPosition(t,n){if(this._setTransformOrigin(t),this._setOverlayElementStyles(n,t),this._setBoundingBoxStyles(n,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new nK(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const n=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<n.length;s++)n[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,n){const i=this._viewportRect,r=this._isRtl();let s,u,h,C,S,O;if("top"===n.overlayY)u=t.y,s=i.height-u+this._viewportMargin;else if("bottom"===n.overlayY)h=i.height-t.y+2*this._viewportMargin,s=i.height-h+this._viewportMargin;else{const F=Math.min(i.bottom-t.y+i.top,t.y),$=this._lastBoundingBoxSize.height;s=2*F,u=t.y-F,s>$&&!this._isInitialRender&&!this._growAfterOpen&&(u=t.y-$/2)}if("end"===n.overlayX&&!r||"start"===n.overlayX&&r)O=i.width-t.x+this._viewportMargin,C=t.x-this._viewportMargin;else if("start"===n.overlayX&&!r||"end"===n.overlayX&&r)S=t.x,C=i.right-t.x;else{const F=Math.min(i.right-t.x+i.left,t.x),$=this._lastBoundingBoxSize.width;C=2*F,S=t.x-F,C>$&&!this._isInitialRender&&!this._growAfterOpen&&(S=t.x-$/2)}return{top:u,left:S,bottom:h,right:O,width:C,height:s}}_setBoundingBoxStyles(t,n){const i=this._calculateBoundingBoxRect(t,n);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,u=this._overlayRef.getConfig().maxWidth;r.height=Cs(i.height),r.top=Cs(i.top),r.bottom=Cs(i.bottom),r.width=Cs(i.width),r.left=Cs(i.left),r.right=Cs(i.right),r.alignItems="center"===n.overlayX?"center":"end"===n.overlayX?"flex-end":"flex-start",r.justifyContent="center"===n.overlayY?"center":"bottom"===n.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=Cs(s)),u&&(r.maxWidth=Cs(u))}this._lastBoundingBoxSize=i,Ig(this._boundingBox.style,r)}_resetBoundingBoxStyles(){Ig(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Ig(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,n){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,u=this._overlayRef.getConfig();if(r){const C=this._viewportRuler.getViewportScrollPosition();Ig(i,this._getExactOverlayY(n,t,C)),Ig(i,this._getExactOverlayX(n,t,C))}else i.position="static";let h="",g=this._getOffset(n,"x"),x=this._getOffset(n,"y");g&&(h+=`translateX(${g}px) `),x&&(h+=`translateY(${x}px)`),i.transform=h.trim(),u.maxHeight&&(r?i.maxHeight=Cs(u.maxHeight):s&&(i.maxHeight="")),u.maxWidth&&(r?i.maxWidth=Cs(u.maxWidth):s&&(i.maxWidth="")),Ig(this._pane.style,i)}_getExactOverlayY(t,n,i){let r={top:"",bottom:""},s=this._getOverlayPoint(n,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=Cs(s.y),r}_getExactOverlayX(t,n,i){let u,r={left:"",right:""},s=this._getOverlayPoint(n,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),u=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===u?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=Cs(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),n=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:AN(t,i),isOriginOutsideView:lI(t,i),isOverlayClipped:AN(n,i),isOverlayOutsideView:lI(n,i)}}_subtractOverflows(t,...n){return n.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,n=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+n-this._viewportMargin,width:t-2*this._viewportMargin,height:n-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,n){return"x"===n?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&UE(t).forEach(n=>{""!==n&&-1===this._appliedPanelClasses.indexOf(n)&&(this._appliedPanelClasses.push(n),this._pane.classList.add(n))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof vs)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const n=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+n,height:i,width:n}}}function Ig(e,t){for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function LN(e){if("number"!=typeof e&&null!=e){const[t,n]=e.split(sK);return n&&"px"!==n?null:parseFloat(t)}return e||null}function FN(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const NN="cdk-global-overlay-wrapper";class lK{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const n=t.getConfig();this._overlayRef=t,this._width&&!n.width&&t.updateSize({width:this._width}),this._height&&!n.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(NN),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,n=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:u,maxHeight:h}=i,g=!("100%"!==r&&"100vw"!==r||u&&"100%"!==u&&"100vw"!==u),x=!("100%"!==s&&"100vh"!==s||h&&"100%"!==h&&"100vh"!==h),C=this._xPosition,S=this._xOffset,O="rtl"===this._overlayRef.getConfig().direction;let F="",$="",G="";g?G="flex-start":"center"===C?(G="center",O?$=S:F=S):O?"left"===C||"end"===C?(G="flex-end",F=S):("right"===C||"start"===C)&&(G="flex-start",$=S):"left"===C||"start"===C?(G="flex-start",F=S):("right"===C||"end"===C)&&(G="flex-end",$=S),t.position=this._cssPosition,t.marginLeft=g?"0":F,t.marginTop=x?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=g?"0":$,n.justifyContent=G,n.alignItems=x?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,n=this._overlayRef.hostElement,i=n.style;n.classList.remove(NN),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let cK=(()=>{class e{constructor(n,i,r,s){this._viewportRuler=n,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new lK}flexibleConnectedTo(n){return new aK(n,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return e.\u0275fac=function(n){return new(n||e)(et(EN),et(Ki),et(Fl),et(kN))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),uK=0,Ly=(()=>{class e{constructor(n,i,r,s,u,h,g,x,C,S,O,F){this.scrollStrategies=n,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=u,this._injector=h,this._ngZone=g,this._document=x,this._directionality=C,this._location=S,this._outsideClickDispatcher=O,this._animationsModuleType=F}create(n){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),u=new PN(n);return u.direction=u.direction||this._directionality.value,new oK(s,i,r,u,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(n){const i=this._document.createElement("div");return i.id="cdk-overlay-"+uK++,i.classList.add("cdk-overlay-pane"),n.appendChild(i),i}_createHostElement(){const n=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(n),n}_createPortalOutlet(n){return this._appRef||(this._appRef=this._injector.get(nm)),new KY(n,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return e.\u0275fac=function(n){return new(n||e)(et(tK),et(kN),et(qp),et(cK),et(iK),et(bs),et(Fi),et(Ki),et(yN),et(TE),et(rK),et(bd,8))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const fK={provide:new sn("cdk-connected-overlay-scroll-strategy"),deps:[Ly],useFactory:function hK(e){return()=>e.scrollStrategies.reposition()}};let zN=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({providers:[Ly,fK],imports:[jb,DN,CN,CN]}),e})();class BN{}class pK{}const Rf="*";function UN(e,t){return{type:7,name:e,definitions:t,options:{}}}function KE(e,t=null){return{type:4,styles:t,timings:e}}function VN(e,t=null){return{type:2,steps:e,options:t}}function Ag(e){return{type:6,styles:e,offset:null}}function QE(e,t,n){return{type:0,name:e,styles:t,options:n}}function JE(e,t,n=null){return{type:1,expr:e,animation:t,options:n}}class Gb{constructor(t=0,n=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+n}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const n="start"==t?this._onStartFns:this._onDoneFns;n.forEach(i=>i()),n.length=0}}class jN{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let n=0,i=0,r=0;const s=this.players.length;0==s?queueMicrotask(()=>this._onFinish()):this.players.forEach(u=>{u.onDone(()=>{++n==s&&this._onFinish()}),u.onDestroy(()=>{++i==s&&this._onDestroy()}),u.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((u,h)=>Math.max(u,h.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const n=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,n/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((n,i)=>null===n||i.totalTime>n.totalTime?i:n,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const n="start"==t?this._onStartFns:this._onDoneFns;n.forEach(i=>i()),n.length=0}}const gK=new sn("mat-sanity-checks",{providedIn:"root",factory:function mK(){return!0}});let om=(()=>{class e{constructor(n,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,n._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(n){return!W2()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[n])}}return e.\u0275fac=function(n){return new(n||e)(et(_N),et(gK,8),et(Ki))},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({imports:[jb,jb]}),e})();function _K(e){return class extends e{get disabled(){return this._disabled}set disabled(t){this._disabled=BE(t)}constructor(...t){super(...t),this._disabled=!1}}}function yK(e,t){return class extends e{get color(){return this._color}set color(n){const i=n||this.defaultColor;i!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),i&&this._elementRef.nativeElement.classList.add(`mat-${i}`),this._color=i)}constructor(...n){super(...n),this.defaultColor=t,this.color=t}}}function vK(e){return class extends e{get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=BE(t)}constructor(...t){super(...t),this._disableRipple=!1}}}class xK{constructor(t,n,i,r=!1){this._renderer=t,this.element=n,this.config=i,this._animationForciblyDisabledThroughCss=r,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const GN=Bb({passive:!0,capture:!0});class wK{constructor(){this._events=new Map,this._delegateEventHandler=t=>{const n=rm(t);n&&this._events.get(t.type)?.forEach((i,r)=>{(r===n||r.contains(n))&&i.forEach(s=>s.handleEvent(t))})}}addHandler(t,n,i,r){const s=this._events.get(n);if(s){const u=s.get(i);u?u.add(r):s.set(i,new Set([r]))}else this._events.set(n,new Map([[i,new Set([r])]])),t.runOutsideAngular(()=>{document.addEventListener(n,this._delegateEventHandler,GN)})}removeHandler(t,n,i){const r=this._events.get(t);if(!r)return;const s=r.get(n);s&&(s.delete(i),0===s.size&&r.delete(n),0===r.size&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,GN)))}}const qN={enterDuration:225,exitDuration:150},WN=Bb({passive:!0,capture:!0}),ZN=["mousedown","touchstart"],XN=["mouseup","mouseleave","touchend","touchcancel"];class Fy{constructor(t,n,i,r){this._target=t,this._ngZone=n,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=Oy(i))}fadeInRipple(t,n,i={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s={...qN,...i.animation};i.centered&&(t=r.left+r.width/2,n=r.top+r.height/2);const u=i.radius||function CK(e,t,n){const i=Math.max(Math.abs(e-n.left),Math.abs(e-n.right)),r=Math.max(Math.abs(t-n.top),Math.abs(t-n.bottom));return Math.sqrt(i*i+r*r)}(t,n,r),h=t-r.left,g=n-r.top,x=s.enterDuration,C=document.createElement("div");C.classList.add("mat-ripple-element"),C.style.left=h-u+"px",C.style.top=g-u+"px",C.style.height=2*u+"px",C.style.width=2*u+"px",null!=i.color&&(C.style.backgroundColor=i.color),C.style.transitionDuration=`${x}ms`,this._containerElement.appendChild(C);const S=window.getComputedStyle(C),F=S.transitionDuration,$="none"===S.transitionProperty||"0s"===F||"0s, 0s"===F||0===r.width&&0===r.height,G=new xK(this,C,i,$);C.style.transform="scale3d(1, 1, 1)",G.state=0,i.persistent||(this._mostRecentTransientRipple=G);let Y=null;return!$&&(x||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const J=()=>this._finishRippleTransition(G),Q=()=>this._destroyRipple(G);C.addEventListener("transitionend",J),C.addEventListener("transitioncancel",Q),Y={onTransitionEnd:J,onTransitionCancel:Q}}),this._activeRipples.set(G,Y),($||!x)&&this._finishRippleTransition(G),G}fadeOutRipple(t){if(2===t.state||3===t.state)return;const n=t.element,i={...qN,...t.config.animation};n.style.transitionDuration=`${i.exitDuration}ms`,n.style.opacity="0",t.state=2,(t._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){const n=Oy(t);!this._platform.isBrowser||!n||n===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=n,ZN.forEach(i=>{Fy._eventManager.addHandler(this._ngZone,i,n,this)}))}handleEvent(t){"mousedown"===t.type?this._onMousedown(t):"touchstart"===t.type?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{XN.forEach(n=>{this._triggerElement.addEventListener(n,this,WN)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){0===t.state?this._startFadeOutTransition(t):2===t.state&&this._destroyRipple(t)}_startFadeOutTransition(t){const n=t===this._mostRecentTransientRipple,{persistent:i}=t.config;t.state=1,!i&&(!n||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){const n=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=3,null!==n&&(t.element.removeEventListener("transitionend",n.onTransitionEnd),t.element.removeEventListener("transitioncancel",n.onTransitionCancel)),t.element.remove()}_onMousedown(t){const n=uN(t),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!n&&!i&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!dN(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const n=t.changedTouches;if(n)for(let i=0;i<n.length;i++)this.fadeInRipple(n[i].clientX,n[i].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{!t.config.persistent&&(1===t.state||t.config.terminateOnPointerUp&&0===t.state)&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const t=this._triggerElement;t&&(ZN.forEach(n=>Fy._eventManager.removeHandler(n,t,this)),this._pointerUpEventsRegistered&&XN.forEach(n=>t.removeEventListener(n,this,WN)))}}Fy._eventManager=new wK;const YN=new sn("mat-ripple-global-options");let MK=(()=>{class e{get disabled(){return this._disabled}set disabled(n){n&&this.fadeOutAllNonPersistent(),this._disabled=n,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(n){this._trigger=n,this._setupTriggerEventsIfEnabled()}constructor(n,i,r,s,u){this._elementRef=n,this._animationMode=u,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=s||{},this._rippleRenderer=new Fy(this,i,n,r)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(n,i=0,r){return"number"==typeof n?this._rippleRenderer.fadeInRipple(n,i,{...this.rippleConfig,...r}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...n})}}return e.\u0275fac=function(n){return new(n||e)(Nt(vs),Nt(Fi),Nt(Fl),Nt(YN,8),Nt(bd,8))},e.\u0275dir=Cr({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(n,i){2&n&&kl("mat-ripple-unbounded",i.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),e})(),TK=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({imports:[om,om]}),e})();const DK=["tooltip"],KN=new sn("mat-tooltip-scroll-strategy"),AK={provide:KN,deps:[Ly],useFactory:function IK(e){return()=>e.scrollStrategies.reposition({scrollThrottle:20})}},OK=new sn("mat-tooltip-default-options",{providedIn:"root",factory:function PK(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),QN="tooltip-panel",JN=Bb({passive:!0});let zK=(()=>{class e{get position(){return this._position}set position(n){n!==this._position&&(this._position=n,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(n){this._positionAtOrigin=BE(n),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(n){this._disabled=BE(n),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(n){this._showDelay=K5(n)}get hideDelay(){return this._hideDelay}set hideDelay(n){this._hideDelay=K5(n),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(n){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=n?String(n).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(n){this._tooltipClass=n,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(n,i,r,s,u,h,g,x,C,S,O,F){this._overlay=n,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=s,this._ngZone=u,this._platform=h,this._ariaDescriber=g,this._focusMonitor=x,this._dir=S,this._defaultOptions=O,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="mat",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new Yn,this._scrollStrategy=C,this._document=F,O&&(this._showDelay=O.showDelay,this._hideDelay=O.hideDelay,O.position&&(this.position=O.position),O.positionAtOrigin&&(this.positionAtOrigin=O.positionAtOrigin),O.touchGestures&&(this.touchGestures=O.touchGestures)),S.change.pipe(Hc(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Hc(this._destroyed)).subscribe(n=>{n?"keyboard"===n&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const n=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{n.removeEventListener(i,r,JN)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(n,this.message,"tooltip"),this._focusMonitor.stopMonitoring(n)}show(n=this.showDelay,i){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const r=this._createOverlay(i);this._detach(),this._portal=this._portal||new YE(this._tooltipComponent,this._viewContainerRef);const s=this._tooltipInstance=r.attach(this._portal).instance;s._triggerElement=this._elementRef.nativeElement,s._mouseLeaveHideDelay=this._hideDelay,s.afterHidden().pipe(Hc(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),s.show(n)}hide(n=this.hideDelay){const i=this._tooltipInstance;i&&(i.isVisible()?i.hide(n):(i._cancelPendingAnimations(),this._detach()))}toggle(n){this._isTooltipVisible()?this.hide():this.show(void 0,n)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(n){if(this._overlayRef){const s=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!n)&&s._origin instanceof vs)return this._overlayRef;this._detach()}const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&n||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i);return r.positionChanges.pipe(Hc(this._destroyed)).subscribe(s=>{this._updateCurrentPositionClass(s.connectionPair),this._tooltipInstance&&s.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:r,panelClass:`${this._cssClassPrefix}-${QN}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(Hc(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(Hc(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(Hc(this._destroyed)).subscribe(s=>{this._isTooltipVisible()&&27===s.keyCode&&!function VX(e,...t){return t.length?t.some(n=>e[n]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(s)&&(s.preventDefault(),s.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(n){const i=n.getConfig().positionStrategy,r=this._getOrigin(),s=this._getOverlayPosition();i.withPositions([this._addOffset({...r.main,...s.main}),this._addOffset({...r.fallback,...s.fallback})])}_addOffset(n){return n}_getOrigin(){const n=!this._dir||"ltr"==this._dir.value,i=this.position;let r;"above"==i||"below"==i?r={originX:"center",originY:"above"==i?"top":"bottom"}:"before"==i||"left"==i&&n||"right"==i&&!n?r={originX:"start",originY:"center"}:("after"==i||"right"==i&&n||"left"==i&&!n)&&(r={originX:"end",originY:"center"});const{x:s,y:u}=this._invertPosition(r.originX,r.originY);return{main:r,fallback:{originX:s,originY:u}}}_getOverlayPosition(){const n=!this._dir||"ltr"==this._dir.value,i=this.position;let r;"above"==i?r={overlayX:"center",overlayY:"bottom"}:"below"==i?r={overlayX:"center",overlayY:"top"}:"before"==i||"left"==i&&n||"right"==i&&!n?r={overlayX:"end",overlayY:"center"}:("after"==i||"right"==i&&n||"left"==i&&!n)&&(r={overlayX:"start",overlayY:"center"});const{x:s,y:u}=this._invertPosition(r.overlayX,r.overlayY);return{main:r,fallback:{overlayX:s,overlayY:u}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Iu(1),Hc(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(n){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=n,this._tooltipInstance._markForCheck())}_invertPosition(n,i){return"above"===this.position||"below"===this.position?"top"===i?i="bottom":"bottom"===i&&(i="top"):"end"===n?n="start":"start"===n&&(n="end"),{x:n,y:i}}_updateCurrentPositionClass(n){const{overlayY:i,originX:r,originY:s}=n;let u;if(u="center"===i?this._dir&&"rtl"===this._dir.value?"end"===r?"left":"right":"start"===r?"left":"right":"bottom"===i&&"top"===s?"above":"below",u!==this._currentPosition){const h=this._overlayRef;if(h){const g=`${this._cssClassPrefix}-${QN}-`;h.removePanelClass(g+this._currentPosition),h.addPanelClass(g+u)}this._currentPosition=u}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",n=>{let i;this._setupPointerExitEventsIfNeeded(),void 0!==n.x&&void 0!==n.y&&(i=n),this.show(void 0,i)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",n=>{const i=n.targetTouches?.[0],r=i?{x:i.clientX,y:i.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,r),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const n=[];if(this._platformSupportsMouseEvents())n.push(["mouseleave",i=>{const r=i.relatedTarget;(!r||!this._overlayRef?.overlayElement.contains(r))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};n.push(["touchend",i],["touchcancel",i])}this._addListeners(n),this._passiveListeners.push(...n)}_addListeners(n){n.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,JN)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(n){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(n.clientX,n.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const n=this.touchGestures;if("off"!==n){const i=this._elementRef.nativeElement,r=i.style;("on"===n||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===n||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return e.\u0275fac=function(n){yh()},e.\u0275dir=Cr({type:e,inputs:{position:["matTooltipPosition","position"],positionAtOrigin:["matTooltipPositionAtOrigin","positionAtOrigin"],disabled:["matTooltipDisabled","disabled"],showDelay:["matTooltipShowDelay","showDelay"],hideDelay:["matTooltipHideDelay","hideDelay"],touchGestures:["matTooltipTouchGestures","touchGestures"],message:["matTooltip","message"],tooltipClass:["matTooltipClass","tooltipClass"]}}),e})(),Wb=(()=>{class e extends zK{constructor(n,i,r,s,u,h,g,x,C,S,O,F){super(n,i,r,s,u,h,g,x,C,S,O,F),this._tooltipComponent=UK,this._cssClassPrefix="mat-mdc",this._viewportMargin=8}_addOffset(n){const r=!this._dir||"ltr"==this._dir.value;return"top"===n.originY?n.offsetY=-8:"bottom"===n.originY?n.offsetY=8:"start"===n.originX?n.offsetX=r?-8:8:"end"===n.originX&&(n.offsetX=r?8:-8),n}}return e.\u0275fac=function(n){return new(n||e)(Nt(Ly),Nt(vs),Nt(wN),Nt($c),Nt(Fi),Nt(Fl),Nt(dY),Nt(pN),Nt(KN),Nt(yN,8),Nt(OK,8),Nt(Ki))},e.\u0275dir=Cr({type:e,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(n,i){2&n&&kl("mat-mdc-tooltip-disabled",i.disabled)},exportAs:["matTooltip"],features:[If]}),e})(),BK=(()=>{class e{constructor(n,i){this._changeDetectorRef=n,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new Yn,this._animationsDisabled="NoopAnimations"===i}show(n){null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},n)}hide(n){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},n)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:n}){(!n||!this._triggerElement.contains(n))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){}_handleAnimationEnd({animationName:n}){(n===this._showAnimation||n===this._hideAnimation)&&this._finalizeAnimation(n===this._showAnimation)}_cancelPendingAnimations(){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(n){n?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(n){const i=this._tooltip.nativeElement,r=this._showAnimation,s=this._hideAnimation;if(i.classList.remove(n?s:r),i.classList.add(n?r:s),this._isVisible=n,n&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const u=getComputedStyle(i);("0s"===u.getPropertyValue("animation-duration")||"none"===u.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}n&&this._onShow(),this._animationsDisabled&&(i.classList.add("_mat-animation-noopable"),this._finalizeAnimation(n))}}return e.\u0275fac=function(n){return new(n||e)(Nt(Ay),Nt(bd,8))},e.\u0275dir=Cr({type:e}),e})(),UK=(()=>{class e extends BK{constructor(n,i,r){super(n,r),this._elementRef=i,this._isMultiline=!1,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide"}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const n=this._elementRef.nativeElement.getBoundingClientRect();return n.height>24&&n.width>=200}}return e.\u0275fac=function(n){return new(n||e)(Nt(Ay),Nt(vs),Nt(bd,8))},e.\u0275cmp=Ni({type:e,selectors:[["mat-tooltip-component"]],viewQuery:function(n,i){if(1&n&&Eg(DK,7),2&n){let r;Jp(r=em())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(n,i){1&n&&xs("mouseleave",function(s){return i._handleMouseLeave(s)}),2&n&&Cy("zoom",i.isVisible()?1:null)},features:[If],decls:4,vars:4,consts:[[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"ngClass","animationend"],["tooltip",""],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(n,i){1&n&&(Rt(0,"div",0,1),xs("animationend",function(s){return i._handleAnimationEnd(s)}),Rt(2,"div",2),In(3),kt()()),2&n&&(kl("mdc-tooltip--multiline",i._isMultiline),Ut("ngClass",i.tooltipClass),xt(3),Ar(i.message))},dependencies:[_5],styles:['.mdc-tooltip__surface{word-break:break-all;word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip--showing-transition .mdc-tooltip__surface-animation{transition:opacity 150ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-tooltip--hide-transition .mdc-tooltip__surface-animation{transition:opacity 75ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - (2 * 8px));margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - (2 * 8px));align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mat-mdc-tooltip{--mdc-plain-tooltip-container-shape:4px;--mdc-plain-tooltip-supporting-text-line-height:16px}.mat-mdc-tooltip .mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color)}.mat-mdc-tooltip .mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__caret-surface-top,.mat-mdc-tooltip .mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color)}.mat-mdc-tooltip .mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0}),e})(),VK=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({providers:[AK],imports:[MY,k2,zN,om,om,oI]}),e})();const jK=["mat-button",""],$K=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],HK=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],e3={capture:!0},t3=["focus","click","mouseenter","touchstart"],Zb="mat-button-ripple-uninitialized";let GK=(()=>{class e{constructor(){this._document=tn(Ki,{optional:!0}),this._animationMode=tn(bd,{optional:!0}),this._globalRippleOptions=tn(YN,{optional:!0}),this._platform=tn(Fl),this._ngZone=tn(Fi),this._onInteraction=n=>{if(n.target===this._document)return;const r=n.target.closest(`[${Zb}]`);r&&(r.removeAttribute(Zb),this._appendRipple(r))},this._ngZone.runOutsideAngular(()=>{for(const n of t3)this._document?.addEventListener(n,this._onInteraction,e3)})}ngOnDestroy(){for(const n of t3)this._document?.removeEventListener(n,this._onInteraction,e3)}_appendRipple(n){if(!this._document)return;const i=this._document.createElement("span");i.classList.add("mat-mdc-button-ripple");const r=new qK(n,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);r.rippleConfig.centered=n.hasAttribute("mat-icon-button"),new Fy(r,this._ngZone,i,this._platform).setupTriggerEvents(n),n.append(i)}_createMatRipple(n){if(!this._document)return;n.querySelector(".mat-mdc-button-ripple")?.remove(),n.removeAttribute(Zb);const i=this._document.createElement("span");i.classList.add("mat-mdc-button-ripple");const r=new MK(new vs(i),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return r._isInitialized=!0,r.trigger=n,n.append(i),r}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class qK{constructor(t,n,i){this._button=t,this._globalRippleOptions=n,this._setRippleConfig(n,i)}_setRippleConfig(t,n){this.rippleConfig=t||{},"NoopAnimations"===n&&(this.rippleConfig.animation={enterDuration:0,exitDuration:0})}get rippleDisabled(){return this._button.hasAttribute("disabled")||!!this._globalRippleOptions?.disabled}}const WK=[{selector:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{selector:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{selector:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{selector:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{selector:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{selector:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{selector:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],ZK=yK(_K(vK(class{constructor(e){this._elementRef=e}})));let XK=(()=>{class e extends ZK{get ripple(){return!this._ripple&&this._rippleLoader&&(this._ripple=this._rippleLoader._createMatRipple(this._elementRef.nativeElement)),this._ripple}set ripple(n){this._ripple=n}constructor(n,i,r,s){super(n),this._platform=i,this._ngZone=r,this._animationMode=s,this._focusMonitor=tn(pN),this._rippleLoader=tn(GK),this._isFab=!1;const u=n.nativeElement.classList;for(const h of WK)this._hasHostAttributes(h.selector)&&h.mdcClasses.forEach(g=>{u.add(g)})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnChanges(){this._ripple&&(this._ripple.disabled=this.disableRipple||this.disabled)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(n="program",i){n?this._focusMonitor.focusVia(this._elementRef.nativeElement,n,i):this._elementRef.nativeElement.focus(i)}_hasHostAttributes(...n){return n.some(i=>this._elementRef.nativeElement.hasAttribute(i))}}return e.\u0275fac=function(n){yh()},e.\u0275dir=Cr({type:e,features:[If,se]}),e})(),KK=(()=>{class e extends XK{constructor(n,i,r,s){super(n,i,r,s)}}return e.\u0275fac=function(n){return new(n||e)(Nt(vs),Nt(Fl),Nt(Fi),Nt(bd,8))},e.\u0275cmp=Ni({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostAttrs:["mat-button-ripple-uninitialized",""],hostVars:7,hostBindings:function(n,i){2&n&&(vb("disabled",i.disabled||null),kl("_mat-animation-noopable","NoopAnimations"===i._animationMode)("mat-unthemed",!i.color)("mat-mdc-button-base",!0))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[If],attrs:jK,ngContentSelectors:HK,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(n,i){1&n&&(Eb($K),Hi(0,"span",0),bg(1),Rt(2,"span",1),bg(3,1),kt(),bg(4,2),Hi(5,"span",2)(6,"span",3)),2&n&&kl("mdc-button__ripple",!i._isFab)("mdc-fab__ripple",i._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(\n      100% + 4px\n    );width:calc(\n      100% + 4px\n    );display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{height:var(--mdc-text-button-container-height, 36px);border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, inherit)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button{height:var(--mdc-filled-button-container-height, 36px);border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color, transparent)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, inherit)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button{height:var(--mdc-protected-button-container-height, 36px);border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px));box-shadow:var(--mdc-protected-button-container-elevation, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color, transparent)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, inherit)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button.mdc-ripple-upgraded--background-focused,.mat-mdc-raised-button:not(.mdc-ripple-upgraded):focus{box-shadow:var(--mdc-protected-button-focus-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled):active{box-shadow:var(--mdc-protected-button-pressed-container-elevation, 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button{height:var(--mdc-outlined-button-container-height, 36px);border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px));padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, inherit)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width, 1px));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width, 1px))}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0;background-color:var(--mat-mdc-button-persistent-ripple-color)}.mat-mdc-button .mat-ripple-element,.mat-mdc-unelevated-button .mat-ripple-element,.mat-mdc-raised-button .mat-ripple-element,.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-mdc-button-ripple-color)}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button[disabled],.mat-mdc-unelevated-button[disabled],.mat-mdc-raised-button[disabled],.mat-mdc-outlined-button[disabled]{cursor:default;pointer-events:none}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px) * -1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0}),e})(),JK=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({imports:[om,TK,om]}),e})();function eQ(e,t){if(1&e){const n=Kp();Rt(0,"div",2)(1,"button",3),xs("click",function(){return Rs(n),Pa(Rn().action())}),In(2),kt()()}if(2&e){const n=Rn();xt(2),Md(" ",n.data.action," ")}}const tQ=["label"];function nQ(e,t){}const iQ=Math.pow(2,31)-1;class uI{constructor(t,n){this._overlayRef=n,this._afterDismissed=new Yn,this._afterOpened=new Yn,this._onAction=new Yn,this._dismissedByAction=!1,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,iQ))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}}const n3=new sn("MatSnackBarData");class eC{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}}let rQ=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Cr({type:e,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]}),e})(),oQ=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Cr({type:e,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]}),e})(),sQ=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Cr({type:e,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]}),e})(),aQ=(()=>{class e{constructor(n,i){this.snackBarRef=n,this.data=i}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}}return e.\u0275fac=function(n){return new(n||e)(Nt(uI),Nt(n3))},e.\u0275cmp=Ni({type:e,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions","",4,"ngIf"],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(n,i){1&n&&(Rt(0,"div",0),In(1),kt(),jn(2,eQ,3,1,"div",1)),2&n&&(xt(1),Md(" ",i.data.message,"\n"),xt(1),Ut("ngIf",i.hasAction))},dependencies:[dc,KK,rQ,oQ,sQ],styles:[".mat-mdc-simple-snack-bar{display:flex}"],encapsulation:2,changeDetection:0}),e})();const lQ={snackBarState:UN("state",[QE("void, hidden",Ag({transform:"scale(0.8)",opacity:0})),QE("visible",Ag({transform:"scale(1)",opacity:1})),JE("* => visible",KE("150ms cubic-bezier(0, 0, 0.2, 1)")),JE("* => void, * => hidden",KE("75ms cubic-bezier(0.4, 0.0, 1, 1)",Ag({opacity:0})))])};let cQ=0,uQ=(()=>{class e extends aI{constructor(n,i,r,s,u){super(),this._ngZone=n,this._elementRef=i,this._changeDetectorRef=r,this._platform=s,this.snackBarConfig=u,this._document=tn(Ki),this._trackedModals=new Set,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new Yn,this._onExit=new Yn,this._onEnter=new Yn,this._animationState="void",this._liveElementId="mat-snack-bar-container-live-"+cQ++,this.attachDomPortal=h=>{this._assertNotAttached();const g=this._portalOutlet.attachDomPortal(h);return this._afterPortalAttached(),g},this._live="assertive"!==u.politeness||u.announcementMessage?"off"===u.politeness?"off":"polite":"assertive",this._platform.FIREFOX&&("polite"===this._live&&(this._role="status"),"assertive"===this._live&&(this._role="alert"))}attachComponentPortal(n){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(n);return this._afterPortalAttached(),i}attachTemplatePortal(n){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(n);return this._afterPortalAttached(),i}onAnimationEnd(n){const{fromState:i,toState:r}=n;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const s=this._onEnter;this._ngZone.run(()=>{s.next(),s.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._ngZone.run(()=>{this._animationState="hidden",this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId)}),this._onExit}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(Iu(1)).subscribe(()=>{this._ngZone.run(()=>{this._onExit.next(),this._onExit.complete()})})}_afterPortalAttached(){const n=this._elementRef.nativeElement,i=this.snackBarConfig.panelClass;i&&(Array.isArray(i)?i.forEach(r=>n.classList.add(r)):n.classList.add(i)),this._exposeToModals()}_exposeToModals(){const n=this._liveElementId,i=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let r=0;r<i.length;r++){const s=i[r],u=s.getAttribute("aria-owns");this._trackedModals.add(s),u?-1===u.indexOf(n)&&s.setAttribute("aria-owns",u+" "+n):s.setAttribute("aria-owns",n)}}_clearFromModals(){this._trackedModals.forEach(n=>{const i=n.getAttribute("aria-owns");if(i){const r=i.replace(this._liveElementId,"").trim();r.length>0?n.setAttribute("aria-owns",r):n.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{const n=this._elementRef.nativeElement.querySelector("[aria-hidden]"),i=this._elementRef.nativeElement.querySelector("[aria-live]");if(n&&i){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&n.contains(document.activeElement)&&(r=document.activeElement),n.removeAttribute("aria-hidden"),i.appendChild(n),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}}return e.\u0275fac=function(n){return new(n||e)(Nt(Fi),Nt(vs),Nt(Ay),Nt(Fl),Nt(eC))},e.\u0275dir=Cr({type:e,viewQuery:function(n,i){if(1&n&&Eg(TN,7),2&n){let r;Jp(r=em())&&(i._portalOutlet=r.first)}},features:[If]}),e})(),dQ=(()=>{class e extends uQ{_afterPortalAttached(){super._afterPortalAttached();const n=this._label.nativeElement,i="mdc-snackbar__label";n.classList.toggle(i,!n.querySelector(`.${i}`))}}return e.\u0275fac=function(){let t;return function(i){return(t||(t=$m(e)))(i||e)}}(),e.\u0275cmp=Ni({type:e,selectors:[["mat-snack-bar-container"]],viewQuery:function(n,i){if(1&n&&Eg(tQ,7),2&n){let r;Jp(r=em())&&(i._label=r.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container","mdc-snackbar--open"],hostVars:1,hostBindings:function(n,i){1&n&&yS("@state.done",function(s){return i.onAnimationEnd(s)}),2&n&&MS("@state",i._animationState)},features:[If],decls:6,vars:3,consts:[[1,"mdc-snackbar__surface"],[1,"mat-mdc-snack-bar-label"],["label",""],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(n,i){1&n&&(Rt(0,"div",0)(1,"div",1,2)(3,"div",3),jn(4,nQ,0,0,"ng-template",4),kt(),Hi(5,"div"),kt()()),2&n&&(xt(5),vb("aria-live",i._live)("role",i._role)("id",i._liveElementId))},dependencies:[TN],styles:['.mdc-snackbar{display:none;position:fixed;right:0;bottom:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;pointer-events:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mdc-snackbar--opening,.mdc-snackbar--open,.mdc-snackbar--closing{display:flex}.mdc-snackbar--open .mdc-snackbar__label,.mdc-snackbar--open .mdc-snackbar__actions{visibility:visible}.mdc-snackbar__surface{padding-left:0;padding-right:8px;display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;transform:scale(0.8);opacity:0}.mdc-snackbar__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-snackbar__surface::before{border-color:CanvasText}}[dir=rtl] .mdc-snackbar__surface,.mdc-snackbar__surface[dir=rtl]{padding-left:8px;padding-right:0}.mdc-snackbar--open .mdc-snackbar__surface{transform:scale(1);opacity:1;pointer-events:auto}.mdc-snackbar--closing .mdc-snackbar__surface{transform:scale(1)}.mdc-snackbar__label{padding-left:16px;padding-right:8px;width:100%;flex-grow:1;box-sizing:border-box;margin:0;visibility:hidden;padding-top:14px;padding-bottom:14px}[dir=rtl] .mdc-snackbar__label,.mdc-snackbar__label[dir=rtl]{padding-left:8px;padding-right:16px}.mdc-snackbar__label::before{display:inline;content:attr(data-mdc-snackbar-label-text)}.mdc-snackbar__actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box;visibility:hidden}.mdc-snackbar__action+.mdc-snackbar__dismiss{margin-left:8px;margin-right:0}[dir=rtl] .mdc-snackbar__action+.mdc-snackbar__dismiss,.mdc-snackbar__action+.mdc-snackbar__dismiss[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-snack-bar-container{margin:8px;--mdc-snackbar-container-shape:4px;position:static}.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:344px}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:100%}}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container{width:100vw}}.mat-mdc-snack-bar-container .mdc-snackbar__surface{max-width:672px}.mat-mdc-snack-bar-container .mdc-snackbar__surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{background-color:var(--mdc-snackbar-container-color)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{border-radius:var(--mdc-snackbar-container-shape)}.mat-mdc-snack-bar-container .mdc-snackbar__label{color:var(--mdc-snackbar-supporting-text-color)}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-size:var(--mdc-snackbar-supporting-text-size);font-family:var(--mdc-snackbar-supporting-text-font);font-weight:var(--mdc-snackbar-supporting-text-weight);line-height:var(--mdc-snackbar-supporting-text-line-height)}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){color:var(--mat-snack-bar-button-color);--mat-mdc-button-persistent-ripple-color: currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{background-color:currentColor;opacity:.1}.mat-mdc-snack-bar-container .mdc-snackbar__label::before{display:none}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-handset .mdc-snackbar__surface{width:100%}'],encapsulation:2,data:{animation:[lQ.snackBarState]}}),e})(),r3=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({imports:[zN,DN,k2,JK,om,om]}),e})();const o3=new sn("mat-snack-bar-default-options",{providedIn:"root",factory:function hQ(){return new eC}});let fQ=(()=>{class e{get _openedSnackBarRef(){const n=this._parentSnackBar;return n?n._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(n){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=n:this._snackBarRefAtThisLevel=n}constructor(n,i,r,s,u,h){this._overlay=n,this._live=i,this._injector=r,this._breakpointObserver=s,this._parentSnackBar=u,this._defaultConfig=h,this._snackBarRefAtThisLevel=null}openFromComponent(n,i){return this._attach(n,i)}openFromTemplate(n,i){return this._attach(n,i)}open(n,i="",r){const s={...this._defaultConfig,...r};return s.data={message:n,action:i},s.announcementMessage===n&&(s.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,s)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(n,i){const s=bs.create({parent:i&&i.viewContainerRef&&i.viewContainerRef.injector||this._injector,providers:[{provide:eC,useValue:i}]}),u=new YE(this.snackBarContainerComponent,i.viewContainerRef,s),h=n.attach(u);return h.instance.snackBarConfig=i,h.instance}_attach(n,i){const r={...new eC,...this._defaultConfig,...i},s=this._createOverlay(r),u=this._attachSnackBarContainer(s,r),h=new uI(u,s);if(n instanceof Eh){const g=new MN(n,null,{$implicit:r.data,snackBarRef:h});h.instance=u.attachTemplatePortal(g)}else{const g=this._createInjector(r,h),x=new YE(n,void 0,g),C=u.attachComponentPortal(x);h.instance=C.instance}return this._breakpointObserver.observe("(max-width: 599.98px) and (orientation: portrait)").pipe(Hc(s.detachments())).subscribe(g=>{s.overlayElement.classList.toggle(this.handsetCssClass,g.matches)}),r.announcementMessage&&u._onAnnounce.subscribe(()=>{this._live.announce(r.announcementMessage,r.politeness)}),this._animateSnackBar(h,r),this._openedSnackBarRef=h,this._openedSnackBarRef}_animateSnackBar(n,i){n.afterDismissed().subscribe(()=>{this._openedSnackBarRef==n&&(this._openedSnackBarRef=null),i.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{n.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):n.containerInstance.enter(),i.duration&&i.duration>0&&n.afterOpened().subscribe(()=>n._dismissAfter(i.duration))}_createOverlay(n){const i=new PN;i.direction=n.direction;let r=this._overlay.position().global();const s="rtl"===n.direction,u="left"===n.horizontalPosition||"start"===n.horizontalPosition&&!s||"end"===n.horizontalPosition&&s,h=!u&&"center"!==n.horizontalPosition;return u?r.left("0"):h?r.right("0"):r.centerHorizontally(),"top"===n.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(n,i){return bs.create({parent:n&&n.viewContainerRef&&n.viewContainerRef.injector||this._injector,providers:[{provide:uI,useValue:i},{provide:n3,useValue:n.data}]})}}return e.\u0275fac=function(n){return new(n||e)(et(Ly),et(fN),et(bs),et(J2),et(e,12),et(o3))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})(),pQ=(()=>{class e extends fQ{constructor(n,i,r,s,u,h){super(n,i,r,s,u,h),this.simpleSnackBarComponent=aQ,this.snackBarContainerComponent=dQ,this.handsetCssClass="mat-mdc-snack-bar-handset"}}return e.\u0275fac=function(n){return new(n||e)(et(Ly),et(fN),et(bs),et(J2),et(e,12),et(o3))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:r3}),e})();function s3(e){return new $e(3e3,!1)}function sm(e){switch(e.length){case 0:return new Gb;case 1:return e[0];default:return new jN(e)}}function a3(e,t,n=new Map,i=new Map){const r=[],s=[];let u=-1,h=null;if(t.forEach(g=>{const x=g.get("offset"),C=x==u,S=C&&h||new Map;g.forEach((O,F)=>{let $=F,G=O;if("offset"!==F)switch($=e.normalizePropertyName($,r),G){case"!":G=n.get(F);break;case Rf:G=i.get(F);break;default:G=e.normalizeStyleValue(F,$,G,r)}S.set($,G)}),C||s.push(S),h=S,u=x}),r.length)throw function NQ(e){return new $e(3502,!1)}();return s}function dI(e,t,n,i){switch(t){case"start":e.onStart(()=>i(n&&hI(n,"start",e)));break;case"done":e.onDone(()=>i(n&&hI(n,"done",e)));break;case"destroy":e.onDestroy(()=>i(n&&hI(n,"destroy",e)))}}function hI(e,t,n){const s=fI(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,n.totalTime??e.totalTime,!!n.disabled),u=e._data;return null!=u&&(s._data=u),s}function fI(e,t,n,i,r="",s=0,u){return{element:e,triggerName:t,fromState:n,toState:i,phaseName:r,totalTime:s,disabled:!!u}}function Gc(e,t,n){let i=e.get(t);return i||e.set(t,i=n),i}function l3(e){const t=e.indexOf(":");return[e.substring(1,t),e.slice(t+1)]}const XQ=(()=>typeof document>"u"?null:document.documentElement)();function pI(e){const t=e.parentNode||e.host||null;return t===XQ?null:t}let Pg=null,c3=!1;function u3(e,t){for(;t;){if(t===e)return!0;t=pI(t)}return!1}function d3(e,t,n){if(n)return Array.from(e.querySelectorAll(t));const i=e.querySelector(t);return i?[i]:[]}let h3=(()=>{class e{validateStyleProperty(n){return function KQ(e){Pg||(Pg=function QQ(){return typeof document<"u"?document.body:null}()||{},c3=!!Pg.style&&"WebkitAppearance"in Pg.style);let t=!0;return Pg.style&&!function YQ(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in Pg.style,!t&&c3&&(t="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in Pg.style)),t}(n)}matchesElement(n,i){return!1}containsElement(n,i){return u3(n,i)}getParentElement(n){return pI(n)}query(n,i,r){return d3(n,i,r)}computeStyle(n,i,r){return r||""}animate(n,i,r,s,u,h=[],g){return new Gb(r,s)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})(),mI=(()=>{class e{}return e.NOOP=new h3,e})();const JQ=1e3,gI="ng-enter",tC="ng-leave",nC="ng-trigger",iC=".ng-trigger",p3="ng-animating",_I=".ng-animating";function Lf(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:yI(parseFloat(t[1]),t[2])}function yI(e,t){return"s"===t?e*JQ:e}function rC(e,t,n){return e.hasOwnProperty("duration")?e:function tJ(e,t,n){let r,s=0,u="";if("string"==typeof e){const h=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===h)return t.push(s3()),{duration:0,delay:0,easing:""};r=yI(parseFloat(h[1]),h[2]);const g=h[3];null!=g&&(s=yI(parseFloat(g),h[4]));const x=h[5];x&&(u=x)}else r=e;if(!n){let h=!1,g=t.length;r<0&&(t.push(function mQ(){return new $e(3100,!1)}()),h=!0),s<0&&(t.push(function gQ(){return new $e(3101,!1)}()),h=!0),h&&t.splice(g,0,s3())}return{duration:r,delay:s,easing:u}}(e,t,n)}function Xb(e,t={}){return Object.keys(e).forEach(n=>{t[n]=e[n]}),t}function m3(e){const t=new Map;return Object.keys(e).forEach(n=>{t.set(n,e[n])}),t}function am(e,t=new Map,n){if(n)for(let[i,r]of n)t.set(i,r);for(let[i,r]of e)t.set(i,r);return t}function Mh(e,t,n){t.forEach((i,r)=>{const s=bI(r);n&&!n.has(r)&&n.set(r,e.style[s]),e.style[s]=i})}function Og(e,t){t.forEach((n,i)=>{const r=bI(i);e.style[r]=""})}function Yb(e){return Array.isArray(e)?1==e.length?e[0]:VN(e):e}const vI=new RegExp("{{\\s*(.+?)\\s*}}","g");function _3(e){let t=[];if("string"==typeof e){let n;for(;n=vI.exec(e);)t.push(n[1]);vI.lastIndex=0}return t}function Kb(e,t,n){const i=e.toString(),r=i.replace(vI,(s,u)=>{let h=t[u];return null==h&&(n.push(function yQ(e){return new $e(3003,!1)}()),h=""),h.toString()});return r==i?e:r}function oC(e){const t=[];let n=e.next();for(;!n.done;)t.push(n.value),n=e.next();return t}const rJ=/-+([a-z0-9])/g;function bI(e){return e.replace(rJ,(...t)=>t[1].toUpperCase())}function qc(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw function vQ(e){return new $e(3004,!1)}()}}function y3(e,t){return window.getComputedStyle(e)[t]}const sC="*";function aJ(e,t){const n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(i=>function lJ(e,t,n){if(":"==e[0]){const g=function cJ(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(n,i)=>parseFloat(i)>parseFloat(n);case":decrement":return(n,i)=>parseFloat(i)<parseFloat(n);default:return t.push(function kQ(e){return new $e(3016,!1)}()),"* => *"}}(e,n);if("function"==typeof g)return void t.push(g);e=g}const i=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return n.push(function OQ(e){return new $e(3015,!1)}()),t;const r=i[1],s=i[2],u=i[3];t.push(v3(r,u));"<"==s[0]&&!(r==sC&&u==sC)&&t.push(v3(u,r))}(i,n,t)):n.push(e),n}const aC=new Set(["true","1"]),lC=new Set(["false","0"]);function v3(e,t){const n=aC.has(e)||lC.has(e),i=aC.has(t)||lC.has(t);return(r,s)=>{let u=e==sC||e==r,h=t==sC||t==s;return!u&&n&&"boolean"==typeof r&&(u=r?aC.has(e):lC.has(e)),!h&&i&&"boolean"==typeof s&&(h=s?aC.has(t):lC.has(t)),u&&h}}const uJ=new RegExp("s*:selfs*,?","g");function xI(e,t,n,i){return new dJ(e).build(t,n,i)}class dJ{constructor(t){this._driver=t}build(t,n,i){const r=new pJ(n);return this._resetContextStyleTimingState(r),qc(this,Yb(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,n){let i=n.queryCount=0,r=n.depCount=0;const s=[],u=[];return"@"==t.name.charAt(0)&&n.errors.push(function xQ(){return new $e(3006,!1)}()),t.definitions.forEach(h=>{if(this._resetContextStyleTimingState(n),0==h.type){const g=h,x=g.name;x.toString().split(/\s*,\s*/).forEach(C=>{g.name=C,s.push(this.visitState(g,n))}),g.name=x}else if(1==h.type){const g=this.visitTransition(h,n);i+=g.queryCount,r+=g.depCount,u.push(g)}else n.errors.push(function wQ(){return new $e(3007,!1)}())}),{type:7,name:t.name,states:s,transitions:u,queryCount:i,depCount:r,options:null}}visitState(t,n){const i=this.visitStyle(t.styles,n),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const s=new Set,u=r||{};i.styles.forEach(h=>{h instanceof Map&&h.forEach(g=>{_3(g).forEach(x=>{u.hasOwnProperty(x)||s.add(x)})})}),s.size&&(oC(s.values()),n.errors.push(function EQ(e,t){return new $e(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,n){n.queryCount=0,n.depCount=0;const i=qc(this,Yb(t.animation),n);return{type:1,matchers:aJ(t.expr,n.errors),animation:i,queryCount:n.queryCount,depCount:n.depCount,options:kg(t.options)}}visitSequence(t,n){return{type:2,steps:t.steps.map(i=>qc(this,i,n)),options:kg(t.options)}}visitGroup(t,n){const i=n.currentTime;let r=0;const s=t.steps.map(u=>{n.currentTime=i;const h=qc(this,u,n);return r=Math.max(r,n.currentTime),h});return n.currentTime=r,{type:3,steps:s,options:kg(t.options)}}visitAnimate(t,n){const i=function gJ(e,t){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return wI(rC(e,t).duration,0,"");const n=e;if(n.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=wI(0,0,"");return s.dynamic=!0,s.strValue=n,s}const r=rC(n,t);return wI(r.duration,r.delay,r.easing)}(t.timings,n.errors);n.currentAnimateTimings=i;let r,s=t.styles?t.styles:Ag({});if(5==s.type)r=this.visitKeyframes(s,n);else{let u=t.styles,h=!1;if(!u){h=!0;const x={};i.easing&&(x.easing=i.easing),u=Ag(x)}n.currentTime+=i.duration+i.delay;const g=this.visitStyle(u,n);g.isEmptyStep=h,r=g}return n.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,n){const i=this._makeStyleAst(t,n);return this._validateStyleAst(i,n),i}_makeStyleAst(t,n){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let h of r)"string"==typeof h?h===Rf?i.push(h):n.errors.push(new $e(3002,!1)):i.push(m3(h));let s=!1,u=null;return i.forEach(h=>{if(h instanceof Map&&(h.has("easing")&&(u=h.get("easing"),h.delete("easing")),!s))for(let g of h.values())if(g.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:u,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,n){const i=n.currentAnimateTimings;let r=n.currentTime,s=n.currentTime;i&&s>0&&(s-=i.duration+i.delay),t.styles.forEach(u=>{"string"!=typeof u&&u.forEach((h,g)=>{const x=n.collectedStyles.get(n.currentQuerySelector),C=x.get(g);let S=!0;C&&(s!=r&&s>=C.startTime&&r<=C.endTime&&(n.errors.push(function MQ(e,t,n,i,r){return new $e(3010,!1)}()),S=!1),s=C.startTime),S&&x.set(g,{startTime:s,endTime:r}),n.options&&function iJ(e,t,n){const i=t.params||{},r=_3(e);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||n.push(function _Q(e){return new $e(3001,!1)}())})}(h,n.options,n.errors)})})}visitKeyframes(t,n){const i={type:5,styles:[],options:null};if(!n.currentAnimateTimings)return n.errors.push(function TQ(){return new $e(3011,!1)}()),i;let s=0;const u=[];let h=!1,g=!1,x=0;const C=t.steps.map(J=>{const Q=this._makeStyleAst(J,n);let he=null!=Q.offset?Q.offset:function mJ(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(n=>{if(n instanceof Map&&n.has("offset")){const i=n;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const n=e;t=parseFloat(n.get("offset")),n.delete("offset")}return t}(Q.styles),ue=0;return null!=he&&(s++,ue=Q.offset=he),g=g||ue<0||ue>1,h=h||ue<x,x=ue,u.push(ue),Q});g&&n.errors.push(function DQ(){return new $e(3012,!1)}()),h&&n.errors.push(function SQ(){return new $e(3200,!1)}());const S=t.steps.length;let O=0;s>0&&s<S?n.errors.push(function IQ(){return new $e(3202,!1)}()):0==s&&(O=1/(S-1));const F=S-1,$=n.currentTime,G=n.currentAnimateTimings,Y=G.duration;return C.forEach((J,Q)=>{const he=O>0?Q==F?1:O*Q:u[Q],ue=he*Y;n.currentTime=$+G.delay+ue,G.duration=ue,this._validateStyleAst(J,n),J.offset=he,i.styles.push(J)}),i}visitReference(t,n){return{type:8,animation:qc(this,Yb(t.animation),n),options:kg(t.options)}}visitAnimateChild(t,n){return n.depCount++,{type:9,options:kg(t.options)}}visitAnimateRef(t,n){return{type:10,animation:this.visitReference(t.animation,n),options:kg(t.options)}}visitQuery(t,n){const i=n.currentQuerySelector,r=t.options||{};n.queryCount++,n.currentQuery=t;const[s,u]=function hJ(e){const t=!!e.split(/\s*,\s*/).find(n=>":self"==n);return t&&(e=e.replace(uJ,"")),e=e.replace(/@\*/g,iC).replace(/@\w+/g,n=>iC+"-"+n.slice(1)).replace(/:animating/g,_I),[e,t]}(t.selector);n.currentQuerySelector=i.length?i+" "+s:s,Gc(n.collectedStyles,n.currentQuerySelector,new Map);const h=qc(this,Yb(t.animation),n);return n.currentQuery=null,n.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:u,animation:h,originalSelector:t.selector,options:kg(t.options)}}visitStagger(t,n){n.currentQuery||n.errors.push(function AQ(){return new $e(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:rC(t.timings,n.errors,!0);return{type:12,animation:qc(this,Yb(t.animation),n),timings:i,options:null}}}class pJ{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function kg(e){return e?(e=Xb(e)).params&&(e.params=function fJ(e){return e?Xb(e):null}(e.params)):e={},e}function wI(e,t,n){return{duration:e,delay:t,easing:n}}function EI(e,t,n,i,r,s,u=null,h=!1){return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:u,subTimeline:h}}class cC{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,n){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...n)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const vJ=new RegExp(":enter","g"),xJ=new RegExp(":leave","g");function CI(e,t,n,i,r,s=new Map,u=new Map,h,g,x=[]){return(new wJ).buildKeyframes(e,t,n,i,r,s,u,h,g,x)}class wJ{buildKeyframes(t,n,i,r,s,u,h,g,x,C=[]){x=x||new cC;const S=new MI(t,n,x,r,s,C,[]);S.options=g;const O=g.delay?Lf(g.delay):0;S.currentTimeline.delayNextStep(O),S.currentTimeline.setStyles([u],null,S.errors,g),qc(this,i,S);const F=S.timelines.filter($=>$.containsAnimation());if(F.length&&h.size){let $;for(let G=F.length-1;G>=0;G--){const Y=F[G];if(Y.element===n){$=Y;break}}$&&!$.allowOnlyTimelineStyles()&&$.setStyles([h],null,S.errors,g)}return F.length?F.map($=>$.buildKeyframes()):[EI(n,[],[],[],0,O,"",!1)]}visitTrigger(t,n){}visitState(t,n){}visitTransition(t,n){}visitAnimateChild(t,n){const i=n.subInstructions.get(n.element);if(i){const r=n.createSubContext(t.options),s=n.currentTimeline.currentTime,u=this._visitSubInstructions(i,r,r.options);s!=u&&n.transformIntoNewTimeline(u)}n.previousNode=t}visitAnimateRef(t,n){const i=n.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],n,i),this.visitReference(t.animation,i),n.transformIntoNewTimeline(i.currentTimeline.currentTime),n.previousNode=t}_applyAnimationRefDelays(t,n,i){for(const r of t){const s=r?.delay;if(s){const u="number"==typeof s?s:Lf(Kb(s,r?.params??{},n.errors));i.delayNextStep(u)}}}_visitSubInstructions(t,n,i){let s=n.currentTimeline.currentTime;const u=null!=i.duration?Lf(i.duration):null,h=null!=i.delay?Lf(i.delay):null;return 0!==u&&t.forEach(g=>{const x=n.appendInstructionToTimeline(g,u,h);s=Math.max(s,x.duration+x.delay)}),s}visitReference(t,n){n.updateOptions(t.options,!0),qc(this,t.animation,n),n.previousNode=t}visitSequence(t,n){const i=n.subContextCount;let r=n;const s=t.options;if(s&&(s.params||s.delay)&&(r=n.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=uC);const u=Lf(s.delay);r.delayNextStep(u)}t.steps.length&&(t.steps.forEach(u=>qc(this,u,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),n.previousNode=t}visitGroup(t,n){const i=[];let r=n.currentTimeline.currentTime;const s=t.options&&t.options.delay?Lf(t.options.delay):0;t.steps.forEach(u=>{const h=n.createSubContext(t.options);s&&h.delayNextStep(s),qc(this,u,h),r=Math.max(r,h.currentTimeline.currentTime),i.push(h.currentTimeline)}),i.forEach(u=>n.currentTimeline.mergeTimelineCollectedStyles(u)),n.transformIntoNewTimeline(r),n.previousNode=t}_visitTiming(t,n){if(t.dynamic){const i=t.strValue;return rC(n.params?Kb(i,n.params,n.errors):i,n.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,n){const i=n.currentAnimateTimings=this._visitTiming(t.timings,n),r=n.currentTimeline;i.delay&&(n.incrementTime(i.delay),r.snapshotCurrentStyles());const s=t.style;5==s.type?this.visitKeyframes(s,n):(n.incrementTime(i.duration),this.visitStyle(s,n),r.applyStylesToKeyframe()),n.currentAnimateTimings=null,n.previousNode=t}visitStyle(t,n){const i=n.currentTimeline,r=n.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(s):i.setStyles(t.styles,s,n.errors,n.options),n.previousNode=t}visitKeyframes(t,n){const i=n.currentAnimateTimings,r=n.currentTimeline.duration,s=i.duration,h=n.createSubContext().currentTimeline;h.easing=i.easing,t.styles.forEach(g=>{h.forwardTime((g.offset||0)*s),h.setStyles(g.styles,g.easing,n.errors,n.options),h.applyStylesToKeyframe()}),n.currentTimeline.mergeTimelineCollectedStyles(h),n.transformIntoNewTimeline(r+s),n.previousNode=t}visitQuery(t,n){const i=n.currentTimeline.currentTime,r=t.options||{},s=r.delay?Lf(r.delay):0;s&&(6===n.previousNode.type||0==i&&n.currentTimeline.hasCurrentStyleProperties())&&(n.currentTimeline.snapshotCurrentStyles(),n.previousNode=uC);let u=i;const h=n.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,n.errors);n.currentQueryTotal=h.length;let g=null;h.forEach((x,C)=>{n.currentQueryIndex=C;const S=n.createSubContext(t.options,x);s&&S.delayNextStep(s),x===n.element&&(g=S.currentTimeline),qc(this,t.animation,S),S.currentTimeline.applyStylesToKeyframe(),u=Math.max(u,S.currentTimeline.currentTime)}),n.currentQueryIndex=0,n.currentQueryTotal=0,n.transformIntoNewTimeline(u),g&&(n.currentTimeline.mergeTimelineCollectedStyles(g),n.currentTimeline.snapshotCurrentStyles()),n.previousNode=t}visitStagger(t,n){const i=n.parentContext,r=n.currentTimeline,s=t.timings,u=Math.abs(s.duration),h=u*(n.currentQueryTotal-1);let g=u*n.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":g=h-g;break;case"full":g=i.currentStaggerTime}const C=n.currentTimeline;g&&C.delayNextStep(g);const S=C.currentTime;qc(this,t.animation,n),n.previousNode=t,i.currentStaggerTime=r.currentTime-S+(r.startTime-i.currentTimeline.startTime)}}const uC={};class MI{constructor(t,n,i,r,s,u,h,g){this._driver=t,this.element=n,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=u,this.timelines=h,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=uC,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=g||new dC(this._driver,n,0),h.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,n){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=Lf(i.duration)),null!=i.delay&&(r.delay=Lf(i.delay));const s=i.params;if(s){let u=r.params;u||(u=this.options.params={}),Object.keys(s).forEach(h=>{(!n||!u.hasOwnProperty(h))&&(u[h]=Kb(s[h],u,this.errors))})}}_copyOptions(){const t={};if(this.options){const n=this.options.params;if(n){const i=t.params={};Object.keys(n).forEach(r=>{i[r]=n[r]})}}return t}createSubContext(t=null,n,i){const r=n||this.element,s=new MI(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=uC,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,n,i){const r={duration:n??t.duration,delay:this.currentTimeline.currentTime+(i??0)+t.delay,easing:""},s=new EJ(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,n,i,r,s,u){let h=[];if(r&&h.push(this.element),t.length>0){t=(t=t.replace(vJ,"."+this._enterClassName)).replace(xJ,"."+this._leaveClassName);let x=this._driver.query(this.element,t,1!=i);0!==i&&(x=i<0?x.slice(x.length+i,x.length):x.slice(0,i)),h.push(...x)}return!s&&0==h.length&&u.push(function PQ(e){return new $e(3014,!1)}()),h}}class dC{constructor(t,n,i,r){this._driver=t,this.element=n,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(n),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(n,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const n=1===this._keyframes.size&&this._pendingStyles.size;this.duration||n?(this.forwardTime(this.currentTime+t),n&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,n){return this.applyStylesToKeyframe(),new dC(this._driver,t,n||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,n){this._localTimelineStyles.set(t,n),this._globalTimelineStyles.set(t,n),this._styleSummary.set(t,{time:this.currentTime,value:n})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[n,i]of this._globalTimelineStyles)this._backFill.set(n,i||Rf),this._currentKeyframe.set(n,Rf);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,n,i,r){n&&this._previousKeyframe.set("easing",n);const s=r&&r.params||{},u=function CJ(e,t){const n=new Map;let i;return e.forEach(r=>{if("*"===r){i=i||t.keys();for(let s of i)n.set(s,Rf)}else am(r,n)}),n}(t,this._globalTimelineStyles);for(let[h,g]of u){const x=Kb(g,s,i);this._pendingStyles.set(h,x),this._localTimelineStyles.has(h)||this._backFill.set(h,this._globalTimelineStyles.get(h)??Rf),this._updateStyle(h,x)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,n)=>{this._currentKeyframe.set(n,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,n)=>{this._currentKeyframe.has(n)||this._currentKeyframe.set(n,t)}))}snapshotCurrentStyles(){for(let[t,n]of this._localTimelineStyles)this._pendingStyles.set(t,n),this._updateStyle(t,n)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let n in this._currentKeyframe)t.push(n);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((n,i)=>{const r=this._styleSummary.get(i);(!r||n.time>r.time)&&this._updateStyle(i,n.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,n=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((h,g)=>{const x=am(h,new Map,this._backFill);x.forEach((C,S)=>{"!"===C?t.add(S):C===Rf&&n.add(S)}),i||x.set("offset",g/this.duration),r.push(x)});const s=t.size?oC(t.values()):[],u=n.size?oC(n.values()):[];if(i){const h=r[0],g=new Map(h);h.set("offset",0),g.set("offset",1),r=[h,g]}return EI(this.element,r,s,u,this.duration,this.startTime,this.easing,!1)}}class EJ extends dC{constructor(t,n,i,r,s,u,h=!1){super(t,n,u.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=h,this.timings={duration:u.duration,delay:u.delay,easing:u.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:n,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&n){const s=[],u=i+n,h=n/u,g=am(t[0]);g.set("offset",0),s.push(g);const x=am(t[0]);x.set("offset",w3(h)),s.push(x);const C=t.length-1;for(let S=1;S<=C;S++){let O=am(t[S]);const F=O.get("offset");O.set("offset",w3((n+F*i)/u)),s.push(O)}i=u,n=0,r="",t=s}return EI(this.element,t,this.preStyleProps,this.postStyleProps,i,n,r,!0)}}function w3(e,t=3){const n=Math.pow(10,t-1);return Math.round(e*n)/n}class TI{}const MJ=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class TJ extends TI{normalizePropertyName(t,n){return bI(t)}normalizeStyleValue(t,n,i,r){let s="";const u=i.toString().trim();if(MJ.has(n)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const h=i.match(/^[+-]?[\d\.]+([a-z]*)$/);h&&0==h[1].length&&r.push(function bQ(e,t){return new $e(3005,!1)}())}return u+s}}function E3(e,t,n,i,r,s,u,h,g,x,C,S,O){return{type:0,element:e,triggerName:t,isRemovalTransition:r,fromState:n,fromStyles:s,toState:i,toStyles:u,timelines:h,queriedElements:g,preStyleProps:x,postStyleProps:C,totalTime:S,errors:O}}const DI={};class C3{constructor(t,n,i){this._triggerName=t,this.ast=n,this._stateStyles=i}match(t,n,i,r){return function DJ(e,t,n,i,r){return e.some(s=>s(t,n,i,r))}(this.ast.matchers,t,n,i,r)}buildStyles(t,n,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(t?.toString())||r),r?r.buildStyles(n,i):new Map}build(t,n,i,r,s,u,h,g,x,C){const S=[],O=this.ast.options&&this.ast.options.params||DI,$=this.buildStyles(i,h&&h.params||DI,S),G=g&&g.params||DI,Y=this.buildStyles(r,G,S),J=new Set,Q=new Map,he=new Map,ue="void"===r,we={params:SJ(G,O),delay:this.ast.options?.delay},Ie=C?[]:CI(t,n,this.ast.animation,s,u,$,Y,we,x,S);let Qe=0;if(Ie.forEach(Ct=>{Qe=Math.max(Ct.duration+Ct.delay,Qe)}),S.length)return E3(n,this._triggerName,i,r,ue,$,Y,[],[],Q,he,Qe,S);Ie.forEach(Ct=>{const At=Ct.element,at=Gc(Q,At,new Set);Ct.preStyleProps.forEach(Ht=>at.add(Ht));const jt=Gc(he,At,new Set);Ct.postStyleProps.forEach(Ht=>jt.add(Ht)),At!==n&&J.add(At)});const ut=oC(J.values());return E3(n,this._triggerName,i,r,ue,$,Y,Ie,ut,Q,he,Qe)}}function SJ(e,t){const n=Xb(t);for(const i in e)e.hasOwnProperty(i)&&null!=e[i]&&(n[i]=e[i]);return n}class IJ{constructor(t,n,i){this.styles=t,this.defaultParams=n,this.normalizer=i}buildStyles(t,n){const i=new Map,r=Xb(this.defaultParams);return Object.keys(t).forEach(s=>{const u=t[s];null!==u&&(r[s]=u)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((u,h)=>{u&&(u=Kb(u,r,n));const g=this.normalizer.normalizePropertyName(h,n);u=this.normalizer.normalizeStyleValue(h,g,u,n),i.set(h,u)})}),i}}class PJ{constructor(t,n,i){this.name=t,this.ast=n,this._normalizer=i,this.transitionFactories=[],this.states=new Map,n.states.forEach(r=>{this.states.set(r.name,new IJ(r.style,r.options&&r.options.params||{},i))}),M3(this.states,"true","1"),M3(this.states,"false","0"),n.transitions.forEach(r=>{this.transitionFactories.push(new C3(t,r,this.states))}),this.fallbackTransition=function OJ(e,t,n){return new C3(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(u,h)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,n,i,r){return this.transitionFactories.find(u=>u.match(t,n,i,r))||null}matchStyles(t,n,i){return this.fallbackTransition.buildStyles(t,n,i)}}function M3(e,t,n){e.has(t)?e.has(n)||e.set(n,e.get(t)):e.has(n)&&e.set(t,e.get(n))}const kJ=new cC;class RJ{constructor(t,n,i){this.bodyNode=t,this._driver=n,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,n){const i=[],s=xI(this._driver,n,i,[]);if(i.length)throw function zQ(e){return new $e(3503,!1)}();this._animations.set(t,s)}_buildPlayer(t,n,i){const r=t.element,s=a3(this._normalizer,t.keyframes,n,i);return this._driver.animate(r,s,t.duration,t.delay,t.easing,[],!0)}create(t,n,i={}){const r=[],s=this._animations.get(t);let u;const h=new Map;if(s?(u=CI(this._driver,n,s,gI,tC,new Map,new Map,i,kJ,r),u.forEach(C=>{const S=Gc(h,C.element,new Map);C.postStyleProps.forEach(O=>S.set(O,null))})):(r.push(function BQ(){return new $e(3300,!1)}()),u=[]),r.length)throw function UQ(e){return new $e(3504,!1)}();h.forEach((C,S)=>{C.forEach((O,F)=>{C.set(F,this._driver.computeStyle(S,F,Rf))})});const x=sm(u.map(C=>{const S=h.get(C.element);return this._buildPlayer(C,new Map,S)}));return this._playersById.set(t,x),x.onDestroy(()=>this.destroy(t)),this.players.push(x),x}destroy(t){const n=this._getPlayer(t);n.destroy(),this._playersById.delete(t);const i=this.players.indexOf(n);i>=0&&this.players.splice(i,1)}_getPlayer(t){const n=this._playersById.get(t);if(!n)throw function VQ(e){return new $e(3301,!1)}();return n}listen(t,n,i,r){const s=fI(n,"","","");return dI(this._getPlayer(t),i,s,r),()=>{}}command(t,n,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,n,r[0]||{});const s=this._getPlayer(t);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const T3="ng-animate-queued",SI="ng-animate-disabled",BJ=[],D3={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},UJ={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Au="__ng_removed";class II{get params(){return this.options.params}constructor(t,n=""){this.namespaceId=n;const i=t&&t.hasOwnProperty("value");if(this.value=function HJ(e){return e??null}(i?t.value:t),i){const s=Xb(t);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){const n=t.params;if(n){const i=this.options.params;Object.keys(n).forEach(r=>{null==i[r]&&(i[r]=n[r])})}}}const Qb="void",AI=new II(Qb);class VJ{constructor(t,n,i){this.id=t,this.hostElement=n,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Pu(n,this._hostClassName)}listen(t,n,i,r){if(!this._triggers.has(n))throw function jQ(e,t){return new $e(3302,!1)}();if(null==i||0==i.length)throw function $Q(e){return new $e(3303,!1)}();if(!function GJ(e){return"start"==e||"done"==e}(i))throw function HQ(e,t){return new $e(3400,!1)}();const s=Gc(this._elementListeners,t,[]),u={name:n,phase:i,callback:r};s.push(u);const h=Gc(this._engine.statesByElement,t,new Map);return h.has(n)||(Pu(t,nC),Pu(t,nC+"-"+n),h.set(n,AI)),()=>{this._engine.afterFlush(()=>{const g=s.indexOf(u);g>=0&&s.splice(g,1),this._triggers.has(n)||h.delete(n)})}}register(t,n){return!this._triggers.has(t)&&(this._triggers.set(t,n),!0)}_getTrigger(t){const n=this._triggers.get(t);if(!n)throw function GQ(e){return new $e(3401,!1)}();return n}trigger(t,n,i,r=!0){const s=this._getTrigger(n),u=new PI(this.id,n,t);let h=this._engine.statesByElement.get(t);h||(Pu(t,nC),Pu(t,nC+"-"+n),this._engine.statesByElement.set(t,h=new Map));let g=h.get(n);const x=new II(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&g&&x.absorbOptions(g.options),h.set(n,x),g||(g=AI),x.value!==Qb&&g.value===x.value){if(!function ZJ(e,t){const n=Object.keys(e),i=Object.keys(t);if(n.length!=i.length)return!1;for(let r=0;r<n.length;r++){const s=n[r];if(!t.hasOwnProperty(s)||e[s]!==t[s])return!1}return!0}(g.params,x.params)){const G=[],Y=s.matchStyles(g.value,g.params,G),J=s.matchStyles(x.value,x.params,G);G.length?this._engine.reportError(G):this._engine.afterFlush(()=>{Og(t,Y),Mh(t,J)})}return}const O=Gc(this._engine.playersByElement,t,[]);O.forEach(G=>{G.namespaceId==this.id&&G.triggerName==n&&G.queued&&G.destroy()});let F=s.matchTransition(g.value,x.value,t,x.params),$=!1;if(!F){if(!r)return;F=s.fallbackTransition,$=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:n,transition:F,fromState:g,toState:x,player:u,isFallbackTransition:$}),$||(Pu(t,T3),u.onStart(()=>{Ny(t,T3)})),u.onDone(()=>{let G=this.players.indexOf(u);G>=0&&this.players.splice(G,1);const Y=this._engine.playersByElement.get(t);if(Y){let J=Y.indexOf(u);J>=0&&Y.splice(J,1)}}),this.players.push(u),O.push(u),u}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(n=>n.delete(t)),this._elementListeners.forEach((n,i)=>{this._elementListeners.set(i,n.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const n=this._engine.playersByElement.get(t);n&&(n.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,n){const i=this._engine.driver.query(t,iC,!0);i.forEach(r=>{if(r[Au])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(u=>u.triggerLeaveAnimation(r,n,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,n,i,r){const s=this._engine.statesByElement.get(t),u=new Map;if(s){const h=[];if(s.forEach((g,x)=>{if(u.set(x,g.value),this._triggers.has(x)){const C=this.trigger(t,x,Qb,r);C&&h.push(C)}}),h.length)return this._engine.markElementAsRemoved(this.id,t,!0,n,u),i&&sm(h).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const n=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(n&&i){const r=new Set;n.forEach(s=>{const u=s.name;if(r.has(u))return;r.add(u);const g=this._triggers.get(u).fallbackTransition,x=i.get(u)||AI,C=new II(Qb),S=new PI(this.id,u,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:u,transition:g,fromState:x,toState:C,player:S,isFallbackTransition:!0})})}}removeNode(t,n){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,n),this.triggerLeaveAnimation(t,n,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(t):[];if(s&&s.length)r=!0;else{let u=t;for(;u=u.parentNode;)if(i.statesByElement.get(u)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,n);else{const s=t[Au];(!s||s===D3)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,n))}}insertNode(t,n){Pu(t,this._hostClassName)}drainQueuedTransitions(t){const n=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,u=this._elementListeners.get(s);u&&u.forEach(h=>{if(h.name==i.triggerName){const g=fI(s,i.triggerName,i.fromState.value,i.toState.value);g._data=t,dI(i.player,h.phase,g,h.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):n.push(i)}),this._queue=[],n.sort((i,r)=>{const s=i.transition.ast.depCount,u=r.transition.ast.depCount;return 0==s||0==u?s-u:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(n=>n.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let n=!1;return this._elementListeners.has(t)&&(n=!0),n=!!this._queue.find(i=>i.element===t)||n,n}}class jJ{_onRemovalComplete(t,n){this.onRemovalComplete(t,n)}constructor(t,n,i){this.bodyNode=t,this.driver=n,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}get queuedPlayers(){const t=[];return this._namespaceList.forEach(n=>{n.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,n){const i=new VJ(t,n,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,n)?this._balanceNamespaceList(i,n):(this.newHostElements.set(n,i),this.collectEnterElement(n)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,n){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let u=!1,h=this.driver.getParentElement(n);for(;h;){const g=r.get(h);if(g){const x=i.indexOf(g);i.splice(x+1,0,t),u=!0;break}h=this.driver.getParentElement(h)}u||i.unshift(t)}else i.push(t);return r.set(n,t),t}register(t,n){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,n)),i}registerTrigger(t,n,i){let r=this._namespaceLookup[t];r&&r.register(n,i)&&this.totalAnimations++}destroy(t,n){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(n))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const n=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&n.add(s)}return n}trigger(t,n,i,r){if(hC(n)){const s=this._fetchNamespace(t);if(s)return s.trigger(n,i,r),!0}return!1}insertNode(t,n,i,r){if(!hC(n))return;const s=n[Au];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const u=this.collectedLeaveElements.indexOf(n);u>=0&&this.collectedLeaveElements.splice(u,1)}if(t){const u=this._fetchNamespace(t);u&&u.insertNode(n,i)}r&&this.collectEnterElement(n)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,n){n?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Pu(t,SI)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Ny(t,SI))}removeNode(t,n,i){if(hC(n)){const r=t?this._fetchNamespace(t):null;r?r.removeNode(n,i):this.markElementAsRemoved(t,n,!1,i);const s=this.namespacesByHostElement.get(n);s&&s.id!==t&&s.removeNode(n,i)}else this._onRemovalComplete(n,i)}markElementAsRemoved(t,n,i,r,s){this.collectedLeaveElements.push(n),n[Au]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,n,i,r,s){return hC(n)?this._fetchNamespace(t).listen(n,i,r,s):()=>{}}_buildInstruction(t,n,i,r,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,n,s)}destroyInnerAnimations(t){let n=this.driver.query(t,iC,!0);n.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(n=this.driver.query(t,_I,!0),n.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const n=this.playersByElement.get(t);n&&n.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const n=this.playersByQueriedElement.get(t);n&&n.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return sm(this.players).onDone(()=>t());t()})}processLeaveNode(t){const n=t[Au];if(n&&n.setForRemoval){if(t[Au]=D3,n.namespaceId){this.destroyInnerAnimations(t);const i=this._fetchNamespace(n.namespaceId);i&&i.clearElementCache(t)}this._onRemovalComplete(t,n.setForRemoval)}t.classList?.contains(SI)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(t=-1){let n=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Pu(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{n=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],n.length?sm(n).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function qQ(e){return new $e(3402,!1)}()}_flushAnimations(t,n){const i=new cC,r=[],s=new Map,u=[],h=new Map,g=new Map,x=new Map,C=new Set;this.disabledNodes.forEach(ge=>{C.add(ge);const Re=this.driver.query(ge,".ng-animate-queued",!0);for(let We=0;We<Re.length;We++)C.add(Re[We])});const S=this.bodyNode,O=Array.from(this.statesByElement.keys()),F=A3(O,this.collectedEnterElements),$=new Map;let G=0;F.forEach((ge,Re)=>{const We=gI+G++;$.set(Re,We),ge.forEach(Ye=>Pu(Ye,We))});const Y=[],J=new Set,Q=new Set;for(let ge=0;ge<this.collectedLeaveElements.length;ge++){const Re=this.collectedLeaveElements[ge],We=Re[Au];We&&We.setForRemoval&&(Y.push(Re),J.add(Re),We.hasAnimation?this.driver.query(Re,".ng-star-inserted",!0).forEach(Ye=>J.add(Ye)):Q.add(Re))}const he=new Map,ue=A3(O,Array.from(J));ue.forEach((ge,Re)=>{const We=tC+G++;he.set(Re,We),ge.forEach(Ye=>Pu(Ye,We))}),t.push(()=>{F.forEach((ge,Re)=>{const We=$.get(Re);ge.forEach(Ye=>Ny(Ye,We))}),ue.forEach((ge,Re)=>{const We=he.get(Re);ge.forEach(Ye=>Ny(Ye,We))}),Y.forEach(ge=>{this.processLeaveNode(ge)})});const we=[],Ie=[];for(let ge=this._namespaceList.length-1;ge>=0;ge--)this._namespaceList[ge].drainQueuedTransitions(n).forEach(We=>{const Ye=We.player,Dt=We.element;if(we.push(Ye),this.collectedEnterElements.length){const Yt=Dt[Au];if(Yt&&Yt.setForMove){if(Yt.previousTriggersValues&&Yt.previousTriggersValues.has(We.triggerName)){const hn=Yt.previousTriggersValues.get(We.triggerName),ft=this.statesByElement.get(We.element);if(ft&&ft.has(We.triggerName)){const pn=ft.get(We.triggerName);pn.value=hn,ft.set(We.triggerName,pn)}}return void Ye.destroy()}}const Bt=!S||!this.driver.containsElement(S,Dt),Lt=he.get(Dt),Dn=$.get(Dt),fn=this._buildInstruction(We,i,Dn,Lt,Bt);if(fn.errors&&fn.errors.length)return void Ie.push(fn);if(Bt)return Ye.onStart(()=>Og(Dt,fn.fromStyles)),Ye.onDestroy(()=>Mh(Dt,fn.toStyles)),void r.push(Ye);if(We.isFallbackTransition)return Ye.onStart(()=>Og(Dt,fn.fromStyles)),Ye.onDestroy(()=>Mh(Dt,fn.toStyles)),void r.push(Ye);const qi=[];fn.timelines.forEach(Yt=>{Yt.stretchStartingKeyframe=!0,this.disabledNodes.has(Yt.element)||qi.push(Yt)}),fn.timelines=qi,i.append(Dt,fn.timelines),u.push({instruction:fn,player:Ye,element:Dt}),fn.queriedElements.forEach(Yt=>Gc(h,Yt,[]).push(Ye)),fn.preStyleProps.forEach((Yt,hn)=>{if(Yt.size){let ft=g.get(hn);ft||g.set(hn,ft=new Set),Yt.forEach((pn,bn)=>ft.add(bn))}}),fn.postStyleProps.forEach((Yt,hn)=>{let ft=x.get(hn);ft||x.set(hn,ft=new Set),Yt.forEach((pn,bn)=>ft.add(bn))})});if(Ie.length){const ge=[];Ie.forEach(Re=>{ge.push(function WQ(e,t){return new $e(3505,!1)}())}),we.forEach(Re=>Re.destroy()),this.reportError(ge)}const Qe=new Map,ut=new Map;u.forEach(ge=>{const Re=ge.element;i.has(Re)&&(ut.set(Re,Re),this._beforeAnimationBuild(ge.player.namespaceId,ge.instruction,Qe))}),r.forEach(ge=>{const Re=ge.element;this._getPreviousPlayers(Re,!1,ge.namespaceId,ge.triggerName,null).forEach(Ye=>{Gc(Qe,Re,[]).push(Ye),Ye.destroy()})});const Ct=Y.filter(ge=>O3(ge,g,x)),At=new Map;I3(At,this.driver,Q,x,Rf).forEach(ge=>{O3(ge,g,x)&&Ct.push(ge)});const jt=new Map;F.forEach((ge,Re)=>{I3(jt,this.driver,new Set(ge),g,"!")}),Ct.forEach(ge=>{const Re=At.get(ge),We=jt.get(ge);At.set(ge,new Map([...Re?.entries()??[],...We?.entries()??[]]))});const Ht=[],Ae=[],Ne={};u.forEach(ge=>{const{element:Re,player:We,instruction:Ye}=ge;if(i.has(Re)){if(C.has(Re))return We.onDestroy(()=>Mh(Re,Ye.toStyles)),We.disabled=!0,We.overrideTotalTime(Ye.totalTime),void r.push(We);let Dt=Ne;if(ut.size>1){let Lt=Re;const Dn=[];for(;Lt=Lt.parentNode;){const fn=ut.get(Lt);if(fn){Dt=fn;break}Dn.push(Lt)}Dn.forEach(fn=>ut.set(fn,Dt))}const Bt=this._buildAnimation(We.namespaceId,Ye,Qe,s,jt,At);if(We.setRealPlayer(Bt),Dt===Ne)Ht.push(We);else{const Lt=this.playersByElement.get(Dt);Lt&&Lt.length&&(We.parentPlayer=sm(Lt)),r.push(We)}}else Og(Re,Ye.fromStyles),We.onDestroy(()=>Mh(Re,Ye.toStyles)),Ae.push(We),C.has(Re)&&r.push(We)}),Ae.forEach(ge=>{const Re=s.get(ge.element);if(Re&&Re.length){const We=sm(Re);ge.setRealPlayer(We)}}),r.forEach(ge=>{ge.parentPlayer?ge.syncPlayerEvents(ge.parentPlayer):ge.destroy()});for(let ge=0;ge<Y.length;ge++){const Re=Y[ge],We=Re[Au];if(Ny(Re,tC),We&&We.hasAnimation)continue;let Ye=[];if(h.size){let Bt=h.get(Re);Bt&&Bt.length&&Ye.push(...Bt);let Lt=this.driver.query(Re,_I,!0);for(let Dn=0;Dn<Lt.length;Dn++){let fn=h.get(Lt[Dn]);fn&&fn.length&&Ye.push(...fn)}}const Dt=Ye.filter(Bt=>!Bt.destroyed);Dt.length?qJ(this,Re,Dt):this.processLeaveNode(Re)}return Y.length=0,Ht.forEach(ge=>{this.players.push(ge),ge.onDone(()=>{ge.destroy();const Re=this.players.indexOf(ge);this.players.splice(Re,1)}),ge.play()}),Ht}elementContainsData(t,n){let i=!1;const r=n[Au];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(n)&&(i=!0),this.playersByQueriedElement.has(n)&&(i=!0),this.statesByElement.has(n)&&(i=!0),this._fetchNamespace(t).elementContainsData(n)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,n,i,r,s){let u=[];if(n){const h=this.playersByQueriedElement.get(t);h&&(u=h)}else{const h=this.playersByElement.get(t);if(h){const g=!s||s==Qb;h.forEach(x=>{x.queued||!g&&x.triggerName!=r||u.push(x)})}}return(i||r)&&(u=u.filter(h=>!(i&&i!=h.namespaceId||r&&r!=h.triggerName))),u}_beforeAnimationBuild(t,n,i){const s=n.element,u=n.isRemovalTransition?void 0:t,h=n.isRemovalTransition?void 0:n.triggerName;for(const g of n.timelines){const x=g.element,C=x!==s,S=Gc(i,x,[]);this._getPreviousPlayers(x,C,u,h,n.toState).forEach(F=>{const $=F.getRealPlayer();$.beforeDestroy&&$.beforeDestroy(),F.destroy(),S.push(F)})}Og(s,n.fromStyles)}_buildAnimation(t,n,i,r,s,u){const h=n.triggerName,g=n.element,x=[],C=new Set,S=new Set,O=n.timelines.map($=>{const G=$.element;C.add(G);const Y=G[Au];if(Y&&Y.removedBeforeQueried)return new Gb($.duration,$.delay);const J=G!==g,Q=function WJ(e){const t=[];return P3(e,t),t}((i.get(G)||BJ).map(Qe=>Qe.getRealPlayer())).filter(Qe=>!!Qe.element&&Qe.element===G),he=s.get(G),ue=u.get(G),we=a3(this._normalizer,$.keyframes,he,ue),Ie=this._buildPlayer($,we,Q);if($.subTimeline&&r&&S.add(G),J){const Qe=new PI(t,h,G);Qe.setRealPlayer(Ie),x.push(Qe)}return Ie});x.forEach($=>{Gc(this.playersByQueriedElement,$.element,[]).push($),$.onDone(()=>function $J(e,t,n){let i=e.get(t);if(i){if(i.length){const r=i.indexOf(n);i.splice(r,1)}0==i.length&&e.delete(t)}return i}(this.playersByQueriedElement,$.element,$))}),C.forEach($=>Pu($,p3));const F=sm(O);return F.onDestroy(()=>{C.forEach($=>Ny($,p3)),Mh(g,n.toStyles)}),S.forEach($=>{Gc(r,$,[]).push(F)}),F}_buildPlayer(t,n,i){return n.length>0?this.driver.animate(t.element,n,t.duration,t.delay,t.easing,i):new Gb(t.duration,t.delay)}}class PI{constructor(t,n,i){this.namespaceId=t,this.triggerName=n,this.element=i,this._player=new Gb,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((n,i)=>{n.forEach(r=>dI(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const n=this._player;n.triggerCallback&&t.onStart(()=>n.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,n){Gc(this._queuedCallbacks,t,[]).push(n)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const n=this._player;n.triggerCallback&&n.triggerCallback(t)}}function hC(e){return e&&1===e.nodeType}function S3(e,t){const n=e.style.display;return e.style.display=t??"none",n}function I3(e,t,n,i,r){const s=[];n.forEach(g=>s.push(S3(g)));const u=[];i.forEach((g,x)=>{const C=new Map;g.forEach(S=>{const O=t.computeStyle(x,S,r);C.set(S,O),(!O||0==O.length)&&(x[Au]=UJ,u.push(x))}),e.set(x,C)});let h=0;return n.forEach(g=>S3(g,s[h++])),u}function A3(e,t){const n=new Map;if(e.forEach(h=>n.set(h,[])),0==t.length)return n;const r=new Set(t),s=new Map;function u(h){if(!h)return 1;let g=s.get(h);if(g)return g;const x=h.parentNode;return g=n.has(x)?x:r.has(x)?1:u(x),s.set(h,g),g}return t.forEach(h=>{const g=u(h);1!==g&&n.get(g).push(h)}),n}function Pu(e,t){e.classList?.add(t)}function Ny(e,t){e.classList?.remove(t)}function qJ(e,t,n){sm(n).onDone(()=>e.processLeaveNode(t))}function P3(e,t){for(let n=0;n<e.length;n++){const i=e[n];i instanceof jN?P3(i.players,t):t.push(i)}}function O3(e,t,n){const i=n.get(e);if(!i)return!1;let r=t.get(e);return r?i.forEach(s=>r.add(s)):t.set(e,i),n.delete(e),!0}class fC{constructor(t,n,i){this.bodyNode=t,this._driver=n,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new jJ(t,n,i),this._timelineEngine=new RJ(t,n,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(t,n,i,r,s){const u=t+"-"+r;let h=this._triggerCache[u];if(!h){const g=[],C=xI(this._driver,s,g,[]);if(g.length)throw function FQ(e,t){return new $e(3404,!1)}();h=function AJ(e,t,n){return new PJ(e,t,n)}(r,C,this._normalizer),this._triggerCache[u]=h}this._transitionEngine.registerTrigger(n,r,h)}register(t,n){this._transitionEngine.register(t,n)}destroy(t,n){this._transitionEngine.destroy(t,n)}onInsert(t,n,i,r){this._transitionEngine.insertNode(t,n,i,r)}onRemove(t,n,i){this._transitionEngine.removeNode(t,n,i)}disableAnimations(t,n){this._transitionEngine.markElementAsDisabled(t,n)}process(t,n,i,r){if("@"==i.charAt(0)){const[s,u]=l3(i);this._timelineEngine.command(s,n,u,r)}else this._transitionEngine.trigger(t,n,i,r)}listen(t,n,i,r,s){if("@"==i.charAt(0)){const[u,h]=l3(i);return this._timelineEngine.listen(u,n,h,s)}return this._transitionEngine.listen(t,n,i,r,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let YJ=(()=>{class e{constructor(n,i,r){this._element=n,this._startStyles=i,this._endStyles=r,this._state=0;let s=e.initialStylesByElement.get(n);s||e.initialStylesByElement.set(n,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&Mh(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Mh(this._element,this._initialStyles),this._endStyles&&(Mh(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(Og(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Og(this._element,this._endStyles),this._endStyles=null),Mh(this._element,this._initialStyles),this._state=3)}}return e.initialStylesByElement=new WeakMap,e})();function OI(e){let t=null;return e.forEach((n,i)=>{(function KJ(e){return"display"===e||"position"===e})(i)&&(t=t||new Map,t.set(i,n))}),t}class k3{constructor(t,n,i,r){this.element=t,this.keyframes=n,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const n=[];return t.forEach(i=>{n.push(Object.fromEntries(i))}),n}_triggerWebAnimation(t,n,i){return t.animate(this._convertKeyframesToObject(n),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:y3(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const n="start"===t?this._onStartFns:this._onDoneFns;n.forEach(i=>i()),n.length=0}}class QJ{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,n){return!1}containsElement(t,n){return u3(t,n)}getParentElement(t){return pI(t)}query(t,n,i){return d3(t,n,i)}computeStyle(t,n,i){return window.getComputedStyle(t)[n]}animate(t,n,i,r,s,u=[]){const g={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(g.easing=s);const x=new Map,C=u.filter(F=>F instanceof k3);(function oJ(e,t){return 0===e||0===t})(i,r)&&C.forEach(F=>{F.currentSnapshot.forEach(($,G)=>x.set(G,$))});let S=function nJ(e){return e.length?e[0]instanceof Map?e:e.map(t=>m3(t)):[]}(n).map(F=>am(F));S=function sJ(e,t,n){if(n.size&&t.length){let i=t[0],r=[];if(n.forEach((s,u)=>{i.has(u)||r.push(u),i.set(u,s)}),r.length)for(let s=1;s<t.length;s++){let u=t[s];r.forEach(h=>u.set(h,y3(e,h)))}}return t}(t,S,x);const O=function XJ(e,t){let n=null,i=null;return Array.isArray(t)&&t.length?(n=OI(t[0]),t.length>1&&(i=OI(t[t.length-1]))):t instanceof Map&&(n=OI(t)),n||i?new YJ(e,n,i):null}(t,S);return new k3(t,S,g,O)}}let JJ=(()=>{class e extends BN{constructor(n,i){super(),this._nextAnimationId=0,this._renderer=n.createRenderer(i.body,{id:"0",encapsulation:To.None,styles:[],data:{animation:[]}})}build(n){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(n)?VN(n):n;return R3(this._renderer,null,i,"register",[r]),new eee(i,this._renderer)}}return e.\u0275fac=function(n){return new(n||e)(et(fg),et(Ki))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();class eee extends pK{constructor(t,n){super(),this._id=t,this._renderer=n}create(t,n){return new tee(this._id,t,n||{},this._renderer)}}class tee{constructor(t,n,i,r){this.id=t,this.element=n,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,n){return this._renderer.listen(this.element,`@@${this.id}:${t}`,n)}_command(t,...n){return R3(this._renderer,this.element,this.id,t,n)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function R3(e,t,n,i,r){return e.setProperty(t,`@@${n}:${i}`,r)}const L3="@.disabled";let nee=(()=>{class e{constructor(n,i,r){this.delegate=n,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,i.onRemovalComplete=(s,u)=>{const h=u?.parentNode(s);h&&u.removeChild(h,s)}}createRenderer(n,i){const s=this.delegate.createRenderer(n,i);if(!(n&&i&&i.data&&i.data.animation)){let C=this._rendererCache.get(s);return C||(C=new F3("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,C)),C}const u=i.id,h=i.id+"-"+this._currentId;this._currentId++,this.engine.register(h,n);const g=C=>{Array.isArray(C)?C.forEach(g):this.engine.registerTrigger(u,h,n,C.name,C)};return i.data.animation.forEach(g),new iee(this,h,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(n,i,r){n>=0&&n<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[u,h]=s;u(h)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return e.\u0275fac=function(n){return new(n||e)(et(fg),et(fC),et(Fi))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();class F3{constructor(t,n,i,r){this.namespaceId=t,this.delegate=n,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?s=>n.destroyNode(s):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(t,n){return this.delegate.createElement(t,n)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,n){this.delegate.appendChild(t,n),this.engine.onInsert(this.namespaceId,n,t,!1)}insertBefore(t,n,i,r=!0){this.delegate.insertBefore(t,n,i),this.engine.onInsert(this.namespaceId,n,t,r)}removeChild(t,n,i){this.engine.onRemove(this.namespaceId,n,this.delegate)}selectRootElement(t,n){return this.delegate.selectRootElement(t,n)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,n,i,r){this.delegate.setAttribute(t,n,i,r)}removeAttribute(t,n,i){this.delegate.removeAttribute(t,n,i)}addClass(t,n){this.delegate.addClass(t,n)}removeClass(t,n){this.delegate.removeClass(t,n)}setStyle(t,n,i,r){this.delegate.setStyle(t,n,i,r)}removeStyle(t,n,i){this.delegate.removeStyle(t,n,i)}setProperty(t,n,i){"@"==n.charAt(0)&&n==L3?this.disableAnimations(t,!!i):this.delegate.setProperty(t,n,i)}setValue(t,n){this.delegate.setValue(t,n)}listen(t,n,i){return this.delegate.listen(t,n,i)}disableAnimations(t,n){this.engine.disableAnimations(t,n)}}class iee extends F3{constructor(t,n,i,r,s){super(n,i,r,s),this.factory=t,this.namespaceId=n}setProperty(t,n,i){"@"==n.charAt(0)?"."==n.charAt(1)&&n==L3?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,n.slice(1),i):this.delegate.setProperty(t,n,i)}listen(t,n,i){if("@"==n.charAt(0)){const r=function ree(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(t);let s=n.slice(1),u="";return"@"!=s.charAt(0)&&([s,u]=function oee(e){const t=e.indexOf(".");return[e.substring(0,t),e.slice(t+1)]}(s)),this.engine.listen(this.namespaceId,r,s,u,h=>{this.factory.scheduleListenerCallback(h._data||-1,i,h)})}return this.delegate.listen(t,n,i)}}const N3=[{provide:BN,useClass:JJ},{provide:TI,useFactory:function aee(){return new TJ}},{provide:fC,useClass:(()=>{class e extends fC{constructor(n,i,r,s){super(n.body,i,r)}ngOnDestroy(){this.flush()}}return e.\u0275fac=function(n){return new(n||e)(et(Ki),et(mI),et(TI),et(nm))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})()},{provide:fg,useFactory:function lee(e,t,n){return new nee(e,t,n)},deps:[V2,fC,Fi]}],kI=[{provide:mI,useFactory:()=>new QJ},{provide:bd,useValue:"BrowserAnimations"},...N3],z3=[{provide:mI,useClass:h3},{provide:bd,useValue:"NoopAnimations"},...N3];let cee=(()=>{class e{static withConfig(n){return{ngModule:e,providers:n.disableAnimations?z3:kI}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({providers:kI,imports:[H5]}),e})();const mC=Uu(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function B3(e){return new ii(t=>{bi(e()).subscribe(t)})}function Jb(e,t){const n=Ri(e)?e:()=>e,i=r=>r.error(n());return new ii(t?r=>t.schedule(i,0,r):i)}function RI(){return hi((e,t)=>{let n=null;e._refCount++;const i=yn(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const r=e._connection,s=n;n=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(i),i.closed||(n=e.connect())})}class U3 extends ii{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,jl(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new pt;const n=this.getSubject();t.add(this.source.subscribe(yn(n,void 0,()=>{this._teardown(),n.complete()},i=>{this._teardown(),n.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=pt.EMPTY)}return t}refCount(){return RI()(this)}}function gC(e){return hi((t,n)=>{let i=!1;t.subscribe(yn(n,r=>{i=!0,n.next(r)},()=>{i||n.next(e),n.complete()}))})}function V3(e=dee){return hi((t,n)=>{let i=!1;t.subscribe(yn(n,r=>{i=!0,n.next(r)},()=>i?n.complete():n.error(e())))})}function dee(){return new mC}function Rg(e,t){const n=arguments.length>=2;return i=>i.pipe(e?hc((r,s)=>e(r,s,i)):Ts,Iu(1),n?gC(t):V3(()=>new mC))}function zy(e,t){return Ri(t)?zr(e,t,1):zr(e,1)}function La(e,t,n){const i=Ri(e)||t||n?{next:e,error:t,complete:n}:e;return i?hi((r,s)=>{var u;null===(u=i.subscribe)||void 0===u||u.call(i);let h=!0;r.subscribe(yn(s,g=>{var x;null===(x=i.next)||void 0===x||x.call(i,g),s.next(g)},()=>{var g;h=!1,null===(g=i.complete)||void 0===g||g.call(i),s.complete()},g=>{var x;h=!1,null===(x=i.error)||void 0===x||x.call(i,g),s.error(g)},()=>{var g,x;h&&(null===(g=i.unsubscribe)||void 0===g||g.call(i)),null===(x=i.finalize)||void 0===x||x.call(i)}))}):Ts}function lm(e){return hi((t,n)=>{let s,i=null,r=!1;i=t.subscribe(yn(n,void 0,void 0,u=>{s=bi(e(u,lm(e)(t))),i?(i.unsubscribe(),i=null,s.subscribe(n)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(n))})}function LI(e){return e<=0?()=>Is:hi((t,n)=>{let i=[];t.subscribe(yn(n,r=>{i.push(r),e<i.length&&i.shift()},()=>{for(const r of i)n.next(r);n.complete()},void 0,()=>{i=null}))})}function j3(e){return pi(()=>e)}function ex(e){return hi((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const Mi="primary",tx=Symbol("RouteTitle");class mee{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function By(e){return new mee(e)}function gee(e,t,n){const i=n.path.split("/");if(i.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||i.length<e.length))return null;const r={};for(let s=0;s<i.length;s++){const u=i[s],h=e[s];if(u.startsWith(":"))r[u.substring(1)]=h;else if(u!==h.path)return null}return{consumed:e.slice(0,i.length),posParams:r}}function Th(e,t){const n=e?Object.keys(e):void 0,i=t?Object.keys(t):void 0;if(!n||!i||n.length!=i.length)return!1;let r;for(let s=0;s<n.length;s++)if(r=n[s],!$3(e[r],t[r]))return!1;return!0}function $3(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),i=[...t].sort();return n.every((r,s)=>i[s]===r)}return e===t}function H3(e){return e.length>0?e[e.length-1]:null}function cm(e){return function uee(e){return!!e&&(e instanceof ii||Ri(e.lift)&&Ri(e.subscribe))}(e)?e:uE(e)?or(Promise.resolve(e)):qt(e)}const yee={exact:function W3(e,t,n){if(!Lg(e.segments,t.segments)||!_C(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!e.children[i]||!W3(e.children[i],t.children[i],n))return!1;return!0},subset:Z3},G3={exact:function vee(e,t){return Th(e,t)},subset:function bee(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>$3(e[n],t[n]))},ignored:()=>!0};function q3(e,t,n){return yee[n.paths](e.root,t.root,n.matrixParams)&&G3[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function Z3(e,t,n){return X3(e,t,t.segments,n)}function X3(e,t,n,i){if(e.segments.length>n.length){const r=e.segments.slice(0,n.length);return!(!Lg(r,n)||t.hasChildren()||!_C(r,n,i))}if(e.segments.length===n.length){if(!Lg(e.segments,n)||!_C(e.segments,n,i))return!1;for(const r in t.children)if(!e.children[r]||!Z3(e.children[r],t.children[r],i))return!1;return!0}{const r=n.slice(0,e.segments.length),s=n.slice(e.segments.length);return!!(Lg(e.segments,r)&&_C(e.segments,r,i)&&e.children[Mi])&&X3(e.children[Mi],t,s,i)}}function _C(e,t,n){return t.every((i,r)=>G3[n](e[r].parameters,i.parameters))}class Uy{constructor(t=new $r([],{}),n={},i=null){this.root=t,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=By(this.queryParams)),this._queryParamMap}toString(){return Eee.serialize(this)}}class $r{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Object.values(n).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return yC(this)}}class nx{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=By(this.parameters)),this._parameterMap}toString(){return Q3(this)}}function Lg(e,t){return e.length===t.length&&e.every((n,i)=>n.path===t[i].path)}let ix=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:function(){return new FI},providedIn:"root"}),e})();class FI{parse(t){const n=new Ree(t);return new Uy(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${rx(t.root,!0)}`,i=function Tee(e){const t=Object.keys(e).map(n=>{const i=e[n];return Array.isArray(i)?i.map(r=>`${vC(n)}=${vC(r)}`).join("&"):`${vC(n)}=${vC(i)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${i}${"string"==typeof t.fragment?`#${function Cee(e){return encodeURI(e)}(t.fragment)}`:""}`}}const Eee=new FI;function yC(e){return e.segments.map(t=>Q3(t)).join("/")}function rx(e,t){if(!e.hasChildren())return yC(e);if(t){const n=e.children[Mi]?rx(e.children[Mi],!1):"",i=[];return Object.entries(e.children).forEach(([r,s])=>{r!==Mi&&i.push(`${r}:${rx(s,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}{const n=function wee(e,t){let n=[];return Object.entries(e.children).forEach(([i,r])=>{i===Mi&&(n=n.concat(t(r,i)))}),Object.entries(e.children).forEach(([i,r])=>{i!==Mi&&(n=n.concat(t(r,i)))}),n}(e,(i,r)=>r===Mi?[rx(e.children[Mi],!1)]:[`${r}:${rx(i,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Mi]?`${yC(e)}/${n[0]}`:`${yC(e)}/(${n.join("//")})`}}function Y3(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function vC(e){return Y3(e).replace(/%3B/gi,";")}function NI(e){return Y3(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function bC(e){return decodeURIComponent(e)}function K3(e){return bC(e.replace(/\+/g,"%20"))}function Q3(e){return`${NI(e.path)}${function Mee(e){return Object.keys(e).map(t=>`;${NI(t)}=${NI(e[t])}`).join("")}(e.parameters)}`}const Dee=/^[^\/()?;#]+/;function zI(e){const t=e.match(Dee);return t?t[0]:""}const See=/^[^\/()?;=#]+/,Aee=/^[^=?&#]+/,Oee=/^[^&#]+/;class Ree{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new $r([],{}):new $r([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(i[Mi]=new $r(t,n)),i}parseSegment(){const t=zI(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new $e(4009,!1);return this.capture(t),new nx(bC(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=function Iee(e){const t=e.match(See);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const r=zI(this.remaining);r&&(i=r,this.capture(i))}t[bC(n)]=bC(i)}parseQueryParam(t){const n=function Pee(e){const t=e.match(Aee);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const u=function kee(e){const t=e.match(Oee);return t?t[0]:""}(this.remaining);u&&(i=u,this.capture(i))}const r=K3(n),s=K3(i);if(t.hasOwnProperty(r)){let u=t[r];Array.isArray(u)||(u=[u],t[r]=u),u.push(s)}else t[r]=s}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=zI(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new $e(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=Mi);const u=this.parseChildren();n[s]=1===Object.keys(u).length?u[Mi]:new $r([],u),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new $e(4011,!1)}}function J3(e){return e.segments.length>0?new $r([],{[Mi]:e}):e}function e4(e){const t={};for(const i of Object.keys(e.children)){const s=e4(e.children[i]);if(i===Mi&&0===s.segments.length&&s.hasChildren())for(const[u,h]of Object.entries(s.children))t[u]=h;else(s.segments.length>0||s.hasChildren())&&(t[i]=s)}return function Lee(e){if(1===e.numberOfChildren&&e.children[Mi]){const t=e.children[Mi];return new $r(e.segments.concat(t.segments),t.children)}return e}(new $r(e.segments,t))}function Fg(e){return e instanceof Uy}function t4(e){let t;const r=J3(function n(s){const u={};for(const g of s.children){const x=n(g);u[g.outlet]=x}const h=new $r(s.url,u);return s===e&&(t=h),h}(e.root));return t??r}function n4(e,t,n,i){let r=e;for(;r.parent;)r=r.parent;if(0===t.length)return BI(r,r,r,n,i);const s=function Nee(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new r4(!0,0,e);let t=0,n=!1;const i=e.reduce((r,s,u)=>{if("object"==typeof s&&null!=s){if(s.outlets){const h={};return Object.entries(s.outlets).forEach(([g,x])=>{h[g]="string"==typeof x?x.split("/"):x}),[...r,{outlets:h}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===u?(s.split("/").forEach((h,g)=>{0==g&&"."===h||(0==g&&""===h?n=!0:".."===h?t++:""!=h&&r.push(h))}),r):[...r,s]},[]);return new r4(n,t,i)}(t);if(s.toRoot())return BI(r,r,new $r([],{}),n,i);const u=function zee(e,t,n){if(e.isAbsolute)return new wC(t,!0,0);if(!n)return new wC(t,!1,NaN);if(null===n.parent)return new wC(n,!0,0);const i=xC(e.commands[0])?0:1;return function Bee(e,t,n){let i=e,r=t,s=n;for(;s>r;){if(s-=r,i=i.parent,!i)throw new $e(4005,!1);r=i.segments.length}return new wC(i,!1,r-s)}(n,n.segments.length-1+i,e.numberOfDoubleDots)}(s,r,e),h=u.processChildren?sx(u.segmentGroup,u.index,s.commands):o4(u.segmentGroup,u.index,s.commands);return BI(r,u.segmentGroup,h,n,i)}function xC(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function ox(e){return"object"==typeof e&&null!=e&&e.outlets}function BI(e,t,n,i,r){let u,s={};i&&Object.entries(i).forEach(([g,x])=>{s[g]=Array.isArray(x)?x.map(C=>`${C}`):`${x}`}),u=e===t?n:i4(e,t,n);const h=J3(e4(u));return new Uy(h,s,r)}function i4(e,t,n){const i={};return Object.entries(e.children).forEach(([r,s])=>{i[r]=s===t?n:i4(s,t,n)}),new $r(e.segments,i)}class r4{constructor(t,n,i){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=i,t&&i.length>0&&xC(i[0]))throw new $e(4003,!1);const r=i.find(ox);if(r&&r!==H3(i))throw new $e(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class wC{constructor(t,n,i){this.segmentGroup=t,this.processChildren=n,this.index=i}}function o4(e,t,n){if(e||(e=new $r([],{})),0===e.segments.length&&e.hasChildren())return sx(e,t,n);const i=function Vee(e,t,n){let i=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<e.segments.length;){if(i>=n.length)return s;const u=e.segments[r],h=n[i];if(ox(h))break;const g=`${h}`,x=i<n.length-1?n[i+1]:null;if(r>0&&void 0===g)break;if(g&&x&&"object"==typeof x&&void 0===x.outlets){if(!a4(g,x,u))return s;i+=2}else{if(!a4(g,{},u))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(e,t,n),r=n.slice(i.commandIndex);if(i.match&&i.pathIndex<e.segments.length){const s=new $r(e.segments.slice(0,i.pathIndex),{});return s.children[Mi]=new $r(e.segments.slice(i.pathIndex),e.children),sx(s,0,r)}return i.match&&0===r.length?new $r(e.segments,{}):i.match&&!e.hasChildren()?UI(e,t,n):i.match?sx(e,0,r):UI(e,t,n)}function sx(e,t,n){if(0===n.length)return new $r(e.segments,{});{const i=function Uee(e){return ox(e[0])?e[0].outlets:{[Mi]:e}}(n),r={};if(!i[Mi]&&e.children[Mi]&&1===e.numberOfChildren&&0===e.children[Mi].segments.length){const s=sx(e.children[Mi],t,n);return new $r(e.segments,s.children)}return Object.entries(i).forEach(([s,u])=>{"string"==typeof u&&(u=[u]),null!==u&&(r[s]=o4(e.children[s],t,u))}),Object.entries(e.children).forEach(([s,u])=>{void 0===i[s]&&(r[s]=u)}),new $r(e.segments,r)}}function UI(e,t,n){const i=e.segments.slice(0,t);let r=0;for(;r<n.length;){const s=n[r];if(ox(s)){const g=jee(s.outlets);return new $r(i,g)}if(0===r&&xC(n[0])){i.push(new nx(e.segments[t].path,s4(n[0]))),r++;continue}const u=ox(s)?s.outlets[Mi]:`${s}`,h=r<n.length-1?n[r+1]:null;u&&h&&xC(h)?(i.push(new nx(u,s4(h))),r+=2):(i.push(new nx(u,{})),r++)}return new $r(i,{})}function jee(e){const t={};return Object.entries(e).forEach(([n,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(t[n]=UI(new $r([],{}),0,i))}),t}function s4(e){const t={};return Object.entries(e).forEach(([n,i])=>t[n]=`${i}`),t}function a4(e,t,n){return e==n.path&&Th(t,n.parameters)}const ax="imperative";class Dh{constructor(t,n){this.id=t,this.url=n}}class VI extends Dh{constructor(t,n,i="imperative",r=null){super(t,n),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class um extends Dh{constructor(t,n,i){super(t,n),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class EC extends Dh{constructor(t,n,i,r){super(t,n),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class lx extends Dh{constructor(t,n,i,r){super(t,n),this.reason=i,this.code=r,this.type=16}}class jI extends Dh{constructor(t,n,i,r){super(t,n),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class $ee extends Dh{constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Hee extends Dh{constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Gee extends Dh{constructor(t,n,i,r,s){super(t,n),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class qee extends Dh{constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Wee extends Dh{constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Zee{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Xee{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Yee{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Kee{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Qee{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Jee{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class l4{constructor(t,n,i){this.routerEvent=t,this.position=n,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class ete{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new cx,this.attachRef=null}}let cx=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,i){const r=this.getOrCreateContext(n);r.outlet=i,this.contexts.set(n,r)}onChildOutletDestroyed(n){const i=this.getContext(n);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let i=this.getContext(n);return i||(i=new ete,this.contexts.set(n,i)),i}getContext(n){return this.contexts.get(n)||null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class c4{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=$I(t,this._root);return n?n.children.map(i=>i.value):[]}firstChild(t){const n=$I(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=HI(t,this._root);return n.length<2?[]:n[n.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return HI(t,this._root).map(n=>n.value)}}function $I(e,t){if(e===t.value)return t;for(const n of t.children){const i=$I(e,n);if(i)return i}return null}function HI(e,t){if(e===t.value)return[t];for(const n of t.children){const i=HI(e,n);if(i.length)return i.unshift(t),i}return[]}class Ff{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Vy(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class u4 extends c4{constructor(t,n){super(t),this.snapshot=n,GI(this,t)}toString(){return this.snapshot.toString()}}function d4(e,t){const n=function tte(e,t){const u=new CC([],{},{},"",{},Mi,t,null,{});return new f4("",new Ff(u,[]))}(0,t),i=new Kr([new nx("",{})]),r=new Kr({}),s=new Kr({}),u=new Kr({}),h=new Kr(""),g=new Ng(i,r,u,h,s,Mi,t,n.root);return g.snapshot=n.root,new u4(new Ff(g,[]),n)}class Ng{constructor(t,n,i,r,s,u,h,g){this.urlSubject=t,this.paramsSubject=n,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=s,this.outlet=u,this.component=h,this._futureSnapshot=g,this.title=this.dataSubject?.pipe(pi(x=>x[tx]))??qt(void 0),this.url=t,this.params=n,this.queryParams=i,this.fragment=r,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(pi(t=>By(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(pi(t=>By(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function h4(e,t="emptyOnly"){const n=e.pathFromRoot;let i=0;if("always"!==t)for(i=n.length-1;i>=1;){const r=n[i],s=n[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function nte(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(i))}class CC{get title(){return this.data?.[tx]}constructor(t,n,i,r,s,u,h,g,x){this.url=t,this.params=n,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=u,this.component=h,this.routeConfig=g,this._resolve=x}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=By(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=By(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class f4 extends c4{constructor(t,n){super(n),this.url=t,GI(this,n)}toString(){return p4(this._root)}}function GI(e,t){t.value._routerState=e,t.children.forEach(n=>GI(e,n))}function p4(e){const t=e.children.length>0?` { ${e.children.map(p4).join(", ")} } `:"";return`${e.value}${t}`}function qI(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Th(t.queryParams,n.queryParams)||e.queryParamsSubject.next(n.queryParams),t.fragment!==n.fragment&&e.fragmentSubject.next(n.fragment),Th(t.params,n.params)||e.paramsSubject.next(n.params),function _ee(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Th(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.urlSubject.next(n.url),Th(t.data,n.data)||e.dataSubject.next(n.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function WI(e,t){const n=Th(e.params,t.params)&&function xee(e,t){return Lg(e,t)&&e.every((n,i)=>Th(n.parameters,t[i].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||WI(e.parent,t.parent))}let ZI=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Mi,this.activateEvents=new ma,this.deactivateEvents=new ma,this.attachEvents=new ma,this.detachEvents=new ma,this.parentContexts=tn(cx),this.location=tn($c),this.changeDetector=tn(Ay),this.environmentInjector=tn(xu),this.inputBinder=tn(MC,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:i,previousValue:r}=n.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new $e(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new $e(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new $e(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new $e(4013,!1);this._activatedRoute=n;const r=this.location,u=n.snapshot.component,h=this.parentContexts.getOrCreateContext(this.name).children,g=new ite(n,h,r.injector);this.activated=r.createComponent(u,{index:r.length,injector:g,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Cr({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[se]}),e})();class ite{constructor(t,n,i){this.route=t,this.childContexts=n,this.parent=i}get(t,n){return t===Ng?this.route:t===cx?this.childContexts:this.parent.get(t,n)}}const MC=new sn("");let m4=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:i}=n,r=jE([i.queryParams,i.params,i.data]).pipe(qr(([s,u,h],g)=>(h={...s,...u,...h},0===g?qt(h):Promise.resolve(h)))).subscribe(s=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==i||null===i.component)return void this.unsubscribeFromRouteData(n);const u=function pW(e){const t=Mn(e);if(!t)return null;const n=new cc(t);return{get selector(){return n.selector},get type(){return n.componentType},get inputs(){return n.inputs},get outputs(){return n.outputs},get ngContentSelectors(){return n.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}(i.component);if(u)for(const{templateName:h}of u.inputs)n.activatedComponentRef.setInput(h,s[h]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,r)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();function ux(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=t.value;const r=function ote(e,t,n){return t.children.map(i=>{for(const r of n.children)if(e.shouldReuseRoute(i.value,r.value.snapshot))return ux(e,i,r);return ux(e,i)})}(e,t,n);return new Ff(i,r)}{if(e.shouldAttach(t.value)){const s=e.retrieve(t.value);if(null!==s){const u=s.route;return u.value._futureSnapshot=t.value,u.children=t.children.map(h=>ux(e,h)),u}}const i=function ste(e){return new Ng(new Kr(e.url),new Kr(e.params),new Kr(e.queryParams),new Kr(e.fragment),new Kr(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(s=>ux(e,s));return new Ff(i,r)}}const XI="ngNavigationCancelingError";function g4(e,t){const{redirectTo:n,navigationBehaviorOptions:i}=Fg(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=_4(!1,0,t);return r.url=n,r.navigationBehaviorOptions=i,r}function _4(e,t,n){const i=new Error("NavigationCancelingError: "+(e||""));return i[XI]=!0,i.cancellationCode=t,n&&(i.url=n),i}function y4(e){return v4(e)&&Fg(e.url)}function v4(e){return e&&e[XI]}let b4=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["ng-component"]],standalone:!0,features:[AL],decls:1,vars:0,template:function(n,i){1&n&&Hi(0,"router-outlet")},dependencies:[ZI],encapsulation:2}),e})();function YI(e){const t=e.children&&e.children.map(YI),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==Mi&&(n.component=b4),n}function Id(e){return e.outlet||Mi}function dx(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class fte{constructor(t,n,i,r,s){this.routeReuseStrategy=t,this.futureState=n,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=s}activate(t){const n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,t),qI(this.futureState.root),this.activateChildRoutes(n,i,t)}deactivateChildRoutes(t,n,i){const r=Vy(n);t.children.forEach(s=>{const u=s.value.outlet;this.deactivateRoutes(s,r[u],i),delete r[u]}),Object.values(r).forEach(s=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(t,n,i){const r=t.value,s=n?n.value:null;if(r===s)if(r.component){const u=i.getContext(r.outlet);u&&this.deactivateChildRoutes(t,n,u.children)}else this.deactivateChildRoutes(t,n,i);else s&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const i=n.getContext(t.value.outlet),r=i&&t.value.component?i.children:n,s=Vy(t);for(const u of Object.keys(s))this.deactivateRouteAndItsChildren(s[u],r);if(i&&i.outlet){const u=i.outlet.detach(),h=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:u,route:t,contexts:h})}}deactivateRouteAndOutlet(t,n){const i=n.getContext(t.value.outlet),r=i&&t.value.component?i.children:n,s=Vy(t);for(const u of Object.keys(s))this.deactivateRouteAndItsChildren(s[u],r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(t,n,i){const r=Vy(n);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new Jee(s.value.snapshot))}),t.children.length&&this.forwardEvent(new Kee(t.value.snapshot))}activateRoutes(t,n,i){const r=t.value,s=n?n.value:null;if(qI(r),r===s)if(r.component){const u=i.getOrCreateContext(r.outlet);this.activateChildRoutes(t,n,u.children)}else this.activateChildRoutes(t,n,i);else if(r.component){const u=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const h=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),u.children.onOutletReAttached(h.contexts),u.attachRef=h.componentRef,u.route=h.route.value,u.outlet&&u.outlet.attach(h.componentRef,h.route.value),qI(h.route.value),this.activateChildRoutes(t,null,u.children)}else{const h=dx(r.snapshot);u.attachRef=null,u.route=r,u.injector=h,u.outlet&&u.outlet.activateWith(r,u.injector),this.activateChildRoutes(t,null,u.children)}}else this.activateChildRoutes(t,null,i)}}class x4{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class TC{constructor(t,n){this.component=t,this.route=n}}function pte(e,t,n){const i=e._root;return hx(i,t?t._root:null,n,[i.value])}function jy(e,t){const n=Symbol(),i=t.get(e,n);return i===n?"function"!=typeof e||function ru(e){return null!==Xo(e)}(e)?t.get(e):e:i}function hx(e,t,n,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Vy(t);return e.children.forEach(u=>{(function gte(e,t,n,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,u=t?t.value:null,h=n?n.getContext(e.value.outlet):null;if(u&&s.routeConfig===u.routeConfig){const g=function _te(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Lg(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Lg(e.url,t.url)||!Th(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!WI(e,t)||!Th(e.queryParams,t.queryParams);default:return!WI(e,t)}}(u,s,s.routeConfig.runGuardsAndResolvers);g?r.canActivateChecks.push(new x4(i)):(s.data=u.data,s._resolvedData=u._resolvedData),hx(e,t,s.component?h?h.children:null:n,i,r),g&&h&&h.outlet&&h.outlet.isActivated&&r.canDeactivateChecks.push(new TC(h.outlet.component,u))}else u&&fx(t,h,r),r.canActivateChecks.push(new x4(i)),hx(e,null,s.component?h?h.children:null:n,i,r)})(u,s[u.value.outlet],n,i.concat([u.value]),r),delete s[u.value.outlet]}),Object.entries(s).forEach(([u,h])=>fx(h,n.getContext(u),r)),r}function fx(e,t,n){const i=Vy(e),r=e.value;Object.entries(i).forEach(([s,u])=>{fx(u,r.component?t?t.children.getContext(s):null:t,n)}),n.canDeactivateChecks.push(new TC(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function px(e){return"function"==typeof e}function w4(e){return e instanceof mC||"EmptyError"===e?.name}const DC=Symbol("INITIAL_VALUE");function $y(){return qr(e=>jE(e.map(t=>t.pipe(Iu(1),iN(DC)))).pipe(pi(t=>{for(const n of t)if(!0!==n){if(n===DC)return DC;if(!1===n||n instanceof Uy)return n}return!0}),hc(t=>t!==DC),Iu(1)))}function E4(e){return function ni(...e){return hl(e)}(La(t=>{if(Fg(t))throw g4(0,t)}),pi(t=>!0===t))}class SC{constructor(t){this.segmentGroup=t||null}}class C4{constructor(t){this.urlTree=t}}function Hy(e){return Jb(new SC(e))}function M4(e){return Jb(new C4(e))}class Nte{constructor(t,n){this.urlSerializer=t,this.urlTree=n}noMatchError(t){return new $e(4002,!1)}lineralizeSegments(t,n){let i=[],r=n.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return qt(i);if(r.numberOfChildren>1||!r.children[Mi])return Jb(new $e(4e3,!1));r=r.children[Mi]}}applyRedirectCommands(t,n,i){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,i)}applyRedirectCreateUrlTree(t,n,i,r){const s=this.createSegmentGroup(t,n.root,i,r);return new Uy(s,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const i={};return Object.entries(t).forEach(([r,s])=>{if("string"==typeof s&&s.startsWith(":")){const h=s.substring(1);i[r]=n[h]}else i[r]=s}),i}createSegmentGroup(t,n,i,r){const s=this.createSegments(t,n.segments,i,r);let u={};return Object.entries(n.children).forEach(([h,g])=>{u[h]=this.createSegmentGroup(t,g,i,r)}),new $r(s,u)}createSegments(t,n,i,r){return n.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,i))}findPosParam(t,n,i){const r=i[n.path.substring(1)];if(!r)throw new $e(4001,!1);return r}findOrReturn(t,n){let i=0;for(const r of n){if(r.path===t.path)return n.splice(i),r;i++}return t}}const KI={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function zte(e,t,n,i,r){const s=QI(e,t,n);return s.matched?(i=function ate(e,t){return e.providers&&!e._injector&&(e._injector=RS(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,i),function Rte(e,t,n,i){const r=t.canMatch;return r&&0!==r.length?qt(r.map(u=>{const h=jy(u,e);return cm(function Ete(e){return e&&px(e.canMatch)}(h)?h.canMatch(t,n):e.runInContext(()=>h(t,n)))})).pipe($y(),E4()):qt(!0)}(i,t,n).pipe(pi(u=>!0===u?s:{...KI}))):qt(s)}function QI(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...KI}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const r=(t.matcher||gee)(n,e,t);if(!r)return{...KI};const s={};Object.entries(r.posParams??{}).forEach(([h,g])=>{s[h]=g.path});const u=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:n.slice(r.consumed.length),parameters:u,positionalParamSegments:r.posParams??{}}}function T4(e,t,n,i){return n.length>0&&function Vte(e,t,n){return n.some(i=>IC(e,t,i)&&Id(i)!==Mi)}(e,n,i)?{segmentGroup:new $r(t,Ute(i,new $r(n,e.children))),slicedSegments:[]}:0===n.length&&function jte(e,t,n){return n.some(i=>IC(e,t,i))}(e,n,i)?{segmentGroup:new $r(e.segments,Bte(e,0,n,i,e.children)),slicedSegments:n}:{segmentGroup:new $r(e.segments,e.children),slicedSegments:n}}function Bte(e,t,n,i,r){const s={};for(const u of i)if(IC(e,n,u)&&!r[Id(u)]){const h=new $r([],{});s[Id(u)]=h}return{...r,...s}}function Ute(e,t){const n={};n[Mi]=t;for(const i of e)if(""===i.path&&Id(i)!==Mi){const r=new $r([],{});n[Id(i)]=r}return n}function IC(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}class qte{constructor(t,n,i,r,s,u,h){this.injector=t,this.configLoader=n,this.rootComponentType=i,this.config=r,this.urlTree=s,this.paramsInheritanceStrategy=u,this.urlSerializer=h,this.allowRedirects=!0,this.applyRedirects=new Nte(this.urlSerializer,this.urlTree)}noMatchError(t){return new $e(4002,!1)}recognize(){const t=T4(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Mi).pipe(lm(n=>{if(n instanceof C4)return this.allowRedirects=!1,this.urlTree=n.urlTree,this.match(n.urlTree);throw n instanceof SC?this.noMatchError(n):n}),pi(n=>{const i=new CC([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Mi,this.rootComponentType,null,{}),r=new Ff(i,n),s=new f4("",r),u=function Fee(e,t,n=null,i=null){return n4(t4(e),t,n,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return u.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(u),this.inheritParamsAndData(s._root),{state:s,tree:u}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t.root,Mi).pipe(lm(i=>{throw i instanceof SC?this.noMatchError(i):i}))}inheritParamsAndData(t){const n=t.value,i=h4(n,this.paramsInheritanceStrategy);n.params=Object.freeze(i.params),n.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,n,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,n,i):this.processSegment(t,n,i,i.segments,r,!0)}processChildren(t,n,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return or(r).pipe(zy(s=>{const u=i.children[s],h=function dte(e,t){const n=e.filter(i=>Id(i)===t);return n.push(...e.filter(i=>Id(i)!==t)),n}(n,s);return this.processSegmentGroup(t,h,u,s)}),function fee(e,t){return hi(function hee(e,t,n,i,r){return(s,u)=>{let h=n,g=t,x=0;s.subscribe(yn(u,C=>{const S=x++;g=h?e(g,C,S):(h=!0,C),i&&u.next(g)},r&&(()=>{h&&u.next(g),u.complete()})))}}(e,t,arguments.length>=2,!0))}((s,u)=>(s.push(...u),s)),gC(null),function pee(e,t){const n=arguments.length>=2;return i=>i.pipe(e?hc((r,s)=>e(r,s,i)):Ts,LI(1),n?gC(t):V3(()=>new mC))}(),zr(s=>{if(null===s)return Hy(i);const u=D4(s);return function Wte(e){e.sort((t,n)=>t.value.outlet===Mi?-1:n.value.outlet===Mi?1:t.value.outlet.localeCompare(n.value.outlet))}(u),qt(u)}))}processSegment(t,n,i,r,s,u){return or(n).pipe(zy(h=>this.processSegmentAgainstRoute(h._injector??t,n,h,i,r,s,u).pipe(lm(g=>{if(g instanceof SC)return qt(null);throw g}))),Rg(h=>!!h),lm(h=>{if(w4(h))return function Hte(e,t,n){return 0===t.length&&!e.children[n]}(i,r,s)?qt([]):Hy(i);throw h}))}processSegmentAgainstRoute(t,n,i,r,s,u,h){return function $te(e,t,n,i){return!!(Id(e)===i||i!==Mi&&IC(t,n,e))&&("**"===e.path||QI(t,e,n).matched)}(i,r,s,u)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,r,i,s,u,h):h&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,r,n,i,s,u):Hy(r):Hy(r)}expandSegmentAgainstRouteUsingRedirect(t,n,i,r,s,u){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,u):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,i,r,s,u)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,i,r){const s=this.applyRedirects.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?M4(s):this.applyRedirects.lineralizeSegments(i,s).pipe(zr(u=>{const h=new $r(u,{});return this.processSegment(t,n,h,u,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,i,r,s,u){const{matched:h,consumedSegments:g,remainingSegments:x,positionalParamSegments:C}=QI(n,r,s);if(!h)return Hy(n);const S=this.applyRedirects.applyRedirectCommands(g,r.redirectTo,C);return r.redirectTo.startsWith("/")?M4(S):this.applyRedirects.lineralizeSegments(r,S).pipe(zr(O=>this.processSegment(t,i,n,O.concat(x),u,!1)))}matchSegmentAgainstRoute(t,n,i,r,s,u){let h;if("**"===i.path){const g=r.length>0?H3(r).parameters:{};h=qt({snapshot:new CC(r,g,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,S4(i),Id(i),i.component??i._loadedComponent??null,i,I4(i)),consumedSegments:[],remainingSegments:[]}),n.children={}}else h=zte(n,i,r,t).pipe(pi(({matched:g,consumedSegments:x,remainingSegments:C,parameters:S})=>g?{snapshot:new CC(x,S,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,S4(i),Id(i),i.component??i._loadedComponent??null,i,I4(i)),consumedSegments:x,remainingSegments:C}:null));return h.pipe(qr(g=>null===g?Hy(n):this.getChildConfig(t=i._injector??t,i,r).pipe(qr(({routes:x})=>{const C=i._loadedInjector??t,{snapshot:S,consumedSegments:O,remainingSegments:F}=g,{segmentGroup:$,slicedSegments:G}=T4(n,O,F,x);if(0===G.length&&$.hasChildren())return this.processChildren(C,x,$).pipe(pi(J=>null===J?null:[new Ff(S,J)]));if(0===x.length&&0===G.length)return qt([new Ff(S,[])]);const Y=Id(i)===s;return this.processSegment(C,x,$,G,Y?Mi:s,!0).pipe(pi(J=>[new Ff(S,J)]))}))))}getChildConfig(t,n,i){return n.children?qt({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?qt({routes:n._loadedRoutes,injector:n._loadedInjector}):function kte(e,t,n,i){const r=t.canLoad;return void 0===r||0===r.length?qt(!0):qt(r.map(u=>{const h=jy(u,e);return cm(function vte(e){return e&&px(e.canLoad)}(h)?h.canLoad(t,n):e.runInContext(()=>h(t,n)))})).pipe($y(),E4())}(t,n,i).pipe(zr(r=>r?this.configLoader.loadChildren(t,n).pipe(La(s=>{n._loadedRoutes=s.routes,n._loadedInjector=s.injector})):function Fte(e){return Jb(_4(!1,3))}())):qt({routes:[],injector:t})}}function Zte(e){const t=e.value.routeConfig;return t&&""===t.path}function D4(e){const t=[],n=new Set;for(const i of e){if(!Zte(i)){t.push(i);continue}const r=t.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),n.add(r)):t.push(i)}for(const i of n){const r=D4(i.children);t.push(new Ff(i.value,r))}return t.filter(i=>!n.has(i))}function S4(e){return e.data||{}}function I4(e){return e.resolve||{}}function A4(e){return"string"==typeof e.title||null===e.title}function JI(e){return qr(t=>{const n=e(t);return n?or(n).pipe(pi(()=>t)):qt(t)})}const Gy=new sn("ROUTES");let eA=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=tn(vF)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return qt(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const i=cm(n.loadComponent()).pipe(pi(P4),La(s=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=s}),ex(()=>{this.componentLoaders.delete(n)})),r=new U3(i,()=>new Yn).pipe(RI());return this.componentLoaders.set(n,r),r}loadChildren(n,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return qt({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(pi(h=>{this.onLoadEndListener&&this.onLoadEndListener(i);let g,x;return Array.isArray(h)?x=h:(g=h.create(n).injector,x=g.get(Gy,[],en.Self|en.Optional).flat()),{routes:x.map(YI),injector:g}}),ex(()=>{this.childrenLoaders.delete(i)})),u=new U3(s,()=>new Yn).pipe(RI());return this.childrenLoaders.set(i,u),u}loadModuleFactoryOrRoutes(n){return cm(n()).pipe(pi(P4),zr(i=>i instanceof SL||Array.isArray(i)?qt(i):or(this.compiler.compileModuleAsync(i))))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function P4(e){return function tne(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let AC=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Yn,this.configLoader=tn(eA),this.environmentInjector=tn(xu),this.urlSerializer=tn(ix),this.rootContexts=tn(cx),this.inputBindingEnabled=null!==tn(MC,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>qt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=r=>this.events.next(new Xee(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new Zee(r))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:i})}setupNavigations(n){return this.transitions=new Kr({id:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:ax,restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(hc(i=>0!==i.id),pi(i=>({...i,extractedUrl:n.urlHandlingStrategy.extract(i.rawUrl)})),qr(i=>{let r=!1,s=!1;return qt(i).pipe(La(u=>{this.currentNavigation={id:u.id,initialUrl:u.rawUrl,extractedUrl:u.extractedUrl,trigger:u.source,extras:u.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),qr(u=>{const h=n.browserUrlTree.toString(),g=!n.navigated||u.extractedUrl.toString()!==h||h!==n.currentUrlTree.toString();if(!g&&"reload"!==(u.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const C="";return this.events.next(new lx(u.id,n.serializeUrl(i.rawUrl),C,0)),n.rawUrlTree=u.rawUrl,u.resolve(null),Is}if(n.urlHandlingStrategy.shouldProcessUrl(u.rawUrl))return O4(u.source)&&(n.browserUrlTree=u.extractedUrl),qt(u).pipe(qr(C=>{const S=this.transitions?.getValue();return this.events.next(new VI(C.id,this.urlSerializer.serialize(C.extractedUrl),C.source,C.restoredState)),S!==this.transitions?.getValue()?Is:Promise.resolve(C)}),function Xte(e,t,n,i,r,s){return zr(u=>function Gte(e,t,n,i,r,s,u="emptyOnly"){return new qte(e,t,n,i,r,u,s).recognize()}(e,t,n,i,u.extractedUrl,r,s).pipe(pi(({state:h,tree:g})=>({...u,targetSnapshot:h,urlAfterRedirects:g}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),La(C=>{if(i.targetSnapshot=C.targetSnapshot,i.urlAfterRedirects=C.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:C.urlAfterRedirects},"eager"===n.urlUpdateStrategy){if(!C.extras.skipLocationChange){const O=n.urlHandlingStrategy.merge(C.urlAfterRedirects,C.rawUrl);n.setBrowserUrl(O,C)}n.browserUrlTree=C.urlAfterRedirects}const S=new $ee(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(S)}));if(g&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:C,extractedUrl:S,source:O,restoredState:F,extras:$}=u,G=new VI(C,this.urlSerializer.serialize(S),O,F);this.events.next(G);const Y=d4(0,this.rootComponentType).snapshot;return qt(i={...u,targetSnapshot:Y,urlAfterRedirects:S,extras:{...$,skipLocationChange:!1,replaceUrl:!1}})}{const C="";return this.events.next(new lx(u.id,n.serializeUrl(i.extractedUrl),C,1)),n.rawUrlTree=u.rawUrl,u.resolve(null),Is}}),La(u=>{const h=new Hee(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(h)}),pi(u=>i={...u,guards:pte(u.targetSnapshot,u.currentSnapshot,this.rootContexts)}),function Mte(e,t){return zr(n=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:u}}=n;return 0===u.length&&0===s.length?qt({...n,guardsResult:!0}):function Tte(e,t,n,i){return or(e).pipe(zr(r=>function Ote(e,t,n,i,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?qt(s.map(h=>{const g=dx(t)??r,x=jy(h,g);return cm(function wte(e){return e&&px(e.canDeactivate)}(x)?x.canDeactivate(e,t,n,i):g.runInContext(()=>x(e,t,n,i))).pipe(Rg())})).pipe($y()):qt(!0)}(r.component,r.route,n,t,i)),Rg(r=>!0!==r,!0))}(u,i,r,e).pipe(zr(h=>h&&function yte(e){return"boolean"==typeof e}(h)?function Dte(e,t,n,i){return or(t).pipe(zy(r=>Ub(function Ite(e,t){return null!==e&&t&&t(new Yee(e)),qt(!0)}(r.route.parent,i),function Ste(e,t){return null!==e&&t&&t(new Qee(e)),qt(!0)}(r.route,i),function Pte(e,t,n){const i=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(u=>function mte(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(u)).filter(u=>null!==u).map(u=>B3(()=>qt(u.guards.map(g=>{const x=dx(u.node)??n,C=jy(g,x);return cm(function xte(e){return e&&px(e.canActivateChild)}(C)?C.canActivateChild(i,e):x.runInContext(()=>C(i,e))).pipe(Rg())})).pipe($y())));return qt(s).pipe($y())}(e,r.path,n),function Ate(e,t,n){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return qt(!0);const r=i.map(s=>B3(()=>{const u=dx(t)??n,h=jy(s,u);return cm(function bte(e){return e&&px(e.canActivate)}(h)?h.canActivate(t,e):u.runInContext(()=>h(t,e))).pipe(Rg())}));return qt(r).pipe($y())}(e,r.route,n))),Rg(r=>!0!==r,!0))}(i,s,e,t):qt(h)),pi(h=>({...n,guardsResult:h})))})}(this.environmentInjector,u=>this.events.next(u)),La(u=>{if(i.guardsResult=u.guardsResult,Fg(u.guardsResult))throw g4(0,u.guardsResult);const h=new Gee(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot,!!u.guardsResult);this.events.next(h)}),hc(u=>!!u.guardsResult||(n.restoreHistory(u),this.cancelNavigationTransition(u,"",3),!1)),JI(u=>{if(u.guards.canActivateChecks.length)return qt(u).pipe(La(h=>{const g=new qee(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(g)}),qr(h=>{let g=!1;return qt(h).pipe(function Yte(e,t){return zr(n=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=n;if(!r.length)return qt(n);let s=0;return or(r).pipe(zy(u=>function Kte(e,t,n,i){const r=e.routeConfig,s=e._resolve;return void 0!==r?.title&&!A4(r)&&(s[tx]=r.title),function Qte(e,t,n,i){const r=function Jte(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===r.length)return qt({});const s={};return or(r).pipe(zr(u=>function ene(e,t,n,i){const r=dx(t)??i,s=jy(e,r);return cm(s.resolve?s.resolve(t,n):r.runInContext(()=>s(t,n)))}(e[u],t,n,i).pipe(Rg(),La(h=>{s[u]=h}))),LI(1),j3(s),lm(u=>w4(u)?Is:Jb(u)))}(s,e,t,i).pipe(pi(u=>(e._resolvedData=u,e.data=h4(e,n).resolve,r&&A4(r)&&(e.data[tx]=r.title),null)))}(u.route,i,e,t)),La(()=>s++),LI(1),zr(u=>s===r.length?qt(n):Is))})}(n.paramsInheritanceStrategy,this.environmentInjector),La({next:()=>g=!0,complete:()=>{g||(n.restoreHistory(h),this.cancelNavigationTransition(h,"",2))}}))}),La(h=>{const g=new Wee(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(g)}))}),JI(u=>{const h=g=>{const x=[];g.routeConfig?.loadComponent&&!g.routeConfig._loadedComponent&&x.push(this.configLoader.loadComponent(g.routeConfig).pipe(La(C=>{g.component=C}),pi(()=>{})));for(const C of g.children)x.push(...h(C));return x};return jE(h(u.targetSnapshot.root)).pipe(gC(),Iu(1))}),JI(()=>this.afterPreactivation()),pi(u=>{const h=function rte(e,t,n){const i=ux(e,t._root,n?n._root:void 0);return new u4(i,t)}(n.routeReuseStrategy,u.targetSnapshot,u.currentRouterState);return i={...u,targetRouterState:h}}),La(u=>{n.currentUrlTree=u.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl),n.routerState=u.targetRouterState,"deferred"===n.urlUpdateStrategy&&(u.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,u),n.browserUrlTree=u.urlAfterRedirects)}),((e,t,n,i)=>pi(r=>(new fte(t,r.targetRouterState,r.currentRouterState,n,i).activate(e),r)))(this.rootContexts,n.routeReuseStrategy,u=>this.events.next(u),this.inputBindingEnabled),Iu(1),La({next:u=>{r=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new um(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(u.targetRouterState.snapshot),u.resolve(!0)},complete:()=>{r=!0}}),ex(()=>{r||s||this.cancelNavigationTransition(i,"",1),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),lm(u=>{if(s=!0,v4(u)){y4(u)||(n.navigated=!0,n.restoreHistory(i,!0));const h=new EC(i.id,this.urlSerializer.serialize(i.extractedUrl),u.message,u.cancellationCode);if(this.events.next(h),y4(u)){const g=n.urlHandlingStrategy.merge(u.url,n.rawUrlTree),x={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||O4(i.source)};n.scheduleNavigation(g,ax,null,x,{resolve:i.resolve,reject:i.reject,promise:i.promise})}else i.resolve(!1)}else{n.restoreHistory(i,!0);const h=new jI(i.id,this.urlSerializer.serialize(i.extractedUrl),u,i.targetSnapshot??void 0);this.events.next(h);try{i.resolve(n.errorHandler(u))}catch(g){i.reject(g)}}return Is}))}))}cancelNavigationTransition(n,i,r){const s=new EC(n.id,this.urlSerializer.serialize(n.extractedUrl),i,r);this.events.next(s),n.resolve(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function O4(e){return e!==ax}let k4=(()=>{class e{buildTitle(n){let i,r=n.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(s=>s.outlet===Mi);return i}getResolvedTitleForRoute(n){return n.data[tx]}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:function(){return tn(nne)},providedIn:"root"}),e})(),nne=(()=>{class e extends k4{constructor(n){super(),this.title=n}updateTitle(n){const i=this.buildTitle(n);void 0!==i&&this.title.setTitle(i)}}return e.\u0275fac=function(n){return new(n||e)(et(G5))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),ine=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:function(){return tn(one)},providedIn:"root"}),e})();class rne{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let one=(()=>{class e extends rne{}return e.\u0275fac=function(){let t;return function(i){return(t||(t=$m(e)))(i||e)}}(),e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const PC=new sn("",{providedIn:"root",factory:()=>({})});let sne=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:function(){return tn(ane)},providedIn:"root"}),e})(),ane=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,i){return n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Wc=(()=>((Wc=Wc||{})[Wc.COMPLETE=0]="COMPLETE",Wc[Wc.FAILED=1]="FAILED",Wc[Wc.REDIRECTING=2]="REDIRECTING",Wc))();function R4(e,t){e.events.pipe(hc(n=>n instanceof um||n instanceof EC||n instanceof jI||n instanceof lx),pi(n=>n instanceof um||n instanceof lx?Wc.COMPLETE:n instanceof EC&&(0===n.code||1===n.code)?Wc.REDIRECTING:Wc.FAILED),hc(n=>n!==Wc.REDIRECTING),Iu(1)).subscribe(()=>{t()})}function lne(e){throw e}function cne(e,t,n){return t.parse("/")}const une={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},dne={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ga=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=tn(yF),this.isNgZoneEnabled=!1,this.options=tn(PC,{optional:!0})||{},this.pendingTasks=tn(vE),this.errorHandler=this.options.errorHandler||lne,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||cne,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=tn(sne),this.routeReuseStrategy=tn(ine),this.titleStrategy=tn(k4),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=tn(Gy,{optional:!0})?.flat()??[],this.navigationTransitions=tn(AC),this.urlSerializer=tn(ix),this.location=tn(TE),this.componentInputBindingEnabled=!!tn(MC,{optional:!0}),this.isNgZoneEnabled=tn(Fi)instanceof Fi&&Fi.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Uy,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=d4(0,null),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId??0},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),ax,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const i="popstate"===n.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,i,n.state)},0)}))}navigateToSyncWithBrowser(n,i,r){const s={replaceUrl:!0},u=r?.navigationId?r:null;if(r){const g={...r};delete g.navigationId,delete g.\u0275routerPageId,0!==Object.keys(g).length&&(s.state=g)}const h=this.parseUrl(n);this.scheduleNavigation(h,i,u,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(YI),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,i={}){const{relativeTo:r,queryParams:s,fragment:u,queryParamsHandling:h,preserveFragment:g}=i,x=g?this.currentUrlTree.fragment:u;let S,C=null;switch(h){case"merge":C={...this.currentUrlTree.queryParams,...s};break;case"preserve":C=this.currentUrlTree.queryParams;break;default:C=s||null}null!==C&&(C=this.removeEmptyProps(C));try{S=t4(r?r.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),S=this.currentUrlTree.root}return n4(S,n,C,x??null)}navigateByUrl(n,i={skipLocationChange:!1}){const r=Fg(n)?n:this.parseUrl(n),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,ax,null,i)}navigate(n,i={skipLocationChange:!1}){return function hne(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new $e(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let i;try{i=this.urlSerializer.parse(n)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,n)}return i}isActive(n,i){let r;if(r=!0===i?{...une}:!1===i?{...dne}:i,Fg(n))return q3(this.currentUrlTree,n,r);const s=this.parseUrl(n);return q3(this.currentUrlTree,s,r)}removeEmptyProps(n){return Object.keys(n).reduce((i,r)=>{const s=n[r];return null!=s&&(i[r]=s),i},{})}scheduleNavigation(n,i,r,s,u){if(this.disposed)return Promise.resolve(!1);let h,g,x;u?(h=u.resolve,g=u.reject,x=u.promise):x=new Promise((S,O)=>{h=S,g=O});const C=this.pendingTasks.add();return R4(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(C))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:s,resolve:h,reject:g,promise:x,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),x.catch(S=>Promise.reject(S))}setBrowserUrl(n,i){const r=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl){const u={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(r,"",u)}else{const s={...i.extras.state,...this.generateNgRouterState(i.id,(this.browserPageId??0)+1)};this.location.go(r,"",s)}}restoreHistory(n,i=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-(this.browserPageId??this.currentPageId);0!==s?this.location.historyGo(s):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===s&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),dm=(()=>{class e{constructor(n,i,r,s,u,h){this.router=n,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=u,this.locationStrategy=h,this.href=null,this.commands=null,this.onChanges=new Yn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const g=u.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===g||"area"===g,this.isAnchorElement?this.subscription=n.events.subscribe(x=>{x instanceof um&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,i,r,s,u){return!!(null===this.urlTree||this.isAnchorElement&&(0!==n||i||r||s||u||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const n=null===this.href?null:function Gv(e,t,n){return function HD(e,t){return"src"===t&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===t&&("base"===e||"link"===e)?Np:Fp}(t,n)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",n)}applyAttributeValue(n,i){const r=this.renderer,s=this.el.nativeElement;null!==i?r.setAttribute(s,n,i):r.removeAttribute(s,n)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return e.\u0275fac=function(n){return new(n||e)(Nt(ga),Nt(Ng),function hu(e){return function $1(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const i=n.length;let r=0;for(;r<i;){const s=n[r];if(Ju(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof n[r];)r++;else{if(s===t)return n[r+1];r+=2}}}return null}(Vr(),e)}("tabindex"),Nt(ly),Nt(vs),Nt(Mg))},e.\u0275dir=Cr({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(n,i){1&n&&xs("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&n&&vb("target",i.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",m2],skipLocationChange:["skipLocationChange","skipLocationChange",m2],replaceUrl:["replaceUrl","replaceUrl",m2],routerLink:"routerLink"},standalone:!0,features:[Gk,se]}),e})();class L4{}let mne=(()=>{class e{constructor(n,i,r,s,u){this.router=n,this.injector=r,this.preloadingStrategy=s,this.loader=u}setUpPreloading(){this.subscription=this.router.events.pipe(hc(n=>n instanceof um),zy(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,i){const r=[];for(const s of i){s.providers&&!s._injector&&(s._injector=RS(s.providers,n,`Route: ${s.path}`));const u=s._injector??n,h=s._loadedInjector??u;(s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent)&&r.push(this.preloadConfig(u,s)),(s.children||s._loadedRoutes)&&r.push(this.processRoutes(h,s.children??s._loadedRoutes))}return or(r).pipe(Js())}preloadConfig(n,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(n,i):qt(null);const s=r.pipe(zr(u=>null===u?qt(void 0):(i._loadedRoutes=u.routes,i._loadedInjector=u.injector,this.processRoutes(u.injector??n,u.routes))));return i.loadComponent&&!i._loadedComponent?or([s,this.loader.loadComponent(i)]).pipe(Js()):s})}}return e.\u0275fac=function(n){return new(n||e)(et(ga),et(vF),et(xu),et(L4),et(eA))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const tA=new sn("");let F4=(()=>{class e{constructor(n,i,r,s,u={}){this.urlSerializer=n,this.transitions=i,this.viewportScroller=r,this.zone=s,this.options=u,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},u.scrollPositionRestoration=u.scrollPositionRestoration||"disabled",u.anchorScrolling=u.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof VI?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof um?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof lx&&0===n.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof l4&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new l4(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(n){yh()},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();function Nf(e,t){return{\u0275kind:e,\u0275providers:t}}function z4(){const e=tn(bs);return t=>{const n=e.get(nm);if(t!==n.components[0])return;const i=e.get(ga),r=e.get(B4);1===e.get(nA)&&i.initialNavigation(),e.get(U4,null,en.Optional)?.setUpPreloading(),e.get(tA,null,en.Optional)?.init(),i.resetRootComponentType(n.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const B4=new sn("",{factory:()=>new Yn}),nA=new sn("",{providedIn:"root",factory:()=>1}),U4=new sn("");function vne(e){return Nf(0,[{provide:U4,useExisting:mne},{provide:L4,useExisting:e}])}const V4=new sn("ROUTER_FORROOT_GUARD"),xne=[TE,{provide:ix,useClass:FI},ga,cx,{provide:Ng,useFactory:function N4(e){return e.routerState.root},deps:[ga]},eA,[]];function wne(){return new AF("Router",ga)}let j4=(()=>{class e{constructor(n){}static forRoot(n,i){return{ngModule:e,providers:[xne,[],{provide:Gy,multi:!0,useValue:n},{provide:V4,useFactory:Tne,deps:[[ga,new Zm,new I_]]},{provide:PC,useValue:i||{}},i?.useHash?{provide:Mg,useClass:vW}:{provide:Mg,useClass:o5},{provide:tA,useFactory:()=>{const e=tn(LZ),t=tn(Fi),n=tn(PC),i=tn(AC),r=tn(ix);return n.scrollOffset&&e.setOffset(n.scrollOffset),new F4(r,i,e,t,n)}},i?.preloadingStrategy?vne(i.preloadingStrategy).\u0275providers:[],{provide:AF,multi:!0,useFactory:wne},i?.initialNavigation?Dne(i):[],i?.bindToComponentInputs?Nf(8,[m4,{provide:MC,useExisting:m4}]).\u0275providers:[],[{provide:$4,useFactory:z4},{provide:a2,multi:!0,useExisting:$4}]]}}static forChild(n){return{ngModule:e,providers:[{provide:Gy,multi:!0,useValue:n}]}}}return e.\u0275fac=function(n){return new(n||e)(et(V4,8))},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({}),e})();function Tne(e){return"guarded"}function Dne(e){return["disabled"===e.initialNavigation?Nf(3,[{provide:QS,multi:!0,useFactory:()=>{const t=tn(ga);return()=>{t.setUpLocationChangeListener()}}},{provide:nA,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Nf(2,[{provide:nA,useValue:0},{provide:QS,multi:!0,deps:[bs],useFactory:t=>{const n=t.get(_W,Promise.resolve());return()=>n.then(()=>new Promise(i=>{const r=t.get(ga),s=t.get(B4);R4(r,()=>{i(!0)}),t.get(AC).afterPreactivation=()=>(i(!0),s.closed?qt(void 0):s),r.initialNavigation()}))}}]).\u0275providers:[]]}const $4=new sn("");let Ine=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-about"]],decls:13,vars:0,consts:[[1,"backdrop"],["routerLink","/munis","queryParamsHandling","merge"],[1,"about"],["routerLink","/munis",1,"entry"],["href","https://data-city.my.canva.site/terms","target","_blank"],[1,"hero"]],template:function(n,i){1&n&&(Rt(0,"div",0),Hi(1,"a",1),kt(),Rt(2,"div",2)(3,"div")(4,"h1"),In(5,"\u05d4\u05d2\u05e2\u05ea \u05dc\u05d9\u05e2\u201d\u05d3"),kt(),Rt(6,"h2"),In(7,'\u05d1\u05d9\u05e2\u05e8 \u05e2\u05d9\u05e8\u05d5\u05e0\u05d9 \u05d3\u05d9\u05d2\u05d9\u05d8\u05dc\u05d9 (\u05d9\u05e2"\u05d3) \u05d0\u05e1\u05e4\u05e0\u05d5 \u05d5\u05e8\u05d9\u05db\u05d6\u05e0\u05d5 \u05e0\u05ea\u05d5\u05e0\u05d9\u05dd \u05e2\u05dc \u05de\u05d9\u05dc\u05d9\u05d5\u05e0\u05d9 \u05e2\u05e6\u05d9 \u05d4\u05d9\u05e2\u05e8 \u05d4\u05e2\u05d9\u05e8\u05d5\u05e0\u05d9 \u05e9\u05dc \u05d4\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05d4\u05de\u05e7\u05d5\u05de\u05d9\u05d5\u05ea \u05d1\u05d9\u05e9\u05e8\u05d0\u05dc. \u05dc\u05e8\u05d0\u05e9\u05d5\u05e0\u05d4 \u05e0\u05d9\u05ea\u05df \u05dc\u05d4\u05e6\u05d9\u05d2, \u05dc\u05d4\u05e9\u05d5\u05d5\u05ea \u05d5\u05dc\u05e9\u05ea\u05e3 \u05de\u05d9\u05d3\u05e2 \u05d0\u05e8\u05e6\u05d9 \u05d5\u05e2\u05d3 \u05d4\u05e2\u05e5 \u05d4\u05d1\u05d5\u05d3\u05d3.'),kt(),Rt(8,"a",3),In(9,"\u05db\u05e0\u05d9\u05e1\u05d4\xa0>"),kt(),Rt(10,"a",4),In(11,"\u05de\u05d3\u05d9\u05e0\u05d9\u05d5\u05ea \u05e9\u05d9\u05de\u05d5\u05e9"),kt()(),Hi(12,"div",5),kt())},dependencies:[dm],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;position:relative;pointer-events:all!important}[_nghost-%COMP%]   .backdrop[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;background-color:#00000080;z-index:0}[_nghost-%COMP%]   .backdrop[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;width:100%;height:100%}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]{width:75%;height:50%;padding:50px 70px 50px 45px;display:flex;flex-flow:row;align-items:center;border-radius:5px;background:#fff;box-shadow:0 4px 8px #0000004d;position:relative;z-index:1;gap:30px}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:0 0 50%;display:flex;flex-flow:column;align-items:flex-start;justify-content:center;gap:30px}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#204e37;font-family:Secular One,sans-serif;font-style:normal;font-weight:400;line-height:80%;letter-spacing:-.56px;width:100%;margin:0}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#383838;font-size:18px;font-style:Normal;font-weight:400;line-height:24px;width:100%;margin:0}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div.hero[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain;background-image:url(hero.73005e3e386cc292.svg);width:359px;height:305px}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#204e37}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{color:inherit}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}']}),e})();const Ane=Ko,One=Symbol("__destroy"),H4=Symbol("__decoratorApplied");function G4(e){return"string"==typeof e?Symbol(`__destroy__${e}`):One}function q4(e,t){e[t]||(e[t]=new Yn)}function W4(e,t){e[t]&&(e[t].next(),e[t].complete(),e[t]=null)}function Z4(e){e instanceof pt&&e.unsubscribe()}function X4(e,t){return function(){if(e&&e.call(this),W4(this,G4()),t.arrayName&&function Rne(e){Array.isArray(e)&&e.forEach(Z4)}(this[t.arrayName]),t.checkProperties)for(const n in this)t.blackList?.includes(n)||Z4(this[n])}}function mx(e={}){return t=>{!function Pne(e){return!!e[Ane]}(t)?function Lne(e,t){e.prototype.ngOnDestroy=X4(e.prototype.ngOnDestroy,t)}(t,e):function Fne(e,t){const n=e.\u0275pipe;n.onDestroy=X4(n.onDestroy,t)}(t,e),function kne(e){e.prototype[H4]=!0}(t)}}Symbol("CheckerHasBeenSet");function zg(e,t){return n=>{const i=G4(t);"string"==typeof t?function Une(e,t,n){const i=e[t];q4(e,n),e[t]=function(){i.apply(this,arguments),W4(this,n),e[t]=i}}(e,t,i):q4(e,i);const r=e[i];return n.pipe(Hc(r))}}function J4(e,t){return t?n=>Ub(t.pipe(Iu(1),function jne(){return hi((e,t)=>{e.subscribe(yn(t,_n))})}()),n.pipe(J4(e))):zr((n,i)=>bi(e(n,i)).pipe(Iu(1),j3(n)))}class rA extends Yn{constructor(t=1/0,n=1/0,i=Y2){super(),this._bufferSize=t,this._windowTime=n,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=n===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,n)}next(t){const{isStopped:n,_buffer:i,_infiniteTimeWindow:r,_timestampProvider:s,_windowTime:u}=this;n||(i.push(t),!r&&i.push(s.now()+u)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const n=this._innerSubscribe(t),{_infiniteTimeWindow:i,_buffer:r}=this,s=r.slice();for(let u=0;u<s.length&&!t.closed;u+=i?1:2)t.next(s[u]);return this._checkFinalizedStatuses(t),n}_trimBuffer(){const{_bufferSize:t,_timestampProvider:n,_buffer:i,_infiniteTimeWindow:r}=this,s=(r?1:2)*t;if(t<1/0&&s<i.length&&i.splice(0,i.length-s),!r){const u=n.now();let h=0;for(let g=1;g<i.length&&i[g]<=u;g+=2)h=g;h&&i.splice(0,h+1)}}}class qy{constructor(t,n,i,r){this.kind=t,this.label=n,this.code=i,this.name=r}toQueryParam(){const t=`${this.kind}:${this.code}`;return this.name?`${t}:${this.name}`:t}display(){return`<span class='kind'>${this.label?this.label+":":""}</span>&nbsp;<strong>${this.name||this.code}</strong>`}boundsQuery(){return null}treesQuery(){return null}mapFilters(){return{}}polygonGeometry(){return null}static fromQueryParam(t){const n=t.split(":");if(n.length>=2){if("muni"===n[0])return new ez(n[1],n[2]);if("stat-area"===n[0])return new tz(n[1]);if("parcel"===n[0])return new nz(n[1]);if("road"===n[0])return new iz(n[1]);if("polygon"===n[0])return new Gne(n[1])}return null}}class ez extends qy{constructor(t,n){super("muni","\u05e8\u05e9\u05d5\u05ea \u05de\u05e7\u05d5\u05de\u05d9\u05ea",t,n)}mapFilters(){return{trees:["==",["to-string",["get","muni"]],["literal",this.code]]}}boundsQuery(){return`SELECT bounds FROM munis WHERE muni_code='${this.code}'`}treesQuery(){return`muni_code='${this.code}'`}}class tz extends qy{constructor(t){super("stat-area","\u05d0\u05d6\u05d5\u05e8 \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9",t)}mapFilters(){return{trees:["==",["to-string",["get","stat_area"]],["literal",this.code]]}}boundsQuery(){return`SELECT bounds FROM stat_areas WHERE code='${this.code}'`}treesQuery(){return`stat_area_code='${this.code}'`}}class nz extends qy{constructor(t){super("parcel","\u05d2\u05d5\u05e9/\u05d7\u05dc\u05e7\u05d4",t)}mapFilters(){return{trees:["==",["to-string",["get","cad"]],["literal",this.code]]}}boundsQuery(){return`SELECT bounds FROM parcels WHERE code='${this.code}'`}treesQuery(){return`cad_code='${this.code}'`}}class iz extends qy{constructor(t){super("road","\u05e8\u05d7\u05d5\u05d1",t)}mapFilters(){return{trees:["==",["to-string",["get","road"]],["literal",this.code]],"roads-border":["==",["to-string",["get","road_id"]],["literal",this.code]]}}boundsQuery(){return`SELECT bounds FROM roads WHERE road_id='${this.code}'`}treesQuery(){return`road_id='${this.code}'`}}class Gne extends qy{constructor(t){super("polygon","","\u05d4\u05e4\u05d5\u05dc\u05d9\u05d2\u05d5\u05df \u05d4\u05e0\u05d1\u05d7\u05e8");let n=t.split(";").map(i=>i.split(",").map(r=>parseFloat(r)));this.geometry={type:"Polygon",coordinates:[n]}}mapFilters(){return{trees:["within",this.geometry]}}boundsQuery(){return null}treesQuery(){return`ST_Contains(\n            ST_GeomFromGeoJSON('${JSON.stringify(this.geometry)}'),\n            ST_SetSRID(ST_MakePoint("location-x", "location-y"), 4326)\n        )`}polygonGeometry(){return this.geometry}}class Ad{constructor(t,n,i){this.filter=t,this.paint=n,this.layout=i}}class gx{constructor(t,n){this.title=t,this.chart=n}}class _a{constructor(t,n,i=!1,r=!1){this.color=t,this.label=n,this.separated=i,this.scaled=r}}class OC{constructor(t,n,i){this.title=t,this.items=n,this.tooltip=i}}class Vi{constructor(t,n){this.value=t,this.label=n}}class oA{constructor(t,n){this.id=t,this.kind=n,this.placeholder="",this.options=[]}}class zf extends oA{constructor(t,n,i){super(t,"select"),this.label=n,this.options=i}}class Wne extends oA{constructor(t,n,i,r){super(t,"multi-select"),this.label=n,this.options=r,this.placeholder=i}}class Bg{constructor(t,n,i={}){this.mode=t,this.id=n,this.filters=i,this.sql=[],this.downloadQuery=null,this.geo=null,this.processed=!1,this.layerConfig={},this.charts=[],this.legend=null,this.filterItems=[],this.focus=null,this.clearFilters=!1,this.popupLayers={},this.focus=this.filters.focus&&qy.fromQueryParam(this.filters.focus)||null,this.focusQuery=this.focus?.treesQuery()||"TRUE",this.clearFilters=this.filters&&Object.keys(this.filters).length>0}process(t){let n=or([!0]);return this.processed||this.sql.length&&(n=function Hne(...e){const t=Hu(e),{args:n,keys:i}=eN(e),r=new ii(s=>{const{length:u}=n;if(!u)return void s.complete();const h=new Array(u);let g=u,x=u;for(let C=0;C<u;C++){let S=!1;bi(n[C]).subscribe(yn(s,O=>{S||(S=!0,x--),h[C]=O},()=>g--,void 0,()=>{(!g||!S)&&(x||s.next(i?tN(i,h):h),s.complete())}))}});return t?r.pipe(Z2(t)):r}(this.sql.map(i=>t.query(i))).pipe(La(i=>{this.processed=!0,this.data=i,this.handleData(i)}))),n}isLayerVisible(t){return!!this.layerConfig[t]}getLayerConfig(t){return this.layerConfig[t]}handleData(t){}}const Wy="rc",Sh="car",kC="quality",_x="cpc",rz=new zf(Wy,"\u05d4\u05e6\u05d2\u05d4:",[new Vi(Sh,"\u05dc\u05e4\u05d9 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd"),new Vi(kC,"\u05dc\u05e4\u05d9 \u05d0\u05d9\u05db\u05d5\u05ea \u05d4\u05de\u05d9\u05d3\u05e2"),new Vi(_x,"\u05dc\u05e4\u05d9 \u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05e2\u05e6\u05d9\u05dd \u05dc\u05e0\u05e4\u05e9")]),Zne=new zf(Wy,"\u05d4\u05e6\u05d2\u05d4:",[new Vi(Sh,"\u05dc\u05e4\u05d9 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd"),new Vi(kC,"\u05dc\u05e4\u05d9 \u05d0\u05d9\u05db\u05d5\u05ea \u05d4\u05de\u05d9\u05d3\u05e2")]),Ug={};Ug[kC]=["match",["coalesce",["get","quality_score"],0],0,["to-color","#cccccc"],1,["to-color","#FFC700"],2,["to-color","#FF7F00"],3,["to-color","#00D315"],["to-color","#00D315"]],Ug[Sh]=["interpolate",["exponential",.01],["get","canopy_area_ratio"],0,["to-color","#ccc"],.05,["to-color","#acecc2"],.4,["to-color","#155b2e"]],Ug[_x]=["interpolate",["exponential",.99],["get","canopy_per_capita"],0,["to-color","#ccc"],10,["to-color","#acecc2"],150,["to-color","#155b2e"]];const hm={};hm[kC]=new OC("\u05de\u05e7\u05e8\u05d0 \u05d0\u05d9\u05db\u05d5\u05ea \u05d4\u05de\u05d9\u05d3\u05e2",[new _a("#00D315","3 \u05de\u05e7\u05d5\u05e8\u05d5\u05ea \u05de\u05d9\u05d3\u05e2 \u05d5\u05de\u05e2\u05dc\u05d4"),new _a("#FF7F00","2 \u05de\u05e7\u05d5\u05e8\u05d5\u05ea \u05de\u05d9\u05d3\u05e2"),new _a("#FFC700","\u05de\u05e7\u05d5\u05e8 \u05de\u05d9\u05d3\u05e2 \u05d0\u05d7\u05d3"),new _a("#cccccc","\u05d0\u05d9\u05df \u05de\u05d9\u05d3\u05e2 \u05db\u05dc\u05dc")],"\u05db\u05db\u05dc \u05e9\u05d9\u05e9 \u05d9\u05d5\u05ea\u05e8 \u05de\u05e7\u05d5\u05e8\u05d5\u05ea \u05de\u05d9\u05d3\u05e2 \u05e0\u05d9\u05ea\u05df \u05dc\u05d4\u05e6\u05dc\u05d9\u05d1 \u05d5\u05dc\u05d8\u05d9\u05d9\u05d1 \u05e0\u05ea\u05d5\u05e0\u05d9\u05dd \u05d5\u05dc\u05e9\u05e4\u05e8 \u05d0\u05ea \u05d0\u05d9\u05db\u05d5\u05ea \u05d4\u05de\u05d9\u05d3\u05e2"),hm[Sh]=new OC("\u05de\u05e7\u05e8\u05d0 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd",[new _a("#155b2e","\u05db\u05d9\u05e1\u05d5\u05d9 \u05d2\u05d1\u05d5\u05d4"),new _a("#3b7f53",""),new _a("#60a478","\u2191",!1,!0),new _a("#86c89d",""),new _a("#acecc2","\u05db\u05d9\u05e1\u05d5\u05d9 \u05e0\u05de\u05d5\u05da"),new _a("#ccc","\u05d0\u05d9\u05df \u05de\u05d9\u05d3\u05e2",!0)],"\u05dc\u05e4\u05d9 \u05de\u05d9\u05e4\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05e2\u05e6\u05d9\u05dd \u05e9\u05dc \u05de\u05e4\u05f4\u05d9"),hm[_x]=new OC("\u05de\u05e7\u05e8\u05d0 \u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05e2\u05e6\u05d9\u05dd \u05dc\u05e0\u05e4\u05e9",[new _a("#155b2e","\u05db\u05d9\u05e1\u05d5\u05d9 \u05d2\u05d1\u05d5\u05d4"),new _a("#3b7f53",""),new _a("#60a478","\u2191",!1,!0),new _a("#86c89d",""),new _a("#acecc2","\u05db\u05d9\u05e1\u05d5\u05d9 \u05e0\u05de\u05d5\u05da"),new _a("#ccc","\u05d0\u05d9\u05df \u05de\u05d9\u05d3\u05e2",!0)],"\u05db\u05d9\u05e1\u05d5\u05d9 \u05d4\u05e6\u05d5\u05de\u05d7 \u05de\u05d7\u05d5\u05e9\u05d1 \u05dc\u05e4\u05d9 \u05de\u05d9\u05e4\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05e2\u05e6\u05d9\u05dd \u05e9\u05dc \u05de\u05e4\u05f4\u05d9, \u05d0\u05d5\u05db\u05dc\u05d5\u05e1\u05d9\u05d4 \u05dc\u05e4\u05d9 \u05e0\u05ea\u05d5\u05e0\u05d9 \u05dc\u05de\u05f4\u05e1 2020");const RC="sei",Kne=[rz,new zf(RC,"\u05dc\u05e4\u05d9 \u05d0\u05e9\u05db\u05d5\u05dc \u05d7\u05d1\u05e8\u05ea\u05d9-\u05db\u05dc\u05db\u05dc\u05d9:",[new Vi("all","\u05db\u05dc \u05d4\u05d0\u05e9\u05db\u05d5\u05dc\u05d5\u05ea"),new Vi("low","\u05d0\u05e9\u05db\u05d5\u05dc\u05d5\u05ea 1-3"),new Vi("mid","\u05d0\u05e9\u05db\u05d5\u05dc\u05d5\u05ea 4-7"),new Vi("high","\u05d0\u05e9\u05db\u05d5\u05dc\u05d5\u05ea 8-10")]),new zf("pd","\u05dc\u05e4\u05d9 \u05e6\u05e4\u05d9\u05e4\u05d5\u05ea \u05d0\u05d5\u05db\u05dc\u05d5\u05e1\u05d9\u05d4:",[new Vi("all","\u05d4\u05db\u05dc"),new Vi("low","<1000 \u05e0\u05e4\u05e9\u05d5\u05ea \u05dc\u05e7\u05de\u05f4\u05e8"),new Vi("mid","1000-5000 \u05e0\u05e4\u05e9\u05d5\u05ea \u05dc\u05e7\u05de\u05f4\u05e8"),new Vi("high",">5000 \u05e0\u05e4\u05e9\u05d5\u05ea \u05dc\u05e7\u05de\u05f4\u05e8")])],Qne=[rz],dz=[Zne];class Jne extends Bg{constructor(t,n){super("muni",t,n),this.sql=[`SELECT * FROM munis WHERE "muni_code" = '${this.id}'`,`SELECT "meta-source" as name, count(1) as count FROM trees_processed WHERE "muni_code" = '${this.id}' GROUP BY 1 order by 2 desc`,`SELECT count(1) as total_count FROM trees_compact WHERE "muni_code" = '${this.id}'`];for(const r of["munis-label","munis-border","munis-fill"])this.layerConfig[r]=new Ad(["==",["get","muni_code"],["literal",this.id]],null,null);const i=this.filters[Wy]||Sh;this.legend=hm[i],this.layerConfig["munis-fill"].paint={"fill-color":Ug[i],"fill-opacity":.8},this.layerConfig["munis-border"].paint={"line-color":"#ff871f","line-opacity":.4},this.layerConfig.trees=new Ad(["==",["get","muni"],["literal",this.id]],null,null),this.legend=hm[i],this.filterItems=Qne}handleData(t){t[0].length&&t[0][0]&&(this.geo={zoom:13,center:t[0][0].center})}}function fc(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function yx(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function vx(e){let t,n,i;function r(h,g,x=0,C=h.length){if(x<C){if(0!==t(g,g))return C;do{const S=x+C>>>1;n(h[S],g)<0?x=S+1:C=S}while(x<C)}return x}return 2!==e.length?(t=fc,n=(h,g)=>fc(e(h),g),i=(h,g)=>e(h)-g):(t=e===fc||e===yx?e:eie,n=e,i=e),{left:r,center:function u(h,g,x=0,C=h.length){const S=r(h,g,x,C-1);return S>x&&i(h[S-1],g)>-i(h[S],g)?S-1:S},right:function s(h,g,x=0,C=h.length){if(x<C){if(0!==t(g,g))return C;do{const S=x+C>>>1;n(h[S],g)<=0?x=S+1:C=S}while(x<C)}return x}}}function eie(){return 0}function hz(e){return null===e?NaN:+e}const nie=vx(fc).right,FC=(vx(hz),nie);function iie(e){return 0|e.length}function rie(e){return!(e>0)}function oie(e){return"object"!=typeof e||"length"in e?e:Array.from(e)}function lie(e,t){var n=0,i=0;return Float64Array.from(e,void 0===t?r=>n+=+r||0:r=>n+=+t(r,i++,e)||0)}function pz(e,t){let i,n=0,r=0,s=0;if(void 0===t)for(let u of e)null!=u&&(u=+u)>=u&&(i=u-r,r+=i/++n,s+=i*(u-r));else{let u=-1;for(let h of e)null!=(h=t(h,++u,e))&&(h=+h)>=h&&(i=h-r,r+=i/++n,s+=i*(h-r))}if(n>1)return s/(n-1)}function mz(e,t){const n=pz(e,t);return n&&Math.sqrt(n)}function Pd(e,t){let n,i;if(void 0===t)for(const r of e)null!=r&&(void 0===n?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));else{let r=-1;for(let s of e)null!=(s=t(s,++r,e))&&(void 0===n?s>=s&&(n=i=s):(n>s&&(n=s),i<s&&(i=s)))}return[n,i]}class Vg extends Map{constructor(t,n=yz){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),null!=t)for(const[i,r]of t)this.set(i,r)}get(t){return super.get(aA(this,t))}has(t){return super.has(aA(this,t))}set(t,n){return super.set(gz(this,t),n)}delete(t){return super.delete(_z(this,t))}}class sA extends Set{constructor(t,n=yz){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),null!=t)for(const i of t)this.add(i)}has(t){return super.has(aA(this,t))}add(t){return super.add(gz(this,t))}delete(t){return super.delete(_z(this,t))}}function aA({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function gz({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function _z({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function yz(e){return null!==e&&"object"==typeof e?e.valueOf():e}function lA(e){return e}function cA(e,...t){return Xy(e,lA,lA,t)}function Zy(e,t,...n){return Xy(e,lA,t,n)}function bz(e,t,...n){return Xy(e,Array.from,t,n)}function Xy(e,t,n,i){return function r(s,u){if(u>=i.length)return n(s);const h=new Vg,g=i[u++];let x=-1;for(const C of s){const S=g(C,++x,s),O=h.get(S);O?O.push(C):h.set(S,[C])}for(const[C,S]of h)h.set(C,r(S,u));return t(h)}(e,0)}function bx(e,...t){if("function"!=typeof e[Symbol.iterator])throw new TypeError("values is not iterable");e=Array.from(e);let[n]=t;if(n&&2!==n.length||t.length>1){const i=Uint32Array.from(e,(r,s)=>s);return t.length>1?(t=t.map(r=>e.map(r)),i.sort((r,s)=>{for(const u of t){const h=NC(u[r],u[s]);if(h)return h}})):(n=e.map(n),i.sort((r,s)=>NC(n[r],n[s]))),function uie(e,t){return Array.from(t,n=>e[n])}(e,i)}return e.sort(wz(n))}function wz(e=fc){if(e===fc)return NC;if("function"!=typeof e)throw new TypeError("compare is not a function");return(t,n)=>{const i=e(t,n);return i||0===i?i:(0===e(n,n))-(0===e(t,t))}}function NC(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))||(e<t?-1:e>t?1:0)}function uA(e,t,n){return(2!==t.length?bx(Zy(e,t,n),([i,r],[s,u])=>fc(r,u)||fc(i,s)):bx(cA(e,n),([i,r],[s,u])=>t(r,u)||fc(i,s))).map(([i])=>i)}function dA(e,t){let n=0;if(void 0===t)for(let i of e)null!=i&&(i=+i)>=i&&++n;else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(r=+r)>=r&&++n}return n}function Ih(e,t){let n;if(void 0===t)for(const i of e)null!=i&&(n<i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function Bf(e,t){let n;if(void 0===t)for(const i of e)null!=i&&(n>i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function Ez(e,t,n=0,i=1/0,r){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),i=Math.floor(Math.min(e.length-1,i)),!(n<=t&&t<=i))return e;for(r=void 0===r?NC:wz(r);i>n;){if(i-n>600){const g=i-n+1,x=t-n+1,C=Math.log(g),S=.5*Math.exp(2*C/3),O=.5*Math.sqrt(C*S*(g-S)/g)*(x-g/2<0?-1:1);Ez(e,t,Math.max(n,Math.floor(t-x*S/g+O)),Math.min(i,Math.floor(t+(g-x)*S/g+O)),r)}const s=e[t];let u=n,h=i;for(xx(e,n,t),r(e[i],s)>0&&xx(e,n,i);u<h;){for(xx(e,u,h),++u,--h;r(e[u],s)<0;)++u;for(;r(e[h],s)>0;)--h}0===r(e[n],s)?xx(e,n,h):(++h,xx(e,h,i)),h<=t&&(n=h+1),t<=h&&(i=h-1)}return e}function xx(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Yy(e,t,n){if(e=Float64Array.from(function*tie(e,t){if(void 0===t)for(let n of e)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)null!=(i=t(i,++n,e))&&(i=+i)>=i&&(yield i)}}(e,n)),(i=e.length)&&!isNaN(t=+t)){if(t<=0||i<2)return Bf(e);if(t>=1)return Ih(e);var i,r=(i-1)*t,s=Math.floor(r),u=Ih(Ez(e,s).subarray(0,s+1));return u+(Bf(e.subarray(s+1))-u)*(r-s)}}function die(e,t,n=hz){if((i=e.length)&&!isNaN(t=+t)){if(t<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,s=Math.floor(r),u=+n(e[s],s,e);return u+(+n(e[s+1],s+1,e)-u)*(r-s)}}function hie(e,t,n){const i=dA(e),r=Yy(e,.75)-Yy(e,.25);return i&&r?Math.ceil((n-t)/(2*r*Math.pow(i,-1/3))):1}function Cz(e,t,n){const i=dA(e),r=mz(e);return i&&r?Math.ceil((n-t)*Math.cbrt(i)/(3.49*r)):1}function fie(e){return Math.max(1,Math.ceil(Math.log(dA(e))/Math.LN2)+1)}function pie(e,t){let n,i=-1,r=-1;if(void 0===t)for(const s of e)++r,null!=s&&(n<s||void 0===n&&s>=s)&&(n=s,i=r);else for(let s of e)null!=(s=t(s,++r,e))&&(n<s||void 0===n&&s>=s)&&(n=s,i=r);return i}function mie(e,t){let n=0,i=0;if(void 0===t)for(let r of e)null!=r&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let s of e)null!=(s=t(s,++r,e))&&(s=+s)>=s&&(++n,i+=s)}if(n)return i/n}function zC(e,t){return Yy(e,.5,t)}function gie(e,t){let n,i=-1,r=-1;if(void 0===t)for(const s of e)++r,null!=s&&(n>s||void 0===n&&s>=s)&&(n=s,i=r);else for(let s of e)null!=(s=t(s,++r,e))&&(n>s||void 0===n&&s>=s)&&(n=s,i=r);return i}function _ie(e,t){const n=new Vg;if(void 0===t)for(let s of e)null!=s&&s>=s&&n.set(s,(n.get(s)||0)+1);else{let s=-1;for(let u of e)null!=(u=t(u,++s,e))&&u>=u&&n.set(u,(n.get(u)||0)+1)}let i,r=0;for(const[s,u]of n)u>r&&(r=u,i=s);return i}function vie(e,t){return[e,t]}function hA(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((t-e)/n)),s=new Array(r);++i<r;)s[i]=e+i*n;return s}function Mz(e,t=fc){let n,i=!1;if(1===t.length){let r;for(const s of e){const u=t(s);(i?fc(u,r)>0:0===fc(u,u))&&(n=s,r=u,i=!0)}}else for(const r of e)(i?t(r,n)>0:0===t(r,r))&&(n=r,i=!0);return n}function fm(e,t){let n=0;if(void 0===t)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}const bie=Math.sqrt(50),xie=Math.sqrt(10),wie=Math.sqrt(2);function BC(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),u=s>=bie?10:s>=xie?5:s>=wie?2:1;let h,g,x;return r<0?(x=Math.pow(10,-r)/u,h=Math.round(e*x),g=Math.round(t*x),h/x<e&&++h,g/x>t&&--g,x=-x):(x=Math.pow(10,r)*u,h=Math.round(e/x),g=Math.round(t/x),h*x<e&&++h,g*x>t&&--g),g<h&&.5<=n&&n<2?BC(e,t,2*n):[h,g,x]}function wx(e,t,n){if(!((n=+n)>0))return[];if((e=+e)==(t=+t))return[e];const i=t<e,[r,s,u]=i?BC(t,e,n):BC(e,t,n);if(!(s>=r))return[];const h=s-r+1,g=new Array(h);if(i)if(u<0)for(let x=0;x<h;++x)g[x]=(s-x)/-u;else for(let x=0;x<h;++x)g[x]=(s-x)*u;else if(u<0)for(let x=0;x<h;++x)g[x]=(r+x)/-u;else for(let x=0;x<h;++x)g[x]=(r+x)*u;return g}function UC(e,t,n){return BC(e=+e,t=+t,n=+n)[2]}function fA(e,t,n){n=+n;const i=(t=+t)<(e=+e),r=i?UC(t,e,n):UC(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}function VC(e){if("function"!=typeof e[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(e).reverse()}function Eie(e){return e}var jC=1,$C=2,pA=3,Ex=4,Tz=1e-6;function Cie(e){return"translate("+e+",0)"}function Mie(e){return"translate(0,"+e+")"}function Tie(e){return t=>+e(t)}function Die(e,t){return t=Math.max(0,e.bandwidth()-2*t)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function Sie(){return!this.__axis}function HC(e,t){var n=[],i=null,r=null,s=6,u=6,h=3,g=typeof window<"u"&&window.devicePixelRatio>1?0:.5,x=e===jC||e===Ex?-1:1,C=e===Ex||e===$C?"x":"y",S=e===jC||e===pA?Cie:Mie;function O(F){var $=i??(t.ticks?t.ticks.apply(t,n):t.domain()),G=r??(t.tickFormat?t.tickFormat.apply(t,n):Eie),Y=Math.max(s,0)+h,J=t.range(),Q=+J[0]+g,he=+J[J.length-1]+g,ue=(t.bandwidth?Die:Tie)(t.copy(),g),we=F.selection?F.selection():F,Ie=we.selectAll(".domain").data([null]),Qe=we.selectAll(".tick").data($,t).order(),ut=Qe.exit(),Ct=Qe.enter().append("g").attr("class","tick"),At=Qe.select("line"),at=Qe.select("text");Ie=Ie.merge(Ie.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Qe=Qe.merge(Ct),At=At.merge(Ct.append("line").attr("stroke","currentColor").attr(C+"2",x*s)),at=at.merge(Ct.append("text").attr("fill","currentColor").attr(C,x*Y).attr("dy",e===jC?"0em":e===pA?"0.71em":"0.32em")),F!==we&&(Ie=Ie.transition(F),Qe=Qe.transition(F),At=At.transition(F),at=at.transition(F),ut=ut.transition(F).attr("opacity",Tz).attr("transform",function(jt){return isFinite(jt=ue(jt))?S(jt+g):this.getAttribute("transform")}),Ct.attr("opacity",Tz).attr("transform",function(jt){var Ht=this.parentNode.__axis;return S((Ht&&isFinite(Ht=Ht(jt))?Ht:ue(jt))+g)})),ut.remove(),Ie.attr("d",e===Ex||e===$C?u?"M"+x*u+","+Q+"H"+g+"V"+he+"H"+x*u:"M"+g+","+Q+"V"+he:u?"M"+Q+","+x*u+"V"+g+"H"+he+"V"+x*u:"M"+Q+","+g+"H"+he),Qe.attr("opacity",1).attr("transform",function(jt){return S(ue(jt)+g)}),At.attr(C+"2",x*s),at.attr(C,x*Y).text(G),we.filter(Sie).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===$C?"start":e===Ex?"end":"middle"),we.each(function(){this.__axis=ue})}return O.scale=function(F){return arguments.length?(t=F,O):t},O.ticks=function(){return n=Array.from(arguments),O},O.tickArguments=function(F){return arguments.length?(n=null==F?[]:Array.from(F),O):n.slice()},O.tickValues=function(F){return arguments.length?(i=null==F?null:Array.from(F),O):i&&i.slice()},O.tickFormat=function(F){return arguments.length?(r=F,O):r},O.tickSize=function(F){return arguments.length?(s=u=+F,O):s},O.tickSizeInner=function(F){return arguments.length?(s=+F,O):s},O.tickSizeOuter=function(F){return arguments.length?(u=+F,O):u},O.tickPadding=function(F){return arguments.length?(h=+F,O):h},O.offset=function(F){return arguments.length?(g=+F,O):g},O}function Aie(){}function mA(e){return null==e?Aie:function(){return this.querySelector(e)}}function kie(){return[]}function Dz(e){return null==e?kie:function(){return this.querySelectorAll(e)}}function Sz(e){return function(){return this.matches(e)}}function Iz(e){return function(t){return t.matches(e)}}var Fie=Array.prototype.find;function zie(){return this.firstElementChild}var Uie=Array.prototype.filter;function Vie(){return Array.from(this.children)}function Az(e){return new Array(e.length)}function GC(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function Wie(e,t,n,i,r,s){for(var h,u=0,g=t.length,x=s.length;u<x;++u)(h=t[u])?(h.__data__=s[u],i[u]=h):n[u]=new GC(e,s[u]);for(;u<g;++u)(h=t[u])&&(r[u]=h)}function Zie(e,t,n,i,r,s,u){var h,g,F,x=new Map,C=t.length,S=s.length,O=new Array(C);for(h=0;h<C;++h)(g=t[h])&&(O[h]=F=u.call(g,g.__data__,h,t)+"",x.has(F)?r[h]=g:x.set(F,g));for(h=0;h<S;++h)F=u.call(e,s[h],h,s)+"",(g=x.get(F))?(i[h]=g,g.__data__=s[h],x.delete(F)):n[h]=new GC(e,s[h]);for(h=0;h<C;++h)(g=t[h])&&x.get(O[h])===g&&(r[h]=g)}function Xie(e){return e.__data__}function Kie(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function ire(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}GC.prototype={constructor:GC,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var gA="http://www.w3.org/1999/xhtml";const Ky={svg:"http://www.w3.org/2000/svg",xhtml:gA,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function qC(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Ky.hasOwnProperty(t)?{space:Ky[t],local:e}:e}function ure(e){return function(){this.removeAttribute(e)}}function dre(e){return function(){this.removeAttributeNS(e.space,e.local)}}function hre(e,t){return function(){this.setAttribute(e,t)}}function fre(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function pre(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function mre(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Pz(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function _re(e){return function(){this.style.removeProperty(e)}}function yre(e,t,n){return function(){this.style.setProperty(e,t,n)}}function vre(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function Qy(e,t){return e.style.getPropertyValue(t)||Pz(e).getComputedStyle(e,null).getPropertyValue(t)}function xre(e){return function(){delete this[e]}}function wre(e,t){return function(){this[e]=t}}function Ere(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Oz(e){return e.trim().split(/^|\s+/)}function _A(e){return e.classList||new kz(e)}function kz(e){this._node=e,this._names=Oz(e.getAttribute("class")||"")}function Rz(e,t){for(var n=_A(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function Lz(e,t){for(var n=_A(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function Mre(e){return function(){Rz(this,e)}}function Tre(e){return function(){Lz(this,e)}}function Dre(e,t){return function(){(t.apply(this,arguments)?Rz:Lz)(this,e)}}function Ire(){this.textContent=""}function Are(e){return function(){this.textContent=e}}function Pre(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function kre(){this.innerHTML=""}function Rre(e){return function(){this.innerHTML=e}}function Lre(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Nre(){this.nextSibling&&this.parentNode.appendChild(this)}function Bre(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Vre(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===gA&&t.documentElement.namespaceURI===gA?t.createElement(e):t.createElementNS(n,e)}}function jre(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function WC(e){var t=qC(e);return(t.local?jre:Vre)(t)}function Hre(){return null}function qre(){var e=this.parentNode;e&&e.removeChild(this)}function Zre(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Xre(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function eoe(e){return function(){var t=this.__on;if(t){for(var s,n=0,i=-1,r=t.length;n<r;++n)s=t[n],e.type&&s.type!==e.type||s.name!==e.name?t[++i]=s:this.removeEventListener(s.type,s.listener,s.options);++i?t.length=i:delete this.__on}}}function toe(e,t,n){return function(){var r,i=this.__on,s=function Qre(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var u=0,h=i.length;u<h;++u)if((r=i[u]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=t);this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},i?i.push(r):this.__on=[r]}}function Fz(e,t,n){var i=Pz(e),r=i.CustomEvent;"function"==typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function ioe(e,t){return function(){return Fz(this,e,t)}}function roe(e,t){return function(){return Fz(this,e,t.apply(this,arguments))}}kz.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var Nz=[null];function Zc(e,t){this._groups=e,this._parents=t}function zz(){return new Zc([[document.documentElement]],Nz)}Zc.prototype=zz.prototype={constructor:Zc,select:function Pie(e){"function"!=typeof e&&(e=mA(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var g,x,s=t[r],u=s.length,h=i[r]=new Array(u),C=0;C<u;++C)(g=s[C])&&(x=e.call(g,g.__data__,C,s))&&("__data__"in g&&(x.__data__=g.__data__),h[C]=x);return new Zc(i,this._parents)},selectAll:function Lie(e){e="function"==typeof e?function Rie(e){return function(){return function Oie(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}(e):Dz(e);for(var t=this._groups,n=t.length,i=[],r=[],s=0;s<n;++s)for(var g,u=t[s],h=u.length,x=0;x<h;++x)(g=u[x])&&(i.push(e.call(g,g.__data__,x,u)),r.push(g));return new Zc(i,r)},selectChild:function Bie(e){return this.select(null==e?zie:function Nie(e){return function(){return Fie.call(this.children,e)}}("function"==typeof e?e:Iz(e)))},selectChildren:function $ie(e){return this.selectAll(null==e?Vie:function jie(e){return function(){return Uie.call(this.children,e)}}("function"==typeof e?e:Iz(e)))},filter:function Hie(e){"function"!=typeof e&&(e=Sz(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var g,s=t[r],u=s.length,h=i[r]=[],x=0;x<u;++x)(g=s[x])&&e.call(g,g.__data__,x,s)&&h.push(g);return new Zc(i,this._parents)},data:function Yie(e,t){if(!arguments.length)return Array.from(this,Xie);var n=t?Zie:Wie,i=this._parents,r=this._groups;"function"!=typeof e&&(e=function qie(e){return function(){return e}}(e));for(var s=r.length,u=new Array(s),h=new Array(s),g=new Array(s),x=0;x<s;++x){var C=i[x],S=r[x],O=S.length,F=Kie(e.call(C,C&&C.__data__,x,i)),$=F.length,G=h[x]=new Array($),Y=u[x]=new Array($);n(C,S,G,Y,g[x]=new Array(O),F,t);for(var ue,we,Q=0,he=0;Q<$;++Q)if(ue=G[Q]){for(Q>=he&&(he=Q+1);!(we=Y[he])&&++he<$;);ue._next=we||null}}return(u=new Zc(u,i))._enter=h,u._exit=g,u},enter:function Gie(){return new Zc(this._enter||this._groups.map(Az),this._parents)},exit:function Qie(){return new Zc(this._exit||this._groups.map(Az),this._parents)},join:function Jie(e,t,n){var i=this.enter(),r=this,s=this.exit();return"function"==typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==n?s.remove():n(s),i&&r?i.merge(r).order():r},merge:function ere(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,u=Math.min(r,i.length),h=new Array(r),g=0;g<u;++g)for(var F,x=n[g],C=i[g],S=x.length,O=h[g]=new Array(S),$=0;$<S;++$)(F=x[$]||C[$])&&(O[$]=F);for(;g<r;++g)h[g]=n[g];return new Zc(h,this._parents)},selection:function aoe(){return this},order:function tre(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var u,i=e[t],r=i.length-1,s=i[r];--r>=0;)(u=i[r])&&(s&&4^u.compareDocumentPosition(s)&&s.parentNode.insertBefore(u,s),s=u);return this},sort:function nre(e){function t(S,O){return S&&O?e(S.__data__,O.__data__):!S-!O}e||(e=ire);for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var x,u=n[s],h=u.length,g=r[s]=new Array(h),C=0;C<h;++C)(x=u[C])&&(g[C]=x);g.sort(t)}return new Zc(r,this._parents).order()},call:function rre(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function ore(){return Array.from(this)},node:function sre(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var u=i[r];if(u)return u}return null},size:function are(){let e=0;for(const t of this)++e;return e},empty:function lre(){return!this.node()},each:function cre(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var h,r=t[n],s=0,u=r.length;s<u;++s)(h=r[s])&&e.call(h,h.__data__,s,r);return this},attr:function gre(e,t){var n=qC(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?dre:ure:"function"==typeof t?n.local?mre:pre:n.local?fre:hre)(n,t))},style:function bre(e,t,n){return arguments.length>1?this.each((null==t?_re:"function"==typeof t?vre:yre)(e,t,n??"")):Qy(this.node(),e)},property:function Cre(e,t){return arguments.length>1?this.each((null==t?xre:"function"==typeof t?Ere:wre)(e,t)):this.node()[e]},classed:function Sre(e,t){var n=Oz(e+"");if(arguments.length<2){for(var i=_A(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof t?Dre:t?Mre:Tre)(n,t))},text:function Ore(e){return arguments.length?this.each(null==e?Ire:("function"==typeof e?Pre:Are)(e)):this.node().textContent},html:function Fre(e){return arguments.length?this.each(null==e?kre:("function"==typeof e?Lre:Rre)(e)):this.node().innerHTML},raise:function zre(){return this.each(Nre)},lower:function Ure(){return this.each(Bre)},append:function $re(e){var t="function"==typeof e?e:WC(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function Gre(e,t){var n="function"==typeof e?e:WC(e),i=null==t?Hre:"function"==typeof t?t:mA(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function Wre(){return this.each(qre)},clone:function Yre(e){return this.select(e?Xre:Zre)},datum:function Kre(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function noe(e,t,n){var r,u,i=function Jre(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}(e+""),s=i.length;if(!(arguments.length<2)){for(h=t?toe:eoe,r=0;r<s;++r)this.each(h(i[r],t,n));return this}var h=this.node().__on;if(h)for(var C,g=0,x=h.length;g<x;++g)for(r=0,C=h[g];r<s;++r)if((u=i[r]).type===C.type&&u.name===C.name)return C.value},dispatch:function ooe(e,t){return this.each(("function"==typeof t?roe:ioe)(e,t))},[Symbol.iterator]:function*soe(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u,i=e[t],r=0,s=i.length;r<s;++r)(u=i[r])&&(yield u)}};const Cx=zz;var loe={value:()=>{}};function Bz(){for(var i,e=0,t=arguments.length,n={};e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new ZC(n)}function ZC(e){this._=e}function uoe(e,t){for(var r,n=0,i=e.length;n<i;++n)if((r=e[n]).name===t)return r.value}function Uz(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=loe,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}ZC.prototype=Bz.prototype={constructor:ZC,on:function(e,t){var r,n=this._,i=function coe(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}(e+"",n),s=-1,u=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++s<u;)if(r=(e=i[s]).type)n[r]=Uz(n[r],e.name,t);else if(null==t)for(r in n)n[r]=Uz(n[r],e.name,null);return this}for(;++s<u;)if((r=(e=i[s]).type)&&(r=uoe(n[r],e.name)))return r},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new ZC(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var r,s,n=new Array(r),i=0;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=0,r=(s=this._[e]).length;i<r;++i)s[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};const doe=Bz;var XC,Dx,Jy=0,Mx=0,Tx=0,Vz=1e3,YC=0,jg=0,KC=0,Sx="object"==typeof performance&&performance.now?performance:Date,jz="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function yA(){return jg||(jz(hoe),jg=Sx.now()+KC)}function hoe(){jg=0}function QC(){this._call=this._time=this._next=null}function $z(e,t,n){var i=new QC;return i.restart(e,t,n),i}function Hz(){jg=(YC=Sx.now())+KC,Jy=Mx=0;try{!function foe(){yA(),++Jy;for(var t,e=XC;e;)(t=jg-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Jy}()}finally{Jy=0,function moe(){for(var e,n,t=XC,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:XC=n);Dx=e,vA(i)}(),jg=0}}function poe(){var e=Sx.now(),t=e-YC;t>Vz&&(KC-=t,YC=e)}function vA(e){Jy||(Mx&&(Mx=clearTimeout(Mx)),e-jg>24?(e<1/0&&(Mx=setTimeout(Hz,e-Sx.now()-KC)),Tx&&(Tx=clearInterval(Tx))):(Tx||(YC=Sx.now(),Tx=setInterval(poe,Vz)),Jy=1,jz(Hz)))}function Gz(e,t,n){var i=new QC;return i.restart(r=>{i.stop(),e(r+t)},t=null==t?0:+t,n),i}QC.prototype=$z.prototype={constructor:QC,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?yA():+n)+(null==t?0:+t),!this._next&&Dx!==this&&(Dx?Dx._next=this:XC=this,Dx=this),this._call=e,this._time=n,vA()},stop:function(){this._call&&(this._call=null,this._time=1/0,vA())}};var goe=doe("start","end","cancel","interrupt"),_oe=[],qz=0,JC=3;function tM(e,t,n,i,r,s){var u=e.__transition;if(u){if(n in u)return}else e.__transition={};!function yoe(e,t,n){var r,i=e.__transition;function u(x){var C,S,O,F;if(1!==n.state)return g();for(C in i)if((F=i[C]).name===n.name){if(F.state===JC)return Gz(u);4===F.state?(F.state=6,F.timer.stop(),F.on.call("interrupt",e,e.__data__,F.index,F.group),delete i[C]):+C<t&&(F.state=6,F.timer.stop(),F.on.call("cancel",e,e.__data__,F.index,F.group),delete i[C])}if(Gz(function(){n.state===JC&&(n.state=4,n.timer.restart(h,n.delay,n.time),h(x))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=JC,r=new Array(O=n.tween.length),C=0,S=-1;C<O;++C)(F=n.tween[C].value.call(e,e.__data__,n.index,n.group))&&(r[++S]=F);r.length=S+1}}function h(x){for(var C=x<n.duration?n.ease.call(null,x/n.duration):(n.timer.restart(g),n.state=5,1),S=-1,O=r.length;++S<O;)r[S].call(e,C);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),g())}function g(){for(var x in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=$z(function s(x){n.state=1,n.timer.restart(u,n.delay,n.time),n.delay<=x&&u(x-n.delay)},0,n.time)}(e,n,{name:t,index:i,group:r,on:goe,tween:_oe,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:qz})}function wA(e,t){var n=Od(e,t);if(n.state>qz)throw new Error("too late; already scheduled");return n}function Ah(e,t){var n=Od(e,t);if(n.state>JC)throw new Error("too late; already running");return n}function Od(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function al(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var nM,Xz=180/Math.PI,EA={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Yz(e,t,n,i,r,s){var u,h,g;return(u=Math.sqrt(e*e+t*t))&&(e/=u,t/=u),(g=e*n+t*i)&&(n-=e*g,i-=t*g),(h=Math.sqrt(n*n+i*i))&&(n/=h,i/=h,g/=h),e*i<t*n&&(e=-e,t=-t,g=-g,u=-u),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*Xz,skewX:Math.atan(g)*Xz,scaleX:u,scaleY:h}}function Kz(e,t,n,i){function r(x){return x.length?x.pop()+" ":""}return function(x,C){var S=[],O=[];return x=e(x),C=e(C),function s(x,C,S,O,F,$){if(x!==S||C!==O){var G=F.push("translate(",null,t,null,n);$.push({i:G-4,x:al(x,S)},{i:G-2,x:al(C,O)})}else(S||O)&&F.push("translate("+S+t+O+n)}(x.translateX,x.translateY,C.translateX,C.translateY,S,O),function u(x,C,S,O){x!==C?(x-C>180?C+=360:C-x>180&&(x+=360),O.push({i:S.push(r(S)+"rotate(",null,i)-2,x:al(x,C)})):C&&S.push(r(S)+"rotate("+C+i)}(x.rotate,C.rotate,S,O),function h(x,C,S,O){x!==C?O.push({i:S.push(r(S)+"skewX(",null,i)-2,x:al(x,C)}):C&&S.push(r(S)+"skewX("+C+i)}(x.skewX,C.skewX,S,O),function g(x,C,S,O,F,$){if(x!==S||C!==O){var G=F.push(r(F)+"scale(",null,",",null,")");$.push({i:G-4,x:al(x,S)},{i:G-2,x:al(C,O)})}else(1!==S||1!==O)&&F.push(r(F)+"scale("+S+","+O+")")}(x.scaleX,x.scaleY,C.scaleX,C.scaleY,S,O),x=C=null,function(F){for(var Y,$=-1,G=O.length;++$<G;)S[(Y=O[$]).i]=Y.x(F);return S.join("")}}}var Eoe=Kz(function xoe(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?EA:Yz(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),Coe=Kz(function woe(e){return null!=e&&(nM||(nM=document.createElementNS("http://www.w3.org/2000/svg","g")),nM.setAttribute("transform",e),e=nM.transform.baseVal.consolidate())?Yz((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):EA},", ",")",")");function Moe(e,t){var n,i;return function(){var r=Ah(this,e),s=r.tween;if(s!==n)for(var u=0,h=(i=n=s).length;u<h;++u)if(i[u].name===t){(i=i.slice()).splice(u,1);break}r.tween=i}}function Toe(e,t,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var s=Ah(this,e),u=s.tween;if(u!==i){r=(i=u).slice();for(var h={name:t,value:n},g=0,x=r.length;g<x;++g)if(r[g].name===t){r[g]=h;break}g===x&&r.push(h)}s.tween=r}}function CA(e,t,n){var i=e._id;return e.each(function(){var r=Ah(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Od(r,i).value[t]}}function e0(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ix(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function pm(){}var t0=1/.7,n0="\\s*([+-]?\\d+)\\s*",Ax="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ph="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Soe=/^#([0-9a-f]{3,8})$/,Ioe=new RegExp(`^rgb\\(${n0},${n0},${n0}\\)$`),Aoe=new RegExp(`^rgb\\(${Ph},${Ph},${Ph}\\)$`),Poe=new RegExp(`^rgba\\(${n0},${n0},${n0},${Ax}\\)$`),Ooe=new RegExp(`^rgba\\(${Ph},${Ph},${Ph},${Ax}\\)$`),koe=new RegExp(`^hsl\\(${Ax},${Ph},${Ph}\\)$`),Roe=new RegExp(`^hsla\\(${Ax},${Ph},${Ph},${Ax}\\)$`),Qz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Jz(){return this.rgb().formatHex()}function eB(){return this.rgb().formatRgb()}function mm(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Soe.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?tB(t):3===n?new ya(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?iM(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?iM(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Ioe.exec(e))?new ya(t[1],t[2],t[3],1):(t=Aoe.exec(e))?new ya(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Poe.exec(e))?iM(t[1],t[2],t[3],t[4]):(t=Ooe.exec(e))?iM(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=koe.exec(e))?rB(t[1],t[2]/100,t[3]/100,1):(t=Roe.exec(e))?rB(t[1],t[2]/100,t[3]/100,t[4]):Qz.hasOwnProperty(e)?tB(Qz[e]):"transparent"===e?new ya(NaN,NaN,NaN,0):null}function tB(e){return new ya(e>>16&255,e>>8&255,255&e,1)}function iM(e,t,n,i){return i<=0&&(e=t=n=NaN),new ya(e,t,n,i)}function MA(e){return e instanceof pm||(e=mm(e)),e?new ya((e=e.rgb()).r,e.g,e.b,e.opacity):new ya}function gm(e,t,n,i){return 1===arguments.length?MA(e):new ya(e,t,n,i??1)}function ya(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function nB(){return`#${Gg(this.r)}${Gg(this.g)}${Gg(this.b)}`}function iB(){const e=rM(this.opacity);return`${1===e?"rgb(":"rgba("}${Hg(this.r)}, ${Hg(this.g)}, ${Hg(this.b)}${1===e?")":`, ${e})`}`}function rM(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Hg(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Gg(e){return((e=Hg(e))<16?"0":"")+e.toString(16)}function rB(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new kd(e,t,n,i)}function oB(e){if(e instanceof kd)return new kd(e.h,e.s,e.l,e.opacity);if(e instanceof pm||(e=mm(e)),!e)return new kd;if(e instanceof kd)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),u=NaN,h=s-r,g=(s+r)/2;return h?(u=t===s?(n-i)/h+6*(n<i):n===s?(i-t)/h+2:(t-n)/h+4,h/=g<.5?s+r:2-s-r,u*=60):h=g>0&&g<1?0:u,new kd(u,h,g,e.opacity)}function TA(e,t,n,i){return 1===arguments.length?oB(e):new kd(e,t,n,i??1)}function kd(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function sB(e){return(e=(e||0)%360)<0?e+360:e}function oM(e){return Math.max(0,Math.min(1,e||0))}function DA(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function aB(e,t,n,i,r){var s=e*e,u=s*e;return((1-3*e+3*s-u)*t+(4-6*s+3*u)*n+(1+3*e+3*s-3*u)*i+u*r)/6}e0(pm,mm,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Jz,formatHex:Jz,formatHex8:function Loe(){return this.rgb().formatHex8()},formatHsl:function Foe(){return oB(this).formatHsl()},formatRgb:eB,toString:eB}),e0(ya,gm,Ix(pm,{brighter(e){return e=null==e?t0:Math.pow(t0,e),new ya(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new ya(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ya(Hg(this.r),Hg(this.g),Hg(this.b),rM(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:nB,formatHex:nB,formatHex8:function Noe(){return`#${Gg(this.r)}${Gg(this.g)}${Gg(this.b)}${Gg(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:iB,toString:iB})),e0(kd,TA,Ix(pm,{brighter(e){return e=null==e?t0:Math.pow(t0,e),new kd(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new kd(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new ya(DA(e>=240?e-240:e+120,r,i),DA(e,r,i),DA(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new kd(sB(this.h),oM(this.s),oM(this.l),rM(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=rM(this.opacity);return`${1===e?"hsl(":"hsla("}${sB(this.h)}, ${100*oM(this.s)}%, ${100*oM(this.l)}%${1===e?")":`, ${e})`}`}}));const sM=e=>()=>e;function lB(e,t){return function(n){return e+n*t}}function SA(e,t){var n=t-e;return n?lB(e,n>180||n<-180?n-360*Math.round(n/360):n):sM(isNaN(e)?t:e)}function va(e,t){var n=t-e;return n?lB(e,n):sM(isNaN(e)?t:e)}const qg=function e(t){var n=function Voe(e){return 1==(e=+e)?va:function(t,n){return n-t?function Uoe(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):sM(isNaN(t)?n:t)}}(t);function i(r,s){var u=n((r=gm(r)).r,(s=gm(s)).r),h=n(r.g,s.g),g=n(r.b,s.b),x=va(r.opacity,s.opacity);return function(C){return r.r=u(C),r.g=h(C),r.b=g(C),r.opacity=x(C),r+""}}return i.gamma=e,i}(1);function cB(e){return function(t){var u,h,n=t.length,i=new Array(n),r=new Array(n),s=new Array(n);for(u=0;u<n;++u)h=gm(t[u]),i[u]=h.r||0,r[u]=h.g||0,s[u]=h.b||0;return i=e(i),r=e(r),s=e(s),h.opacity=1,function(g){return h.r=i(g),h.g=r(g),h.b=s(g),h+""}}}var joe=cB(function zoe(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],s=e[i+1];return aB((n-i/t)*t,i>0?e[i-1]:2*r-s,r,s,i<t-1?e[i+2]:2*s-r)}}),IA=(cB(function Boe(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t);return aB((n-i/t)*t,e[(i+t-1)%t],e[i%t],e[(i+1)%t],e[(i+2)%t])}}),/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g),AA=new RegExp(IA.source,"g");function uB(e,t){var i,r,s,n=IA.lastIndex=AA.lastIndex=0,u=-1,h=[],g=[];for(e+="",t+="";(i=IA.exec(e))&&(r=AA.exec(t));)(s=r.index)>n&&(s=t.slice(n,s),h[u]?h[u]+=s:h[++u]=s),(i=i[0])===(r=r[0])?h[u]?h[u]+=r:h[++u]=r:(h[++u]=null,g.push({i:u,x:al(i,r)})),n=AA.lastIndex;return n<t.length&&(s=t.slice(n),h[u]?h[u]+=s:h[++u]=s),h.length<2?g[0]?function Hoe(e){return function(t){return e(t)+""}}(g[0].x):function $oe(e){return function(){return e}}(t):(t=g.length,function(x){for(var S,C=0;C<t;++C)h[(S=g[C]).i]=S.x(x);return h.join("")})}function dB(e,t){var n;return("number"==typeof t?al:t instanceof mm?qg:(n=mm(t))?(t=n,qg):uB)(e,t)}function Goe(e){return function(){this.removeAttribute(e)}}function qoe(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Woe(e,t,n){var i,s,r=n+"";return function(){var u=this.getAttribute(e);return u===r?null:u===i?s:s=t(i=u,n)}}function Zoe(e,t,n){var i,s,r=n+"";return function(){var u=this.getAttributeNS(e.space,e.local);return u===r?null:u===i?s:s=t(i=u,n)}}function Xoe(e,t,n){var i,r,s;return function(){var u,g,h=n(this);return null==h?void this.removeAttribute(e):(u=this.getAttribute(e))===(g=h+"")?null:u===i&&g===r?s:(r=g,s=t(i=u,h))}}function Yoe(e,t,n){var i,r,s;return function(){var u,g,h=n(this);return null==h?void this.removeAttributeNS(e.space,e.local):(u=this.getAttributeNS(e.space,e.local))===(g=h+"")?null:u===i&&g===r?s:(r=g,s=t(i=u,h))}}function ese(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&function Joe(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,s)),n}return r._value=t,r}function tse(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&function Qoe(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,s)),n}return r._value=t,r}function ise(e,t){return function(){wA(this,e).delay=+t.apply(this,arguments)}}function rse(e,t){return t=+t,function(){wA(this,e).delay=t}}function sse(e,t){return function(){Ah(this,e).duration=+t.apply(this,arguments)}}function ase(e,t){return t=+t,function(){Ah(this,e).duration=t}}var wse=Cx.prototype.constructor;function hB(e){return function(){this.style.removeProperty(e)}}var Use=0;function Uf(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function fB(){return++Use}var Vf=Cx.prototype;Uf.prototype=function Vse(e){return Cx().transition(e)}.prototype={constructor:Uf,select:function bse(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=mA(e));for(var i=this._groups,r=i.length,s=new Array(r),u=0;u<r;++u)for(var C,S,h=i[u],g=h.length,x=s[u]=new Array(g),O=0;O<g;++O)(C=h[O])&&(S=e.call(C,C.__data__,O,h))&&("__data__"in C&&(S.__data__=C.__data__),x[O]=S,tM(x[O],t,n,O,x,Od(C,n)));return new Uf(s,this._parents,t,n)},selectAll:function xse(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=Dz(e));for(var i=this._groups,r=i.length,s=[],u=[],h=0;h<r;++h)for(var C,g=i[h],x=g.length,S=0;S<x;++S)if(C=g[S]){for(var F,O=e.call(C,C.__data__,S,g),$=Od(C,n),G=0,Y=O.length;G<Y;++G)(F=O[G])&&tM(F,t,n,G,O,$);s.push(O),u.push(C)}return new Uf(s,u,t,n)},selectChild:Vf.selectChild,selectChildren:Vf.selectChildren,filter:function fse(e){"function"!=typeof e&&(e=Sz(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var g,s=t[r],u=s.length,h=i[r]=[],x=0;x<u;++x)(g=s[x])&&e.call(g,g.__data__,x,s)&&h.push(g);return new Uf(i,this._parents,this._name,this._id)},merge:function pse(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,s=Math.min(i,n.length),u=new Array(i),h=0;h<s;++h)for(var O,g=t[h],x=n[h],C=g.length,S=u[h]=new Array(C),F=0;F<C;++F)(O=g[F]||x[F])&&(S[F]=O);for(;h<i;++h)u[h]=t[h];return new Uf(u,this._parents,this._name,this._id)},selection:function Ese(){return new wse(this._groups,this._parents)},transition:function zse(){for(var e=this._name,t=this._id,n=fB(),i=this._groups,r=i.length,s=0;s<r;++s)for(var g,u=i[s],h=u.length,x=0;x<h;++x)if(g=u[x]){var C=Od(g,t);tM(g,e,n,x,u,{time:C.time+C.delay+C.duration,delay:0,duration:C.duration,ease:C.ease})}return new Uf(i,this._parents,e,n)},call:Vf.call,nodes:Vf.nodes,node:Vf.node,size:Vf.size,empty:Vf.empty,each:Vf.each,on:function _se(e,t){var n=this._id;return arguments.length<2?Od(this.node(),n).on.on(e):this.each(function gse(e,t,n){var i,r,s=function mse(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||"start"===t})}(t)?wA:Ah;return function(){var u=s(this,e),h=u.on;h!==i&&(r=(i=h).copy()).on(t,n),u.on=r}}(n,e,t))},attr:function Koe(e,t){var n=qC(e),i="transform"===n?Coe:dB;return this.attrTween(e,"function"==typeof t?(n.local?Yoe:Xoe)(n,i,CA(this,"attr."+e,t)):null==t?(n.local?qoe:Goe)(n):(n.local?Zoe:Woe)(n,i,t))},attrTween:function nse(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var i=qC(e);return this.tween(n,(i.local?ese:tse)(i,t))},style:function Sse(e,t,n){var i="transform"==(e+="")?Eoe:dB;return null==t?this.styleTween(e,function Cse(e,t){var n,i,r;return function(){var s=Qy(this,e),u=(this.style.removeProperty(e),Qy(this,e));return s===u?null:s===n&&u===i?r:r=t(n=s,i=u)}}(e,i)).on("end.style."+e,hB(e)):"function"==typeof t?this.styleTween(e,function Tse(e,t,n){var i,r,s;return function(){var u=Qy(this,e),h=n(this),g=h+"";return null==h&&(this.style.removeProperty(e),g=h=Qy(this,e)),u===g?null:u===i&&g===r?s:(r=g,s=t(i=u,h))}}(e,i,CA(this,"style."+e,t))).each(function Dse(e,t){var n,i,r,h,s="style."+t,u="end."+s;return function(){var g=Ah(this,e),x=g.on,C=null==g.value[s]?h||(h=hB(t)):void 0;(x!==n||r!==C)&&(i=(n=x).copy()).on(u,r=C),g.on=i}}(this._id,e)):this.styleTween(e,function Mse(e,t,n){var i,s,r=n+"";return function(){var u=Qy(this,e);return u===r?null:u===i?s:s=t(i=u,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function Pse(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw new Error;return this.tween(i,function Ase(e,t,n){var i,r;function s(){var u=t.apply(this,arguments);return u!==r&&(i=(r=u)&&function Ise(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}(e,u,n)),i}return s._value=t,s}(e,t,n??""))},text:function Rse(e){return this.tween("text","function"==typeof e?function kse(e){return function(){var t=e(this);this.textContent=t??""}}(CA(this,"text",e)):function Ose(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function Nse(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function Fse(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&function Lse(e){return function(t){this.textContent=e.call(this,t)}}(r)),t}return i._value=e,i}(e))},remove:function vse(){return this.on("end.remove",function yse(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function Doe(e,t){var n=this._id;if(e+="",arguments.length<2){for(var u,i=Od(this.node(),n).tween,r=0,s=i.length;r<s;++r)if((u=i[r]).name===e)return u.value;return null}return this.each((null==t?Moe:Toe)(n,e,t))},delay:function ose(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?ise:rse)(t,e)):Od(this.node(),t).delay},duration:function lse(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?sse:ase)(t,e)):Od(this.node(),t).duration},ease:function use(e){var t=this._id;return arguments.length?this.each(function cse(e,t){if("function"!=typeof t)throw new Error;return function(){Ah(this,e).ease=t}}(t,e)):Od(this.node(),t).ease},easeVarying:function hse(e){if("function"!=typeof e)throw new Error;return this.each(function dse(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Ah(this,e).ease=n}}(this._id,e))},end:function Bse(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(s,u){var h={value:u},g={value:function(){0==--r&&s()}};n.each(function(){var x=Ah(this,i),C=x.on;C!==e&&((t=(e=C).copy())._.cancel.push(h),t._.interrupt.push(h),t._.end.push(g)),x.on=t}),0===r&&s()})},[Symbol.iterator]:Vf[Symbol.iterator]};var $se={time:null,delay:0,duration:250,ease:function jse(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Hse(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}Cx.prototype.interrupt=function boe(e){return this.each(function(){!function voe(e,t){var i,r,u,n=e.__transition,s=!0;if(n){for(u in t=null==t?null:t+"",n)(i=n[u]).name===t?(r=i.state>2&&i.state<5,i.state=6,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[u]):s=!1;s&&delete e.__transition}}(this,e)})},Cx.prototype.transition=function Gse(e){var t,n;e instanceof Uf?(t=e._id,e=e._name):(t=fB(),(n=$se).time=yA(),e=null==e?null:e+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var g,u=i[s],h=u.length,x=0;x<h;++x)(g=u[x])&&tM(g,e,t,x,u,n||Hse(g,t));return new Uf(i,this._parents,e,t)};Math;function Px(e){return{type:e}}function cM(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function s0(e){return(e=cM(Math.abs(e)))?e[1]:NaN}["w","e"].map(Px),["n","s"].map(Px),["n","w","e","s","nw","ne","sw","se"].map(Px);var vB,nae=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ox(e){if(!(t=nae.exec(e)))throw new Error("invalid format: "+e);var t;return new LA({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function LA(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function bB(e,t){var n=cM(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}Ox.prototype=LA.prototype,LA.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const xB={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function Jse(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>bB(100*e,t),r:bB,s:function rae(e,t){var n=cM(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(vB=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,u=i.length;return s===u?i:s>u?i+new Array(s-u+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+cM(e,Math.max(0,t+s-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function wB(e){return e}var uM,kx,MB,EB=Array.prototype.map,CB=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];!function sae(e){uM=function oae(e){var t=void 0===e.grouping||void 0===e.thousands?wB:function eae(e,t){return function(n,i){for(var r=n.length,s=[],u=0,h=e[0],g=0;r>0&&h>0&&(g+h+1>i&&(h=Math.max(1,i-g)),s.push(n.substring(r-=h,r+h)),!((g+=h+1)>i));)h=e[u=(u+1)%e.length];return s.reverse().join(t)}}(EB.call(e.grouping,Number),e.thousands+""),n=void 0===e.currency?"":e.currency[0]+"",i=void 0===e.currency?"":e.currency[1]+"",r=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?wB:function tae(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}(EB.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",h=void 0===e.minus?"\u2212":e.minus+"",g=void 0===e.nan?"NaN":e.nan+"";function x(S){var O=(S=Ox(S)).fill,F=S.align,$=S.sign,G=S.symbol,Y=S.zero,J=S.width,Q=S.comma,he=S.precision,ue=S.trim,we=S.type;"n"===we?(Q=!0,we="g"):xB[we]||(void 0===he&&(he=12),ue=!0,we="g"),(Y||"0"===O&&"="===F)&&(Y=!0,O="0",F="=");var Ie="$"===G?n:"#"===G&&/[boxX]/.test(we)?"0"+we.toLowerCase():"",Qe="$"===G?i:/[%p]/.test(we)?u:"",ut=xB[we],Ct=/[defgprs%]/.test(we);function At(at){var Ae,Ne,ge,jt=Ie,Ht=Qe;if("c"===we)Ht=ut(at)+Ht,at="";else{var Re=(at=+at)<0||1/at<0;if(at=isNaN(at)?g:ut(Math.abs(at),he),ue&&(at=function iae(e){e:for(var r,t=e.length,n=1,i=-1;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":0===i&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(r+1):e}(at)),Re&&0==+at&&"+"!==$&&(Re=!1),jt=(Re?"("===$?$:h:"-"===$||"("===$?"":$)+jt,Ht=("s"===we?CB[8+vB/3]:"")+Ht+(Re&&"("===$?")":""),Ct)for(Ae=-1,Ne=at.length;++Ae<Ne;)if(48>(ge=at.charCodeAt(Ae))||ge>57){Ht=(46===ge?r+at.slice(Ae+1):at.slice(Ae))+Ht,at=at.slice(0,Ae);break}}Q&&!Y&&(at=t(at,1/0));var We=jt.length+at.length+Ht.length,Ye=We<J?new Array(J-We+1).join(O):"";switch(Q&&Y&&(at=t(Ye+at,Ye.length?J-Ht.length:1/0),Ye=""),F){case"<":at=jt+at+Ht+Ye;break;case"=":at=jt+Ye+at+Ht;break;case"^":at=Ye.slice(0,We=Ye.length>>1)+jt+at+Ht+Ye.slice(We);break;default:at=Ye+jt+at+Ht}return s(at)}return he=void 0===he?6:/[gprs]/.test(we)?Math.max(1,Math.min(21,he)):Math.max(0,Math.min(20,he)),At.toString=function(){return S+""},At}return{format:x,formatPrefix:function C(S,O){var F=x(((S=Ox(S)).type="f",S)),$=3*Math.max(-8,Math.min(8,Math.floor(s0(O)/3))),G=Math.pow(10,-$),Y=CB[8+$/3];return function(J){return F(G*J)+Y}}}}(e),kx=uM.format,MB=uM.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});var Oi=1e-6,TB=1e-12,Gi=Math.PI,Vo=Gi/2,DB=Gi/4,Xc=2*Gi,Nl=180/Gi,jo=Gi/180,Hr=Math.abs,a0=Math.atan,$f=Math.atan2,ji=Math.cos,SB=(Math,Math.exp),dM=(Math,Math,Math.log),FA=Math.pow,xi=Math.sin,Ou=Math.sign||function(e){return e>0?1:e<0?-1:0},pc=Math.sqrt,NA=Math.tan;function IB(e){return e>1?0:e<-1?Gi:Math.acos(e)}function ku(e){return e>1?Vo:e<-1?-Vo:Math.asin(e)}function Ru(){}function AB(){var t,e=[];return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:Ru,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function hM(e,t){return Hr(e[0]-t[0])<Oi&&Hr(e[1]-t[1])<Oi}function fM(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function PB(e,t,n,i,r){var h,g,s=[],u=[];if(e.forEach(function($){if(!((G=$.length-1)<=0)){var G,Q,Y=$[0],J=$[G];if(hM(Y,J)){if(!Y[2]&&!J[2]){for(r.lineStart(),h=0;h<G;++h)r.point((Y=$[h])[0],Y[1]);return void r.lineEnd()}J[0]+=2*Oi}s.push(Q=new fM(Y,$,null,!0)),u.push(Q.o=new fM(Y,null,Q,!1)),s.push(Q=new fM(J,$,null,!1)),u.push(Q.o=new fM(J,null,Q,!0))}}),s.length){for(u.sort(t),OB(s),OB(u),h=0,g=u.length;h<g;++h)u[h].e=n=!n;for(var C,S,x=s[0];;){for(var O=x,F=!0;O.v;)if((O=O.n)===x)return;C=O.z,r.lineStart();do{if(O.v=O.o.v=!0,O.e){if(F)for(h=0,g=C.length;h<g;++h)r.point((S=C[h])[0],S[1]);else i(O.x,O.n.x,1,r);O=O.n}else{if(F)for(h=(C=O.p.z).length-1;h>=0;--h)r.point((S=C[h])[0],S[1]);else i(O.x,O.p.x,-1,r);O=O.p}C=(O=O.o).z,F=!F}while(!O.v);r.lineEnd()}}}function OB(e){if(t=e.length){for(var t,r,n=0,i=e[0];++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function kB(e){return Array.from(function*lae(e){for(const t of e)yield*t}(e))}var Rx=1e9,pM=-Rx;function RB(e,t,n,i){function r(x,C){return e<=x&&x<=n&&t<=C&&C<=i}function s(x,C,S,O){var F=0,$=0;if(null==x||(F=u(x,S))!==($=u(C,S))||g(x,C)<0^S>0)do{O.point(0===F||3===F?e:n,F>1?i:t)}while((F=(F+S+4)%4)!==$);else O.point(C[0],C[1])}function u(x,C){return Hr(x[0]-e)<Oi?C>0?0:3:Hr(x[0]-n)<Oi?C>0?2:1:Hr(x[1]-t)<Oi?C>0?1:0:C>0?3:2}function h(x,C){return g(x.x,C.x)}function g(x,C){var S=u(x,1),O=u(C,1);return S!==O?S-O:0===S?C[1]-x[1]:1===S?x[0]-C[0]:2===S?x[1]-C[1]:C[0]-x[0]}return function(x){var O,F,$,G,Y,J,Q,he,ue,we,Ie,C=x,S=AB(),Qe={point:ut,lineStart:function jt(){Qe.point=Ae,F&&F.push($=[]),we=!0,ue=!1,Q=he=NaN},lineEnd:function Ht(){O&&(Ae(G,Y),J&&ue&&S.rejoin(),O.push(S.result())),Qe.point=ut,ue&&C.lineEnd()},polygonStart:function At(){C=S,O=[],F=[],Ie=!0},polygonEnd:function at(){var Ne=function Ct(){for(var Ne=0,ge=0,Re=F.length;ge<Re;++ge)for(var Lt,Dn,We=F[ge],Ye=1,Dt=We.length,Bt=We[0],fn=Bt[0],qi=Bt[1];Ye<Dt;++Ye)Lt=fn,Dn=qi,fn=(Bt=We[Ye])[0],qi=Bt[1],Dn<=i?qi>i&&(fn-Lt)*(i-Dn)>(qi-Dn)*(e-Lt)&&++Ne:qi<=i&&(fn-Lt)*(i-Dn)<(qi-Dn)*(e-Lt)&&--Ne;return Ne}(),ge=Ie&&Ne,Re=(O=kB(O)).length;(ge||Re)&&(x.polygonStart(),ge&&(x.lineStart(),s(null,null,1,x),x.lineEnd()),Re&&PB(O,h,Ne,s,x),x.polygonEnd()),C=x,O=F=$=null}};function ut(Ne,ge){r(Ne,ge)&&C.point(Ne,ge)}function Ae(Ne,ge){var Re=r(Ne,ge);if(F&&$.push([Ne,ge]),we)G=Ne,Y=ge,J=Re,we=!1,Re&&(C.lineStart(),C.point(Ne,ge));else if(Re&&ue)C.point(Ne,ge);else{var We=[Q=Math.max(pM,Math.min(Rx,Q)),he=Math.max(pM,Math.min(Rx,he))],Ye=[Ne=Math.max(pM,Math.min(Rx,Ne)),ge=Math.max(pM,Math.min(Rx,ge))];!function aae(e,t,n,i,r,s){var $,u=e[0],h=e[1],C=0,S=1,O=t[0]-u,F=t[1]-h;if($=n-u,O||!($>0)){if($/=O,O<0){if($<C)return;$<S&&(S=$)}else if(O>0){if($>S)return;$>C&&(C=$)}if($=r-u,O||!($<0)){if($/=O,O<0){if($>S)return;$>C&&(C=$)}else if(O>0){if($<C)return;$<S&&(S=$)}if($=i-h,F||!($>0)){if($/=F,F<0){if($<C)return;$<S&&(S=$)}else if(F>0){if($>S)return;$>C&&(C=$)}if($=s-h,F||!($<0)){if($/=F,F<0){if($>S)return;$>C&&(C=$)}else if(F>0){if($<C)return;$<S&&(S=$)}return C>0&&(e[0]=u+C*O,e[1]=h+C*F),S<1&&(t[0]=u+S*O,t[1]=h+S*F),!0}}}}}(We,Ye,e,t,n,i)?Re&&(C.lineStart(),C.point(Ne,ge),Ie=!1):(ue||(C.lineStart(),C.point(We[0],We[1])),C.point(Ye[0],Ye[1]),Re||C.lineEnd(),Ie=!1)}Q=Ne,he=ge,ue=Re}return Qe}}const zA=e=>e;function mM(e,t){e&&FB.hasOwnProperty(e.type)&&FB[e.type](e,t)}var LB={Feature:function(e,t){mM(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)mM(n[i].geometry,t)}},FB={Sphere:function(e,t){t.sphere()},Point:function(e,t){t.point((e=e.coordinates)[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)t.point((e=n[i])[0],e[1],e[2])},LineString:function(e,t){BA(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)BA(n[i],t,0)},Polygon:function(e,t){NB(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)NB(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)mM(n[i],t)}};function BA(e,t,n){var s,i=-1,r=e.length-n;for(t.lineStart();++i<r;)t.point((s=e[i])[0],s[1],s[2]);t.lineEnd()}function NB(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)BA(e[n],t,1);t.polygonEnd()}function Wg(e,t){e&&LB.hasOwnProperty(e.type)?LB[e.type](e,t):mM(e,t)}class Hf{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const s=n[r],u=t+s,h=Math.abs(t)<Math.abs(s)?t-(u-s):s-(u-t);h&&(n[i++]=h),t=u}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let i,r,s,n=this._n,u=0;if(n>0){for(u=t[--n];n>0&&(i=u,r=t[--n],u=i+r,s=r-(u-i),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(r=2*s,i=u+r,r==i-u&&(u=i))}return u}}var zB,BB,jA,$A,UA=new Hf,VA=new Hf,_m={point:Ru,lineStart:Ru,lineEnd:Ru,polygonStart:function(){_m.lineStart=cae,_m.lineEnd=dae},polygonEnd:function(){_m.lineStart=_m.lineEnd=_m.point=Ru,UA.add(Hr(VA)),VA=new Hf},result:function(){var e=UA/2;return UA=new Hf,e}};function cae(){_m.point=uae}function uae(e,t){_m.point=UB,zB=jA=e,BB=$A=t}function UB(e,t){VA.add($A*e-jA*t),jA=e,$A=t}function dae(){UB(zB,BB)}const VB=_m;var l0=1/0,gM=l0,Lx=-l0,_M=Lx;const yM={point:function fae(e,t){e<l0&&(l0=e),e>Lx&&(Lx=e),t<gM&&(gM=t),t>_M&&(_M=t)},lineStart:Ru,lineEnd:Ru,polygonStart:Ru,polygonEnd:Ru,result:function(){var e=[[l0,gM],[Lx,_M]];return Lx=_M=-(gM=l0=1/0),e}};var jB,$B,Oh,kh,HA=0,GA=0,Fx=0,vM=0,bM=0,c0=0,qA=0,WA=0,Nx=0,Rd={point:Zg,lineStart:HB,lineEnd:GB,polygonStart:function(){Rd.lineStart=gae,Rd.lineEnd=_ae},polygonEnd:function(){Rd.point=Zg,Rd.lineStart=HB,Rd.lineEnd=GB},result:function(){var e=Nx?[qA/Nx,WA/Nx]:c0?[vM/c0,bM/c0]:Fx?[HA/Fx,GA/Fx]:[NaN,NaN];return HA=GA=Fx=vM=bM=c0=qA=WA=Nx=0,e}};function Zg(e,t){HA+=e,GA+=t,++Fx}function HB(){Rd.point=pae}function pae(e,t){Rd.point=mae,Zg(Oh=e,kh=t)}function mae(e,t){var n=e-Oh,i=t-kh,r=pc(n*n+i*i);vM+=r*(Oh+e)/2,bM+=r*(kh+t)/2,c0+=r,Zg(Oh=e,kh=t)}function GB(){Rd.point=Zg}function gae(){Rd.point=yae}function _ae(){qB(jB,$B)}function yae(e,t){Rd.point=qB,Zg(jB=Oh=e,$B=kh=t)}function qB(e,t){var n=e-Oh,i=t-kh,r=pc(n*n+i*i);vM+=r*(Oh+e)/2,bM+=r*(kh+t)/2,c0+=r,qA+=(r=kh*e-Oh*t)*(Oh+e),WA+=r*(kh+t),Nx+=3*r,Zg(Oh=e,kh=t)}const WB=Rd;function ZB(e){this._context=e}ZB.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Xc)}},result:Ru};var XA,XB,YB,zx,Bx,ZA=new Hf,xM={point:Ru,lineStart:function(){xM.point=vae},lineEnd:function(){XA&&KB(XB,YB),xM.point=Ru},polygonStart:function(){XA=!0},polygonEnd:function(){XA=null},result:function(){var e=+ZA;return ZA=new Hf,e}};function vae(e,t){xM.point=KB,XB=zx=e,YB=Bx=t}function KB(e,t){ZA.add(pc((zx-=e)*zx+(Bx-=t)*Bx)),zx=e,Bx=t}const QB=xM;let JB,wM,e6,t6;class n6{constructor(t){this._append=null==t?i6:function bae(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return i6;if(t!==JB){const n=10**t;JB=t,wM=function(r){let s=1;this._+=r[0];for(const u=r.length;s<u;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}return wM}(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:this._append`M${t},${n}`,this._point=1;break;case 1:this._append`L${t},${n}`;break;default:if(this._append`M${t},${n}`,this._radius!==e6||this._append!==wM){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,e6=i,wM=this._append,t6=this._,this._=r}this._+=t6}}result(){const t=this._;return this._="",t.length?t:null}}function i6(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function r6(e,t){let r,s,n=3,i=4.5;function u(h){return h&&("function"==typeof i&&s.pointRadius(+i.apply(this,arguments)),Wg(h,r(s))),s.result()}return u.area=function(h){return Wg(h,r(VB)),VB.result()},u.measure=function(h){return Wg(h,r(QB)),QB.result()},u.bounds=function(h){return Wg(h,r(yM)),yM.result()},u.centroid=function(h){return Wg(h,r(WB)),WB.result()},u.projection=function(h){return arguments.length?(r=null==h?(e=null,zA):(e=h).stream,u):e},u.context=function(h){return arguments.length?(s=null==h?(t=null,new n6(n)):new ZB(t=h),"function"!=typeof i&&s.pointRadius(i),u):t},u.pointRadius=function(h){return arguments.length?(i="function"==typeof h?h:(s.pointRadius(+h),+h),u):i},u.digits=function(h){if(!arguments.length)return n;if(null==h)n=null;else{const g=Math.floor(h);if(!(g>=0))throw new RangeError(`invalid digits: ${h}`);n=g}return null===t&&(s=new n6(n)),u},u.projection(e).digits(n).context(t)}function YA(e){return[$f(e[1],e[0]),ku(e[2])]}function u0(e){var t=e[0],n=e[1],i=ji(n);return[i*ji(t),i*xi(t),xi(n)]}function EM(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function CM(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function KA(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function MM(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function QA(e){var t=pc(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function JA(e){return Hr(e[0])<=Gi?e[0]:Ou(e[0])*((Hr(e[0])+Gi)%Xc-Gi)}function o6(e,t,n,i){return function(r){var x,C,S,s=t(r),u=AB(),h=t(u),g=!1,O={point:F,lineStart:G,lineEnd:Y,polygonStart:function(){O.point=J,O.lineStart=Q,O.lineEnd=he,C=[],x=[]},polygonEnd:function(){O.point=F,O.lineStart=G,O.lineEnd=Y,C=kB(C);var ue=function xae(e,t){var n=JA(t),i=t[1],r=xi(i),s=[xi(n),-ji(n),0],u=0,h=0,g=new Hf;1===r?i=Vo+Oi:-1===r&&(i=-Vo-Oi);for(var x=0,C=e.length;x<C;++x)if(O=(S=e[x]).length)for(var S,O,F=S[O-1],$=JA(F),G=F[1]/2+DB,Y=xi(G),J=ji(G),Q=0;Q<O;++Q,$=ue,Y=Ie,J=Qe,F=he){var he=S[Q],ue=JA(he),we=he[1]/2+DB,Ie=xi(we),Qe=ji(we),ut=ue-$,Ct=ut>=0?1:-1,At=Ct*ut,at=At>Gi,jt=Y*Ie;if(g.add($f(jt*Ct*xi(At),J*Qe+jt*ji(At))),u+=at?ut+Ct*Xc:ut,at^$>=n^ue>=n){var Ht=CM(u0(F),u0(he));QA(Ht);var Ae=CM(s,Ht);QA(Ae);var Ne=(at^ut>=0?-1:1)*ku(Ae[2]);(i>Ne||i===Ne&&(Ht[0]||Ht[1]))&&(h+=at^ut>=0?1:-1)}}return(u<-Oi||u<Oi&&g<-TB)^1&h}(x,i);C.length?(g||(r.polygonStart(),g=!0),PB(C,Eae,ue,n,r)):ue&&(g||(r.polygonStart(),g=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),g&&(r.polygonEnd(),g=!1),C=x=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function F(ue,we){e(ue,we)&&r.point(ue,we)}function $(ue,we){s.point(ue,we)}function G(){O.point=$,s.lineStart()}function Y(){O.point=F,s.lineEnd()}function J(ue,we){S.push([ue,we]),h.point(ue,we)}function Q(){h.lineStart(),S=[]}function he(){J(S[0][0],S[0][1]),h.lineEnd();var Ie,ut,Ct,At,ue=h.clean(),we=u.result(),Qe=we.length;if(S.pop(),x.push(S),S=null,Qe){if(1&ue){if((ut=(Ct=we[0]).length-1)>0){for(g||(r.polygonStart(),g=!0),r.lineStart(),Ie=0;Ie<ut;++Ie)r.point((At=Ct[Ie])[0],At[1]);r.lineEnd()}return}Qe>1&&2&ue&&we.push(we.pop().concat(we.shift())),C.push(we.filter(wae))}}return O}}function wae(e){return e.length>1}function Eae(e,t){return((e=e.x)[0]<0?e[1]-Vo-Oi:Vo-e[1])-((t=t.x)[0]<0?t[1]-Vo-Oi:Vo-t[1])}const s6=o6(function(){return!0},function Cae(e){var r,t=NaN,n=NaN,i=NaN;return{lineStart:function(){e.lineStart(),r=1},point:function(s,u){var h=s>0?Gi:-Gi,g=Hr(s-t);Hr(g-Gi)<Oi?(e.point(t,n=(n+u)/2>0?Vo:-Vo),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(h,n),e.point(s,n),r=0):i!==h&&g>=Gi&&(Hr(t-i)<Oi&&(t-=i*Oi),Hr(s-h)<Oi&&(s-=h*Oi),n=function Mae(e,t,n,i){var r,s,u=xi(e-n);return Hr(u)>Oi?a0((xi(t)*(s=ji(i))*xi(n)-xi(i)*(r=ji(t))*xi(e))/(r*s*u)):(t+i)/2}(t,n,s,u),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(h,n),r=0),e.point(t=s,n=u),i=h},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}},function Tae(e,t,n,i){var r;if(null==e)i.point(-Gi,r=n*Vo),i.point(0,r),i.point(Gi,r),i.point(Gi,0),i.point(Gi,-r),i.point(0,-r),i.point(-Gi,-r),i.point(-Gi,0),i.point(-Gi,r);else if(Hr(e[0]-t[0])>Oi){var s=e[0]<t[0]?Gi:-Gi;i.point(-s,r=n*s/2),i.point(0,r),i.point(s,r)}else i.point(t[0],t[1])},[-Gi,-Vo]);function l6(e,t){(t=u0(t))[0]-=e,QA(t);var n=IB(-t[1]);return((-t[2]<0?-n:n)+Xc-Oi)%Xc}function eP(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return(i=t.invert(i,r))&&e.invert(i[0],i[1])}),n}function tP(e,t){return Hr(e)>Gi&&(e-=Math.round(e/Xc)*Xc),[e,t]}function c6(e,t,n){return(e%=Xc)?t||n?eP(d6(e),h6(t,n)):d6(e):t||n?h6(t,n):tP}function u6(e){return function(t,n){return Hr(t+=e)>Gi&&(t-=Math.round(t/Xc)*Xc),[t,n]}}function d6(e){var t=u6(e);return t.invert=u6(-e),t}function h6(e,t){var n=ji(e),i=xi(e),r=ji(t),s=xi(t);function u(h,g){var x=ji(g),C=ji(h)*x,S=xi(h)*x,O=xi(g),F=O*n+C*i;return[$f(S*r-F*s,C*n-O*i),ku(F*r+S*s)]}return u.invert=function(h,g){var x=ji(g),C=ji(h)*x,S=xi(h)*x,O=xi(g),F=O*r-S*s;return[$f(S*r+O*s,C*n+F*i),ku(F*n-C*i)]},u}function nP(e){return{stream:TM(e)}}function TM(e){return function(t){var n=new iP;for(var i in e)n[i]=e[i];return n.stream=t,n}}function iP(){}function rP(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=i&&e.clipExtent(null),Wg(n,e.stream(yM)),t(yM.result()),null!=i&&e.clipExtent(i),e}function oP(e,t,n){return rP(e,function(i){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],u=Math.min(r/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),h=+t[0][0]+(r-u*(i[1][0]+i[0][0]))/2,g=+t[0][1]+(s-u*(i[1][1]+i[0][1]))/2;e.scale(150*u).translate([h,g])},n)}function f6(e,t,n){return oP(e,[[0,0],t],n)}function p6(e,t,n){return rP(e,function(i){var r=+t,s=r/(i[1][0]-i[0][0]),u=(r-s*(i[1][0]+i[0][0]))/2,h=-s*i[0][1];e.scale(150*s).translate([u,h])},n)}function m6(e,t,n){return rP(e,function(i){var r=+t,s=r/(i[1][1]-i[0][1]),u=-s*i[0][0],h=(r-s*(i[1][1]+i[0][1]))/2;e.scale(150*s).translate([u,h])},n)}tP.invert=tP,iP.prototype={constructor:iP,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var g6=16,Iae=ji(30*jo);function _6(e,t){return+t?function Pae(e,t){function n(i,r,s,u,h,g,x,C,S,O,F,$,G,Y){var J=x-i,Q=C-r,he=J*J+Q*Q;if(he>4*t&&G--){var ue=u+O,we=h+F,Ie=g+$,Qe=pc(ue*ue+we*we+Ie*Ie),ut=ku(Ie/=Qe),Ct=Hr(Hr(Ie)-1)<Oi||Hr(s-S)<Oi?(s+S)/2:$f(we,ue),At=e(Ct,ut),at=At[0],jt=At[1],Ht=at-i,Ae=jt-r,Ne=Q*Ht-J*Ae;(Ne*Ne/he>t||Hr((J*Ht+Q*Ae)/he-.5)>.3||u*O+h*F+g*$<Iae)&&(n(i,r,s,u,h,g,at,jt,Ct,ue/=Qe,we/=Qe,Ie,G,Y),Y.point(at,jt),n(at,jt,Ct,ue,we,Ie,x,C,S,O,F,$,G,Y))}}return function(i){var r,s,u,h,g,x,C,S,O,F,$,G,Y={point:J,lineStart:Q,lineEnd:ue,polygonStart:function(){i.polygonStart(),Y.lineStart=we},polygonEnd:function(){i.polygonEnd(),Y.lineStart=Q}};function J(ut,Ct){ut=e(ut,Ct),i.point(ut[0],ut[1])}function Q(){S=NaN,Y.point=he,i.lineStart()}function he(ut,Ct){var At=u0([ut,Ct]),at=e(ut,Ct);n(S,O,C,F,$,G,S=at[0],O=at[1],C=ut,F=At[0],$=At[1],G=At[2],g6,i),i.point(S,O)}function ue(){Y.point=J,i.lineEnd()}function we(){Q(),Y.point=Ie,Y.lineEnd=Qe}function Ie(ut,Ct){he(r=ut,Ct),s=S,u=O,h=F,g=$,x=G,Y.point=he}function Qe(){n(S,O,C,F,$,G,s,u,r,h,g,x,g6,i),Y.lineEnd=ue,ue()}return Y}}(e,t):function Aae(e){return TM({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var Oae=TM({point:function(e,t){this.stream.point(e*jo,t*jo)}});function y6(e,t,n,i,r,s){if(!s)return function Rae(e,t,n,i,r){function s(u,h){return[t+e*(u*=i),n-e*(h*=r)]}return s.invert=function(u,h){return[(u-t)/e*i,(n-h)/e*r]},s}(e,t,n,i,r);var u=ji(s),h=xi(s),g=u*e,x=h*e,C=u/e,S=h/e,O=(h*n-u*t)/e,F=(h*t+u*n)/e;function $(G,Y){return[g*(G*=i)-x*(Y*=r)+t,n-x*G-g*Y]}return $.invert=function(G,Y){return[i*(C*G-S*Y+O),r*(F-S*G-C*Y)]},$}function ym(e){return v6(function(){return e})()}function v6(e){var t,C,J,Q,he,Ie,Qe,ut,Ct,At,n=150,i=480,r=250,s=0,u=0,h=0,g=0,x=0,S=0,O=1,F=1,$=null,G=s6,Y=null,ue=zA,we=.5;function at(Ne){return ut(Ne[0]*jo,Ne[1]*jo)}function jt(Ne){return(Ne=ut.invert(Ne[0],Ne[1]))&&[Ne[0]*Nl,Ne[1]*Nl]}function Ht(){var Ne=y6(n,0,0,O,F,S).apply(null,t(s,u)),ge=y6(n,i-Ne[0],r-Ne[1],O,F,S);return C=c6(h,g,x),Qe=eP(t,ge),ut=eP(C,Qe),Ie=_6(Qe,we),Ae()}function Ae(){return Ct=At=null,at}return at.stream=function(Ne){return Ct&&At===Ne?Ct:Ct=Oae(function kae(e){return TM({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}(C)(G(Ie(ue(At=Ne)))))},at.preclip=function(Ne){return arguments.length?(G=Ne,$=void 0,Ae()):G},at.postclip=function(Ne){return arguments.length?(ue=Ne,Y=J=Q=he=null,Ae()):ue},at.clipAngle=function(Ne){return arguments.length?(G=+Ne?function Dae(e){var t=ji(e),n=6*jo,i=t>0,r=Hr(t)>Oi;function u(C,S){return ji(C)*ji(S)>t}function g(C,S,O){var G=[1,0,0],Y=CM(u0(C),u0(S)),J=EM(Y,Y),Q=Y[0],he=J-Q*Q;if(!he)return!O&&C;var ue=t*J/he,we=-t*Q/he,Ie=CM(G,Y),Qe=MM(G,ue);KA(Qe,MM(Y,we));var Ct=Ie,At=EM(Qe,Ct),at=EM(Ct,Ct),jt=At*At-at*(EM(Qe,Qe)-1);if(!(jt<0)){var Ht=pc(jt),Ae=MM(Ct,(-At-Ht)/at);if(KA(Ae,Qe),Ae=YA(Ae),!O)return Ae;var Ye,Ne=C[0],ge=S[0],Re=C[1],We=S[1];ge<Ne&&(Ye=Ne,Ne=ge,ge=Ye);var Dt=ge-Ne,Bt=Hr(Dt-Gi)<Oi;if(!Bt&&We<Re&&(Ye=Re,Re=We,We=Ye),Bt||Dt<Oi?Bt?Re+We>0^Ae[1]<(Hr(Ae[0]-Ne)<Oi?Re:We):Re<=Ae[1]&&Ae[1]<=We:Dt>Gi^(Ne<=Ae[0]&&Ae[0]<=ge)){var Dn=MM(Ct,(-At+Ht)/at);return KA(Dn,Qe),[Ae,YA(Dn)]}}}function x(C,S){var O=i?e:Gi-e,F=0;return C<-O?F|=1:C>O&&(F|=2),S<-O?F|=4:S>O&&(F|=8),F}return o6(u,function h(C){var S,O,F,$,G;return{lineStart:function(){$=F=!1,G=1},point:function(Y,J){var he,Q=[Y,J],ue=u(Y,J),we=i?ue?0:x(Y,J):ue?x(Y+(Y<0?Gi:-Gi),J):0;if(!S&&($=F=ue)&&C.lineStart(),ue!==F&&(!(he=g(S,Q))||hM(S,he)||hM(Q,he))&&(Q[2]=1),ue!==F)G=0,ue?(C.lineStart(),he=g(Q,S),C.point(he[0],he[1])):(he=g(S,Q),C.point(he[0],he[1],2),C.lineEnd()),S=he;else if(r&&S&&i^ue){var Ie;!(we&O)&&(Ie=g(Q,S,!0))&&(G=0,i?(C.lineStart(),C.point(Ie[0][0],Ie[0][1]),C.point(Ie[1][0],Ie[1][1]),C.lineEnd()):(C.point(Ie[1][0],Ie[1][1]),C.lineEnd(),C.lineStart(),C.point(Ie[0][0],Ie[0][1],3)))}ue&&(!S||!hM(S,Q))&&C.point(Q[0],Q[1]),S=Q,F=ue,O=we},lineEnd:function(){F&&C.lineEnd(),S=null},clean:function(){return G|($&&F)<<1}}},function s(C,S,O,F){!function a6(e,t,n,i,r,s){if(n){var u=ji(t),h=xi(t),g=i*n;null==r?(r=t+i*Xc,s=t-g/2):(r=l6(u,r),s=l6(u,s),(i>0?r<s:r>s)&&(r+=i*Xc));for(var x,C=r;i>0?C>s:C<s;C-=g)x=YA([u,-h*ji(C),-h*xi(C)]),e.point(x[0],x[1])}}(F,e,n,O,C,S)},i?[0,-e]:[-Gi,e-Gi])}($=Ne*jo):($=null,s6),Ae()):$*Nl},at.clipExtent=function(Ne){return arguments.length?(ue=null==Ne?(Y=J=Q=he=null,zA):RB(Y=+Ne[0][0],J=+Ne[0][1],Q=+Ne[1][0],he=+Ne[1][1]),Ae()):null==Y?null:[[Y,J],[Q,he]]},at.scale=function(Ne){return arguments.length?(n=+Ne,Ht()):n},at.translate=function(Ne){return arguments.length?(i=+Ne[0],r=+Ne[1],Ht()):[i,r]},at.center=function(Ne){return arguments.length?(s=Ne[0]%360*jo,u=Ne[1]%360*jo,Ht()):[s*Nl,u*Nl]},at.rotate=function(Ne){return arguments.length?(h=Ne[0]%360*jo,g=Ne[1]%360*jo,x=Ne.length>2?Ne[2]%360*jo:0,Ht()):[h*Nl,g*Nl,x*Nl]},at.angle=function(Ne){return arguments.length?(S=Ne%360*jo,Ht()):S*Nl},at.reflectX=function(Ne){return arguments.length?(O=Ne?-1:1,Ht()):O<0},at.reflectY=function(Ne){return arguments.length?(F=Ne?-1:1,Ht()):F<0},at.precision=function(Ne){return arguments.length?(Ie=_6(Qe,we=Ne*Ne),Ae()):pc(we)},at.fitExtent=function(Ne,ge){return oP(at,Ne,ge)},at.fitSize=function(Ne,ge){return f6(at,Ne,ge)},at.fitWidth=function(Ne,ge){return p6(at,Ne,ge)},at.fitHeight=function(Ne,ge){return m6(at,Ne,ge)},function(){return t=e.apply(this,arguments),at.invert=t.invert&&jt,Ht()}}function sP(e){var t=0,n=Gi/3,i=v6(e),r=i(t,n);return r.parallels=function(s){return arguments.length?i(t=s[0]*jo,n=s[1]*jo):[t*Nl,n*Nl]},r}function Fae(e,t){var n=xi(e),i=(n+xi(t))/2;if(Hr(i)<Oi)return function Lae(e){var t=ji(e);function n(i,r){return[i*t,xi(r)/t]}return n.invert=function(i,r){return[i/t,ku(r*t)]},n}(e);var r=1+n*(2*i-n),s=pc(r)/i;function u(h,g){var x=pc(r-2*i*xi(g))/i;return[x*xi(h*=i),s-x*ji(h)]}return u.invert=function(h,g){var x=s-g,C=$f(h,Hr(x))*Ou(x);return x*i<0&&(C-=Gi*Ou(h)*Ou(x)),[C/i,ku((r-(h*h+x*x)*i*i)/(2*i))]},u}function DM(){return sP(Fae).scale(155.424).center([0,33.6442])}function b6(){return DM().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function zae(){var e,t,i,s,h,g,n=b6(),r=DM().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=DM().rotate([157,0]).center([-3,19.9]).parallels([8,18]),x={point:function(O,F){g=[O,F]}};function C(O){var F=O[0],$=O[1];return g=null,i.point(F,$),g||(s.point(F,$),g)||(h.point(F,$),g)}function S(){return e=t=null,C}return C.invert=function(O){var F=n.scale(),$=n.translate(),G=(O[0]-$[0])/F,Y=(O[1]-$[1])/F;return(Y>=.12&&Y<.234&&G>=-.425&&G<-.214?r:Y>=.166&&Y<.234&&G>=-.214&&G<-.115?u:n).invert(O)},C.stream=function(O){return e&&t===O?e:e=function Nae(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}([n.stream(t=O),r.stream(O),u.stream(O)])},C.precision=function(O){return arguments.length?(n.precision(O),r.precision(O),u.precision(O),S()):n.precision()},C.scale=function(O){return arguments.length?(n.scale(O),r.scale(.35*O),u.scale(O),C.translate(n.translate())):n.scale()},C.translate=function(O){if(!arguments.length)return n.translate();var F=n.scale(),$=+O[0],G=+O[1];return i=n.translate(O).clipExtent([[$-.455*F,G-.238*F],[$+.455*F,G+.238*F]]).stream(x),s=r.translate([$-.307*F,G+.201*F]).clipExtent([[$-.425*F+Oi,G+.12*F+Oi],[$-.214*F-Oi,G+.234*F-Oi]]).stream(x),h=u.translate([$-.205*F,G+.212*F]).clipExtent([[$-.214*F+Oi,G+.166*F+Oi],[$-.115*F-Oi,G+.234*F-Oi]]).stream(x),S()},C.fitExtent=function(O,F){return oP(C,O,F)},C.fitSize=function(O,F){return f6(C,O,F)},C.fitWidth=function(O,F){return p6(C,O,F)},C.fitHeight=function(O,F){return m6(C,O,F)},C.scale(1070)}function x6(e){return function(t,n){var i=ji(t),r=ji(n),s=e(i*r);return s===1/0?[2,0]:[s*r*xi(t),s*xi(n)]}}function Ux(e){return function(t,n){var i=pc(t*t+n*n),r=e(i),s=xi(r),u=ji(r);return[$f(t*s,i*u),ku(i&&n*s/i)]}}var w6=x6(function(e){return pc(2/(1+e))});function Bae(){return ym(w6).scale(124.75).clipAngle(179.999)}w6.invert=Ux(function(e){return 2*ku(e/2)});var E6=x6(function(e){return(e=IB(e))&&e/xi(e)});function Uae(){return ym(E6).scale(79.4188).clipAngle(179.999)}function SM(e,t){return[e,dM(NA((Vo+t)/2))]}function Vae(){return C6(SM).scale(961/Xc)}function C6(e){var h,g,x,t=ym(e),n=t.center,i=t.scale,r=t.translate,s=t.clipExtent,u=null;function C(){var S=Gi*i(),O=t(function Sae(e){function t(n){return(n=e(n[0]*jo,n[1]*jo))[0]*=Nl,n[1]*=Nl,n}return e=c6(e[0]*jo,e[1]*jo,e.length>2?e[2]*jo:0),t.invert=function(n){return(n=e.invert(n[0]*jo,n[1]*jo))[0]*=Nl,n[1]*=Nl,n},t}(t.rotate()).invert([0,0]));return s(null==u?[[O[0]-S,O[1]-S],[O[0]+S,O[1]+S]]:e===SM?[[Math.max(O[0]-S,u),h],[Math.min(O[0]+S,g),x]]:[[u,Math.max(O[1]-S,h)],[g,Math.min(O[1]+S,x)]])}return t.scale=function(S){return arguments.length?(i(S),C()):i()},t.translate=function(S){return arguments.length?(r(S),C()):r()},t.center=function(S){return arguments.length?(n(S),C()):n()},t.clipExtent=function(S){return arguments.length?(null==S?u=h=g=x=null:(u=+S[0][0],h=+S[0][1],g=+S[1][0],x=+S[1][1]),C()):null==u?null:[[u,h],[g,x]]},C()}function IM(e){return NA((Vo+e)/2)}function jae(e,t){var n=ji(e),i=e===t?xi(e):dM(n/ji(t))/dM(IM(t)/IM(e)),r=n*FA(IM(e),i)/i;if(!i)return SM;function s(u,h){r>0?h<-Vo+Oi&&(h=-Vo+Oi):h>Vo-Oi&&(h=Vo-Oi);var g=r/FA(IM(h),i);return[g*xi(i*u),r-g*ji(i*u)]}return s.invert=function(u,h){var g=r-h,x=Ou(i)*pc(u*u+g*g),C=$f(u,Hr(g))*Ou(g);return g*i<0&&(C-=Gi*Ou(u)*Ou(g)),[C/i,2*a0(FA(r/x,1/i))-Vo]},s}function $ae(){return sP(jae).scale(109.5).parallels([30,30])}function AM(e,t){return[e,t]}function Hae(){return ym(AM).scale(152.63)}function Gae(e,t){var n=ji(e),i=e===t?xi(e):(n-ji(t))/(t-e),r=n/i+e;if(Hr(i)<Oi)return AM;function s(u,h){var g=r-h,x=i*u;return[g*xi(x),r-g*ji(x)]}return s.invert=function(u,h){var g=r-h,x=$f(u,Hr(g))*Ou(g);return g*i<0&&(x-=Gi*Ou(u)*Ou(g)),[x/i,r-Ou(i)*pc(u*u+g*g)]},s}function qae(){return sP(Gae).scale(131.154).center([0,13.9389])}E6.invert=Ux(function(e){return e}),SM.invert=function(e,t){return[e,2*a0(SB(t))-Vo]},AM.invert=AM;var Vx=1.340264,jx=-.081106,$x=893e-6,Hx=.003796,PM=pc(3)/2;function M6(e,t){var n=ku(PM*xi(t)),i=n*n,r=i*i*i;return[e*ji(n)/(PM*(Vx+3*jx*i+r*(7*$x+9*Hx*i))),n*(Vx+jx*i+r*($x+Hx*i))]}function Zae(){return ym(M6).scale(177.158)}function T6(e,t){var n=ji(t),i=ji(e)*n;return[n*xi(e)/i,xi(t)/i]}function Xae(){return ym(T6).scale(144.049).clipAngle(60)}function D6(e,t){return[ji(t)*xi(e),xi(t)]}function Yae(){return ym(D6).scale(249.5).clipAngle(90+Oi)}function S6(e,t){var n=ji(t),i=1+ji(e)*n;return[n*xi(e)/i,xi(t)/i]}function Kae(){return ym(S6).scale(250).clipAngle(142)}function I6(e,t){return[dM(NA((Vo+t)/2)),-e]}function Qae(){var e=C6(I6),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):[(i=t())[1],-i[0]]},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):[(i=n())[0],i[1],i[2]-90]},n([0,0,90]).scale(159.155)}function aP(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function A6(e){return function(t,n){var i=e((t=TA(t)).h,(n=TA(n)).h),r=va(t.s,n.s),s=va(t.l,n.l),u=va(t.opacity,n.opacity);return function(h){return t.h=i(h),t.s=r(h),t.l=s(h),t.opacity=u(h),t+""}}}M6.invert=function(e,t){for(var u,n=t,i=n*n,r=i*i*i,s=0;s<12&&(r=(i=(n-=u=(n*(Vx+jx*i+r*($x+Hx*i))-t)/(Vx+3*jx*i+r*(7*$x+9*Hx*i)))*n)*i*i,!(Hr(u)<TB));++s);return[PM*e*(Vx+3*jx*i+r*(7*$x+9*Hx*i))/ji(n),ku(xi(n)/PM)]},T6.invert=Ux(a0),D6.invert=Ux(ku),S6.invert=Ux(function(e){return 2*a0(e)}),I6.invert=function(e,t){return[-t,2*a0(SB(e))-Vo]};const Jae=A6(SA);A6(va);const P6=Math.PI/180,O6=180/Math.PI,k6=.96422,R6=1,L6=.82521,F6=4/29,d0=6/29,N6=3*d0*d0,ele=d0*d0*d0;function z6(e){if(e instanceof Ld)return new Ld(e.l,e.a,e.b,e.opacity);if(e instanceof Rh)return U6(e);e instanceof ya||(e=MA(e));var s,u,t=hP(e.r),n=hP(e.g),i=hP(e.b),r=cP((.2225045*t+.7168786*n+.0606169*i)/R6);return t===n&&n===i?s=u=r:(s=cP((.4360747*t+.3850649*n+.1430804*i)/k6),u=cP((.0139322*t+.0971045*n+.7141733*i)/L6)),new Ld(116*r-16,500*(s-r),200*(r-u),e.opacity)}function lP(e,t,n,i){return 1===arguments.length?z6(e):new Ld(e,t,n,i??1)}function Ld(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}function cP(e){return e>ele?Math.pow(e,1/3):e/N6+F6}function uP(e){return e>d0?e*e*e:N6*(e-F6)}function dP(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function hP(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function fP(e,t,n,i){return 1===arguments.length?function B6(e){if(e instanceof Rh)return new Rh(e.h,e.c,e.l,e.opacity);if(e instanceof Ld||(e=z6(e)),0===e.a&&0===e.b)return new Rh(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*O6;return new Rh(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}(e):new Rh(e,t,n,i??1)}function Rh(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function U6(e){if(isNaN(e.h))return new Ld(e.l,0,0,e.opacity);var t=e.h*P6;return new Ld(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function V6(e){return function(t,n){var i=e((t=fP(t)).h,(n=fP(n)).h),r=va(t.c,n.c),s=va(t.l,n.l),u=va(t.opacity,n.opacity);return function(h){return t.h=i(h),t.c=r(h),t.l=s(h),t.opacity=u(h),t+""}}}e0(Ld,lP,Ix(pm,{brighter(e){return new Ld(this.l+18*(e??1),this.a,this.b,this.opacity)},darker(e){return new Ld(this.l-18*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new ya(dP(3.1338561*(t=k6*uP(t))-1.6168667*(e=R6*uP(e))-.4906146*(n=L6*uP(n))),dP(-.9787684*t+1.9161415*e+.033454*n),dP(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),e0(Rh,fP,Ix(pm,{brighter(e){return new Rh(this.h,this.c,this.l+18*(e??1),this.opacity)},darker(e){return new Rh(this.h,this.c,this.l-18*(e??1),this.opacity)},rgb(){return U6(this).rgb()}}));const nle=V6(SA);function j6(e,t){var u,n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),s=new Array(n);for(u=0;u<i;++u)r[u]=Gx(e[u],t[u]);for(;u<n;++u)s[u]=t[u];return function(h){for(u=0;u<i;++u)s[u]=r[u](h);return s}}function ile(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function rle(e,t){var r,n={},i={};for(r in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)r in e?n[r]=Gx(e[r],t[r]):i[r]=t[r];return function(s){for(r in n)i[r]=n[r](s);return i}}function ole(e,t){t||(t=[]);var r,n=e?Math.min(t.length,e.length):0,i=t.slice();return function(s){for(r=0;r<n;++r)i[r]=e[r]*(1-s)+t[r]*s;return i}}function Gx(e,t){var i,n=typeof t;return null==t||"boolean"===n?sM(t):("number"===n?al:"string"===n?(i=mm(t))?(t=i,qg):uB:t instanceof mm?qg:t instanceof Date?ile:function sle(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?ole:Array.isArray(t)?j6:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?rle:al)(e,t)}function kM(e,t){void 0===t&&(t=e,e=Gx);for(var n=0,i=t.length-1,r=t[0],s=new Array(i<0?0:i);n<i;)s[n]=e(r,r=t[++n]);return function(u){var h=Math.max(0,Math.min(i-1,Math.floor(u*=i)));return s[h](u-h)}}function Fd(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}V6(va);const pP=Math.PI,mP=2*pP,Xg=1e-6,ale=mP-Xg;function $6(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}class gP{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?$6:function lle(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return $6;const n=10**t;return function(i){this._+=i[0];for(let r=1,s=i.length;r<s;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,s,u){this._append`C${+t},${+n},${+i},${+r},${this._x1=+s},${this._y1=+u}`}arcTo(t,n,i,r,s){if(t=+t,n=+n,i=+i,r=+r,(s=+s)<0)throw new Error(`negative radius: ${s}`);let u=this._x1,h=this._y1,g=i-t,x=r-n,C=u-t,S=h-n,O=C*C+S*S;if(null===this._x1)this._append`M${this._x1=t},${this._y1=n}`;else if(O>Xg)if(Math.abs(S*g-x*C)>Xg&&s){let F=i-u,$=r-h,G=g*g+x*x,Y=F*F+$*$,J=Math.sqrt(G),Q=Math.sqrt(O),he=s*Math.tan((pP-Math.acos((G+O-Y)/(2*J*Q)))/2),ue=he/Q,we=he/J;Math.abs(ue-1)>Xg&&this._append`L${t+ue*C},${n+ue*S}`,this._append`A${s},${s},0,0,${+(S*F>C*$)},${this._x1=t+we*g},${this._y1=n+we*x}`}else this._append`L${this._x1=t},${this._y1=n}`}arc(t,n,i,r,s,u){if(t=+t,n=+n,u=!!u,(i=+i)<0)throw new Error(`negative radius: ${i}`);let h=i*Math.cos(r),g=i*Math.sin(r),x=t+h,C=n+g,S=1^u,O=u?r-s:s-r;null===this._x1?this._append`M${x},${C}`:(Math.abs(this._x1-x)>Xg||Math.abs(this._y1-C)>Xg)&&this._append`L${x},${C}`,i&&(O<0&&(O=O%mP+mP),O>ale?this._append`A${i},${i},0,1,${S},${t-h},${n-g}A${i},${i},0,1,${S},${this._x1=x},${this._y1=C}`:O>Xg&&this._append`A${i},${i},0,${+(O>=pP)},${S},${this._x1=t+i*Math.cos(s)},${this._y1=n+i*Math.sin(s)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function _P(e=3){return new gP(+e)}function Lh(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function RM(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const yP=Symbol("implicit");function vP(){var e=new Vg,t=[],n=[],i=yP;function r(s){let u=e.get(s);if(void 0===u){if(i!==yP)return i;e.set(s,u=t.push(s)-1)}return n[u%n.length]}return r.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new Vg;for(const u of s)e.has(u)||e.set(u,t.push(u)-1);return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return vP(t,n).unknown(i)},Lh.apply(r,arguments),r}function LM(){var s,u,e=vP().unknown(void 0),t=e.domain,n=e.range,i=0,r=1,h=!1,g=0,x=0,C=.5;function S(){var O=t().length,F=r<i,$=F?r:i,G=F?i:r;s=(G-$)/Math.max(1,O-g+2*x),h&&(s=Math.floor(s)),$+=(G-$-s*(O-g))*C,u=s*(1-g),h&&($=Math.round($),u=Math.round(u));var Y=hA(O).map(function(J){return $+s*J});return n(F?Y.reverse():Y)}return delete e.unknown,e.domain=function(O){return arguments.length?(t(O),S()):t()},e.range=function(O){return arguments.length?([i,r]=O,i=+i,r=+r,S()):[i,r]},e.rangeRound=function(O){return[i,r]=O,i=+i,r=+r,h=!0,S()},e.bandwidth=function(){return u},e.step=function(){return s},e.round=function(O){return arguments.length?(h=!!O,S()):h},e.padding=function(O){return arguments.length?(g=Math.min(1,x=+O),S()):g},e.paddingInner=function(O){return arguments.length?(g=Math.min(1,O),S()):g},e.paddingOuter=function(O){return arguments.length?(x=+O,S()):x},e.align=function(O){return arguments.length?(C=Math.max(0,Math.min(1,O)),S()):C},e.copy=function(){return LM(t(),[i,r]).round(h).paddingInner(g).paddingOuter(x).align(C)},Lh.apply(S(),arguments)}function H6(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return H6(t())},e}function ule(){return H6(LM.apply(null,arguments).paddingInner(1))}function bP(e){return+e}var G6=[0,1];function Lu(e){return e}function xP(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function dle(e){return function(){return e}}(isNaN(t)?NaN:.5)}function fle(e,t,n){var i=e[0],r=e[1],s=t[0],u=t[1];return r<i?(i=xP(r,i),s=n(u,s)):(i=xP(i,r),s=n(s,u)),function(h){return s(i(h))}}function ple(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),s=new Array(i),u=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++u<i;)r[u]=xP(e[u],e[u+1]),s[u]=n(t[u],t[u+1]);return function(h){var g=FC(e,h,1,i)-1;return s[g](r[g](h))}}function qx(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function FM(){var i,r,s,h,g,x,e=G6,t=G6,n=Gx,u=Lu;function C(){var O=Math.min(e.length,t.length);return u!==Lu&&(u=function hle(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}(e[0],e[O-1])),h=O>2?ple:fle,g=x=null,S}function S(O){return null==O||isNaN(O=+O)?s:(g||(g=h(e.map(i),t,n)))(i(u(O)))}return S.invert=function(O){return u(r((x||(x=h(t,e.map(i),al)))(O)))},S.domain=function(O){return arguments.length?(e=Array.from(O,bP),C()):e.slice()},S.range=function(O){return arguments.length?(t=Array.from(O),C()):t.slice()},S.rangeRound=function(O){return t=Array.from(O),n=aP,C()},S.clamp=function(O){return arguments.length?(u=!!O||Lu,C()):u!==Lu},S.interpolate=function(O){return arguments.length?(n=O,C()):n},S.unknown=function(O){return arguments.length?(s=O,S):s},function(O,F){return i=O,r=F,C()}}function q6(){return FM()(Lu,Lu)}function Wx(e){var t=e.domain;return e.ticks=function(n){var i=t();return wx(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return function yle(e,t,n,i){var s,r=fA(e,t,n);switch((i=Ox(i??",f")).type){case"s":var u=Math.max(Math.abs(e),Math.abs(t));return null==i.precision&&!isNaN(s=function mle(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(s0(t)/3)))-s0(Math.abs(e)))}(r,u))&&(i.precision=s),MB(i,u);case"":case"e":case"g":case"p":case"r":null==i.precision&&!isNaN(s=function gle(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,s0(t)-s0(e))+1}(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=s-("e"===i.type));break;case"f":case"%":null==i.precision&&!isNaN(s=function _le(e){return Math.max(0,-s0(Math.abs(e)))}(r))&&(i.precision=s-2*("%"===i.type))}return kx(i)}(r[0],r[r.length-1],n??10,i)},e.nice=function(n){null==n&&(n=10);var g,x,i=t(),r=0,s=i.length-1,u=i[r],h=i[s],C=10;for(h<u&&(x=u,u=h,h=x,x=r,r=s,s=x);C-- >0;){if((x=UC(u,h,n))===g)return i[r]=u,i[s]=h,t(i);if(x>0)u=Math.floor(u/x)*x,h=Math.ceil(h/x)*x;else{if(!(x<0))break;u=Math.ceil(u*x)/x,h=Math.floor(h*x)/x}g=x}return e},e}function wP(){var e=q6();return e.copy=function(){return qx(e,wP())},Lh.apply(e,arguments),Wx(e)}function W6(e){var t;function n(i){return null==i||isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,bP),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return W6(e).unknown(t)},e=arguments.length?Array.from(e,bP):[0,1],Wx(n)}function Z6(e,t){var u,n=0,i=(e=e.slice()).length-1,r=e[n],s=e[i];return s<r&&(u=n,n=i,i=u,u=r,r=s,s=u),e[n]=t.floor(r),e[i]=t.ceil(s),e}function X6(e){return Math.log(e)}function Y6(e){return Math.exp(e)}function vle(e){return-Math.log(-e)}function ble(e){return-Math.exp(-e)}function xle(e){return isFinite(e)?+("1e"+e):e<0?0:e}function K6(e){return(t,n)=>-e(-t,n)}function Q6(e){const t=e(X6,Y6),n=t.domain;let r,s,i=10;function u(){return r=function Ele(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(i),s=function wle(e){return 10===e?xle:e===Math.E?Math.exp:t=>Math.pow(e,t)}(i),n()[0]<0?(r=K6(r),s=K6(s),e(vle,ble)):e(X6,Y6),t}return t.base=function(h){return arguments.length?(i=+h,u()):i},t.domain=function(h){return arguments.length?(n(h),u()):n()},t.ticks=h=>{const g=n();let x=g[0],C=g[g.length-1];const S=C<x;S&&([x,C]=[C,x]);let $,G,O=r(x),F=r(C);const Y=null==h?10:+h;let J=[];if(!(i%1)&&F-O<Y){if(O=Math.floor(O),F=Math.ceil(F),x>0){for(;O<=F;++O)for($=1;$<i;++$)if(G=O<0?$/s(-O):$*s(O),!(G<x)){if(G>C)break;J.push(G)}}else for(;O<=F;++O)for($=i-1;$>=1;--$)if(G=O>0?$/s(-O):$*s(O),!(G<x)){if(G>C)break;J.push(G)}2*J.length<Y&&(J=wx(x,C,Y))}else J=wx(O,F,Math.min(F-O,Y)).map(s);return S?J.reverse():J},t.tickFormat=(h,g)=>{if(null==h&&(h=10),null==g&&(g=10===i?"s":","),"function"!=typeof g&&(!(i%1)&&null==(g=Ox(g)).precision&&(g.trim=!0),g=kx(g)),h===1/0)return g;const x=Math.max(1,i*h/t.ticks().length);return C=>{let S=C/s(Math.round(r(C)));return S*i<i-.5&&(S*=i),S<=x?g(C):""}},t.nice=()=>n(Z6(n(),{floor:h=>s(Math.floor(r(h))),ceil:h=>s(Math.ceil(r(h)))})),t}function J6(){const e=Q6(FM()).domain([1,10]);return e.copy=()=>qx(e,J6()).base(e.base()),Lh.apply(e,arguments),e}function e8(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function t8(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function n8(e){var t=1,n=e(e8(t),t8(t));return n.constant=function(i){return arguments.length?e(e8(t=+i),t8(t)):t},Wx(n)}function i8(){var e=n8(FM());return e.copy=function(){return qx(e,i8()).constant(e.constant())},Lh.apply(e,arguments)}function r8(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Cle(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Mle(e){return e<0?-e*e:e*e}function o8(e){var t=e(Lu,Lu),n=1;return t.exponent=function(r){return arguments.length?(n=+r,function i(){return 1===n?e(Lu,Lu):.5===n?e(Cle,Mle):e(r8(n),r8(1/n))}()):n},Wx(t)}function EP(){var e=o8(FM());return e.copy=function(){return qx(e,EP()).exponent(e.exponent())},Lh.apply(e,arguments),e}function s8(){var i,e=[],t=[],n=[];function r(){var u=0,h=Math.max(1,t.length);for(n=new Array(h-1);++u<h;)n[u-1]=die(e,u/h);return s}function s(u){return null==u||isNaN(u=+u)?i:t[FC(n,u)]}return s.invertExtent=function(u){var h=t.indexOf(u);return h<0?[NaN,NaN]:[h>0?n[h-1]:e[0],h<n.length?n[h]:e[e.length-1]]},s.domain=function(u){if(!arguments.length)return e.slice();e=[];for(let h of u)null!=h&&!isNaN(h=+h)&&e.push(h);return e.sort(fc),r()},s.range=function(u){return arguments.length?(t=Array.from(u),r()):t.slice()},s.unknown=function(u){return arguments.length?(i=u,s):i},s.quantiles=function(){return n.slice()},s.copy=function(){return s8().domain(e).range(t).unknown(i)},Lh.apply(s,arguments)}function a8(){var n,e=[.5],t=[0,1],i=1;function r(s){return null!=s&&s<=s?t[FC(e,s,0,i)]:n}return r.domain=function(s){return arguments.length?(e=Array.from(s),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(s){return arguments.length?(t=Array.from(s),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(s){var u=t.indexOf(s);return[e[u-1],e[u]]},r.unknown=function(s){return arguments.length?(n=s,r):n},r.copy=function(){return a8().domain(e).range(t).unknown(n)},Lh.apply(r,arguments)}const Gf=1e3,Fu=6e4,qf=60*Fu,Wf=24*qf,CP=7*Wf,l8=30*Wf,MP=365*Wf,TP=new Date,DP=new Date;function Hs(e,t,n,i){function r(s){return e(s=0===arguments.length?new Date:new Date(+s)),s}return r.floor=s=>(e(s=new Date(+s)),s),r.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),r.round=s=>{const u=r(s),h=r.ceil(s);return s-u<h-s?u:h},r.offset=(s,u)=>(t(s=new Date(+s),null==u?1:Math.floor(u)),s),r.range=(s,u,h)=>{const g=[];if(s=r.ceil(s),h=null==h?1:Math.floor(h),!(s<u&&h>0))return g;let x;do{g.push(x=new Date(+s)),t(s,h),e(s)}while(x<s&&s<u);return g},r.filter=s=>Hs(u=>{if(u>=u)for(;e(u),!s(u);)u.setTime(u-1)},(u,h)=>{if(u>=u)if(h<0)for(;++h<=0;)for(;t(u,-1),!s(u););else for(;--h>=0;)for(;t(u,1),!s(u););}),n&&(r.count=(s,u)=>(TP.setTime(+s),DP.setTime(+u),e(TP),e(DP),Math.floor(n(TP,DP))),r.every=s=>(s=Math.floor(s),isFinite(s)&&s>0?s>1?r.filter(i?u=>i(u)%s==0:u=>r.count(0,u)%s==0):r:null)),r}const NM=Hs(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);NM.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?Hs(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):NM:null);const Zf=Hs(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Gf)},(e,t)=>(t-e)/Gf,e=>e.getUTCSeconds()),zM=Hs(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Gf)},(e,t)=>{e.setTime(+e+t*Fu)},(e,t)=>(t-e)/Fu,e=>e.getMinutes()),BM=Hs(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Fu)},(e,t)=>(t-e)/Fu,e=>e.getUTCMinutes()),UM=Hs(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Gf-e.getMinutes()*Fu)},(e,t)=>{e.setTime(+e+t*qf)},(e,t)=>(t-e)/qf,e=>e.getHours()),VM=Hs(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*qf)},(e,t)=>(t-e)/qf,e=>e.getUTCHours()),h0=Hs(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Fu)/Wf,e=>e.getDate()-1),jM=Hs(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Wf,e=>e.getUTCDate()-1),SP=Hs(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Wf,e=>Math.floor(e/Wf));function Yg(e){return Hs(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+7*n)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Fu)/CP)}const f0=Yg(0),Zx=Yg(1),c8=Yg(2),u8=Yg(3),Kg=Yg(4),d8=Yg(5),h8=Yg(6);function Qg(e){return Hs(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+7*n)},(t,n)=>(n-t)/CP)}const p0=Qg(0),Xx=Qg(1),f8=Qg(2),p8=Qg(3),Jg=Qg(4),m8=Qg(5),g8=Qg(6),$M=Hs(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear()),e=>e.getMonth()),HM=Hs(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear()),e=>e.getUTCMonth()),Nd=Hs(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Nd.every=e=>isFinite(e=Math.floor(e))&&e>0?Hs(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)}):null;const zd=Hs(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());function _8(e,t,n,i,r,s){const u=[[Zf,1,Gf],[Zf,5,5e3],[Zf,15,15e3],[Zf,30,3e4],[s,1,Fu],[s,5,5*Fu],[s,15,15*Fu],[s,30,30*Fu],[r,1,qf],[r,3,3*qf],[r,6,6*qf],[r,12,12*qf],[i,1,Wf],[i,2,2*Wf],[n,1,CP],[t,1,l8],[t,3,3*l8],[e,1,MP]];function g(x,C,S){const O=Math.abs(C-x)/S,F=vx(([,,Y])=>Y).right(u,O);if(F===u.length)return e.every(fA(x/MP,C/MP,S));if(0===F)return NM.every(Math.max(fA(x,C,S),1));const[$,G]=u[O/u[F-1][2]<u[F][2]/O?F-1:F];return $.every(G)}return[function h(x,C,S){const O=C<x;O&&([x,C]=[C,x]);const F=S&&"function"==typeof S.range?S:g(x,C,S),$=F?F.range(x,+C+1):[];return O?$.reverse():$},g]}zd.every=e=>isFinite(e=Math.floor(e))&&e>0?Hs(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null;const[Tle,y8]=_8(zd,HM,p0,SP,VM,BM),[Dle,Sle]=_8(Nd,$M,f0,h0,UM,zM);function IP(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function AP(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Yx(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var m0,GM,Jx,v8={"-":"",_:" ",0:"0"},ba=/^\s*\d+/,Ale=/^%/,Ple=/[\\^$*+?|[\]().{}]/g;function Pr(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",s=r.length;return i+(s<n?new Array(n-s+1).join(t)+r:r)}function Ole(e){return e.replace(Ple,"\\$&")}function Kx(e){return new RegExp("^(?:"+e.map(Ole).join("|")+")","i")}function Qx(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function kle(e,t,n){var i=ba.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function Rle(e,t,n){var i=ba.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function Lle(e,t,n){var i=ba.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function Fle(e,t,n){var i=ba.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function Nle(e,t,n){var i=ba.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function b8(e,t,n){var i=ba.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function x8(e,t,n){var i=ba.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function zle(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function Ble(e,t,n){var i=ba.exec(t.slice(n,n+1));return i?(e.q=3*i[0]-3,n+i[0].length):-1}function Ule(e,t,n){var i=ba.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function w8(e,t,n){var i=ba.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function Vle(e,t,n){var i=ba.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function E8(e,t,n){var i=ba.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function jle(e,t,n){var i=ba.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function $le(e,t,n){var i=ba.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function Hle(e,t,n){var i=ba.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function Gle(e,t,n){var i=ba.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function qle(e,t,n){var i=Ale.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function Wle(e,t,n){var i=ba.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function Zle(e,t,n){var i=ba.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function C8(e,t){return Pr(e.getDate(),t,2)}function Xle(e,t){return Pr(e.getHours(),t,2)}function Yle(e,t){return Pr(e.getHours()%12||12,t,2)}function Kle(e,t){return Pr(1+h0.count(Nd(e),e),t,3)}function M8(e,t){return Pr(e.getMilliseconds(),t,3)}function Qle(e,t){return M8(e,t)+"000"}function Jle(e,t){return Pr(e.getMonth()+1,t,2)}function ece(e,t){return Pr(e.getMinutes(),t,2)}function tce(e,t){return Pr(e.getSeconds(),t,2)}function nce(e){var t=e.getDay();return 0===t?7:t}function ice(e,t){return Pr(f0.count(Nd(e)-1,e),t,2)}function T8(e){var t=e.getDay();return t>=4||0===t?Kg(e):Kg.ceil(e)}function rce(e,t){return e=T8(e),Pr(Kg.count(Nd(e),e)+(4===Nd(e).getDay()),t,2)}function oce(e){return e.getDay()}function sce(e,t){return Pr(Zx.count(Nd(e)-1,e),t,2)}function ace(e,t){return Pr(e.getFullYear()%100,t,2)}function lce(e,t){return Pr((e=T8(e)).getFullYear()%100,t,2)}function cce(e,t){return Pr(e.getFullYear()%1e4,t,4)}function uce(e,t){var n=e.getDay();return Pr((e=n>=4||0===n?Kg(e):Kg.ceil(e)).getFullYear()%1e4,t,4)}function dce(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Pr(t/60|0,"0",2)+Pr(t%60,"0",2)}function D8(e,t){return Pr(e.getUTCDate(),t,2)}function hce(e,t){return Pr(e.getUTCHours(),t,2)}function fce(e,t){return Pr(e.getUTCHours()%12||12,t,2)}function pce(e,t){return Pr(1+jM.count(zd(e),e),t,3)}function S8(e,t){return Pr(e.getUTCMilliseconds(),t,3)}function mce(e,t){return S8(e,t)+"000"}function gce(e,t){return Pr(e.getUTCMonth()+1,t,2)}function _ce(e,t){return Pr(e.getUTCMinutes(),t,2)}function yce(e,t){return Pr(e.getUTCSeconds(),t,2)}function vce(e){var t=e.getUTCDay();return 0===t?7:t}function bce(e,t){return Pr(p0.count(zd(e)-1,e),t,2)}function I8(e){var t=e.getUTCDay();return t>=4||0===t?Jg(e):Jg.ceil(e)}function xce(e,t){return e=I8(e),Pr(Jg.count(zd(e),e)+(4===zd(e).getUTCDay()),t,2)}function wce(e){return e.getUTCDay()}function Ece(e,t){return Pr(Xx.count(zd(e)-1,e),t,2)}function Cce(e,t){return Pr(e.getUTCFullYear()%100,t,2)}function Mce(e,t){return Pr((e=I8(e)).getUTCFullYear()%100,t,2)}function Tce(e,t){return Pr(e.getUTCFullYear()%1e4,t,4)}function Dce(e,t){var n=e.getUTCDay();return Pr((e=n>=4||0===n?Jg(e):Jg.ceil(e)).getUTCFullYear()%1e4,t,4)}function Sce(){return"+0000"}function A8(){return"%"}function P8(e){return+e}function O8(e){return Math.floor(+e/1e3)}function Oce(e){return new Date(e)}function kce(e){return e instanceof Date?+e:+new Date(+e)}function PP(e,t,n,i,r,s,u,h,g,x){var C=q6(),S=C.invert,O=C.domain,F=x(".%L"),$=x(":%S"),G=x("%I:%M"),Y=x("%I %p"),J=x("%a %d"),Q=x("%b %d"),he=x("%B"),ue=x("%Y");function we(Ie){return(g(Ie)<Ie?F:h(Ie)<Ie?$:u(Ie)<Ie?G:s(Ie)<Ie?Y:i(Ie)<Ie?r(Ie)<Ie?J:Q:n(Ie)<Ie?he:ue)(Ie)}return C.invert=function(Ie){return new Date(S(Ie))},C.domain=function(Ie){return arguments.length?O(Array.from(Ie,kce)):O().map(Oce)},C.ticks=function(Ie){var Qe=O();return e(Qe[0],Qe[Qe.length-1],Ie??10)},C.tickFormat=function(Ie,Qe){return null==Qe?we:x(Qe)},C.nice=function(Ie){var Qe=O();return(!Ie||"function"!=typeof Ie.range)&&(Ie=t(Qe[0],Qe[Qe.length-1],Ie??10)),Ie?O(Z6(Qe,Ie)):C},C.copy=function(){return qx(C,PP(e,t,n,i,r,s,u,h,g,x))},C}function vm(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function WM(){var r,s,u,h,g,C,O,e=0,t=.5,n=1,i=1,x=Lu,S=!1;function F(G){return isNaN(G=+G)?O:(G=.5+((G=+C(G))-s)*(i*G<i*s?h:g),x(S?Math.max(0,Math.min(1,G)):G))}function $(G){return function(Y){var J,Q,he;return arguments.length?([J,Q,he]=Y,x=kM(G,[J,Q,he]),F):[x(0),x(.5),x(1)]}}return F.domain=function(G){return arguments.length?([e,t,n]=G,r=C(e=+e),s=C(t=+t),u=C(n=+n),h=r===s?0:.5/(s-r),g=s===u?0:.5/(u-s),i=s<r?-1:1,F):[e,t,n]},F.clamp=function(G){return arguments.length?(S=!!G,F):S},F.interpolator=function(G){return arguments.length?(x=G,F):x},F.range=$(Gx),F.rangeRound=$(aP),F.unknown=function(G){return arguments.length?(O=G,F):O},function(G){return C=G,r=G(e),s=G(t),u=G(n),h=r===s?0:.5/(s-r),g=s===u?0:.5/(u-s),i=s<r?-1:1,F}}function R8(){var e=Wx(WM()(Lu));return e.copy=function(){return vm(e,R8())},RM.apply(e,arguments)}function L8(){var e=Q6(WM()).domain([.1,1,10]);return e.copy=function(){return vm(e,L8()).base(e.base())},RM.apply(e,arguments)}function F8(){var e=n8(WM());return e.copy=function(){return vm(e,F8()).constant(e.constant())},RM.apply(e,arguments)}function OP(){var e=o8(WM());return e.copy=function(){return vm(e,OP()).exponent(e.exponent())},RM.apply(e,arguments)}function ki(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(6*i,6*++i);return n}!function Pce(e){m0=function Ile(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,s=e.days,u=e.shortDays,h=e.months,g=e.shortMonths,x=Kx(r),C=Qx(r),S=Kx(s),O=Qx(s),F=Kx(u),$=Qx(u),G=Kx(h),Y=Qx(h),J=Kx(g),Q=Qx(g),he={a:function Re(ft){return u[ft.getDay()]},A:function We(ft){return s[ft.getDay()]},b:function Ye(ft){return g[ft.getMonth()]},B:function Dt(ft){return h[ft.getMonth()]},c:null,d:C8,e:C8,f:Qle,g:lce,G:uce,H:Xle,I:Yle,j:Kle,L:M8,m:Jle,M:ece,p:function Bt(ft){return r[+(ft.getHours()>=12)]},q:function Lt(ft){return 1+~~(ft.getMonth()/3)},Q:P8,s:O8,S:tce,u:nce,U:ice,V:rce,w:oce,W:sce,x:null,X:null,y:ace,Y:cce,Z:dce,"%":A8},ue={a:function Dn(ft){return u[ft.getUTCDay()]},A:function fn(ft){return s[ft.getUTCDay()]},b:function qi(ft){return g[ft.getUTCMonth()]},B:function Gr(ft){return h[ft.getUTCMonth()]},c:null,d:D8,e:D8,f:mce,g:Mce,G:Dce,H:hce,I:fce,j:pce,L:S8,m:gce,M:_ce,p:function Yt(ft){return r[+(ft.getUTCHours()>=12)]},q:function hn(ft){return 1+~~(ft.getUTCMonth()/3)},Q:P8,s:O8,S:yce,u:vce,U:bce,V:xce,w:wce,W:Ece,x:null,X:null,y:Cce,Y:Tce,Z:Sce,"%":A8},we={a:function At(ft,pn,bn){var bt=F.exec(pn.slice(bn));return bt?(ft.w=$.get(bt[0].toLowerCase()),bn+bt[0].length):-1},A:function at(ft,pn,bn){var bt=S.exec(pn.slice(bn));return bt?(ft.w=O.get(bt[0].toLowerCase()),bn+bt[0].length):-1},b:function jt(ft,pn,bn){var bt=J.exec(pn.slice(bn));return bt?(ft.m=Q.get(bt[0].toLowerCase()),bn+bt[0].length):-1},B:function Ht(ft,pn,bn){var bt=G.exec(pn.slice(bn));return bt?(ft.m=Y.get(bt[0].toLowerCase()),bn+bt[0].length):-1},c:function Ae(ft,pn,bn){return ut(ft,t,pn,bn)},d:w8,e:w8,f:Gle,g:x8,G:b8,H:E8,I:E8,j:Vle,L:Hle,m:Ule,M:jle,p:function Ct(ft,pn,bn){var bt=x.exec(pn.slice(bn));return bt?(ft.p=C.get(bt[0].toLowerCase()),bn+bt[0].length):-1},q:Ble,Q:Wle,s:Zle,S:$le,u:Rle,U:Lle,V:Fle,w:kle,W:Nle,x:function Ne(ft,pn,bn){return ut(ft,n,pn,bn)},X:function ge(ft,pn,bn){return ut(ft,i,pn,bn)},y:x8,Y:b8,Z:zle,"%":qle};function Ie(ft,pn){return function(bn){var Ji,zn,no,bt=[],Gn=-1,yi=0,wr=ft.length;for(bn instanceof Date||(bn=new Date(+bn));++Gn<wr;)37===ft.charCodeAt(Gn)&&(bt.push(ft.slice(yi,Gn)),null!=(zn=v8[Ji=ft.charAt(++Gn)])?Ji=ft.charAt(++Gn):zn="e"===Ji?" ":"0",(no=pn[Ji])&&(Ji=no(bn,zn)),bt.push(Ji),yi=Gn+1);return bt.push(ft.slice(yi,Gn)),bt.join("")}}function Qe(ft,pn){return function(bn){var yi,wr,bt=Yx(1900,void 0,1);if(ut(bt,ft,bn+="",0)!=bn.length)return null;if("Q"in bt)return new Date(bt.Q);if("s"in bt)return new Date(1e3*bt.s+("L"in bt?bt.L:0));if(pn&&!("Z"in bt)&&(bt.Z=0),"p"in bt&&(bt.H=bt.H%12+12*bt.p),void 0===bt.m&&(bt.m="q"in bt?bt.q:0),"V"in bt){if(bt.V<1||bt.V>53)return null;"w"in bt||(bt.w=1),"Z"in bt?(wr=(yi=AP(Yx(bt.y,0,1))).getUTCDay(),yi=wr>4||0===wr?Xx.ceil(yi):Xx(yi),yi=jM.offset(yi,7*(bt.V-1)),bt.y=yi.getUTCFullYear(),bt.m=yi.getUTCMonth(),bt.d=yi.getUTCDate()+(bt.w+6)%7):(wr=(yi=IP(Yx(bt.y,0,1))).getDay(),yi=wr>4||0===wr?Zx.ceil(yi):Zx(yi),yi=h0.offset(yi,7*(bt.V-1)),bt.y=yi.getFullYear(),bt.m=yi.getMonth(),bt.d=yi.getDate()+(bt.w+6)%7)}else("W"in bt||"U"in bt)&&("w"in bt||(bt.w="u"in bt?bt.u%7:"W"in bt?1:0),wr="Z"in bt?AP(Yx(bt.y,0,1)).getUTCDay():IP(Yx(bt.y,0,1)).getDay(),bt.m=0,bt.d="W"in bt?(bt.w+6)%7+7*bt.W-(wr+5)%7:bt.w+7*bt.U-(wr+6)%7);return"Z"in bt?(bt.H+=bt.Z/100|0,bt.M+=bt.Z%100,AP(bt)):IP(bt)}}function ut(ft,pn,bn,bt){for(var Ji,zn,Gn=0,yi=pn.length,wr=bn.length;Gn<yi;){if(bt>=wr)return-1;if(37===(Ji=pn.charCodeAt(Gn++))){if(Ji=pn.charAt(Gn++),!(zn=we[Ji in v8?pn.charAt(Gn++):Ji])||(bt=zn(ft,bn,bt))<0)return-1}else if(Ji!=bn.charCodeAt(bt++))return-1}return bt}return he.x=Ie(n,he),he.X=Ie(i,he),he.c=Ie(t,he),ue.x=Ie(n,ue),ue.X=Ie(i,ue),ue.c=Ie(t,ue),{format:function(ft){var pn=Ie(ft+="",he);return pn.toString=function(){return ft},pn},parse:function(ft){var pn=Qe(ft+="",!1);return pn.toString=function(){return ft},pn},utcFormat:function(ft){var pn=Ie(ft+="",ue);return pn.toString=function(){return ft},pn},utcParse:function(ft){var pn=Qe(ft+="",!0);return pn.toString=function(){return ft},pn}}}(e),GM=m0.format,Jx=m0.utcFormat}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});const Bce=ki("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Uce=ki("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),Vce=ki("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),jce=ki("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),$ce=ki("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),Hce=ki("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Gce=ki("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),qce=ki("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Wce=ki("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),Zce=ki("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),to=e=>joe(e[e.length-1]);var N8=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(ki);const z8=to(N8);var B8=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(ki);const U8=to(B8);var V8=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(ki);const j8=to(V8);var $8=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(ki);const H8=to($8);var kP=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(ki);const ZM=to(kP);var G8=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(ki);const q8=to(G8);var RP=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(ki);const XM=to(RP);var W8=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(ki);const Z8=to(W8);var X8=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(ki);const Y8=to(X8);var K8=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(ki);const Q8=to(K8);var J8=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(ki);const eU=to(J8);var tU=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(ki);const nU=to(tU);var iU=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(ki);const rU=to(iU);var oU=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(ki);const sU=to(oU);var aU=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(ki);const lU=to(aU);var cU=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(ki);const uU=to(cU);var dU=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(ki);const hU=to(dU);var fU=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(ki);const pU=to(fU);var mU=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(ki);const gU=to(mU);var _U=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(ki);const yU=to(_U);var vU=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(ki);const bU=to(vU);var xU=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(ki);const wU=to(xU);var EU=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(ki);const CU=to(EU);var MU=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(ki);const TU=to(MU);var DU=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(ki);const SU=to(DU);var IU=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(ki);const AU=to(IU);var PU=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(ki);const OU=to(PU);function kU(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-2710.57*e)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-67.37*e)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-2475.67*e)))))))+")"}var LP=1.78277,FP=-.29227,YM=-.90649,e1=1.97294,LU=e1*YM,FU=e1*LP,NU=LP*FP- -.14861*YM;function Fh(e,t,n,i){return 1===arguments.length?function Xce(e){if(e instanceof e_)return new e_(e.h,e.s,e.l,e.opacity);e instanceof ya||(e=MA(e));var n=e.g/255,i=e.b/255,r=(NU*i+LU*(e.r/255)-FU*n)/(NU+LU-FU),s=i-r,u=(e1*(n-r)-FP*s)/YM,h=Math.sqrt(u*u+s*s)/(e1*r*(1-r)),g=h?Math.atan2(u,s)*O6-120:NaN;return new e_(g<0?g+360:g,h,r,e.opacity)}(e):new e_(e,t,n,i??1)}function e_(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function zU(e){return function t(n){function i(r,s){var u=e((r=Fh(r)).h,(s=Fh(s)).h),h=va(r.s,s.s),g=va(r.l,s.l),x=va(r.opacity,s.opacity);return function(C){return r.h=u(C),r.s=h(C),r.l=g(Math.pow(C,n)),r.opacity=x(C),r+""}}return n=+n,i.gamma=t,i}(1)}e0(e_,Fh,Ix(pm,{brighter(e){return e=null==e?t0:Math.pow(t0,e),new e_(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new e_(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*P6,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new ya(255*(t+n*(-.14861*i+LP*r)),255*(t+n*(FP*i+YM*r)),255*(t+n*(e1*i)),this.opacity)}})),zU(SA);var NP=zU(va);const BU=NP(Fh(300,.5,0),Fh(-240,.5,1));var UU=NP(Fh(-100,.75,.35),Fh(80,1.5,.8)),VU=NP(Fh(260,.75,.35),Fh(80,1.5,.8)),KM=Fh();function jU(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return KM.h=360*e-100,KM.s=1.5-1.5*t,KM.l=.8-.9*t,KM+""}var QM=gm(),Yce=Math.PI/3,Kce=2*Math.PI/3;function $U(e){var t;return e=(.5-e)*Math.PI,QM.r=255*(t=Math.sin(e))*t,QM.g=255*(t=Math.sin(e+Yce))*t,QM.b=255*(t=Math.sin(e+Kce))*t,QM+""}function HU(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-14825.05*e)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+707.56*e)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-6838.66*e)))))))+")"}function JM(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}const GU=JM(ki("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var qU=JM(ki("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),WU=JM(ki("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),ZU=JM(ki("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function t1(e){return"string"==typeof e?new Zc([[document.querySelector(e)]],[document.documentElement]):new Zc([[e]],Nz)}Math,Math;const XU=Math.cos,zP=(Math,Math.min),eT=Math.sin,Gs=Math.sqrt,g0=Math.PI,tT=2*g0,eue=Gs(3),KU={draw(e,t){const n=.59436*Gs(t+zP(t/28,.75)),i=n/2,r=i*eue;e.moveTo(0,n),e.lineTo(0,-n),e.moveTo(-r,-i),e.lineTo(r,i),e.moveTo(-r,i),e.lineTo(r,-i)}},BP={draw(e,t){const n=Gs(t/g0);e.moveTo(n,0),e.arc(0,0,n,0,tT)}},QU={draw(e,t){const n=Gs(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},JU=Gs(1/3),tue=2*JU,eV={draw(e,t){const n=Gs(t/tue),i=n*JU;e.moveTo(0,-n),e.lineTo(i,0),e.lineTo(0,n),e.lineTo(-i,0),e.closePath()}},tV={draw(e,t){const n=.62625*Gs(t);e.moveTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.lineTo(-n,0),e.closePath()}},nV={draw(e,t){const n=.87559*Gs(t-zP(t/7,2));e.moveTo(-n,0),e.lineTo(n,0),e.moveTo(0,n),e.lineTo(0,-n)}},iV={draw(e,t){const n=Gs(t),i=-n/2;e.rect(i,i,n,n)}},rV={draw(e,t){const n=.4431*Gs(t);e.moveTo(n,n),e.lineTo(n,-n),e.lineTo(-n,-n),e.lineTo(-n,n),e.closePath()}},oV=eT(g0/10)/eT(7*g0/10),iue=eT(tT/10)*oV,rue=-XU(tT/10)*oV,sV={draw(e,t){const n=Gs(.8908130915292852*t),i=iue*n,r=rue*n;e.moveTo(0,-n),e.lineTo(i,r);for(let s=1;s<5;++s){const u=tT*s/5,h=XU(u),g=eT(u);e.lineTo(g*n,-h*n),e.lineTo(h*i-g*r,g*i+h*r)}e.closePath()}},UP=Gs(3),aV={draw(e,t){const n=-Gs(t/(3*UP));e.moveTo(0,2*n),e.lineTo(-UP*n,-n),e.lineTo(UP*n,-n),e.closePath()}},oue=Gs(3),lV={draw(e,t){const n=.6824*Gs(t),i=n/2,r=n*oue/2;e.moveTo(0,-n),e.lineTo(r,i),e.lineTo(-r,i),e.closePath()}},Nu=-.5,zu=Gs(3)/2,VP=1/Gs(12),sue=3*(VP/2+1),cV={draw(e,t){const n=Gs(t/sue),i=n/2,r=n*VP,s=i,u=n*VP+n,h=-s,g=u;e.moveTo(i,r),e.lineTo(s,u),e.lineTo(h,g),e.lineTo(Nu*i-zu*r,zu*i+Nu*r),e.lineTo(Nu*s-zu*u,zu*s+Nu*u),e.lineTo(Nu*h-zu*g,zu*h+Nu*g),e.lineTo(Nu*i+zu*r,Nu*r-zu*i),e.lineTo(Nu*s+zu*u,Nu*u-zu*s),e.lineTo(Nu*h+zu*g,Nu*g-zu*h),e.closePath()}},uV={draw(e,t){const n=.6189*Gs(t-zP(t/6,1.7));e.moveTo(-n,-n),e.lineTo(n,n),e.moveTo(-n,n),e.lineTo(n,-n)}},aue=[BP,QU,eV,iV,sV,aV,cV],lue=[BP,nV,uV,lV,KU,rV,tV];function _0(e,t,n){this.k=e,this.x=t,this.y=n}function t_(e){return null!=e&&!Number.isNaN(e)}function Bd(e,t){return+t_(t)-+t_(e)||fc(e,t)}function nT(e,t){return+t_(t)-+t_(e)||yx(e,t)}function hV(e){return null!=e&&""!=`${e}`}function fV(e){return isFinite(e)?e:NaN}function jP(e){return e>0&&isFinite(e)?e:NaN}function pV(e){return e<0&&isFinite(e)?e:NaN}_0.prototype={constructor:_0,scale:function(e){return 1===e?this:new _0(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new _0(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new _0(1,0,0);const gue=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function mV(e,t){return gue.test(e+="")?new Date(e):"function"==typeof t?t(e):t}const HP=36e5,n1=24*HP,gV=30*n1,r1=[["millisecond",500],["second",1e3],["second",3e4],["minute",6e4],["minute",18e5],["hour",HP],["hour",12*HP],["day",n1],["day",2*n1],["week",6048e5],["month",gV],["month",3*gV],["year",31536e6]],vue=new Map([["second",Zf],["minute",zM],["hour",UM],["day",h0],["week",f0],["month",$M],["year",Nd],["monday",Zx],["tuesday",c8],["wednesday",u8],["thursday",Kg],["friday",d8],["saturday",h8],["sunday",f0]]),bue=new Map([["second",Zf],["minute",BM],["hour",VM],["day",SP],["week",p0],["month",HM],["year",zd],["monday",Xx],["tuesday",f8],["wednesday",p8],["thursday",Jg],["friday",m8],["saturday",g8],["sunday",p0]]);function _V(e,t){let n=`${e}`.toLowerCase();n.endsWith("s")&&(n=n.slice(0,-1));let i=1;const r=/^(?:(\d+)\s+)/.exec(n);switch(r&&(n=n.slice(r[0].length),i=+r[1]),n){case"quarter":n="month",i*=3;break;case"half":n="month",i*=6}let s=t.get(n);if(!s)throw new Error(`unknown interval: ${e}`);if(!(i>1))return s;if(!s.every)throw new Error(`non-periodic interval: ${n}`);return s.every(i)}function xue(e){return _V(e,vue)}function yV(e){return _V(e,bue)}function n_(e,t,n){return(i,r,s)=>{const u=e(i,r),h=t(i,r),g=r-v0(s);return r!==g&&void 0!==s[g]&&h===t(s[g],g)?u:n(u,h)}}const o1=Object.getPrototypeOf(Uint8Array),Tue=Object.prototype.toString;function xa(e,t,n){const i=typeof t;return"string"===i?vV(e,xV(t),n):"function"===i?vV(e,t,n):"number"===i||t instanceof Date||"boolean"===i?qs(e,s1(t),n):function bV(e,t){return void 0===t?Kc(e):e instanceof t?e:t.prototype instanceof o1&&!(e instanceof o1)?t.from(e,WP):t.from(e)}("function"==typeof t?.transform?t.transform(e):t,n)}function vV(e,t,n){return qs(e,n?.prototype instanceof o1?function Due(e){return(t,n)=>WP(e(t,n))}(t):t,n)}const rT=[null],xV=e=>t=>t[e],oT={transform:Nh},Fa={transform:e=>e},Sue=()=>1,Iue=()=>!0,zl=e=>null==e?e:`${e}`,lo=e=>null==e?e:+e,GP=e=>e?e[0]:void 0,qP=e=>e?e[1]:void 0,s1=e=>()=>e;function sT(e){return e instanceof o1?e:qs(e,WP,Float64Array)}function WP(e){return null==e?NaN:Number(e)}function Pue(e){return qs(e,wV)}function wV(e){return e instanceof Date&&!isNaN(e)?e:"string"==typeof e?mV(e):null==e||isNaN(e=+e)?void 0:new Date(e)}function Xf(e,t){return void 0===e&&(e=t),null===e?[void 0,"none"]:dT(e)?[void 0,e]:[e,void 0]}function Yc(e,t){return void 0===e&&(e=t),null===e||"number"==typeof e?[void 0,e]:[e,void 0]}function aT(e,t,n){if(null!=e)return Yf(e,t,n)}function Yf(e,t,n){const i=`${e}`.toLowerCase();if(!n.includes(i))throw new Error(`invalid ${t}: ${e}`);return i}function Kc(e){return null==e||e instanceof Array||e instanceof o1?e:Array.from(e)}function qs(e,t,n=Array){return null==e?e:e instanceof n?e.map(t):n.from(e,t)}function ZP(e,t=Array){return e instanceof t?e.slice():t.from(e)}function EV({x:e,x1:t,x2:n}){return void 0!==e||void 0!==t||void 0!==n}function CV({y:e,y1:t,y2:n}){return void 0!==e||void 0!==t||void 0!==n}function XP(e){return EV(e)||CV(e)||void 0!==e.interval}function i_(e){return e?.toString===Tue}function YP(e){return i_(e)&&(void 0!==e.type||void 0!==e.domain)}function KP(e){return i_(e)&&"function"!=typeof e.transform}function a1(e){return KP(e)&&void 0===e.value&&void 0===e.channel}function MV(e,t,n,i=Fa){return void 0===t&&void 0===n?(t=0,n=void 0===e?i:e):void 0===t?t=void 0===e?0:e:void 0===n&&(n=void 0===e?0:e),[t,n]}function TV(e,t){return void 0===e&&void 0===t?[GP,qP]:[e,t]}function Nh(e){const t=e.length,n=new Uint32Array(t);for(let i=0;i<t;++i)n[i]=i;return n}function QP(e,t){return qs(t,n=>e[n])}function kue(e,t,n){return e.subarray?e.subarray(t,n):e.slice(t,n)}function lT(e){return null!==e&&"object"==typeof e?e.valueOf():e}function cT(e){let t;return[{transform:()=>t,label:r_(e)},n=>t=n]}function Kf(e){return null==e?[e]:cT(e)}function r_(e,t){return"string"==typeof e?e:e&&void 0!==e.label?e.label:t}function uT(e,t){return{transform(n){const i=e.transform(n),r=t.transform(n);return Ud(i)||Ud(r)?qs(i,(s,u)=>new Date((+i[u]+ +r[u])/2)):qs(i,(s,u)=>(+i[u]+ +r[u])/2,Float64Array)},label:e.label}}function DV(e,t){const n=SV(t?.interval,t?.type);return n?qs(e,n):e}function SV(e,t){const n=JP(e,t);return n&&(i=>t_(i)?n.floor(i):i)}function JP(e,t){if(null!=e){if("number"==typeof e){0<e&&e<1&&Number.isInteger(1/e)&&(e=-1/e);const n=Math.abs(e);return e<0?{floor:i=>Math.floor(i*n)/n,offset:i=>(i*n+1)/n,range:(i,r)=>hA(Math.ceil(i*n),r*n).map(s=>s/n)}:{floor:i=>Math.floor(i/n)*n,offset:i=>i+n,range:(i,r)=>hA(Math.ceil(i/n),r/n).map(s=>s*n)}}if("string"==typeof e)return("time"===t?xue:yV)(e);if("function"!=typeof e.floor)throw new Error("invalid interval; missing floor method");if("function"!=typeof e.offset)throw new Error("invalid interval; missing offset method");return e}}function y0(e,t){if((e=JP(e,t))&&"function"!=typeof e.range)throw new Error("invalid interval: missing range method");return e}function l1(e){return void 0===e||KP(e)?e:{value:e}}function zh(e){return e&&"function"==typeof e[Symbol.iterator]}function IV(e){for(const t of e)if(null!=t)return"object"!=typeof t||t instanceof Date}function AV(e){for(const t of e){if(null==t)continue;const n=typeof t;return"string"===n||"boolean"===n}}function Ud(e){for(const t of e)if(null!=t)return t instanceof Date}function Nue(e){for(const t of e)if(null!=t)return"string"==typeof t&&isNaN(t)&&mV(t)}function zue(e){for(const t of e)if(null!=t){if("string"!=typeof t)return!1;if(t.trim())return!isNaN(t)}}function eO(e,t){let n;for(const i of e)if(null!=i){if(!t(i))return!1;n=!0}return n}function dT(e){return"string"==typeof e&&("none"===(e=e.toLowerCase().trim())||"currentcolor"===e||e.startsWith("url(")&&e.endsWith(")")||e.startsWith("var(")&&e.endsWith(")")||null!==mm(e))}function Uue(e){return"number"==typeof e&&(0<=e&&e<=1||isNaN(e))}function mc(e){return null==e||c1(e)}function c1(e){return/^\s*none\s*$/i.test(e)}function PV(e,t){return aT(e,t,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function tO(e="middle"){return PV(e,"frameAnchor")}function v0(e){if(null!=e)return yx(e[0],e[e.length-1])}function OV(e){return zh(e)?function $ue(e){console.warn("named iterables are deprecated; please use an object instead");const t=new Set;return Object.fromEntries(Array.from(e,n=>{const{name:i}=n;if(null==i)throw new Error("missing name");const r=`${i}`;if("__proto__"===r)throw new Error(`illegal name: ${r}`);if(t.has(r))throw new Error(`duplicate name: ${r}`);return t.add(r),[i,n]}))}(e):e}const Bh=Symbol("position"),Qf=Symbol("color"),hT=Symbol("radius"),fT=Symbol("length"),pT=Symbol("opacity"),mT=Symbol("symbol"),Hue=Symbol("projection"),$o=new Map([["x",Bh],["y",Bh],["fx",Bh],["fy",Bh],["r",hT],["color",Qf],["opacity",pT],["symbol",mT],["length",fT],["projection",Hue]]),Gue=2/Math.sqrt(3),nO=new Map([["asterisk",KU],["circle",BP],["cross",QU],["diamond",eV],["diamond2",tV],["hexagon",{draw(e,t){const n=Math.sqrt(t/Math.PI),i=n*Gue,r=i/2;e.moveTo(0,i),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(0,-i),e.lineTo(-n,-r),e.lineTo(-n,r),e.closePath()}}],["plus",nV],["square",iV],["square2",rV],["star",sV],["times",uV],["triangle",aV],["triangle2",lV],["wye",cV]]);function iO(e){return e&&"function"==typeof e.draw}function Wue(e){return!!iO(e)||"string"==typeof e&&nO.has(e.toLowerCase())}function rO(e){if(null==e||iO(e))return e;const t=nO.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid symbol: ${e}`)}function b0(e,...t){for(const{name:n}of e)if(t.includes(n))return!0;return!1}function oO(e,t,n,i=sO){let r;i_(t)&&"reduce"in t&&(r=t.scale,t=t.reduce);const s=i(e,t,n),[u,h]=cT(s.label);let g;return{name:e,output:void 0===r?u:{value:u,scale:r},initialize(x){s.initialize(x),g=h([])},scope(x,C){s.scope(x,C)},reduce(x,C){g.push(s.reduce(x,C))}}}function sO(e,t,n,i=_T){const r=function Rue(e,t){if(void 0!==t[e])return t[e];switch(e){case"x1":case"x2":e="x";break;case"y1":case"y2":e="y"}return t[e]}(e,n),s=i(t,r);let u,h;return{label:r_(s===yT?null:r,s.label),initialize(g){u=void 0===r?g:xa(g,r),"data"===s.scope&&(h=s.reduceIndex(Nh(g),u))},scope(g,x){s.scope===g&&(h=s.reduceIndex(x,u))},reduce:(g,x)=>null==s.scope?s.reduceIndex(g,u,x):s.reduceIndex(g,u,h,x)}}function u1(e,t){return t?bx(cA(e,n=>t[n]),GP):[[,e]]}function _T(e,t,n=Xue){if(null==e)return n(e);if("function"==typeof e.reduceIndex)return e;if("function"==typeof e.reduce&&i_(e))return function Yue(e){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...e,reduceIndex:e.reduce.bind(e)}}(e);if("function"==typeof e)return function Kue(e){return{reduceIndex:(t,n,i)=>e(QP(n,t),i)}}(e);if(/^p\d{2}$/i.test(e))return Jf(function Aue(e){const t=+`${e}`.slice(1)/100;return(n,i)=>Yy(n,t,i)}(e));switch(`${e}`.toLowerCase()){case"first":return NV;case"last":return Jue;case"identity":return aO;case"count":return yT;case"distinct":return ede;case"sum":return null==t?yT:tde;case"proportion":return zV(t,"data");case"proportion-facet":return zV(t,"facet");case"deviation":return Jf(mz);case"min":return Jf(Bf);case"min-index":return Jf(gie);case"max":return Jf(Ih);case"max-index":return Jf(pie);case"mean":return FV(mie);case"median":return FV(zC);case"variance":return Jf(pz);case"mode":return Jf(_ie)}return n(e)}function Xue(e){throw new Error(`invalid reduce: ${e}`)}function Jf(e){return{reduceIndex:(t,n)=>e(t,i=>n[i])}}function FV(e){return{reduceIndex(t,n){const i=e(t,r=>n[r]);return Ud(n)?new Date(i):i}}}const aO={reduceIndex:(e,t)=>QP(t,e)},NV={reduceIndex:(e,t)=>t[e[0]]},Que={reduceIndex(e,t){const i=bx(Zy(e,s=>s.length,s=>t[s]),qP),r=i.slice(-5).reverse();if(r.length<i.length){const s=i.slice(0,-4);r[4]=[`\u2026 ${s.length.toLocaleString("en-US")} more`,fm(s,qP)]}return r.map(([s,u])=>`${s} (${u.toLocaleString("en-US")})`).join("\n")}},Jue={reduceIndex:(e,t)=>t[e[e.length-1]]},yT={label:"Frequency",reduceIndex:e=>e.length},ede={label:"Distinct",reduceIndex(e,t){const n=new sA;for(const i of e)n.add(t[i]);return n.size}},tde=Jf(fm);function zV(e,t){return null==e?{scope:t,label:"Frequency",reduceIndex:(n,i,r=1)=>n.length/r}:{scope:t,reduceIndex:(n,i,r=1)=>fm(n,s=>i[s])/r}}function d1(e,{scale:t,type:n,value:i,filter:r,hint:s},u){return void 0===s&&"function"==typeof i?.transform&&(s=i.hint),BV(u,{scale:t,type:n,value:xa(e,i),label:r_(i),filter:r,hint:s})}function BV(e,t){const{scale:n,value:i}=t;if(!0===n||"auto"===n)switch(e){case"fill":case"stroke":case"color":t.scale=!0!==n&&eO(i,dT)?null:"color";break;case"fillOpacity":case"strokeOpacity":case"opacity":t.scale=!0!==n&&eO(i,Uue)?null:"opacity";break;case"symbol":!0!==n&&eO(i,Wue)?(t.scale=null,t.value=qs(i,rO)):t.scale="symbol";break;default:t.scale=$o.has(e)?e:null}else if(!1===n)t.scale=null;else if(null!=n&&!$o.has(n))throw new Error(`unknown scale: ${n}`);return t}function ode(e,t){for(const n in e){const i=e[n];if(i.scale===t)return i}}function sde(e,t){const n=e.original;if(n===e)return t;const i=t.value,r=t.value=[];for(let s=0;s<n.length;++s){const u=i[n[s][0]];for(const h of e[s])r[h]=u}return t}function UV(e,t,n){const i=lO(e,t);return qs(lO(e,n),(s,u)=>Math.abs(s-i[u]),Float64Array)}function lO(e,t,n){let i=e[t];if(!i&&void 0!==n&&(i=e[n]),i)return i.value;throw new Error(`missing channel: ${t}`)}function ade(e){if(null==e||"function"==typeof e)return e;switch(`${e}`.toLowerCase()){case"ascending":return VV;case"descending":return jV}throw new Error(`invalid order: ${e}`)}function VV([e,t],[n,i]){return Bd(t,i)||Bd(e,n)}function jV([e,t],[n,i]){return nT(t,i)||Bd(e,n)}function lde(e,t){let n=e[t];if(n){for(;n.source;)n=n.source;return null===n.source?null:n}}function cO(e={}){const{document:t=(typeof window<"u"?window.document:void 0)}=e;return{document:t}}function Bl(e,{document:t}){return t1(WC(e).call(t.documentElement))}let uO=0;function x0(e){console.warn(e),++uO}const $V=Math.PI,ep=2*$V,HV=.618;function GV(e){switch(`${e}`.toLowerCase()){case"albers-usa":return Vd(zae,.7463,.4673);case"albers":return vT(b6,.7463,.4673);case"azimuthal-equal-area":return Vd(Bae,4,4);case"azimuthal-equidistant":return Vd(Uae,ep,ep);case"conic-conformal":return vT($ae,ep,ep);case"conic-equal-area":return vT(DM,6.1702,2.9781);case"conic-equidistant":return vT(qae,7.312,3.6282);case"equal-earth":return Vd(Zae,5.4133,2.6347);case"equirectangular":return Vd(Hae,ep,$V);case"gnomonic":return Vd(Xae,3.4641,3.4641);case"identity":return{type:qV};case"reflect-y":return{type:hde};case"mercator":return Vd(Vae,ep,ep);case"orthographic":return Vd(Yae,2,2);case"stereographic":return Vd(Kae,2,2);case"transverse-mercator":return Vd(Qae,ep,ep);default:throw new Error(`unknown projection type: ${e}`)}}function Vd(e,t,n){return{type:({width:i,height:r,rotate:s,precision:u=.15,clip:h})=>{const g=e();return null!=u&&g.precision?.(u),null!=s&&g.rotate?.(s),"number"==typeof h&&g.clipAngle?.(h),g.scale(Math.min(i/t,r/n)),g.translate([i/2,r/2]),g},aspectRatio:n/t}}function vT(e,t,n){const{type:i,aspectRatio:r}=Vd(e,t,n);return{type:s=>{const{parallels:u,domain:h,width:g,height:x}=s,C=i(s);return null!=u&&(C.parallels(u),void 0===h&&C.fitSize([g,x],{type:"Sphere"})),C},aspectRatio:r}}const qV=s1({stream:e=>e}),hde=s1(nP({point(e,t){this.stream.point(e,-t)}}));function WV(e,t,n,i){const r=n[e],s=n[t],u=r.length,h=n[e]=new Float64Array(u).fill(NaN),g=n[t]=new Float64Array(u).fill(NaN);let x;const C=i.stream({point(S,O){h[x]=S,g[x]=O}});for(x=0;x<u;++x)C.point(r[x],s[x])}function fde({projection:e}={}){return null!=e&&("function"==typeof e.stream||(i_(e)&&(e=e.type),null!=e))}function mde(e){const t=[],n=[],i={scale:"x",value:t},r={scale:"y",value:n},s={point(u,h){t.push(u),n.push(h)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(const u of e.value)Wg(u,s);return[i,r]}const ZV=new Map([["accent",Uce],["category10",Bce],["dark2",Vce],["paired",jce],["pastel1",$ce],["pastel2",Hce],["set1",Gce],["set2",qce],["set3",Wce],["tableau10",Zce]]),XV=new Map([...ZV,["brbg",tp(N8,z8)],["prgn",tp(B8,U8)],["piyg",tp(V8,j8)],["puor",tp($8,H8)],["rdbu",tp(kP,ZM)],["rdgy",tp(G8,q8)],["rdylbu",tp(RP,XM)],["rdylgn",tp(W8,Z8)],["spectral",tp(X8,Y8)],["burd",YV(kP,ZM)],["buylrd",YV(RP,XM)],["blues",wa(xU,wU)],["greens",wa(EU,CU)],["greys",wa(MU,TU)],["oranges",wa(PU,OU)],["purples",wa(DU,SU)],["reds",wa(IU,AU)],["turbo",np(HU)],["viridis",np(GU)],["magma",np(qU)],["inferno",np(WU)],["plasma",np(ZU)],["cividis",np(kU)],["cubehelix",np(BU)],["warm",np(UU)],["cool",np(VU)],["bugn",wa(K8,Q8)],["bupu",wa(J8,eU)],["gnbu",wa(tU,nU)],["orrd",wa(iU,rU)],["pubu",wa(aU,lU)],["pubugn",wa(oU,sU)],["purd",wa(cU,uU)],["rdpu",wa(dU,hU)],["ylgn",wa(mU,gU)],["ylgnbu",wa(fU,pU)],["ylorbr",wa(_U,yU)],["ylorrd",wa(vU,bU)],["rainbow",KV(jU)],["sinebow",KV($U)]]);function wa(e,t){return({length:n})=>1===n?[e[3][1]]:2===n?[e[3][1],e[3][2]]:(n=Math.max(3,Math.floor(n)))>9?Fd(t,n):e[n]}function tp(e,t){return({length:n})=>2===n?[e[3][0],e[3][2]]:(n=Math.max(3,Math.floor(n)))>11?Fd(t,n):e[n]}function YV(e,t){return({length:n})=>2===n?[e[3][2],e[3][0]]:(n=Math.max(3,Math.floor(n)))>11?Fd(i=>t(1-i),n):e[n].slice().reverse()}function np(e){return({length:t})=>Fd(e,Math.max(2,Math.floor(t)))}function KV(e){return({length:t})=>Fd(e,Math.floor(t)+1).slice(0,-1)}function QV(e){const t=`${e}`.toLowerCase();if(!XV.has(t))throw new Error(`unknown ordinal scheme: ${t}`);return XV.get(t)}function bT(e,t){const n=QV(e),i="function"==typeof n?n({length:t}):n;return i.length!==t?i.slice(0,t):i}const JV=new Map([["brbg",z8],["prgn",U8],["piyg",j8],["puor",H8],["rdbu",ZM],["rdgy",q8],["rdylbu",XM],["rdylgn",Z8],["spectral",Y8],["burd",e=>ZM(1-e)],["buylrd",e=>XM(1-e)],["blues",wU],["greens",CU],["greys",TU],["purples",SU],["reds",AU],["oranges",OU],["turbo",HU],["viridis",GU],["magma",qU],["inferno",WU],["plasma",ZU],["cividis",kU],["cubehelix",BU],["warm",UU],["cool",VU],["bugn",Q8],["bupu",eU],["gnbu",nU],["orrd",rU],["pubugn",sU],["pubu",lU],["purd",uU],["rdpu",hU],["ylgnbu",pU],["ylgn",gU],["ylorbr",yU],["ylorrd",bU],["rainbow",jU],["sinebow",$U]]);function dO(e){const t=`${e}`.toLowerCase();if(!JV.has(t))throw new Error(`unknown quantitative scheme: ${t}`);return JV.get(t)}const yde=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]),ej=e=>t=>e(1-t),hO=[0,1],tj=new Map([["number",al],["rgb",qg],["hsl",Jae],["hcl",nle],["lab",function tle(e,t){var n=va((e=lP(e)).l,(t=lP(t)).l),i=va(e.a,t.a),r=va(e.b,t.b),s=va(e.opacity,t.opacity);return function(u){return e.l=n(u),e.a=i(u),e.b=r(u),e.opacity=s(u),e+""}}]]);function nj(e){const t=`${e}`.toLowerCase();if(!tj.has(t))throw new Error(`unknown interpolator: ${t}`);return tj.get(t)}function h1(e,t,n,{type:i,nice:r,clamp:s,zero:u,domain:h=rj(e,n),unknown:g,round:x,scheme:C,interval:S,range:O=($o.get(e)===hT?Ade(n,h):$o.get(e)===fT?Pde(n,h):$o.get(e)===pT?hO:void 0),interpolate:F=($o.get(e)===Qf?null==C&&void 0!==O?qg:dO(void 0!==C?C:"cyclical"===i?"rainbow":"turbo"):x?aP:al),reverse:$}){if(S=y0(S,i),("cyclical"===i||"sequential"===i)&&(i="linear"),"function"!=typeof F&&(F=nj(F)),$=!!$,void 0!==O&&(h=Kc(h)).length!==(O=Kc(O)).length){if(1===F.length)throw new Error("invalid piecewise interpolator");F=kM(F,O),O=void 0}if(1===F.length?($&&(F=ej(F),$=!1),void 0===O&&2===(O=Float64Array.from(h,(G,Y)=>Y/(h.length-1))).length&&(O=hO),t.interpolate((O===hO?s1:pO)(F))):t.interpolate(F),u){const[G,Y]=Pd(h);(G>0||Y<0)&&(v0(h=ZP(h))!==Math.sign(G)?h[h.length-1]=0:h[0]=0)}return $&&(h=VC(h)),t.domain(h).unknown(g),r&&(t.nice(function bde(e,t){return!0===e?void 0:"number"==typeof e?e:function Lue(e,t){if((e=y0(e,t))&&"function"!=typeof e.ceil)throw new Error("invalid interval: missing ceil method");return e}(e,t)}(r,i)),h=t.domain()),void 0!==O&&t.range(O),s&&t.clamp(s),{type:i,domain:h,range:O,scale:t,interpolate:F,interval:S}}function ij(e,t,{exponent:n=1,...i}){return h1(e,EP().exponent(n),t,{...i,type:"pow"})}function Ede(e,t,{base:n=10,domain:i=Ode(t),...r}){return h1(e,J6().base(n),t,{...r,domain:i})}function Cde(e,t,{constant:n=1,...i}){return h1(e,i8().constant(n),t,i)}function Mde(e,t,{range:n,quantiles:i=(void 0===n?5:(n=[...n]).length),n:r=i,scheme:s="rdylbu",domain:u=kde(t),unknown:h,interpolate:g,reverse:x}){return void 0===n&&(n=void 0!==g?Fd(g,r):$o.get(e)===Qf?bT(s,r):void 0),u.length>0&&(u=s8(u,void 0===n?{length:r}:n).quantiles()),fO(e,0,{domain:u,range:n,reverse:x,unknown:h})}function fO(e,t,{domain:n=[0],unknown:i,scheme:r="rdylbu",interpolate:s,range:u=(void 0!==s?Fd(s,n.length+1):$o.get(e)===Qf?bT(r,n.length+1):void 0),reverse:h}){const g=v0(n=Kc(n));if(!isNaN(g)&&!function Dde(e,t){for(let n=1,i=e.length,r=e[0];n<i;++n){const s=yx(r,r=e[n]);if(0!==s&&s!==t)return!1}return!0}(n,g))throw new Error(`the ${e} scale has a non-monotonic domain`);return h&&(u=VC(u)),{type:"threshold",scale:a8(g<0?VC(n):n,void 0===u?[]:u).unknown(i),domain:n,range:u}}function f1(e,t=fV){return e.length?[Bf(e,({value:n})=>void 0===n?n:Bf(n,t)),Ih(e,({value:n})=>void 0===n?n:Ih(n,t))]:[0,1]}function rj(e,t){const n=$o.get(e);return(n===hT||n===pT||n===fT?Ide:f1)(t)}function Ide(e){return[0,e.length?Ih(e,({value:t})=>void 0===t?t:Ih(t,fV)):1]}function Ade(e,t){const n=e.find(({radius:u})=>void 0!==u);if(void 0!==n)return[0,n.radius];const i=Yy(e,.5,({value:u})=>void 0===u?NaN:Yy(u,.25,jP)),r=t.map(u=>3*Math.sqrt(u/i)),s=30/Ih(r);return s<1?r.map(u=>u*s):r}function Pde(e,t){const n=zC(e,({value:s})=>void 0===s?NaN:zC(s,Math.abs)),i=t.map(s=>12*s/n),r=60/Ih(i);return r<1?i.map(s=>s*r):i}function Ode(e){for(const{value:t}of e)if(void 0!==t)for(let n of t){if(n>0)return f1(e,jP);if(n<0)return f1(e,pV)}return[1,10]}function kde(e){const t=[];for(const{value:n}of e)if(void 0!==n)for(const i of n)t.push(i);return t}function pO(e){return(t,n)=>i=>e(t+i*(n-t))}function xT(e,t,n,i,{type:r,nice:s,clamp:u,domain:h=f1(i),unknown:g,pivot:x=0,scheme:C,range:S,symmetric:O=!0,interpolate:F=($o.get(e)===Qf?null==C&&void 0!==S?qg:dO(void 0!==C?C:"rdbu"):al),reverse:$}){x=+x,h=Kc(h);let[G,Y]=h;if(h.length>2&&x0(`Warning: the diverging ${e} scale domain contains extra elements.`),yx(G,Y)<0&&([G,Y]=[Y,G],$=!$),G=Math.min(G,x),Y=Math.max(Y,x),"function"!=typeof F&&(F=nj(F)),void 0!==S&&(F=1===F.length?pO(F)(...S):kM(F,S)),$&&(F=ej(F)),O){const J=n.apply(x),Q=J-n.apply(G),he=n.apply(Y)-J;Q<he?G=n.invert(J-he):Q>he&&(Y=n.invert(J+Q))}return t.domain([G,x,Y]).unknown(g).interpolator(F),u&&t.clamp(u),s&&t.nice(s),{type:r,domain:[G,Y],pivot:x,interpolate:F,scale:t}}function Rde(e,t,n){return xT(e,R8(),zde,t,n)}function oj(e,t,{exponent:n=1,...i}){return xT(e,OP().exponent(n=+n),function Vde(e){return.5===e?Ude:{apply:t=>Math.sign(t)*Math.pow(Math.abs(t),e),invert:t=>Math.sign(t)*Math.pow(Math.abs(t),1/e)}}(n),t,{...i,type:"diverging-pow"})}function Fde(e,t,{base:n=10,pivot:i=1,domain:r=f1(t,i<0?pV:jP),...s}){return xT(e,L8().base(n=+n),Bde,t,{domain:r,pivot:i,...s})}function Nde(e,t,{constant:n=1,...i}){return xT(e,F8().constant(n=+n),function jde(e){return{apply:t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),invert:t=>Math.sign(t)*Math.expm1(Math.abs(t))*e}}(n),t,i)}const zde={apply:e=>e,invert:e=>e},Bde={apply:Math.log,invert:Math.exp},Ude={apply:e=>Math.sign(e)*Math.sqrt(Math.abs(e)),invert:e=>Math.sign(e)*(e*e)};function sj(e,t,n,i){return h1(e,t,n,i)}const p1=Symbol("ordinal");function aj(e,t,n,{type:i,interval:r,domain:s,range:u,reverse:h,hint:g}){return r=y0(r,i),void 0===s&&(s=cj(n,r,e)),("categorical"===i||i===p1)&&(i="ordinal"),h&&(s=VC(s)),t.domain(s),void 0!==u&&("function"==typeof u&&(u=u(s)),t.range(u)),{type:i,domain:s,range:u,scale:t,hint:g,interval:r}}function lj(e,t,n,i){let{round:r}=n;return void 0!==r&&e.round(r=!!r),(e=aj(i,e,t,n)).round=r,e}function cj(e,t,n){const i=new sA;for(const{value:r,domain:s}of e){if(void 0!==s)return s();if(void 0!==r)for(const u of r)i.add(u)}if(void 0!==t){const[r,s]=Pd(i).map(t.floor,t);return t.range(r,t.offset(s))}if(i.size>1e4&&$o.get(n)===Bh)throw new Error(`implicit ordinal domain of ${n} scale has more than 10,000 values`);return bx(i,Bd)}function uj(e,t){let n;for(const{hint:i}of e){const r=i?.[t];if(void 0!==r)if(void 0===n)n=r;else if(n!==r)return}return n}function mO(e,{label:t,inset:n=0,insetTop:i=n,insetRight:r=n,insetBottom:s=n,insetLeft:u=n,round:h,nice:g,clamp:x,zero:C,align:S,padding:O,projection:F,facet:{label:$=t}={},...G}={}){const Y={};for(const[J,Q]of e){const he=G[J],ue=_j(J,Q,{round:$o.get(J)===Bh?h:void 0,nice:g,clamp:x,zero:C,align:S,padding:O,projection:F,...he});if(ue){let{label:we=("fx"===J||"fy"===J?$:t),percent:Ie,transform:Qe,inset:ut,insetTop:Ct=(void 0!==ut?ut:"y"===J?i:0),insetRight:At=(void 0!==ut?ut:"x"===J?r:0),insetBottom:at=(void 0!==ut?ut:"y"===J?s:0),insetLeft:jt=(void 0!==ut?ut:"x"===J?u:0)}=he||{};if(null==Qe)Qe=void 0;else if("function"!=typeof Qe)throw new Error("invalid scale transform; not a function");ue.percent=!!Ie,ue.label=void 0===we?Kde(Q,ue):we,ue.transform=Qe,"x"===J||"fx"===J?(ue.insetLeft=+jt,ue.insetRight=+At):("y"===J||"fy"===J)&&(ue.insetTop=+Ct,ue.insetBottom=+at),Y[J]=ue}}return Y}function dj(e){return Object.fromEntries(Object.entries(e).filter(([,{scale:t}])=>t).map(([t,{scale:n,type:i,interval:r,label:s}])=>(n.type=i,null!=r&&(n.interval=r),null!=s&&(n.label=s),[t,n])))}function Kde(e=[],t){let n;for(const{label:i}of e)if(void 0!==i)if(void 0===n)n=i;else if(n!==i)return;if(void 0!==n)return!o_(t)&&t.percent&&(n=`${n} (%)`),{inferred:!0,toString:()=>n}}function gO(e){const{marginTop:t,marginRight:n,marginBottom:i,marginLeft:r,width:s,height:u,facet:{marginTop:h,marginRight:g,marginBottom:x,marginLeft:C}}=e;return{marginTop:Math.max(t,h),marginRight:Math.max(n,g),marginBottom:Math.max(i,x),marginLeft:Math.max(r,C),width:s,height:u}}function hj({fx:e,fy:t},n){const{marginTop:i,marginRight:r,marginBottom:s,marginLeft:u,width:h,height:g}=gO(n);return{marginTop:i,marginRight:r,marginBottom:s,marginLeft:u,width:e?e.scale.bandwidth()+u+r:h,height:t?t.scale.bandwidth()+i+s:g,facet:{width:h,height:g}}}function fj(e,t){if(void 0===e.range){const{insetLeft:n,insetRight:i}=e,{width:r,marginLeft:s=0,marginRight:u=0}=t,h=s+n;e.range=[h,Math.max(h,r-u-i)],o_(e)||(e.range=gj(e)),e.scale.range(e.range)}mj(e)}function pj(e,t){if(void 0===e.range){const{insetTop:n,insetBottom:i}=e,{height:r,marginTop:s=0,marginBottom:u=0}=t,h=s+n;e.range=[Math.max(h,r-u-i),h],o_(e)?e.range.reverse():e.range=gj(e),e.scale.range(e.range)}mj(e)}function mj(e){void 0===e.round&&function the({type:e}){return"point"===e||"band"===e}(e)&&function Qde({scale:e}){const t=e.domain().length,[n,i]=e.range(),r=e.paddingInner?e.paddingInner():1,s=e.paddingOuter?e.paddingOuter():e.padding(),u=t-r,h=Math.abs(i-n)/Math.max(1,u+2*s);return(h-Math.floor(h))*u}(e)<=30&&e.scale.round(!0)}function gj(e){const t=e.scale.domain().length+vj(e);if(!(t>2))return e.range;const[n,i]=e.range;return Array.from({length:t},(r,s)=>n+s/(t-1)*(i-n))}function _j(e,t=[],n={}){const i=function ehe(e,t,{type:n,domain:i,range:r,scheme:s,pivot:u,projection:h}){if("fx"===e||"fy"===e)return"band";("x"===e||"y"===e)&&null!=h&&(n=yj);for(const{type:x}of t)if(void 0!==x)if(void 0===n)n=x;else if(n!==x)throw new Error(`scale incompatible with channel: ${n} !== ${x}`);if(n===yj)return;if(void 0!==n)return n;if(void 0===i&&!t.some(({value:x})=>void 0!==x))return;const g=$o.get(e);if(g===hT)return"sqrt";if(g===pT||g===fT)return"linear";if(g===mT)return"ordinal";if((i||r||[]).length>2)return _O(g);if(void 0!==i){if(AV(i))return _O(g);if(Ud(i))return"utc"}else{const x=t.map(({value:C})=>C).filter(C=>void 0!==C);if(x.some(AV))return _O(g);if(x.some(Ud))return"utc"}if(g===Qf){if(null!=u||function vde(e){return null!=e&&yde.has(`${e}`.toLowerCase())}(s))return"diverging";if(function gde(e){return null!=e&&ZV.has(`${e}`.toLowerCase())}(s))return"categorical"}return"linear"}(e,t,n);if(void 0===n.type&&void 0===n.domain&&void 0===n.range&&null==n.interval&&"fx"!==e&&"fy"!==e&&o_({type:i})){const r=t.map(({value:s})=>s).filter(s=>void 0!==s);r.some(Ud)?x0(`Warning: some data associated with the ${e} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${w0(i)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${e} scale to "${w0(i)}".`):r.some(Nue)?x0(`Warning: some data associated with the ${e} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${w0(i)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${e} scale to "${w0(i)}".`):r.some(zue)&&x0(`Warning: some data associated with the ${e} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${w0(i)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${e} scale to "${w0(i)}".`)}switch(n.type=i,i){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":n=wT(t,n,sT);break;case"identity":switch($o.get(e)){case Bh:n=wT(t,n,sT);break;case mT:n=wT(t,n,nhe)}break;case"utc":case"time":n=wT(t,n,Pue)}switch(i){case"diverging":return Rde(e,t,n);case"diverging-sqrt":return function Lde(e,t,n){return oj(e,t,{...n,exponent:.5})}(e,t,n);case"diverging-pow":return oj(e,t,n);case"diverging-log":return Fde(e,t,n);case"diverging-symlog":return Nde(e,t,n);case"categorical":case"ordinal":case p1:return function Gde(e,t,{type:n,interval:i,domain:r,range:s,scheme:u,unknown:h,...g}){let x;if(i=y0(i,n),void 0===r&&(r=cj(t,i,e)),$o.get(e)===mT)x=function Zde(e){return{fill:uj(e,"fill"),stroke:uj(e,"stroke")}}(t),s=void 0===s?function Xde(e){return mc(e.fill)?lue:aue}(x):qs(s,rO);else if($o.get(e)===Qf&&(void 0===s&&("ordinal"===n||n===p1)&&(s=function _de(e,t="greys"){const n=new Set,[i,r]=bT(t,2);for(const s of e)if(null!=s)if(!0===s)n.add(r);else{if(!1!==s)return;n.add(i)}return[...n]}(r,u),void 0!==s&&(u=void 0)),void 0===u&&void 0===s&&(u="ordinal"===n?"turbo":"tableau10"),void 0!==u))if(void 0!==s){const C=dO(u),S=s[0],O=s[1]-s[0];s=({length:F})=>Fd($=>C(S+O*$),F)}else s=QV(u);if(h===yP)throw new Error(`implicit unknown on ${e} scale is not supported`);return aj(e,vP().unknown(h),t,{...g,type:n,domain:r,range:s,hint:x})}(e,t,n);case"cyclical":case"sequential":case"linear":return function xde(e,t,n){return h1(e,wP(),t,n)}(e,t,n);case"sqrt":return function wde(e,t,n){return ij(e,t,{...n,exponent:.5})}(e,t,n);case"threshold":return fO(e,0,n);case"quantile":return Mde(e,t,n);case"quantize":return function Tde(e,t,{range:n,n:i=(void 0===n?5:(n=[...n]).length),scheme:r="rdylbu",domain:s=rj(e,t),unknown:u,interpolate:h,reverse:g}){const[x,C]=Pd(s);let S;return void 0===n?(S=wx(x,C,i),S[0]<=x&&S.splice(0,1),S[S.length-1]>=C&&S.pop(),i=S.length+1,n=void 0!==h?Fd(h,i):$o.get(e)===Qf?bT(r,i):void 0):(S=Fd(al(x,C),i+1).slice(1,-1),x instanceof Date&&(S=S.map(O=>new Date(O)))),v0(Kc(s))<0&&S.reverse(),fO(e,0,{domain:S,range:n,reverse:g,unknown:u})}(e,t,n);case"pow":return ij(e,t,n);case"log":return Ede(e,t,n);case"symlog":return Cde(e,t,n);case"utc":return function Hde(e,t,n){return sj(e,function Lce(){return Lh.apply(PP(Tle,y8,zd,HM,p0,jM,VM,BM,Zf,Jx).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}(),t,n)}(e,t,n);case"time":return function $de(e,t,n){return sj(e,function Rce(){return Lh.apply(PP(Dle,Sle,Nd,$M,f0,h0,UM,zM,Zf,GM).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}(),t,n)}(e,t,n);case"point":return function qde(e,t,{align:n=.5,padding:i=.5,...r}){return lj(ule().align(n).padding(i),t,r,e)}(e,t,n);case"band":return function Wde(e,t,{align:n=.5,padding:i=.1,paddingInner:r=i,paddingOuter:s=("fx"===e||"fy"===e?0:i),...u}){return lj(LM().align(n).paddingInner(r).paddingOuter(s),t,u,e)}(e,t,n);case"identity":return $o.get(e)===Bh?function Sde(){return{type:"identity",scale:W6()}}():{type:"identity"};case void 0:return;default:throw new Error(`unknown scale type: ${i}`)}}function w0(e){return"symbol"==typeof e?e.description:e}const yj={toString:()=>"projection"};function _O(e){switch(e){case Bh:return"point";case Qf:return p1;default:return"ordinal"}}function yO({type:e}){return"time"===e||"utc"===e}function o_({type:e}){return"ordinal"===e||"point"===e||"band"===e||e===p1}function vj({type:e}){return"threshold"===e}function Bu(e){if(void 0===e)return!0;const t=e.domain(),n=e(t[0]);for(let i=1,r=t.length;i<r;++i)if(e(t[i])-n)return!1;return!0}function wT(e,{domain:t,...n},i){for(const r of e)void 0!==r.value&&(r.value=i(r.value));return{domain:void 0===t?t:i(t),...n}}function nhe(e){return qs(e,rO)}function ip(e,t){return`${e}`.padStart(t,"0")}function vO(e){let t,n;return(...i)=>((n?.length!==i.length||n.some((r,s)=>r!==i[s]))&&(n=i,t=e(...i)),t)}const she=vO(e=>new Intl.NumberFormat(e));function uhe(e){return function rhe(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return"function"==typeof t?t(e):t;const n=e.getUTCHours(),i=e.getUTCMinutes(),r=e.getUTCSeconds(),s=e.getUTCMilliseconds();return`${function ohe(e){return e<0?`-${ip(-e,6)}`:e>9999?`+${ip(e,6)}`:ip(e,4)}(e.getUTCFullYear())}-${ip(e.getUTCMonth()+1,2)}-${ip(e.getUTCDate(),2)}${n||i||r||s?`T${ip(n,2)}:${ip(i,2)}${r||s?`:${ip(r,2)}${s?`.${ip(s,3)}`:""}`:""}Z`:""}`}(e,"Invalid Date")}vO((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{month:t}})),vO((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{weekday:t}}));const bm=function dhe(e="en-US"){const t=function che(e="en-US"){const t=she(e);return n=>null==n||isNaN(n)?void 0:t.format(n)}(e);return n=>(n instanceof Date?uhe:"number"==typeof n?t:zl)(n)}(),Qc=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5;let hhe=0;function xj(){return"plot-clip-"+ ++hhe}function fhe(e,{title:t,href:n,ariaLabel:i,ariaDescription:r,ariaHidden:s,target:u,fill:h,fillOpacity:g,stroke:x,strokeWidth:C,strokeOpacity:S,strokeLinejoin:O,strokeLinecap:F,strokeMiterlimit:$,strokeDasharray:G,strokeDashoffset:Y,opacity:J,mixBlendMode:Q,imageFilter:he,paintOrder:ue,pointerEvents:we,shapeRendering:Ie,channels:Qe},{ariaLabel:ut,fill:Ct="currentColor",fillOpacity:At,stroke:at="none",strokeOpacity:jt,strokeWidth:Ht,strokeLinecap:Ae,strokeLinejoin:Ne,strokeMiterlimit:ge,paintOrder:Re}){null===Ct&&(h=null,g=null),null===at&&(x=null,S=null),mc(Ct)?!mc(at)&&(!mc(h)||Qe?.fill)&&(at="none"):mc(at)&&(!mc(x)||Qe?.stroke)&&(Ct="none");const[We,Ye]=Xf(h,Ct),[Dt,Bt]=Yc(g,At),[Lt,Dn]=Xf(x,at),[fn,qi]=Yc(S,jt),[Gr,Yt]=Yc(J);c1(Dn)||(void 0===C&&(C=Ht),void 0===F&&(F=Ae),void 0===O&&(O=Ne),void 0===$&&!function Vue(e){return/^\s*round\s*$/i.test(e)}(O)&&($=ge),!c1(Ye)&&void 0===ue&&(ue=Re));const[hn,ft]=Yc(C);return null!==Ct&&(e.fill=Ws(Ye,"currentColor"),e.fillOpacity=m1(Bt,1)),null!==at&&(e.stroke=Ws(Dn,"none"),e.strokeWidth=m1(ft,1),e.strokeOpacity=m1(qi,1),e.strokeLinejoin=Ws(O,"miter"),e.strokeLinecap=Ws(F,"butt"),e.strokeMiterlimit=m1($,4),e.strokeDasharray=Ws(G,"none"),e.strokeDashoffset=Ws(Y,"0")),e.target=zl(u),e.ariaLabel=zl(ut),e.ariaDescription=zl(r),e.ariaHidden=zl(s),e.opacity=m1(Yt,1),e.mixBlendMode=Ws(Q,"normal"),e.imageFilter=Ws(he,"none"),e.paintOrder=Ws(ue,"normal"),e.pointerEvents=Ws(we,"auto"),e.shapeRendering=Ws(Ie,"auto"),{title:{value:t,optional:!0,filter:null},href:{value:n,optional:!0,filter:null},ariaLabel:{value:i,optional:!0,filter:null},fill:{value:We,scale:"auto",optional:!0},fillOpacity:{value:Dt,scale:"auto",optional:!0},stroke:{value:Lt,scale:"auto",optional:!0},strokeOpacity:{value:fn,scale:"auto",optional:!0},strokeWidth:{value:hn,optional:!0},opacity:{value:Gr,scale:"auto",optional:!0}}}function ghe(e,t){t&&e.text(n=>bm(t[n]))}function s_(e,{target:t,tip:n},{ariaLabel:i,title:r,fill:s,fillOpacity:u,stroke:h,strokeOpacity:g,strokeWidth:x,opacity:C,href:S}){i&&vi(e,"aria-label",O=>i[O]),s&&vi(e,"fill",O=>s[O]),u&&vi(e,"fill-opacity",O=>u[O]),h&&vi(e,"stroke",O=>h[O]),g&&vi(e,"stroke-opacity",O=>g[O]),x&&vi(e,"stroke-width",O=>x[O]),C&&vi(e,"opacity",O=>C[O]),S&&function wj(e,t,n){e.each(function(i){const r=t(i);if(null!=r){const s=this.ownerDocument.createElementNS(Ky.svg,"a");s.setAttribute("fill","inherit"),s.setAttributeNS(Ky.xlink,"href",r),null!=n&&s.setAttribute("target",n),this.parentNode.insertBefore(s,this).appendChild(this)}})}(e,O=>S[O],t),n||function phe(e,t){t&&e.filter(n=>hV(t[n])).append("title").call(ghe,t)}(e,r)}function xm(e,t,n,i){(function xhe(e,t,n,i){let r;switch(t.clip){case"frame":{const{width:s,height:u,marginLeft:h,marginRight:g,marginTop:x,marginBottom:C}=n,S=xj();r=`url(#${S})`,e=Bl("svg:g",i).call(O=>O.append("svg:clipPath").attr("id",S).append("rect").attr("x",h).attr("y",x).attr("width",s-g-h).attr("height",u-x-C)).each(function(){this.appendChild(e.node()),e.node=()=>this});break}case"sphere":{const{projection:s}=i;if(!s)throw new Error('the "sphere" clip option requires a projection');const u=xj();r=`url(#${u})`,e.append("clipPath").attr("id",u).append("path").attr("d",r6(s)({type:"Sphere"}));break}}vi(e,"aria-label",t.ariaLabel),vi(e,"aria-description",t.ariaDescription),vi(e,"aria-hidden",t.ariaHidden),vi(e,"clip-path",r)})(e,t,n,i),vi(e,"fill",t.fill),vi(e,"fill-opacity",t.fillOpacity),vi(e,"stroke",t.stroke),vi(e,"stroke-width",t.strokeWidth),vi(e,"stroke-opacity",t.strokeOpacity),vi(e,"stroke-linejoin",t.strokeLinejoin),vi(e,"stroke-linecap",t.strokeLinecap),vi(e,"stroke-miterlimit",t.strokeMiterlimit),vi(e,"stroke-dasharray",t.strokeDasharray),vi(e,"stroke-dashoffset",t.strokeDashoffset),vi(e,"shape-rendering",t.shapeRendering),vi(e,"filter",t.imageFilter),vi(e,"paint-order",t.paintOrder);const{pointerEvents:r=(!1===i.pointerSticky?"none":void 0)}=t;vi(e,"pointer-events",r)}function wm(e,t){(function whe(e,t,n){null!=n&&e.style(t,n)})(e,"mix-blend-mode",t.mixBlendMode),vi(e,"opacity",t.opacity)}function vi(e,t,n){null!=n&&e.attr(t,n)}function rp(e,t,{x:n,y:i},r=Qc,s=Qc){r+=t.dx,s+=t.dy,n?.bandwidth&&(r+=n.bandwidth()/2),i?.bandwidth&&(s+=i.bandwidth()/2),(r||s)&&e.attr("transform",`translate(${r},${s})`)}function Ws(e,t){if((e=zl(e))!==t)return e}function m1(e,t){if((e=lo(e))!==t)return e}const Ehe=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function bO(e){if(void 0===e)return"plot-d6a7b5";if(!Ehe.test(e=`${e}`))throw new Error(`invalid class name: ${e}`);return e}function xO(e,t){if("string"==typeof t)e.property("style",t);else if(null!=t)for(const n of e)Object.assign(n.style,t)}function ET({frameAnchor:e},{width:t,height:n,marginTop:i,marginRight:r,marginBottom:s,marginLeft:u}){return[/left$/.test(e)?u:/right$/.test(e)?t-r:(u+t-r)/2,/^top/.test(e)?i:/^bottom/.test(e)?n-s:(i+n-s)/2]}function Mhe({x:e,y:t,fy:n,fx:i},{projection:r,aspectRatio:s},{width:u,marginTopDefault:h,marginRightDefault:g,marginBottomDefault:x,marginLeftDefault:C}){const S=n?n.scale.domain().length:1,O=function pde(e){if("function"==typeof e?.stream)return HV;if(i_(e)&&(e=e.type),null!=e){if("function"!=typeof e){const{aspectRatio:t}=GV(e);if(t)return t}return HV}}(r);if(O){const $=i?i.scale.domain().length:1,Y=Math.max(.1,Math.min(10,(1.1*S-.1)/(1.1*$-.1)*O));return Math.round((u-C-g)*Y+h+x)}const F=t?o_(t)?t.scale.domain().length:Math.max(7,17/S):1;if(null!=s){if(s=+s,!(isFinite(s)&&s>0))throw new Error(`invalid aspectRatio: ${s}`);const $=Ej("y",t)/(Ej("x",e)*s),G=i?i.scale.bandwidth():1,Y=n?n.scale.bandwidth():1;return($*(G*(u-C-g)-e.insetLeft-e.insetRight)+t.insetTop+t.insetBottom)/Y+h+x}return!(!t&&!n)*Math.max(1,Math.min(60,F*S))*20+30*!!i+60}function Ej(e,t){if(!t)throw new Error(`aspectRatio requires ${e} scale`);const{type:n,domain:i}=t;let r;switch(n){case"linear":case"utc":case"time":r=Number;break;case"pow":{const h=t.scale.exponent();r=g=>Math.pow(g,h);break}case"log":r=Math.log;break;case"point":case"band":return i.length;default:throw new Error(`unsupported ${e} scale for aspectRatio: ${n}`)}const[s,u]=Pd(i);return Math.abs(r(u)-r(s))}function wO(e,{fx:t,fy:n}){const i=Nh(e),r=t?.value,s=n?.value;return t&&n?Zy(i,u=>(u.fx=r[u[0]],u.fy=s[u[0]],u),u=>r[u],u=>s[u]):t?Zy(i,u=>(u.fx=r[u[0]],u),u=>r[u]):Zy(i,u=>(u.fy=s[u[0]],u),u=>s[u])}function Ihe(e){const t=[],n=new Uint32Array(fm(e,i=>i.length));for(const i of e){let r=0;for(const s of e)i!==s&&(n.set(s,r),r+=s.length);t.push(n.slice(0,r))}return t}const Ahe=new Map([["top",CO],["right",DO],["bottom",MO],["left",TO],["top-left",MT(CO,TO)],["top-right",MT(CO,DO)],["bottom-left",MT(MO,TO)],["bottom-right",MT(MO,DO)],["top-empty",function khe(e,{y:t},{x:n,y:i,empty:r}){if(r)return!1;if(!t)return;const s=Em(t,i);return s>0?CT(e,n,t[s-1]):void 0}],["right-empty",function Fhe(e,{x:t},{x:n,y:i,empty:r}){if(r)return!1;if(!t)return;const s=Em(t,n);return s<t.length-1?CT(e,t[s+1],i):void 0}],["bottom-empty",function Rhe(e,{y:t},{x:n,y:i,empty:r}){if(r)return!1;if(!t)return;const s=Em(t,i);return s<t.length-1?CT(e,n,t[s+1]):void 0}],["left-empty",function Lhe(e,{x:t},{x:n,y:i,empty:r}){if(r)return!1;if(!t)return;const s=Em(t,n);return s>0?CT(e,t[s-1],i):void 0}],["empty",function Nhe(e,t,{empty:n}){return n}]]),Cj=new WeakMap;function EO(e){let t=Cj.get(e);return t||Cj.set(e,t=new Vg(qs(e,(n,i)=>[n,i]))),t}function Em(e,t){return EO(e).get(t)}function CT(e,t,n){return function Ohe(e,t,n){return t=lT(t),n=lT(n),e.find(i=>Object.is(lT(i.x),t)&&Object.is(lT(i.y),n))}(e,t,n)?.empty}function CO(e,{y:t},{y:n}){return!t||0===Em(t,n)}function MO(e,{y:t},{y:n}){return!t||Em(t,n)===t.length-1}function TO(e,{x:t},{x:n}){return!t||0===Em(t,n)}function DO(e,{x:t},{x:n}){return!t||Em(t,n)===t.length-1}function MT(e,t){return function(){return e.apply(null,arguments)&&t.apply(null,arguments)}}function SO(e,{channels:{fx:t,fy:n},groups:i}){return e.map(t&&n?({x:r,y:s})=>i.get(r)?.get(s)??[]:t?({x:r})=>i.get(r)??[]:({y:r})=>i.get(r)??[])}function TT({filter:e,sort:t,reverse:n,transform:i,initializer:r,...s}={},u){if(void 0===i&&(null!=e&&(i=PO(e)),null!=t&&!a1(t)&&(i=IO(i,kO(t))),n&&(i=IO(i,OO))),null!=u&&null!=r)throw new Error("transforms cannot be applied after initializers");return{...s,...(null===t||a1(t))&&{sort:t},transform:IO(i,u)}}function E0({filter:e,sort:t,reverse:n,initializer:i,...r}={},s){return void 0===i&&(null!=e&&(i=PO(e)),null!=t&&!a1(t)&&(i=AO(i,kO(t))),n&&(i=AO(i,OO))),{...r,...(null===t||a1(t))&&{sort:t},initializer:AO(i,s)}}function IO(e,t){return null==e?null===t?void 0:t:null==t?null===e?void 0:e:function(n,i,r){return({data:n,facets:i}=e.call(this,n,i,r)),t.call(this,Kc(n),i,r)}}function AO(e,t){return null==e?null===t?void 0:t:null==t?null===e?void 0:e:function(n,i,r,...s){let u,h,g,x,C,S;return({data:h=n,facets:g=i,channels:u}=e.call(this,n,i,r,...s)),({data:C=h,facets:S=g,channels:x}=t.call(this,h,g,{...r,...u},...s)),{data:C,facets:S,channels:{...u,...x}}}}function PO(e){return(t,n)=>{const i=xa(t,e);return{data:t,facets:n.map(r=>r.filter(s=>i[s]))}}}function OO(e,t){return{data:e,facets:t.map(n=>n.slice().reverse())}}function kO(e){return("function"==typeof e&&1!==e.length?zhe:Mj)(e)}function zhe(e){return(t,n)=>{const i=(r,s)=>e(t[r],t[s]);return{data:t,facets:n.map(r=>r.slice().sort(i))}}}function Mj(e){let t,n;({channel:t,value:e,order:n}={...l1(e)});const i=t?.startsWith("-");if(i&&(t=t.slice(1)),void 0===n&&(n=i?nT:Bd),"function"!=typeof n)switch(`${n}`.toLowerCase()){case"ascending":n=Bd;break;case"descending":n=nT;break;default:throw new Error(`invalid order: ${n}`)}return(r,s,u)=>{let h;if(void 0===t)h=xa(r,e);else{if(void 0===u)throw new Error("channel sort requires an initializer");if(h=u[t],!h)return{};h=h.value}const g=(x,C)=>n(h[x],h[C]);return{data:r,facets:s.map(x=>x.slice().sort(g))}}}class jd{constructor(t,n={},i={},r){const{facet:s="auto",facetAnchor:u,fx:h,fy:g,sort:x,dx:C=0,dy:S=0,margin:O=0,marginTop:F=O,marginRight:$=O,marginBottom:G=O,marginLeft:Y=O,clip:J,channels:Q,tip:he,render:ue}=i;if(this.data=t,this.sort=a1(x)?x:null,this.initializer=E0(i).initializer,this.transform=this.initializer?i.transform:TT(i).transform,null===s||!1===s?this.facet=null:(this.facet=Yf(!0===s?"include":s,"facet",["auto","include","exclude","super"]),this.fx=t===rT&&"string"==typeof h?[h]:h,this.fy=t===rT&&"string"==typeof g?[g]:g),this.facetAnchor=function Phe(e){if(null==e)return null;const t=Ahe.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid facet anchor: ${e}`)}(u),n=OV(n),void 0!==Q&&(n={...(e=Q,Object.fromEntries(Object.entries(OV(e)).map(([t,n])=>(void 0===(n=l1(n)).filter&&null==n.scale&&(n={...n,filter:null}),[t,n])))),...n}),void 0!==r&&(n={...fhe(this,i,r),...n}),this.channels=Object.fromEntries(Object.entries(n).map(([we,Ie])=>{if(KP(Ie.value)){const{value:Qe,scale:ut=Ie.scale}=Ie.value;Ie={...Ie,scale:ut,value:Qe}}if(t===rT&&"string"==typeof Ie.value){const{value:Qe}=Ie;Ie={...Ie,value:[Qe]}}return[we,Ie]}).filter(([we,{value:Ie,optional:Qe}])=>{if(null!=Ie)return!0;if(Qe)return!1;throw new Error(`missing channel value: ${we}`)})),this.dx=+C,this.dy=+S,this.marginTop=+F,this.marginRight=+$,this.marginBottom=+G,this.marginLeft=+Y,this.clip=function bhe(e){return!0===e?e="frame":!1===e&&(e=null),aT(e,"clip",["frame","sphere"])}(J),this.tip=function Uhe(e){return!0===e?"xy":!1===e?null:aT(e,"tip",["x","y","xy"])}(he),"super"===this.facet){if(h||g)throw new Error("super-faceting cannot use fx or fy");for(const we in this.channels){const{scale:Ie}=n[we];if("x"===Ie||"y"===Ie)throw new Error("super-faceting cannot use x or y")}}var e;null!=ue&&(this.render=Dj(ue,this.render))}initialize(t,n,i){let r=Kc(this.data);void 0===t&&null!=r&&(t=[Nh(r)]);const s=t;null!=this.transform&&(({facets:t,data:r}=this.transform(r,t,i)),r=Kc(r)),void 0!==t&&(t.original=s);const u=function nde(e,t){return Object.fromEntries(Object.entries(e).map(([n,i])=>[n,d1(t,i,n)]))}(this.channels,r);return null!=this.sort&&function rde(e,t,n,i,r){const{order:s,reverse:u,reduce:h=!0,limit:g}=r;for(const x in r){if(!$o.has(x))continue;let{value:C,order:S=s,reverse:O=u,reduce:F=h,limit:$=g}=l1(r[x]);const G=C?.startsWith("-");if(G&&(C=C.slice(1)),S=void 0===S?G!==("width"===C||"height"===C)?jV:VV:ade(S),null==F||!1===F)continue;const Y="fx"===x||"fy"===x?sde(t,i[x]):ode(n,x);if(!Y)throw new Error(`missing channel for scale: ${x}`);const J=Y.value,[Q=0,he=1/0]=zh($)?$:$<0?[$]:[0,$];if(null==C)Y.domain=()=>{let ue=Array.from(new sA(J));return O&&(ue=ue.reverse()),(0!==Q||he!==1/0)&&(ue=ue.slice(Q,he)),ue};else{const ue="data"===C?e:"height"===C?UV(n,"y1","y2"):"width"===C?UV(n,"x1","x2"):lO(n,C,"y"===C?"y2":"x"===C?"x2":void 0),we=_T(!0===F?"max":F,ue);Y.domain=()=>{let Ie=bz(Nh(J),Qe=>we.reduceIndex(Qe,ue),Qe=>J[Qe]);return S&&Ie.sort(S),O&&Ie.reverse(),(0!==Q||he!==1/0)&&(Ie=Ie.slice(Q,he)),Ie.map(GP)}}}}(r,t,u,n,this.sort),{data:r,facets:t,channels:u}}filter(t,n,i){for(const r in n){const{filter:s=t_}=n[r];if(null!==s){const u=i[r];t=t.filter(h=>s(u[h]))}}return t}project(t,n,i){for(const r in t)if("x"===t[r].scale&&/^x|x$/.test(r)){const s=r.replace(/^x|x$/,"y");s in t&&"y"===t[s].scale&&WV(r,s,n,i.projection)}}scale(t,n,i){const r=function ide(e,t){const n=Object.fromEntries(Object.entries(e).map(([i,{scale:r,value:s}])=>{const u=null==r?null:t[r];return[i,null==u?s:qs(s,u)]}));return n.channels=e,n}(t,n);return i.projection&&this.project(t,r,i),r}}function Tj(...e){return e.plot=jd.prototype.plot,e}function Dj(e,t){if(null==e)return null===t?void 0:t;if(null==t)return null===e?void 0:e;if("function"!=typeof e)throw new TypeError(`invalid render transform: ${e}`);if("function"!=typeof t)throw new TypeError(`invalid render transform: ${t}`);return function(n,i,r,s,u,h){return e.call(this,n,i,r,s,u,(g,x,C,S,O)=>t.call(this,g,x,C,S,O,h))}}function ST(e,t){return!0===e?.tip?{...e,tip:t}:e}const Sj=new WeakMap;function RO(e,t,{x:n,y:i,px:r,py:s,maxRadius:u=40,channels:h,render:g,...x}={}){return u=+u,null!=r&&(n??=null,h={...h,px:{value:r,scale:"x"}}),null!=s&&(i??=null,h={...h,py:{value:s,scale:"y"}}),{x:n,y:i,channels:h,...x,render:Dj(function(C,S,O,F,$,G){const Y=($={...$,pointerSticky:!1}).ownerSVGElement,{data:J}=$.getMarkState(this);let Q=Sj.get(Y);Q||Sj.set(Y,Q={sticky:!1,roots:[],renders:[]});let he=Q.renders.push(Dn)-1;const{x:ue,y:we,fx:Ie,fy:Qe}=S;let ut=Ie?Ie(C.fx)-F.marginLeft:0,Ct=Qe?Qe(C.fy)-F.marginTop:0;ue?.bandwidth&&(ut+=ue.bandwidth()/2),we?.bandwidth&&(Ct+=we.bandwidth()/2);const At=null!=C.fi;let at;if(At){let Yt=Q.facetStates;Yt||(Q.facetStates=Yt=new Map),at=Yt.get(this),at||Yt.set(this,at=new Map)}const[jt,Ht]=ET(this,F),{px:Ae,py:Ne}=O,ge=Ae?Yt=>Ae[Yt]:Ij(O,jt),Re=Ne?Yt=>Ne[Yt]:Aj(O,Ht);let We,Ye,Dt,Bt;function Lt(Yt,hn){if(At){if(Bt&&(Bt=cancelAnimationFrame(Bt)),null!=Yt)return at.set(C.fi,hn),void(Bt=requestAnimationFrame(()=>{Bt=null;for(const ft of at.values())if(ft<hn){Yt=null;break}Dn(Yt)}));at.delete(C.fi)}Dn(Yt)}function Dn(Yt){if(We===Yt&&Dt===Q.sticky)return;We=Yt,Dt=$.pointerSticky=Q.sticky;const hn=null==We?[]:[We];At&&(hn.fx=C.fx,hn.fy=C.fy,hn.fi=C.fi);const ft=G(hn,S,O,F,$);if(Ye){if(At){const pn=Ye.parentNode,bn=Ye.getAttribute("transform"),bt=ft.getAttribute("transform");bn?ft.setAttribute("transform",bn):ft.removeAttribute("transform"),bt?pn.setAttribute("transform",bt):pn.removeAttribute("transform"),ft.removeAttribute("aria-label"),ft.removeAttribute("aria-description"),ft.removeAttribute("aria-hidden")}Ye.replaceWith(ft)}return Q.roots[he]=Ye=ft,$.dispatchValue(null==We?null:J[We]),ft}function fn(Yt){if(Q.sticky||"mouse"===Yt.pointerType&&1===Yt.buttons)return;let[hn,ft]=function Jce(e,t){if(e=function Qce(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}(Yt);hn-=ut,ft-=Ct;let pn=null,bn=u*u;for(const bt of C){const Gn=e*(ge(bt)-hn),yi=t*(Re(bt)-ft),wr=Gn*Gn+yi*yi;wr<=bn&&(pn=bt,bn=wr)}Lt(pn,bn)}return Y.addEventListener("pointerenter",fn),Y.addEventListener("pointermove",fn),Y.addEventListener("pointerdown",function qi(Yt){"mouse"===Yt.pointerType&&null!=We&&(Q.sticky&&Q.roots.some(hn=>hn?.contains(Yt.target))||(Q.sticky?(Q.sticky=!1,Q.renders.forEach(hn=>hn(null))):(Q.sticky=!0,Dn(We)),Yt.stopImmediatePropagation()))}),Y.addEventListener("pointerleave",function Gr(Yt){"mouse"===Yt.pointerType&&(Q.sticky||Lt(null))}),Dn(null)},g)}}function Vhe(e){return RO(1,1,e)}function jhe(e){return RO(1,.01,e)}function $he(e){return RO(.01,1,e)}function Ij({x1:e,x2:t,x:n=e},i){return e&&t?r=>(e[r]+t[r])/2:n?r=>n[r]:()=>i}function Aj({y1:e,y2:t,y:n=e},i){return e&&t?r=>(e[r]+t[r])/2:n?r=>n[r]:()=>i}function Pj(e){return o_(e)&&void 0===e.interval?void 0:"tabular-nums"}const Oj=Math.PI/180;function kj(e,{marker:t,markerStart:n=t,markerMid:i=t,markerEnd:r=t}={}){e.markerStart=LO(n),e.markerMid=LO(i),e.markerEnd=LO(r)}function LO(e){if(null==e||!1===e)return null;if(!0===e)return Lj;if("function"==typeof e)return e;switch(`${e}`.toLowerCase()){case"none":return null;case"arrow":return Rj("auto");case"arrow-reverse":return Rj("auto-start-reverse");case"dot":return Ghe;case"circle":case"circle-fill":return Lj;case"circle-stroke":return qhe}throw new Error(`invalid marker: ${e}`)}function Rj(e){return(t,n)=>Bl("svg:marker",n).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",e).attr("fill","none").attr("stroke",t).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(i=>i.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function Ghe(e,t){return Bl("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","none").call(n=>n.append("circle").attr("r",2.5)).node()}function Lj(e,t){return Bl("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","white").attr("stroke-width",1.5).call(n=>n.append("circle").attr("r",3)).node()}function qhe(e,t){return Bl("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","white").attr("stroke",e).attr("stroke-width",1.5).call(n=>n.append("circle").attr("r",3)).node()}let Whe=0;function Fj(e,t,{stroke:n},i){return function Nj(e,{markerStart:t,markerMid:n,markerEnd:i,stroke:r},s=(()=>r),u){const h=new Map;function g(x){return function(C){const S=s(C);let O=h.get(x);O||h.set(x,O=new Map);let F=O.get(S);if(!F){const $=this.parentNode.insertBefore(x(S,u),this),G="plot-marker-"+ ++Whe;$.setAttribute("id",G),O.set(S,F=`url(#${G})`)}return F}}t&&e.attr("marker-start",g(t)),n&&e.attr("marker-mid",g(n)),i&&e.attr("marker-end",g(i))}(e,t,n&&(r=>n[r]),i)}function IT({inset:e,insetLeft:t,insetRight:n,...i}={}){return[t,n]=Bj(e,t,n),{inset:e,insetLeft:t,insetRight:n,...i}}function zj({inset:e,insetTop:t,insetBottom:n,...i}={}){return[t,n]=Bj(e,t,n),{inset:e,insetTop:t,insetBottom:n,...i}}function Bj(e,t,n){return void 0===e&&void 0===t&&void 0===n?Qc?[1,0]:[.5,.5]:[t,n]}function Uj(e,{interval:t}){return(e={...l1(e)}).interval=JP(void 0===e.interval?t:e.interval),e}function AT(e,t,n,i){const{[e]:r,[`${e}1`]:s,[`${e}2`]:u}=n,{value:h,interval:g}=Uj(r,n);if(null==h||null==g&&!i)return n;const x=r_(r);if(null==g){let F;const $={transform:G=>F||(F=xa(G,h)),label:x};return{...n,[e]:void 0,[`${e}1`]:void 0===s?$:s,[`${e}2`]:void 0===u?$:u}}let C,S;function O(F){return void 0!==S&&F===C?S:S=qs(xa(C=F,h),$=>g.floor($))}return t({...n,[e]:void 0,[`${e}1`]:void 0===s?{transform:O,label:x}:s,[`${e}2`]:void 0===u?{transform:F=>O(F).map($=>g.offset($)),label:x}:u})}function Vj(e,t,n){const{[e]:i}=n,{value:r,interval:s}=Uj(i,n);return null==r||null==s?n:t({...n,[e]:{label:r_(i),transform:u=>{const h=qs(xa(u,r),x=>s.floor(x)),g=h.map(x=>s.offset(x));return h.map(Ud(h)?(x,C)=>null==x||isNaN(x=+x)||null==(C=g[C])||isNaN(C=+C)?void 0:new Date((x+C)/2):(x,C)=>null==x||null==(C=g[C])?NaN:(+x+ +C)/2)}}})}function jj(e={}){return AT("x",IT,e)}function $j(e={}){return AT("y",zj,e)}const Hj={ariaLabel:"rule",fill:null,stroke:"currentColor"};class Khe extends jd{constructor(t,n={}){const{x:i,y1:r,y2:s,inset:u=0,insetTop:h=u,insetBottom:g=u}=n;super(t,{x:{value:i,scale:"x",optional:!0},y1:{value:r,scale:"y",optional:!0},y2:{value:s,scale:"y",optional:!0}},ST(n,"x"),Hj),this.insetTop=lo(h),this.insetBottom=lo(g),kj(this,n)}render(t,n,i,r,s){const{x:u,y:h}=n,{x:g,y1:x,y2:C}=i,{width:S,height:O,marginTop:F,marginRight:$,marginLeft:G,marginBottom:Y}=r,{insetTop:J,insetBottom:Q}=this;return Bl("svg:g",s).call(xm,this,r,s).call(rp,this,{x:g&&u},Qc,0).call(he=>he.selectAll().data(t).enter().append("line").call(wm,this).attr("x1",g?ue=>g[ue]:(G+S-$)/2).attr("x2",g?ue=>g[ue]:(G+S-$)/2).attr("y1",x&&!Bu(h)?ue=>x[ue]+J:F+J).attr("y2",C&&!Bu(h)?h.bandwidth?ue=>C[ue]+h.bandwidth()-Q:ue=>C[ue]-Q:O-Y-Q).call(s_,this,i).call(Fj,this,i,s)).node()}}class Qhe extends jd{constructor(t,n={}){const{x1:i,x2:r,y:s,inset:u=0,insetRight:h=u,insetLeft:g=u}=n;super(t,{y:{value:s,scale:"y",optional:!0},x1:{value:i,scale:"x",optional:!0},x2:{value:r,scale:"x",optional:!0}},ST(n,"y"),Hj),this.insetRight=lo(h),this.insetLeft=lo(g),kj(this,n)}render(t,n,i,r,s){const{x:u,y:h}=n,{y:g,x1:x,x2:C}=i,{width:S,height:O,marginTop:F,marginRight:$,marginLeft:G,marginBottom:Y}=r,{insetLeft:J,insetRight:Q}=this;return Bl("svg:g",s).call(xm,this,r,s).call(rp,this,{y:g&&h},0,Qc).call(he=>he.selectAll().data(t).enter().append("line").call(wm,this).attr("x1",x&&!Bu(u)?ue=>x[ue]+J:G+J).attr("x2",C&&!Bu(u)?u.bandwidth?ue=>C[ue]+u.bandwidth()-Q:ue=>C[ue]-Q:S-$-Q).attr("y1",g?ue=>g[ue]:(F+O-Y)/2).attr("y2",g?ue=>g[ue]:(F+O-Y)/2).call(s_,this,i).call(Fj,this,i,s)).node()}}function PT(e,t){let{x:n=Fa,y:i,y1:r,y2:s,...u}=$j(t);return[r,s]=Gj(i,r,s),new Khe(e,{...u,x:n,y1:r,y2:s})}function FO(e,t){let{y:n=Fa,x:i,x1:r,x2:s,...u}=jj(t);return[r,s]=Gj(i,r,s),new Qhe(e,{...u,y:n,x1:r,x2:s})}function Gj(e,t,n){if(null==e){if(void 0===t){if(void 0!==n)return[0,n]}else if(void 0===n)return[0,t]}else{if(void 0===t)return void 0===n?[0,e]:[e,n];if(void 0===n)return[e,t]}return[t,n]}function qj(e,...t){let n=t.length;for(let i=0,r=!0;i<n;++i)"function"!=typeof t[i]&&(r&&(e=e.slice(),r=!1),e.splice(i,2,e[i]+t[i]+e[i+1]),t.splice(i,1),--i,--n);return i=>{let r=e[0];for(let s=0;s<n;++s)r+=t[s](i)+e[s+1];return r}}const Jhe={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},Wj="\xad";class NO extends jd{constructor(t,n={}){const{x:i,y:r,text:s=(zh(t)&&IV(t)?Fa:oT),frameAnchor:u,textAnchor:h=(/right$/i.test(u)?"end":/left$/i.test(u)?"start":"middle"),lineAnchor:g=(/^top/i.test(u)?"top":/^bottom/i.test(u)?"bottom":"middle"),lineHeight:x=1,lineWidth:C=1/0,textOverflow:S,monospace:O,fontFamily:F=(O?"ui-monospace, monospace":void 0),fontSize:$,fontStyle:G,fontVariant:Y,fontWeight:J,rotate:Q}=n,[he,ue]=Yc(Q,0),[we,Ie]=function ofe(e){return null==e||"number"==typeof e?[void 0,e]:"string"!=typeof e?[e,void 0]:(e=e.trim().toLowerCase(),rfe.has(e)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(e)?[void 0,e]:[e,void 0])}($);if(super(t,{x:{value:i,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},fontSize:{value:we,optional:!0},rotate:{value:(e=he,null==e?null:{transform:t=>xa(t,e,Float64Array),label:r_(e)}),optional:!0},text:{value:s,filter:hV,optional:!0}},n,Jhe),this.rotate=ue,this.textAnchor=Ws(h,"middle"),this.lineAnchor=Yf(g,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+x,this.lineWidth=+C,this.textOverflow=Zj(S),this.monospace=!!O,this.fontFamily=zl(F),this.fontSize=Ie,this.fontStyle=zl(G),this.fontVariant=zl(Y),this.fontWeight=zl(J),this.frameAnchor=tO(u),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${C}`);var e;this.splitLines=Kj(this),this.clipLine=Qj(this)}render(t,n,i,r,s){const{x:u,y:h}=n,{x:g,y:x,rotate:C,text:S,title:O,fontSize:F}=i,{rotate:$}=this,[G,Y]=ET(this,r);return Bl("svg:g",s).call(xm,this,r,s).call(Xj,this,S,r).call(rp,this,{x:g&&u,y:x&&h}).call(J=>J.selectAll().data(t).enter().append("text").call(wm,this).call(efe,this,S,O).attr("transform",qj`translate(${g?Q=>g[Q]:G},${x?Q=>x[Q]:Y})${C?Q=>` rotate(${C[Q]})`:$?` rotate(${$})`:""}`).call(vi,"font-size",F&&(Q=>F[Q])).call(s_,this,i)).node()}}function Zj(e){return null==e?null:Yf(e,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function efe(e,t,n,i){if(!n)return;const{lineAnchor:r,lineHeight:s,textOverflow:u,splitLines:h,clipLine:g}=t;e.each(function(x){const C=h(bm(n[x])??"").map(g),S=C.length,O="top"===r?.71:"bottom"===r?1-S:(164-100*S)/200;if(S>1){let F=0;for(let $=0;$<S;++$){if(++F,!C[$])continue;const G=this.ownerDocument.createElementNS(Ky.svg,"tspan");G.setAttribute("x",0),$===F-1?G.setAttribute("y",(O+$)*s+"em"):G.setAttribute("dy",F*s+"em"),G.textContent=C[$],this.appendChild(G),F=0}}else O&&this.setAttribute("y",O*s+"em"),this.textContent=C[0];if(u&&!i&&C[0]!==n[x]){const F=this.ownerDocument.createElementNS(Ky.svg,"title");F.textContent=n[x],this.appendChild(F)}})}function g1(e,{x:t,y:n,...i}={}){return void 0===i.frameAnchor&&([t,n]=TV(t,n)),new NO(e,{...i,x:t,y:n})}function tfe(e,{x:t=Fa,...n}={}){return new NO(e,function Yhe(e={}){return Vj("y",zj,e)}({...n,x:t}))}function nfe(e,{y:t=Fa,...n}={}){return new NO(e,function Xhe(e={}){return Vj("x",IT,e)}({...n,y:t}))}function Xj(e,t,n){vi(e,"text-anchor",t.textAnchor),vi(e,"font-family",t.fontFamily),vi(e,"font-size",t.fontSize),vi(e,"font-style",t.fontStyle),vi(e,"font-variant",void 0===t.fontVariant?function ife(e){return e&&(function Bue(e){for(const t of e)if(null!=t)return"number"==typeof t}(e)||Ud(e))?"tabular-nums":void 0}(n):t.fontVariant),vi(e,"font-weight",t.fontWeight)}const rfe=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);const Yj={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"\u2018":31,"\u2019":31,"\u201c":47,"\u201d":47,"\u2026":82};function zO(e,t=0,n=e.length){let i=0;for(let r=t;r<n;r=T0(e,r))i+=Yj[e[r]]??(i$(e,r)?120:Yj.e);return i}function BO(e,t=0,n=e.length){let i=0;for(let r=t;r<n;r=T0(e,r))i+=i$(e,r)?200:100;return i}function Kj({monospace:e,lineWidth:t,textOverflow:n}){if(null!=n||t==1/0)return s=>s.split(/\r\n?|\n/g);const i=e?BO:zO,r=100*t;return s=>function sfe(e,t,n){const i=[];let r,s=0;for(const[u,h,g]of function*afe(e){let t=0,n=0;const i=e.length;for(;n<i;){let r=1;switch(e[n]){case Wj:case"-":++n,yield[t,n,!1],t=n;break;case" ":for(yield[t,n,!1];" "===e[++n];);t=n;break;case"\r":"\n"===e[n+1]&&++r;case"\n":yield[t,n,!0],n+=r,t=n;break;default:++n}}yield[t,n,!0]}(e))void 0===r&&(r=u),s>r&&n(e,r,h)>t&&(i.push(e.slice(r,s)+(e[s-1]===Wj?"-":"")),r=u),g?(i.push(e.slice(r,h)),r=void 0):s=h;return i}(s,r,i)}function Qj({monospace:e,lineWidth:t,textOverflow:n}){if(null==n||t==1/0)return s=>s;const i=e?BO:zO,r=100*t;switch(n){case"clip-start":return s=>e$(s,r,i,"");case"clip-end":return s=>Jj(s,r,i,"");case"ellipsis-start":return s=>e$(s,r,i,C0);case"ellipsis-middle":return s=>function lfe(e,t,n,i){const r=n(e=e.trim());if(r<=t)return e;const s=n(i)/2,[u,h]=M0(e,t/2,n,s),[g]=M0(e,r-t/2-h+s,n,-s);return g<0?i:e.slice(0,u).trimEnd()+i+e.slice(T0(e,g)).trimStart()}(s,r,i,C0);case"ellipsis-end":return s=>Jj(s,r,i,C0)}}const C0="\u2026";function M0(e,t,n,i){const r=[];let s=0;for(let u=0,h=0,g=e.length;u<g;u=h){h=T0(e,u);const x=n(e,u,h);if(s+x>t){for(s+=i;s>t&&u>0;)h=u,u=r.pop(),s-=n(e,u,h);return[u,t-s]}s+=x,r.push(u)}return[-1,0]}function Jj(e,t,n,i){e=e.trim();const r=n(i),[s]=M0(e,t,n,r);return s<0?e:e.slice(0,s).trimEnd()+i}function e$(e,t,n,i){const r=n(e=e.trim());if(r<=t)return e;const s=n(i),[u]=M0(e,r-t+s,n,-s);return u<0?i:i+e.slice(T0(e,u)).trimStart()}const UO=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,t$=/\p{Extended_Pictographic}/uy;function T0(e,t){return t+=function cfe(e,t){const n=e.charCodeAt(t);if(n>=55296&&n<56320){const i=e.charCodeAt(t+1);return i>=56320&&i<57344}return!1}(e,t)?2:1,function dfe(e,t){return!n$(e,t)&&(UO.lastIndex=t,UO.test(e))}(e,t)&&(t=UO.lastIndex),function ufe(e,t){return 8205===e.charCodeAt(t)}(e,t)?T0(e,t+1):t}function n$(e,t){return e.charCodeAt(t)<128}function i$(e,t){return!n$(e,t)&&(t$.lastIndex=t,t$.test(e))}const r$={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},o$=3.5,hfe=5*o$,s$={draw(e,t,n){const i=t*n/hfe;e.moveTo(0,0),e.lineTo(0,-t),e.moveTo(-i,i-t),e.lineTo(0,-t),e.lineTo(i,i-t)}},ffe=new Map([["arrow",s$],["spike",{draw(e,t,n){e.moveTo(-n,0),e.lineTo(0,-t),e.lineTo(n,0)}}]]);class VO extends jd{constructor(t,n={}){const{x:i,y:r,r:s=o$,length:u,rotate:h,shape:g=s$,anchor:x="middle",frameAnchor:C}=n,[S,O]=Yc(u,12),[F,$]=Yc(h,0);super(t,{x:{value:i,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},length:{value:S,scale:"length",optional:!0},rotate:{value:F,optional:!0}},n,r$),this.r=+s,this.length=O,this.rotate=$,this.shape=function mfe(e){if(function pfe(e){return e&&"function"==typeof e.draw}(e))return e;const t=ffe.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid shape: ${e}`)}(g),this.anchor=Yf(x,"anchor",["start","middle","end"]),this.frameAnchor=tO(C)}render(t,n,i,r,s){const{x:u,y:h}=n,{x:g,y:x,length:C,rotate:S}=i,{length:O,rotate:F,anchor:$,shape:G,r:Y}=this,[J,Q]=ET(this,r);return Bl("svg:g",s).call(xm,this,r,s).call(rp,this,{x:g&&u,y:x&&h}).call(he=>he.selectAll().data(t).enter().append("path").call(wm,this).attr("transform",qj`translate(${g?ue=>g[ue]:J},${x?ue=>x[ue]:Q})${S?ue=>` rotate(${S[ue]})`:F?` rotate(${F})`:""}${"start"===$?"":"end"===$?C?ue=>` translate(0,${C[ue]})`:` translate(0,${O})`:C?ue=>` translate(0,${C[ue]/2})`:` translate(0,${O/2})`}`).attr("d",C?ue=>{const we=_P();return G.draw(we,C[ue],Y),we}:(()=>{const ue=_P();return G.draw(ue,O,Y),ue})()).call(s_,this,i)).node()}}function _fe(e,t={}){const{x:n=Fa,...i}=t;return new VO(e,{...i,x:n})}function yfe(e,t={}){const{y:n=Fa,...i}=t;return new VO(e,{...i,y:n})}function Cm(e,t){return arguments.length<2&&!zh(e)&&(t=e,e=null),void 0===t&&(t={}),[e,t]}function OT({anchor:e}={},t){return void 0===e?t[0]:Yf(e,"anchor",t)}function l$(e){return OT(e,["left","right"])}function c$(e){return OT(e,["right","left"])}function u$(e){return OT(e,["bottom","top"])}function d$(e){return OT(e,["top","bottom"])}function h$(){const[e,t]=Cm(...arguments);return p$("y",l$(t),e,t)}function vfe(){const[e,t]=Cm(...arguments);return p$("fy",c$(t),e,t)}function f$(){const[e,t]=Cm(...arguments);return m$("x",u$(t),e,t)}function bfe(){const[e,t]=Cm(...arguments);return m$("fx",d$(t),e,t)}function p$(e,t,n,{color:i="currentColor",opacity:r=1,stroke:s=i,strokeOpacity:u=r,strokeWidth:h=1,fill:g=i,fillOpacity:x=r,textAnchor:C,textStroke:S,textStrokeOpacity:O,textStrokeWidth:F,tickSize:$=("y"===e?6:0),tickPadding:G,tickRotate:Y,x:J,margin:Q,marginTop:he=(void 0===Q?20:Q),marginRight:ue=(void 0===Q?"right"===t?40:0:Q),marginBottom:we=(void 0===Q?20:Q),marginLeft:Ie=(void 0===Q?"left"===t?40:0:Q),label:Qe,labelAnchor:ut,labelArrow:Ct,labelOffset:At,...at}){return $=lo($),G=lo(G),Y=lo(Y),void 0!==ut&&(ut=Yf(ut,"labelAnchor",["center","top","bottom"])),Ct=E$(Ct),Tj($&&!mc(s)?function xfe(e,t,n,{strokeWidth:i=1,strokeLinecap:r=null,strokeLinejoin:s=null,facetAnchor:u=t+("y"===e?"-empty":""),frameAnchor:h=t,tickSize:g,inset:x=0,insetLeft:C=x,insetRight:S=x,dx:O=0,y:F=("y"===e?void 0:null),...$}){return D0(yfe,e,`${e}-axis tick`,n,{strokeWidth:i,strokeLinecap:r,strokeLinejoin:s,facetAnchor:u,frameAnchor:h,y:F,...$,dx:"left"===t?+O-Qc+ +C:+O+Qc-S,anchor:"start",length:g,shape:"left"===t?Pfe:Ofe})}(e,t,n,{stroke:s,strokeOpacity:u,strokeWidth:h,tickSize:$,tickPadding:G,tickRotate:Y,x:J,...at}):null,mc(g)?null:function Efe(e,t,n,{facetAnchor:i=t+("y"===e?"-empty":""),frameAnchor:r=t,tickSize:s,tickRotate:u=0,tickPadding:h=Math.max(3,9-s)+(Math.abs(u)>60?4*Math.cos(u*Oj):0),tickFormat:g,text:x=("function"==typeof g?g:void 0),textAnchor:C=(Math.abs(u)>60?"middle":"left"===t?"end":"start"),lineAnchor:S=(u>60?"top":u<-60?"bottom":"middle"),fontVariant:O,inset:F=0,insetLeft:$=F,insetRight:G=F,dx:Y=0,y:J=("y"===e?void 0:null),...Q}){return D0(nfe,e,`${e}-axis tick label`,n,{facetAnchor:i,frameAnchor:r,text:void 0===x?null:x,textAnchor:C,lineAnchor:S,fontVariant:O,rotate:u,y:J,...Q,dx:"left"===t?+Y-s-h+ +$:+Y+ +s+ +h-G},function(he,ue,we,Ie){void 0===O&&(this.fontVariant=x$(he)),void 0===x&&(Ie.text=b$(he,ue,we,g,t))})}(e,t,n,{fill:g,fillOpacity:x,stroke:S,strokeOpacity:O,strokeWidth:F,textAnchor:C,tickSize:$,tickPadding:G,tickRotate:Y,x:J,marginTop:he,marginRight:ue,marginBottom:we,marginLeft:Ie,...at}),mc(g)||null===Qe?null:g1([],v$({fill:g,fillOpacity:x,...at},function(jt,Ht,Ae,Ne,ge){const Re=Ne[e],{marginTop:We,marginRight:Ye,marginBottom:Dt,marginLeft:Bt}="y"===e&&ge.inset||ge,Lt=ut??(Re.bandwidth?"center":"top"),Dn=At??("right"===t?Ye:Bt)-3;return"center"===Lt?(this.textAnchor=void 0,this.lineAnchor="right"===t?"bottom":"top",this.frameAnchor=t,this.rotate=-90):(this.textAnchor="right"===t?"end":"start",this.lineAnchor=Lt,this.frameAnchor=`${Lt}-${t}`,this.rotate=0),this.dy="top"===Lt?3-We:"bottom"===Lt?Dt-3:0,this.dx="right"===t?Dn:-Dn,this.ariaLabel=`${e}-axis label`,{facets:[[0]],channels:{text:{value:[w$(e,Re,{anchor:t,label:Qe,labelAnchor:Lt,labelArrow:Ct})]}}}})))}function m$(e,t,n,{color:i="currentColor",opacity:r=1,stroke:s=i,strokeOpacity:u=r,strokeWidth:h=1,fill:g=i,fillOpacity:x=r,textAnchor:C,textStroke:S,textStrokeOpacity:O,textStrokeWidth:F,tickSize:$=("x"===e?6:0),tickPadding:G,tickRotate:Y,y:J,margin:Q,marginTop:he=(void 0===Q?"top"===t?30:0:Q),marginRight:ue=(void 0===Q?20:Q),marginBottom:we=(void 0===Q?"bottom"===t?30:0:Q),marginLeft:Ie=(void 0===Q?20:Q),label:Qe,labelAnchor:ut,labelArrow:Ct,labelOffset:At,...at}){return $=lo($),G=lo(G),Y=lo(Y),void 0!==ut&&(ut=Yf(ut,"labelAnchor",["center","left","right"])),Ct=E$(Ct),Tj($&&!mc(s)?function wfe(e,t,n,{strokeWidth:i=1,strokeLinecap:r=null,strokeLinejoin:s=null,facetAnchor:u=t+("x"===e?"-empty":""),frameAnchor:h=t,tickSize:g,inset:x=0,insetTop:C=x,insetBottom:S=x,dy:O=0,x:F=("x"===e?void 0:null),...$}){return D0(_fe,e,`${e}-axis tick`,n,{strokeWidth:i,strokeLinejoin:s,strokeLinecap:r,facetAnchor:u,frameAnchor:h,x:F,...$,dy:"bottom"===t?+O-Qc-S:+O+Qc+ +C,anchor:"start",length:g,shape:"bottom"===t?Ife:Afe})}(e,t,n,{stroke:s,strokeOpacity:u,strokeWidth:h,tickSize:$,tickPadding:G,tickRotate:Y,y:J,...at}):null,mc(g)?null:function Cfe(e,t,n,{facetAnchor:i=t+("x"===e?"-empty":""),frameAnchor:r=t,tickSize:s,tickRotate:u=0,tickPadding:h=Math.max(3,9-s)+(Math.abs(u)>=10?4*Math.cos(u*Oj):0),tickFormat:g,text:x=("function"==typeof g?g:void 0),textAnchor:C=(Math.abs(u)>=10?u<0^"bottom"===t?"start":"end":"middle"),lineAnchor:S=(Math.abs(u)>=10?"middle":"bottom"===t?"top":"bottom"),fontVariant:O,inset:F=0,insetTop:$=F,insetBottom:G=F,dy:Y=0,x:J=("x"===e?void 0:null),...Q}){return D0(tfe,e,`${e}-axis tick label`,n,{facetAnchor:i,frameAnchor:r,text:void 0===x?null:x,textAnchor:C,lineAnchor:S,fontVariant:O,rotate:u,x:J,...Q,dy:"bottom"===t?+Y+ +s+ +h-G:+Y-s-h+ +$},function(he,ue,we,Ie){void 0===O&&(this.fontVariant=x$(he)),void 0===x&&(Ie.text=b$(he,ue,we,g,t))})}(e,t,n,{fill:g,fillOpacity:x,stroke:S,strokeOpacity:O,strokeWidth:F,textAnchor:C,tickSize:$,tickPadding:G,tickRotate:Y,y:J,marginTop:he,marginRight:ue,marginBottom:we,marginLeft:Ie,...at}),mc(g)||null===Qe?null:g1([],v$({fill:g,fillOpacity:x,...at},function(jt,Ht,Ae,Ne,ge){const Re=Ne[e],{marginTop:We,marginRight:Ye,marginBottom:Dt,marginLeft:Bt}="x"===e&&ge.inset||ge,Lt=ut??(Re.bandwidth?"center":"right"),Dn=At??("top"===t?We:Dt)-3;return"center"===Lt?(this.frameAnchor=t,this.textAnchor=void 0):(this.frameAnchor=`${t}-${Lt}`,this.textAnchor="right"===Lt?"end":"start"),this.lineAnchor=t,this.dy="top"===t?-Dn:Dn,this.dx="right"===Lt?Ye-3:"left"===Lt?3-Bt:0,this.ariaLabel=`${e}-axis label`,{facets:[[0]],channels:{text:{value:[w$(e,Re,{anchor:t,label:Qe,labelAnchor:Lt,labelArrow:Ct})]}}}})))}function Mfe(){const[e,t]=Cm(...arguments);return g$("y",l$(t),e,t)}function Tfe(){const[e,t]=Cm(...arguments);return g$("fy",c$(t),e,t)}function Dfe(){const[e,t]=Cm(...arguments);return _$("x",u$(t),e,t)}function Sfe(){const[e,t]=Cm(...arguments);return _$("fx",d$(t),e,t)}function g$(e,t,n,{y:i=("y"===e?void 0:null),x:r=null,x1:s=("left"===t?r:null),x2:u=("right"===t?r:null),...h}){return D0(FO,e,`${e}-grid`,n,{y:i,x1:s,x2:u,...y$(h)})}function _$(e,t,n,{x:i=("x"===e?void 0:null),y:r=null,y1:s=("top"===t?r:null),y2:u=("bottom"===t?r:null),...h}){return D0(PT,e,`${e}-grid`,n,{x:i,y1:s,y2:u,...y$(h)})}function y$({color:e="currentColor",opacity:t=.1,stroke:n=e,strokeOpacity:i=t,strokeWidth:r=1,...s}){return{stroke:n,strokeOpacity:i,strokeWidth:r,...s}}function v$({fill:e,fillOpacity:t,fontFamily:n,fontSize:i,fontStyle:r,fontWeight:s,monospace:u,pointerEvents:h,shapeRendering:g},x){return[,e]=Xf(e),[,t]=Yc(t),{facet:"super",x:null,y:null,fill:e,fillOpacity:t,fontFamily:n,fontSize:i,fontStyle:r,fontWeight:s,monospace:u,pointerEvents:h,shapeRendering:g,initializer:x}}function D0(e,t,n,i,r,s){let u;const g=E0(r).initializer,x=e(i,E0({...r,initializer:function h(C,S,O,F,$,G){const Y=null==C&&("fx"===t||"fy"===t),{[t]:J}=F;if(!J)throw new Error(`missing scale: ${t}`);let{ticks:Q,tickSpacing:he,interval:ue}=r;if(yO(J)&&"string"==typeof Q&&(ue=Q,Q=void 0),null==C){if(zh(Q))C=Kc(Q);else if(J.ticks)if(void 0!==Q)C=J.ticks(Q);else if(ue=y0(void 0===ue?J.interval:ue,J.type),void 0!==ue){const[Ie,Qe]=Pd(J.domain());C=ue.range(Ie,ue.offset(ue.floor(Qe)))}else{const[Ie,Qe]=Pd(J.range());Q=(Qe-Ie)/(void 0===he?"x"===t?80:35:he),C=J.ticks(Q)}else C=J.domain();"y"===t||"x"===t?S=[Nh(C)]:u[t]={scale:t,value:Fa}}s?.call(this,J,C,Q,u);const we=Object.fromEntries(Object.entries(u).map(([Ie,Qe])=>[Ie,{...Qe,value:xa(C,Qe.value)}]));return Y&&(S=G.filterFacets(C,we)),{data:C,facets:S,channels:we}}},g));return null==i?(u=x.channels,x.channels={}):u={},x.ariaLabel=n,x}function b$(e,t,n,i,r){return{value:kT(e,t,n,i,r)}}function kT(e,t,n,i,r){return void 0===i&&yO(e)?function Cue(e,t,n,i){const r="time"===e.type?GM:Jx,s="left"===i||"right"===i?(u,h)=>`\n${u}\n${h}`:"top"===i?(u,h)=>`${h}\n${u}`:(u,h)=>`${u}\n${h}`;switch(function Mue(e,t,n){const i=zC(function yie(e,t=vie){const n=[];let i,r=!1;for(const s of e)r&&n.push(t(i,s)),i=s,r=!0;return n}(t,(g,x)=>Math.abs(x-g)||NaN));if(i>0)return r1[vx(([,g])=>g).right(r1,i,1,r1.length)-1][0];const[r,s]=Pd(e.domain()),u="number"==typeof n?n:10,h=Math.abs(s-r)/u;return r1[vx(([,g])=>Math.log(g)).center(r1,Math.log(h))][0]}(e,t,n)){case"millisecond":return n_(r(".%L"),r(":%M:%S"),s);case"second":return n_(r(":%S"),r("%-I:%M"),s);case"minute":return n_(r("%-I:%M"),r("%p"),s);case"hour":return n_(r("%-I %p"),r("%b %-d"),s);case"day":case"week":return n_(r("%-d"),r("%b"),s);case"month":return n_(r("%b"),r("%Y"),s);case"year":return r("%Y")}throw new Error("unable to format time ticks")}(e,t,n,r):e.tickFormat?e.tickFormat(zh(n)?null:n,i):void 0===i?function wue(e){if(!e)return!1;const t=e.floor(new Date(Date.UTC(2e3,11,31)));return zd(t)>=t}(e.interval)?Jx("%Y"):function Eue(e){if(!e)return!1;const t=e.floor(new Date(2e3,11,31));return Nd(t)>=t}(e.interval)?GM("%Y"):bm:"string"==typeof i?(Ud(e.domain())?Jx:kx)(i):s1(i)}const Ife={draw(e,t){e.moveTo(0,0),e.lineTo(0,t)}},Afe={draw(e,t){e.moveTo(0,0),e.lineTo(0,-t)}},Pfe={draw(e,t){e.moveTo(0,0),e.lineTo(-t,0)}},Ofe={draw(e,t){e.moveTo(0,0),e.lineTo(t,0)}};function x$(e){return e.bandwidth&&!e.interval?void 0:"tabular-nums"}function w$(e,t,{anchor:n,label:i=t.label,labelAnchor:r,labelArrow:s}={}){if(!(null==i||i.inferred&&function Rfe(e){return yO(e)||null!=e.interval}(t)&&/^(date|time|year)$/i.test(i))){if(i=String(i),"auto"===s&&(s=(!t.bandwidth||t.interval)&&!/[\u2191\u2193\u2192\u2190]/.test(i)),!s)return i;if(!0===s){const u=function kfe(e){return Math.sign(v0(e.domain()))*Math.sign(v0(e.range()))}(t);u&&(s=/x$/.test(e)||"center"===r?/x$/.test(e)===u<0?"left":"right":u<0?"up":"down")}switch(s){case"left":return`\u2190 ${i}`;case"right":return`${i} \u2192`;case"up":return"right"===n?`${i} \u2191`:`\u2191 ${i}`;case"down":return"right"===n?`${i} \u2193`:`\u2193 ${i}`}return i}}function E$(e="auto"){return!mc(e)&&("boolean"==typeof e?e:Yf(e,"labelArrow",["auto","up","right","down","left"]))}function C$(e,t){if(null==t)return t;const n=e(t);if(!n)throw new Error(`scale not found: ${t}`);return n}function M$(e,t={},n){let{columns:i,tickFormat:r,fontVariant:s=Pj(e),swatchSize:u=15,swatchWidth:h=u,swatchHeight:g=u,marginLeft:x=0,className:C,style:S,width:O}=t;const F=cO(t);C=bO(C),"function"!=typeof r&&(r=kT(e.scale,e.domain,void 0,r));const $=Bl("div",F).attr("class",`${C}-swatches ${C}-swatches-${null!=i?"columns":"wrap"}`);let G;return null!=i?(G=`.${C}-swatches-columns .${C}-swatch {\n  display: flex;\n  align-items: center;\n  break-inside: avoid;\n  padding-bottom: 1px;\n}\n.${C}-swatches-columns .${C}-swatch::before {\n  flex-shrink: 0;\n}\n.${C}-swatches-columns .${C}-swatch-label {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}`,$.style("columns",i).selectAll().data(e.domain).enter().append("div").attr("class",`${C}-swatch`).call(n,e,h,g).call(Y=>Y.append("div").attr("class",`${C}-swatch-label`).attr("title",r).text(r))):(G=`.${C}-swatches-wrap {\n  display: flex;\n  align-items: center;\n  min-height: 33px;\n  flex-wrap: wrap;\n}\n.${C}-swatches-wrap .${C}-swatch {\n  display: inline-flex;\n  align-items: center;\n  margin-right: 1em;\n}`,$.selectAll().data(e.domain).enter().append("span").attr("class",`${C}-swatch`).call(n,e,h,g).append(function(){return this.ownerDocument.createTextNode(r.apply(this,arguments))})),$.call(Y=>Y.insert("style","*").text(`.${C}-swatches {\n  font-family: system-ui, sans-serif;\n  font-size: 10px;\n  margin-bottom: 0.5em;\n}\n.${C}-swatch > svg {\n  margin-right: 0.5em;\n  overflow: visible;\n}\n${G}`)).style("margin-left",x?+x+"px":null).style("width",void 0===O?null:+O+"px").style("font-variant",Ws(s,"normal")).call(xO,S).node()}const RT=new Map([["symbol",function Ffe(e,{fill:t=(void 0!==e.hint?.fill?e.hint.fill:"none"),fillOpacity:n=1,stroke:i=(void 0!==e.hint?.stroke?e.hint.stroke:mc(t)?"currentColor":"none"),strokeOpacity:r=1,strokeWidth:s=1.5,r:u=4.5,...h}={},g){const[x,C]=Xf(t),[S,O]=Xf(i),F=C$(g,x),$=C$(g,S),G=u*u*Math.PI;return n=Yc(n)[1],r=Yc(r)[1],s=Yc(s)[1],M$(e,h,(Y,J,Q,he)=>Y.append("svg").attr("viewBox","-8 -8 16 16").attr("width",Q).attr("height",he).attr("fill","color"===x?ue=>F.scale(ue):C).attr("fill-opacity",n).attr("stroke","color"===S?ue=>$.scale(ue):O).attr("stroke-opacity",r).attr("stroke-width",s).append("path").attr("d",ue=>{const we=_P();return e.scale(ue).draw(we,G),we}))}],["color",T$],["opacity",function zfe({type:e,interpolate:t,...n},{legend:i=!0,color:r=gm(0,0,0),...s}){if(!t)throw new Error(`${e} opacity scales are not supported`);if(!0===i&&(i="ramp"),"ramp"!==`${i}`.toLowerCase())throw new Error(`${i} opacity legends are not supported`);return T$({type:e,...n,interpolate:Bfe(r)},{legend:i,...s})}]]);function jO({className:e,...t},{label:n,ticks:i,tickFormat:r}={},s){return function jue(e={},...t){let n=e;for(const i of t)for(const r in i)if(void 0===n[r]){const s=i[r];n===e?n={...n,[r]:s}:n[r]=s}return n}(s,{className:e,...t},{label:n,ticks:i,tickFormat:r})}function T$(e,{legend:t=!0,...n}){if(!0===t&&(t="ordinal"===e.type?"swatches":"ramp"),void 0!==e.domain)switch(`${t}`.toLowerCase()){case"swatches":return function Lfe(e,{opacity:t,...n}={}){if(!o_(e)&&!vj(e))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${e.type})`);return M$(e,n,(i,r,s,u)=>i.append("svg").attr("width",s).attr("height",u).attr("fill",r.scale).attr("fill-opacity",Yc(t)[1]).append("rect").attr("width","100%").attr("height","100%"))}(e,n);case"ramp":return function Hhe(e,t){let{label:n=e.label,tickSize:i=6,width:r=240,height:s=44+i,marginTop:u=18,marginRight:h=0,marginBottom:g=16+i,marginLeft:x=0,style:C,ticks:S=(r-x-h)/64,tickFormat:O,fontVariant:F=Pj(e),round:$=!0,opacity:G,className:Y}=t;const J=cO(t);Y=bO(Y),G=Yc(G)[1],null===O&&(O=()=>null);const Q=Bl("svg",J).attr("class",`${Y}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",r).attr("height",s).attr("viewBox",`0 0 ${r} ${s}`).call(jt=>jt.append("style").text(`.${Y}-ramp {\n  display: block;\n  background: white;\n  height: auto;\n  height: intrinsic;\n  max-width: 100%;\n  overflow: visible;\n}\n.${Y}-ramp text {\n  white-space: pre;\n}`)).call(xO,C);let ue,he=jt=>jt.selectAll(".tick line").attr("y1",u+g-s);const we=$?(jt,Ht)=>jt.rangeRound(Ht):(jt,Ht)=>jt.range(Ht),{type:Ie,domain:Qe,range:ut,interpolate:Ct,scale:At,pivot:at}=e;if(Ct){const jt=void 0===ut?Ct:kM(1===Ct.length?pO(Ct):Ct,ut);ue=we(At.copy(),Fd(al(x,r-h),Math.min(Qe.length+(void 0!==at),void 0===ut?1/0:ut.length)));const Ht=256,Ae=J.document.createElement("canvas");Ae.width=Ht,Ae.height=1;const Ne=Ae.getContext("2d");for(let ge=0,Re=Ht-1;ge<Ht;++ge)Ne.fillStyle=jt(ge/Re),Ne.fillRect(ge,0,1,1);Q.append("image").attr("opacity",G).attr("x",x).attr("y",u).attr("width",r-x-h).attr("height",s-u-g).attr("preserveAspectRatio","none").attr("xlink:href",Ae.toDataURL())}else if("threshold"===Ie){const jt=Qe,Ht=void 0===O?Ae=>Ae:"string"==typeof O?kx(O):O;ue=we(wP().domain([-1,ut.length-1]),[x,r-h]),Q.append("g").attr("fill-opacity",G).selectAll().data(ut).enter().append("rect").attr("x",(Ae,Ne)=>ue(Ne-1)).attr("y",u).attr("width",(Ae,Ne)=>ue(Ne)-ue(Ne-1)).attr("height",s-u-g).attr("fill",Ae=>Ae),S=qs(jt,(Ae,Ne)=>Ne),O=Ae=>Ht(jt[Ae],Ae)}else ue=we(LM().domain(Qe),[x,r-h]),Q.append("g").attr("fill-opacity",G).selectAll().data(Qe).enter().append("rect").attr("x",ue).attr("y",u).attr("width",Math.max(0,ue.bandwidth()-1)).attr("height",s-u-g).attr("fill",At),he=()=>{};return Q.append("g").attr("transform",`translate(0,${s-g})`).call(function Iie(e){return HC(pA,e)}(ue).ticks(Array.isArray(S)?null:S,"string"==typeof O?O:void 0).tickFormat("function"==typeof O?O:void 0).tickSize(i).tickValues(Array.isArray(S)?S:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",Ws(F,"normal")).call(he).call(jt=>jt.select(".domain").remove()),void 0!==n&&Q.append("text").attr("x",x).attr("y",u-6).attr("fill","currentColor").attr("font-weight","bold").text(n),Q.node()}(e,n);default:throw new Error(`unknown legend type: ${t}`)}}function Bfe(e){const{r:t,g:n,b:i}=gm(e)||gm(0,0,0);return r=>`rgba(${t},${n},${i},${r})`}const Vfe={ariaLabel:"frame",fill:"none",stroke:"currentColor"},jfe={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square"};class $fe extends jd{constructor(t={}){const{anchor:n=null,inset:i=0,insetTop:r=i,insetRight:s=i,insetBottom:u=i,insetLeft:h=i,rx:g,ry:x}=t;super(rT,void 0,t,null==n?Vfe:jfe),this.anchor=aT(n,"anchor",["top","right","bottom","left"]),this.insetTop=lo(r),this.insetRight=lo(s),this.insetBottom=lo(u),this.insetLeft=lo(h),this.rx=lo(g),this.ry=lo(x)}render(t,n,i,r,s){const{marginTop:u,marginRight:h,marginBottom:g,marginLeft:x,width:C,height:S}=r,{anchor:O,insetTop:F,insetRight:$,insetBottom:G,insetLeft:Y,rx:J,ry:Q}=this,he=x+Y,ue=C-h-$,we=u+F,Ie=S-g-G;return Bl(O?"svg:line":"svg:rect",s).datum(0).call(xm,this,r,s).call(wm,this).call(s_,this,i).call(rp,this,{}).call("left"===O?Qe=>Qe.attr("x1",he).attr("x2",he).attr("y1",we).attr("y2",Ie):"right"===O?Qe=>Qe.attr("x1",ue).attr("x2",ue).attr("y1",we).attr("y2",Ie):"top"===O?Qe=>Qe.attr("x1",he).attr("x2",ue).attr("y1",we).attr("y2",we):"bottom"===O?Qe=>Qe.attr("x1",he).attr("x2",ue).attr("y1",Ie).attr("y2",Ie):Qe=>Qe.attr("x",he).attr("y",we).attr("width",ue-he).attr("height",Ie-we).attr("rx",J).attr("ry",Q)).node()}}const $O={ariaLabel:"tip",fill:"white",stroke:"currentColor"},Gfe=new Set(["geometry","href","src","ariaLabel"]);class qfe extends jd{constructor(t,n={}){n.tip&&(n={...n,tip:!1}),void 0===n.title&&zh(t)&&IV(t)&&(n={...n,title:Fa});const{x:i,y:r,x1:s,x2:u,y1:h,y2:g,anchor:x,monospace:C,fontFamily:S=(C?"ui-monospace, monospace":void 0),fontSize:O,fontStyle:F,fontVariant:$,fontWeight:G,lineHeight:Y=1,lineWidth:J=20,frameAnchor:Q,textAnchor:he="start",textOverflow:ue,textPadding:we=8,title:Ie,pointerSize:Qe=12,pathFilter:ut="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=n;super(t,{x:{value:null!=s&&null!=u?null:i,scale:"x",optional:!0},y:{value:null!=h&&null!=g?null:r,scale:"y",optional:!0},x1:{value:s,scale:"x",optional:null==u},y1:{value:h,scale:"y",optional:null==g},x2:{value:u,scale:"x",optional:null==s},y2:{value:g,scale:"y",optional:null==h},title:{value:Ie,optional:!0}},n,$O),this.anchor=PV(x,"anchor"),this.previousAnchor=this.anchor??"top-left",this.frameAnchor=tO(Q),this.textAnchor=Ws(he,"middle"),this.textPadding=+we,this.pointerSize=+Qe,this.pathFilter=zl(ut),this.lineHeight=+Y,this.lineWidth=+J,this.textOverflow=Zj(ue),this.monospace=!!C,this.fontFamily=zl(S),this.fontSize=lo(O),this.fontStyle=zl(F),this.fontVariant=zl($),this.fontWeight=zl(G);for(const Ct in $O)Ct in this.channels&&(this[Ct]=$O[Ct]);this.splitLines=Kj(this),this.clipLine=Qj(this)}render(t,n,i,r,s){const u=this,{x:h,y:g,fx:x,fy:C}=n,{ownerSVGElement:S,document:O}=s,{anchor:F,monospace:$,lineHeight:G,lineWidth:Y}=this,{textPadding:J,pointerSize:Q,pathFilter:he}=this,{marginTop:ue,marginLeft:we}=r,Ie=function Kfe({channels:e}){const t={};for(const n in e){if(Gfe.has(n))continue;const i=lde(e,n);i&&(t[n]=i)}return t}(i),{x1:Qe,y1:ut,x2:Ct,y2:At,x:at=Qe??Ct,y:jt=ut??At}=i,Ht=x?x(t.fx)-we:0,Ae=C?C(t.fy)-ue:0,[Ne,ge]=ET(this,r),Re=Ij(i,Ne),We=Aj(i,ge),Ye=$?BO:zO,Dt=Ye(C0),Bt=x&&kT(x),Lt=C&&kT(C),fn=Bl("svg:g",s).call(xm,this,r,s).call(Xj,this).call(rp,this,{x:at&&h,y:jt&&g}).call(Yt=>Yt.selectAll().data(t).enter().append("g").attr("transform",hn=>`translate(${Math.round(Re(hn))},${Math.round(We(hn))})`).call(wm,this).call(hn=>hn.append("path").attr("filter",he)).call(hn=>hn.append("text").each(function(ft){const pn=t1(this);this.setAttribute("fill","currentColor"),this.setAttribute("fill-opacity",1),this.setAttribute("stroke","none");const bn=new Set;for(const bt of function*Dn(Yt,hn){if("title"in Yt){const ft=Yt.title.value[hn];for(const pn of u.splitLines(bm(ft)))yield{name:"",value:u.clipLine(pn)}}else{for(const ft in Yt){if("x1"===ft&&"x2"in Yt||"y1"===ft&&"y2"in Yt)continue;const pn=Yt[ft],bn=pn.value[hn];if(t_(bn)||null!=pn.scale)if("x2"===ft&&"x1"in Yt)yield{name:HO(n,pn,"x"),value:D$(Yt.x1,pn,hn)};else if("y2"===ft&&"y1"in Yt)yield{name:HO(n,pn,"y"),value:D$(Yt.y1,pn,hn)};else{const bt=pn.scale,Gn={name:HO(n,pn,ft),value:bm(bn)};("color"===bt||"opacity"===bt)&&(Gn[bt]=i[ft][hn]),yield Gn}}null!=t.fi&&x&&(yield{name:String(x.label??"fx"),value:Bt(t.fx)}),null!=t.fi&&C&&(yield{name:String(C.label??"fy"),value:Lt(t.fy)})}}(Ie,ft)){const Gn=bt.name;Gn&&bn.has(Gn)||(bn.add(Gn),qi(pn,bt))}})));function qi(Yt,{name:hn,value:ft,color:pn,opacity:bn}){const bt=null!=pn||null!=bn;let Gn,yi=100*Y;const[wr]=M0(hn,yi,Ye,Dt);if(wr>=0)hn=hn.slice(0,wr).trimEnd()+C0,Gn=ft.trim(),ft="";else{(hn||!ft&&!bt)&&(ft=" "+ft);const[zn]=M0(ft,yi-Ye(hn),Ye,Dt);zn>=0&&(Gn=(ft=ft.slice(0,zn).trimEnd()+C0).trim())}const Ji=Yt.append("tspan").attr("x",0).attr("dy",`${G}em`).text("\u200b");hn&&Ji.append("tspan").attr("font-weight","bold").text(hn),ft&&Ji.append(()=>O.createTextNode(ft)),bt&&Ji.append("tspan").text(" \u25a0").attr("fill",pn).attr("fill-opacity",bn).style("user-select","none"),Gn&&Ji.append("title").text(Gn)}function Gr(){const{width:Yt,height:hn}=r.facet??r;fn.selectChildren().each(function(ft){let{x:pn,width:bn,height:bt}=this.getBBox();bn=Math.round(bn),bt=Math.round(bt);let Gn=F;if(void 0===Gn){Gn=u.previousAnchor;const Ji=Re(ft)+Ht,zn=We(ft)+Ae,no=Ji+bn+2*J<Yt,Vh=Ji-bn-2*J>0,Jc=zn+bt+Q+2*J+7<hn,YT=zn-bt-Q-2*J>0,KT=(/-left$/.test(Gn)?no||!Vh:no&&!Vh)?"left":"right",Ek=(/^top-/.test(Gn)?Jc||!YT:Jc&&!YT)?"top":"bottom";Gn=u.previousAnchor=`${Ek}-${KT}`}const wr=this.lastChild;if(this.firstChild.setAttribute("d",function Yfe(e,t,n,i,r){const s=i+2*n,u=r+2*n;switch(e){case"middle":return`M${-s/2},${-u/2}h${s}v${u}h${-s}z`;case"top-left":return`M0,0l${t},${t}h${s-t}v${u}h${-s}z`;case"top":return`M0,0l${t/2},${t/2}h${(s-t)/2}v${u}h${-s}v${-u}h${(s-t)/2}z`;case"top-right":return`M0,0l${-t},${t}h${t-s}v${u}h${s}z`;case"right":return`M0,0l${-t/2},${-t/2}v${t/2-u/2}h${-s}v${u}h${s}v${t/2-u/2}z`;case"bottom-left":return`M0,0l${t},${-t}h${s-t}v${-u}h${-s}z`;case"bottom":return`M0,0l${t/2},${-t/2}h${(s-t)/2}v${-u}h${-s}v${u}h${(s-t)/2}z`;case"bottom-right":return`M0,0l${-t},${-t}h${t-s}v${-u}h${s}z`;case"left":return`M0,0l${t/2},${-t/2}v${t/2-u/2}h${s}v${u}h${-s}v${t/2-u/2}z`}}(Gn,Q,J,bn,bt)),pn)for(const Ji of wr.childNodes)Ji.setAttribute("x",-pn);wr.setAttribute("y",+function Zfe(e,t,n){return/^top(?:-|$)/.test(e)?.94-n:-.29-t*n}(Gn,wr.childNodes.length,G).toFixed(6)+"em"),wr.setAttribute("transform",`translate(${function Xfe(e,t,n,i,r){switch(e){case"middle":return[-i/2,r/2];case"top-left":return[n,t+n];case"top":return[-i/2,t/2+n];case"top-right":return[-i-n,t+n];case"right":return[-t/2-i-n,r/2];case"bottom-left":return[n,-t-n];case"bottom":return[-i/2,-t/2-n];case"bottom-right":return[-i-n,-t-n];case"left":return[n+t/2,r/2]}}(Gn,Q,J,bn,bt)})`)})}return S.isConnected?Promise.resolve().then(Gr):typeof requestAnimationFrame<"u"&&requestAnimationFrame(Gr),fn.node()}}function Wfe(e,{x:t,y:n,...i}={}){return void 0===i.frameAnchor&&([t,n]=TV(t,n)),new qfe(e,{...i,x:t,y:n})}function D$(e,t,n){return t.hint?.length?`${bm(t.value[n]-e.value[n])}`:`${bm(e.value[n])}\u2013${bm(t.value[n])}`}function HO(e,t,n){return String(e[t.scale]?.label??t?.label??n)}function S0(e={}){const{facet:t,style:n,caption:i,ariaLabel:r,ariaDescription:s}=e,u=bO(e.className),h=void 0===e.marks?[]:S$(e.marks);h.push(...function rpe(e){const t=[];for(const n of e){const i=n.tip;if(i){const s=("x"===i?jhe:"y"===i?$he:Vhe)(ipe(n));s.title=null,t.push(Wfe(n.data,s))}}return t}(h));const g=function npe(e,t){if(null==e)return;const{x:n,y:i}=e;if(null==n&&null==i)return;const r=Kc(e.data);if(null==r)throw new Error("missing facet data");const s={};null!=n&&(s.fx=d1(r,{value:n,scale:"fx"})),null!=i&&(s.fy=d1(r,{value:i,scale:"fy"})),GO(s,t);return{channels:s,groups:wO(r,s),data:e.data}}(t,e),x=new Map;for(const ge of h){const Re=A$(ge,g,e);Re&&x.set(ge,Re)}const C=new Map;g&&_1(C,[g],e),_1(C,x,e);const S=S$(function ope(e,t,n){let{projection:i,x:r={},y:s={},fx:u={},fy:h={},axis:g,grid:x,facet:C={},facet:{axis:S=g,grid:O}=C,x:{axis:F=g,grid:$=(null===F?null:x)}=r,y:{axis:G=g,grid:Y=(null===G?null:x)}=s,fx:{axis:J=S,grid:Q=(null===J?null:O)}=u,fy:{axis:he=S,grid:ue=(null===he?null:O)}=h}=n;(i||!YP(r)&&!P$("x",e))&&(F=$=null),(i||!YP(s)&&!P$("y",e))&&(G=Y=null),t.has("fx")||(J=Q=null),t.has("fy")||(he=ue=null),void 0===F&&(F=!NT(e,"x")),void 0===G&&(G=!NT(e,"y")),void 0===J&&(J=!NT(e,"fx")),void 0===he&&(he=!NT(e,"fy")),!0===F&&(F="bottom"),!0===G&&(G="left"),!0===J&&(J="top"===F||null===F?"bottom":"top"),!0===he&&(he="right"===G||null===G?"left":"right");const we=[];return FT(we,ue,Tfe,h),LT(we,he,vfe,"right","left",C,h),FT(we,Q,Sfe,u),LT(we,J,bfe,"top","bottom",C,u),FT(we,Y,Mfe,s),LT(we,G,h$,"left","right",n,s),FT(we,$,Dfe,r),LT(we,F,f$,"bottom","top",n,r),we}(h,C,e));for(const ge of S){const Re=A$(ge,g,e);Re&&x.set(ge,Re)}h.unshift(...S);let O=function The(e,t){const{fx:n,fy:i}=mO(e,t),r=n?.scale.domain(),s=i?.scale.domain();return r&&s?function aie(...e){const t="function"==typeof e[e.length-1]&&function sie(e){return t=>e(...t)}(e.pop()),n=(e=e.map(oie)).map(iie),i=e.length-1,r=new Array(i+1).fill(0),s=[];if(i<0||n.some(rie))return s;for(;;){s.push(r.map((h,g)=>e[g][h]));let u=i;for(;++r[u]===n[u];){if(0===u)return t?s.map(t):s;r[u--]=0}}}(r,s).map(([u,h],g)=>({x:u,y:h,i:g})):r?r.map((u,h)=>({x:u,i:h})):s?s.map((u,h)=>({y:u,i:h})):void 0}(C,e);if(void 0!==O){const ge=g?SO(O,g):void 0;for(const We of h){if(null===We.facet||"super"===We.facet)continue;const Ye=x.get(We);void 0!==Ye&&(Ye.facetsIndex=null!=We.fx||null!=We.fy?SO(O,Ye):ge)}const Re=new Set;for(const{facetsIndex:We}of x.values())We?.forEach((Ye,Dt)=>{Ye?.length>0&&Re.add(Dt)});O.forEach(0<Re.size&&Re.size<O.length?(We,Ye)=>We.empty=!Re.has(Ye):We=>We.empty=!1);for(const We of h)if("exclude"===We.facet){const Ye=x.get(We);void 0!==Ye&&(Ye.facetsIndex=Ihe(Ye.facetsIndex))}}for(const ge of $o.keys())YP(e[ge])&&"fx"!==ge&&"fy"!==ge&&C.set(ge,[]);const F=new Map;for(const ge of h){if(F.has(ge))throw new Error("duplicate mark; each mark must be unique");const{facetsIndex:Re,channels:We}=x.get(ge)??{},{data:Ye,facets:Dt,channels:Bt}=ge.initialize(Re,We,e);GO(Bt,e),F.set(ge,{data:Ye,facets:Dt,channels:Bt})}const $=mO(_1(C,F,e),e),G=dj($),Y=function Che(e,t,n={}){let i=.5-Qc,r=.5+Qc,s=.5+Qc,u=.5-Qc;for(const{marginTop:G,marginRight:Y,marginBottom:J,marginLeft:Q}of t)G>i&&(i=G),Y>r&&(r=Y),J>s&&(s=J),Q>u&&(u=Q);let{margin:h,marginTop:g=(void 0!==h?h:i),marginRight:x=(void 0!==h?h:r),marginBottom:C=(void 0!==h?h:s),marginLeft:S=(void 0!==h?h:u)}=n;g=+g,x=+x,C=+C,S=+S;let{width:O=640,height:F=Mhe(e,n,{width:O,marginTopDefault:i,marginRightDefault:r,marginBottomDefault:s,marginLeftDefault:u})+Math.max(0,g-i+C-s)}=n;O=+O,F=+F;const $={width:O,height:F,marginTop:g,marginRight:x,marginBottom:C,marginLeft:S};if(e.fx||e.fy){let{margin:G,marginTop:Y=(void 0!==G?G:g),marginRight:J=(void 0!==G?G:x),marginBottom:Q=(void 0!==G?G:C),marginLeft:he=(void 0!==G?G:S)}=n.facet??{};Y=+Y,J=+J,Q=+Q,he=+he,$.facet={marginTop:Y,marginRight:J,marginBottom:Q,marginLeft:he}}return $}($,h,e);!function Yde(e,t){const{x:n,y:i,fx:r,fy:s}=e,u=r||s?gO(t):t;r&&fj(r,u),s&&pj(s,u);const h=r||s?hj(e,t):t;n&&fj(n,h),i&&pj(i,h)}($,Y);const{fx:J,fy:Q}=G,he=J||Q?hj($,Y):Y,ue=J||Q?function hpe({fx:e,fy:t},n){const{marginTop:i,marginRight:r,marginBottom:s,marginLeft:u,width:h,height:g}=gO(n),x=e&&O$(e),C=t&&O$(t);return{marginTop:t?C[0]:i,marginRight:e?h-x[1]:r,marginBottom:t?g-C[1]:s,marginLeft:e?x[0]:u,inset:{marginTop:n.marginTop,marginRight:n.marginRight,marginBottom:n.marginBottom,marginLeft:n.marginLeft},width:h,height:g}}(G,Y):Y,we=cO(e),Ie=we.document,Qe=WC("svg").call(Ie.documentElement);let ut=Qe;we.ownerSVGElement=Qe,we.className=u,we.projection=function ude({projection:e,inset:t=0,insetTop:n=t,insetRight:i=t,insetBottom:r=t,insetLeft:s=t}={},u){if(null==e)return;if("function"==typeof e.stream)return e;let h,g,x="frame";if(i_(e)){let we;if(({type:e,domain:g,inset:we,insetTop:n=(void 0!==we?we:n),insetRight:i=(void 0!==we?we:i),insetBottom:r=(void 0!==we?we:r),insetLeft:s=(void 0!==we?we:s),clip:x=x,...h}=e),null==e)return}"function"!=typeof e&&({type:e}=GV(e));const{width:C,height:S,marginLeft:O,marginRight:F,marginTop:$,marginBottom:G}=u,Y=C-O-F-s-i,J=S-$-G-n-r;if(e=e?.({width:Y,height:J,clip:x,...h}),null==e)return;x=function dde(e,t,n,i,r){if(!1===e||null==e||"number"==typeof e)return s=>s;if("frame"===(!0===e&&(e="frame"),`${e}`.toLowerCase()))return RB(t,n,i,r);throw new Error(`unknown projection clip type: ${e}`)}(x,O,$,C-F,S-G);let ue,Q=O+s,he=$+n;if(null!=g){const[[we,Ie],[Qe,ut]]=r6(e).bounds(g),Ct=Math.min(Y/(Qe-we),J/(ut-Ie));Ct>0?(Q-=(Ct*(we+Qe)-Y)/2,he-=(Ct*(Ie+ut)-J)/2,ue=nP({point(At,at){this.stream.point(At*Ct+Q,at*Ct+he)}})):x0("Warning: the projection could not be fit to the specified domain; using the default scale.")}return ue??=0===Q&&0===he?qV():nP({point(we,Ie){this.stream.point(we+Q,Ie+he)}}),{stream:we=>e.stream(ue.stream(x(we)))}}(e,he),we.filterFacets=(ge,Re)=>SO(O,{channels:Re,groups:wO(ge,Re)}),we.getMarkState=ge=>{const Re=F.get(ge),We=x.get(ge);return{...Re,channels:{...Re.channels,...We?.channels}}},we.dispatchValue=ge=>{ut.value!==ge&&(ut.value=ge,ut.dispatchEvent(new Event("input",{bubbles:!0})))};const Ct=new Set;for(const[ge,Re]of F)if(null!=ge.initializer){const Ye=ge.initializer(Re.data,Re.facets,Re.channels,G,"super"===ge.facet?ue:he,we);if(void 0!==Ye.data&&(Re.data=Ye.data),void 0!==Ye.facets&&(Re.facets=Ye.facets),void 0!==Ye.channels){const{fx:Dt,fy:Bt,...Lt}=Ye.channels;tpe(Lt),Object.assign(Re.channels,Lt);for(const Dn of Object.values(Lt)){const{scale:fn}=Dn;null!=fn&&$o.get(fn)!==Bh&&(I$(Dn,e),Ct.add(fn))}(null!=Dt||null!=Bt)&&x.set(ge,!0)}}if(Ct.size){const ge=new Map;_1(ge,F,e,Ye=>Ct.has(Ye)),_1(C,F,e,Ye=>Ct.has(Ye));const Re=function dpe(e,t){for(const n in e){const i=e[n],r=t[n];void 0===i.label&&r&&(i.label=r.label)}return e}(mO(ge,e),$),We=dj(Re);Object.assign($,Re),Object.assign(G,We)}let At,at;void 0!==O&&(At={x:J?.domain(),y:Q?.domain()},O=function Dhe(e,{x:t,y:n}){return t&&=EO(t),n&&=EO(n),e.filter(t&&n?i=>t.has(i.x)&&n.has(i.y):t?i=>t.has(i.x):i=>n.has(i.y)).sort(t&&n?(i,r)=>t.get(i.x)-t.get(r.x)||n.get(i.y)-n.get(r.y):t?(i,r)=>t.get(i.x)-t.get(r.x):(i,r)=>n.get(i.y)-n.get(r.y))}(O,At),at=function She(e,t,{marginTop:n,marginLeft:i}){return e&&t?({x:r,y:s})=>`translate(${e(r)-i},${t(s)-n})`:e?({x:r})=>`translate(${e(r)-i},0)`:({y:r})=>`translate(0,${t(r)-n})`}(J,Q,Y));for(const[ge,Re]of F)Re.values=ge.scale(Re.channels,G,we);const{width:jt,height:Ht}=Y;t1(Qe).attr("class",u).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",jt).attr("height",Ht).attr("viewBox",`0 0 ${jt} ${Ht}`).attr("aria-label",r).attr("aria-description",s).call(ge=>ge.append("style").text(`.${u} {\n  display: block;\n  background: white;\n  height: auto;\n  height: intrinsic;\n  max-width: 100%;\n}\n.${u} text,\n.${u} tspan {\n  white-space: pre;\n}`)).call(xO,n);for(const ge of h){const{channels:Re,values:We,facets:Ye}=F.get(ge);if(void 0===O||"super"===ge.facet){let Dt=null;if(Ye&&(Dt=Ye[0],Dt=ge.filter(Dt,Re,We),0===Dt.length))continue;const Bt=ge.render(Dt,G,We,ue,we);if(null==Bt)continue;Qe.appendChild(Bt)}else{let Dt;for(const Bt of O){if(!(ge.facetAnchor?.(O,At,Bt)??!Bt.empty))continue;let Lt=null;if(Ye){const fn=x.has(ge);if(Lt=Ye[fn?Bt.i:0],Lt=ge.filter(Lt,Re,We),0===Lt.length)continue;!fn&&Lt===Ye[0]&&(Lt=kue(Lt)),Lt.fx=Bt.x,Lt.fy=Bt.y,Lt.fi=Bt.i}const Dn=ge.render(Lt,G,We,he,we);if(null!=Dn){(Dt??=t1(Qe).append("g")).append(()=>Dn).datum(Bt);for(const fn of["aria-label","aria-description","aria-hidden","transform"])Dn.hasAttribute(fn)&&(Dt.attr(fn,Dn.getAttribute(fn)),Dn.removeAttribute(fn))}}Dt?.selectChildren().attr("transform",at)}}const Ae=function Ufe(e,t,n){const i=[];for(const[r,s]of RT){const u=n[r];if(u?.legend&&r in e){const h=s(e[r],jO(t,e[r],u),g=>e[g]);null!=h&&i.push(h)}}return i}($,we,e);if(null!=i||Ae.length>0){ut=Ie.createElement("figure"),ut.style.maxWidth="initial";for(const ge of Ae)ut.appendChild(ge);if(ut.appendChild(Qe),null!=i){const ge=Ie.createElement("figcaption");ge.appendChild(i?.ownerDocument?i:Ie.createTextNode(i)),ut.appendChild(ge)}}ut.scale=function ihe(e){return t=>{if(!$o.has(t=`${t}`))throw new Error(`unknown scale: ${t}`);return t in e?function bj({scale:e,type:t,domain:n,range:i,interpolate:r,interval:s,transform:u,percent:h,pivot:g}){if("identity"===t)return{type:"identity",apply:C=>C,invert:C=>C};const x=e.unknown?e.unknown():void 0;return{type:t,domain:ZP(n),...void 0!==i&&{range:ZP(i)},...void 0!==u&&{transform:u},...h&&{percent:h},...void 0!==x&&{unknown:x},...void 0!==s&&{interval:s},...void 0!==r&&{interpolate:r},...e.clamp&&{clamp:e.clamp()},...void 0!==g&&{pivot:g,symmetric:!1},...e.base&&{base:e.base()},...e.exponent&&{exponent:e.exponent()},...e.constant&&{constant:e.constant()},...e.align&&{align:e.align(),round:e.round()},...e.padding&&(e.paddingInner?{paddingInner:e.paddingInner(),paddingOuter:e.paddingOuter()}:{padding:e.padding()}),...e.bandwidth&&{bandwidth:e.bandwidth(),step:e.step()},apply:C=>e(C),...e.invert&&{invert:C=>e.invert(C)}}}(e[t]):void 0}}($),ut.legend=function Nfe(e,t,n={}){return(i,r)=>{if(!RT.has(i))throw new Error(`unknown legend type: ${i}`);if(i in e)return RT.get(i)(e[i],jO(t,n[i],r),s=>e[s])}}($,we,e);const Ne=function cde(){const e=uO;return uO=0,e}();return Ne>0&&t1(Qe).append("text").attr("x",jt).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("\u26a0\ufe0f").append("title").text(`${Ne.toLocaleString("en-US")} warning${1===Ne?"":"s"}. Please check the console.`),ut}function S$(e){return e.flat(1/0).filter(t=>null!=t).map(Jfe)}function Jfe(e){return"function"==typeof e.render?e:new epe(e)}jd.prototype.plot=function Qfe({marks:e=[],...t}={}){return S0({...t,marks:[...e,this]})};class epe extends jd{constructor(t){if("function"!=typeof t)throw new TypeError("invalid mark; missing render function");super(),this.render=t}render(){}}function GO(e,t){for(const n in e)I$(e[n],t);return e}function I$(e,t){const{scale:n,transform:i=!0}=e;if(null==n||!i)return;const{type:r,percent:s,interval:u,transform:h=(s?g=>100*g:SV(u,r))}=t[n]??{};null!=h&&(e.value=qs(e.value,h),e.transform=!1)}function tpe(e){for(const t in e)BV(t,e[t])}function _1(e,t,n,i=Iue){for(const{channels:r}of t.values())for(const s in r){const u=r[s],{scale:h}=u;if(null!=h&&i(h))if("projection"===h){if(!fde(n)){const g=void 0===n.x?.domain,x=void 0===n.y?.domain;if(g||x){const[C,S]=mde(u);g&&qO(e,"x",C),x&&qO(e,"y",S)}}}else qO(e,h,u)}return e}function qO(e,t,n){const i=e.get(t);void 0!==i?i.push(n):e.set(t,[n])}function A$(e,t,n){if(null===e.facet||"super"===e.facet)return;const{fx:i,fy:r}=e;if(null!=i||null!=r){const g=Kc(e.data??i??r);if(void 0===g)throw new Error(`missing facet data in ${e.ariaLabel}`);if(null===g)return;const x={};return null!=i&&(x.fx=d1(g,{value:i,scale:"fx"})),null!=r&&(x.fy=d1(g,{value:r,scale:"fy"})),GO(x,n),{channels:x,groups:wO(g,x)}}if(void 0===t)return;const{channels:s,groups:u,data:h}=t;if("auto"!==e.facet||e.data===h)return{channels:s,groups:u};h.length>0&&(u.size>1||1===u.size&&s.fx&&s.fy&&[...u][0][1].size>1)&&Kc(e.data)?.length===h.length&&x0(`Warning: the ${e.ariaLabel} mark appears to use faceted data, but isn\u2019t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function ipe(e,t={}){return E0({...t,x:null,y:null},(n,i,r,s,u,h)=>h.getMarkState(e))}function LT(e,t,n,i,r,s,u){if(!t)return;const h=function spe(e){return/^\s*both\s*$/i.test(e)}(t);u=function ape(e,t,{line:n=t.line,ticks:i,tickSize:r,tickSpacing:s,tickPadding:u,tickFormat:h,tickRotate:g,fontVariant:x,ariaLabel:C,ariaDescription:S,label:O=t.label,labelAnchor:F,labelArrow:$=t.labelArrow,labelOffset:G}){return{anchor:e,line:n,ticks:i,tickSize:r,tickSpacing:s,tickPadding:u,tickFormat:h,tickRotate:g,fontVariant:x,ariaLabel:C,ariaDescription:S,label:O,labelAnchor:F,labelArrow:$,labelOffset:G}}(h?i:t,s,u);const{line:g}=u;(n===h$||n===f$)&&g&&!c1(g)&&e.push(function Hfe(e){return new $fe(e)}(function lpe(e){const{anchor:t,line:n}=e;return{anchor:t,facetAnchor:t+"-empty",stroke:!0===n?void 0:n}}(u))),e.push(n(u)),h&&e.push(n({...u,anchor:r,label:null}))}function FT(e,t,n,i){!t||c1(t)||e.push(n(function cpe(e,{stroke:t=(dT(e)?e:void 0),ticks:n=(upe(e)?e:void 0),tickSpacing:i,ariaLabel:r,ariaDescription:s}){return{stroke:t,ticks:n,tickSpacing:i,ariaLabel:r,ariaDescription:s}}(t,i)))}function upe(e){switch(typeof e){case"number":return!0;case"string":return!dT(e)}return zh(e)||"function"==typeof e?.range}function NT(e,t){const n=`${t}-axis `;return e.some(i=>i.ariaLabel?.startsWith(n))}function P$(e,t){for(const n of t)for(const i in n.channels){const{scale:r}=n.channels[i];if(r===e||"projection"===r)return!0}return!1}function O$(e){const t=e.domain();let n=e(t[0]),i=e(t[t.length-1]);return i<n&&([n,i]=[i,n]),[n,i+e.bandwidth()]}function k$(e={}){return CV(e)?e:{...e,y:Fa}}function R$({y:e,y1:t,y2:n,...i}={}){return i=ST(i,"x"),void 0===t&&void 0===n?function mpe(e={},t={}){1===arguments.length&&([e,t]=I0(e));const{x1:n,x:i=n,y:r,...s}=t,[u,h,g,x]=A0(i,r,"x","y",e,s);return{...u,x1:n,x:h,y1:g,y2:x,y:uT(g,x)}}({y:e,...i}):([t,n]=MV(e,t,n),{...i,y1:t,y2:n})}function I0(e){const{offset:t,order:n,reverse:i,...r}=e;return[{offset:t,order:n,reverse:i},r]}const _pe={length:!0};function A0(e,t=Sue,n,i,{offset:r,order:s,reverse:u},h){const g=function Oue({z:e,fill:t,stroke:n}={}){return void 0===e&&([e]=Xf(t)),void 0===e&&([e]=Xf(n)),e}(h),[x,C]=Kf(e),[S,O]=cT(t),[F,$]=cT(t);return S.hint=F.hint=_pe,r=function ype(e){if(null!=e){if("function"==typeof e)return e;switch(`${e}`.toLowerCase()){case"expand":case"normalize":return vpe;case"center":case"silhouette":return bpe;case"wiggle":return F$}throw new Error(`unknown offset: ${e}`)}}(r),s=function xpe(e,t,n){if(void 0===e&&t===F$)return B$(Bd);if(null!=e){if("string"==typeof e){const i=e.startsWith("-"),r=i?nT:Bd;switch((i?e.slice(1):e).toLowerCase()){case"value":case n:return function wpe(e){return(t,n,i)=>(r,s)=>e(i[r],i[s])}(r);case"z":return function Epe(e){return(t,n,i,r)=>(s,u)=>e(r[s],r[u])}(r);case"sum":return function Cpe(e){return zT(e,(t,n,i,r)=>uA(Nh(t),s=>fm(s,u=>i[u]),s=>r[s]))}(r);case"appearance":return function Mpe(e){return zT(e,(t,n,i,r)=>uA(Nh(t),s=>n[Mz(s,u=>i[u])],s=>r[s]))}(r);case"inside-out":return B$(r)}return U$(xV(e))}if("function"==typeof e)return(1===e.length?U$:Tpe)(e);if(Array.isArray(e))return function Dpe(e){return zT(Bd,()=>e)}(e);throw new Error(`invalid order: ${e}`)}}(s,r,i),[TT(h,(G,Y,J)=>{const Q=null==e?void 0:C(DV(xa(G,e),J?.[n])),he=xa(G,t,Float64Array),ue=xa(G,g),we=s&&s(G,Q,he,ue),Ie=G.length,Qe=O(new Float64Array(Ie)),ut=$(new Float64Array(Ie)),Ct=[];for(const At of Y){const at=Q?Array.from(cA(At,jt=>Q[jt]).values()):[At];if(we)for(const jt of at)jt.sort(we);for(const jt of at){let Ht=0,Ae=0;u&&jt.reverse();for(const Ne of jt){const ge=he[Ne];ge<0?Ht=ut[Ne]=(Qe[Ne]=Ht)+ge:ge>0?Ae=ut[Ne]=(Qe[Ne]=Ae)+ge:ut[Ne]=Qe[Ne]=Ae}}Ct.push(at)}return r&&r(Ct,Qe,ut,ue),{data:G,facets:Y}}),x,S,F]}function L$(e,t){let n=0,i=0;for(const r of e){const s=t[r];s<n&&(n=s),s>i&&(i=s)}return[n,i]}function vpe(e,t,n){for(const i of e)for(const r of i){const[s,u]=L$(r,n);for(const h of r){const g=1/(u-s||1);t[h]=g*(t[h]-s),n[h]=g*(n[h]-s)}}}function bpe(e,t,n){for(const i of e){for(const r of i){const[s,u]=L$(r,n);for(const h of r){const g=(u+s)/2;t[h]-=g,n[h]-=g}}N$(i,t,n)}z$(e,t,n)}function F$(e,t,n,i){for(const r of e){const s=new Vg;let u=0;for(const h of r){let g=-1;const x=h.map(F=>Math.abs(n[F]-t[F])),C=h.map(F=>{g=i?i[F]:++g;const $=n[F]-t[F],G=s.has(g)?$-s.get(g):0;return s.set(g,$),G}),S=[0,...lie(C)];for(const F of h)t[F]+=u,n[F]+=u;const O=fm(x);O&&(u-=fm(x,(F,$)=>(C[$]/2+S[$])*F)/O)}N$(r,t,n)}z$(e,t,n)}function N$(e,t,n){const i=Bf(e,r=>Bf(r,s=>t[s]));for(const r of e)for(const s of r)t[s]-=i,n[s]-=i}function z$(e,t,n){const i=e.length;if(1===i)return;const r=e.map(h=>h.flat()),s=r.map(h=>(Bf(h,g=>t[g])+Ih(h,g=>n[g]))/2),u=Bf(s);for(let h=0;h<i;h++){const g=u-s[h];for(const x of r[h])t[x]+=g,n[x]+=g}}function B$(e){return zT(e,(t,n,i,r)=>{const s=Nh(t),u=uA(s,S=>n[Mz(S,O=>i[O])],S=>r[S]),h=Zy(s,S=>fm(S,O=>i[O]),S=>r[S]),g=[],x=[];let C=0;for(const S of u)C<0?(C+=h.get(S),g.push(S)):(C-=h.get(S),x.push(S));return x.reverse().concat(g)})}function U$(e){return t=>{const n=xa(t,e);return(i,r)=>Bd(n[i],n[r])}}function Tpe(e){return t=>(n,i)=>e(t[n],t[i])}function zT(e,t){return(n,i,r,s)=>{if(!s)throw new Error("missing channel: z");const u=new Vg(t(n,i,r,s).map((h,g)=>[h,g]));return(h,g)=>e(u.get(s[h]),u.get(s[g]))}}class V$ extends jd{constructor(t,n,i={},r){super(t,n,i,r);const{inset:s=0,insetTop:u=s,insetRight:h=s,insetBottom:g=s,insetLeft:x=s,rx:C,ry:S}=i;this.insetTop=lo(u),this.insetRight=lo(h),this.insetBottom=lo(g),this.insetLeft=lo(x),this.rx=Ws(C,"auto"),this.ry=Ws(S,"auto")}render(t,n,i,r,s){const{rx:u,ry:h}=this;return Bl("svg:g",s).call(xm,this,r,s).call(this._transform,this,n).call(g=>g.selectAll().data(t).enter().append("rect").call(wm,this).attr("x",this._x(n,i,r)).attr("width",this._width(n,i,r)).attr("y",this._y(n,i,r)).attr("height",this._height(n,i,r)).call(vi,"rx",u).call(vi,"ry",h).call(s_,this,i)).node()}_x(t,{x:n},{marginLeft:i}){const{insetLeft:r}=this;return n?s=>n[s]+r:i+r}_y(t,{y:n},{marginTop:i}){const{insetTop:r}=this;return n?s=>n[s]+r:i+r}_width({x:t},{x:n},{marginRight:i,marginLeft:r,width:s}){const{insetLeft:u,insetRight:h}=this,g=n&&t?t.bandwidth():s-i-r;return Math.max(0,g-u-h)}_height({y:t},{y:n},{marginTop:i,marginBottom:r,height:s}){const{insetTop:u,insetBottom:h}=this,g=n&&t?t.bandwidth():s-i-r;return Math.max(0,g-u-h)}}const j$={ariaLabel:"bar"};class Spe extends V${constructor(t,n={}){const{x1:i,x2:r,y:s}=n;super(t,{x1:{value:i,scale:"x"},x2:{value:r,scale:"x"},y:{value:s,scale:"y",type:"band",optional:!0}},n,j$)}_transform(t,n,{x:i}){t.call(rp,n,{x:i},0,0)}_x({x:t},{x1:n,x2:i},{marginLeft:r}){const{insetLeft:s}=this;return Bu(t)?r+s:u=>Math.min(n[u],i[u])+s}_width({x:t},{x1:n,x2:i},{marginRight:r,marginLeft:s,width:u}){const{insetLeft:h,insetRight:g}=this;return Bu(t)?u-r-s-h-g:x=>Math.max(0,Math.abs(i[x]-n[x])-h-g)}}class Ipe extends V${constructor(t,n={}){const{x:i,y1:r,y2:s}=n;super(t,{y1:{value:r,scale:"y"},y2:{value:s,scale:"y"},x:{value:i,scale:"x",type:"band",optional:!0}},n,j$)}_transform(t,n,{y:i}){t.call(rp,n,{y:i},0,0)}_y({y:t},{y1:n,y2:i},{marginTop:r}){const{insetTop:s}=this;return Bu(t)?r+s:u=>Math.min(n[u],i[u])+s}_height({y:t},{y1:n,y2:i},{marginTop:r,marginBottom:s,height:u}){const{insetTop:h,insetBottom:g}=this;return Bu(t)?u-r-s-h-g:x=>Math.max(0,Math.abs(i[x]-n[x])-h-g)}}function WO(e,t={}){return XP(t)||(t={...t,y:oT,x2:Fa}),new Spe(e,function gpe({x:e,x1:t,x2:n,...i}={}){return i=ST(i,"y"),void 0===t&&void 0===n?function ppe(e={},t={}){1===arguments.length&&([e,t]=I0(e));const{y1:n,y:i=n,x:r,...s}=t,[u,h,g,x]=A0(i,r,"y","x",e,s);return{...u,y1:n,y:h,x1:g,x2:x,x:uT(g,x)}}({x:e,...i}):([t,n]=MV(e,t,n),{...i,x1:t,x2:n})}(jj(function fpe(e={}){return EV(e)?e:{...e,x:Fa}}(t))))}function Ape(e,t={}){return XP(t)||(t={...t,x:oT,y2:Fa}),new Ipe(e,R$($j(k$(t))))}const Ppe={ariaLabel:"rect"};class ZO extends jd{constructor(t,n={}){const{x1:i,y1:r,x2:s,y2:u,inset:h=0,insetTop:g=h,insetRight:x=h,insetBottom:C=h,insetLeft:S=h,rx:O,ry:F}=n;super(t,{x1:{value:i,scale:"x",optional:!0},y1:{value:r,scale:"y",optional:!0},x2:{value:s,scale:"x",optional:!0},y2:{value:u,scale:"y",optional:!0}},n,Ppe),this.insetTop=lo(g),this.insetRight=lo(x),this.insetBottom=lo(C),this.insetLeft=lo(S),this.rx=Ws(O,"auto"),this.ry=Ws(F,"auto")}render(t,n,i,r,s){const{x:u,y:h}=n,{x1:g,y1:x,x2:C,y2:S}=i,{marginTop:O,marginRight:F,marginBottom:$,marginLeft:G,width:Y,height:J}=r,{projection:Q}=s,{insetTop:he,insetRight:ue,insetBottom:we,insetLeft:Ie,rx:Qe,ry:ut}=this;return Bl("svg:g",s).call(xm,this,r,s).call(rp,this,{x:g&&C&&u,y:x&&S&&h},0,0).call(Ct=>Ct.selectAll().data(t).enter().append("rect").call(wm,this).attr("x",g&&C&&(Q||!Bu(u))?At=>Math.min(g[At],C[At])+Ie:G+Ie).attr("y",x&&S&&(Q||!Bu(h))?At=>Math.min(x[At],S[At])+he:O+he).attr("width",g&&C&&(Q||!Bu(u))?At=>Math.max(0,Math.abs(C[At]-g[At])-Ie-ue):Y-F-G-ue-Ie).attr("height",x&&S&&(Q||!Bu(h))?At=>Math.max(0,Math.abs(x[At]-S[At])-he-we):J-O-$-he-we).call(vi,"rx",Qe).call(vi,"ry",ut).call(s_,this,i)).node()}}function Ope(e,t={}){return XP(t)||(t={...t,x:oT,y2:Fa,interval:1}),new ZO(e,R$(function Zhe(e={}){return AT("x",IT,e,!0)}(k$(t))))}function $$(e={y:"count"},t={}){[e,t]=function YO({cumulative:e,domain:t,thresholds:n,interval:i,...r},s){return[r,{cumulative:e,domain:t,thresholds:n,interval:i,...s}]}(e,t);const{x:n,y:i}=t;return function XO(e,t,n,i,{data:r=aO,filter:s=yT,sort:u,reverse:h,...g}={},x={}){e=G$(e),t=G$(t),g=function Fpe(e,t){return function kV(e,t,n=oO){const i=Object.entries(e);return null!=t.title&&void 0===e.title&&i.push(["title",Que]),null!=t.href&&void 0===e.href&&i.push(["href",NV]),i.filter(([,r])=>void 0!==r).map(([r,s])=>null===s?function Zue(e){return{name:e,initialize(){},scope(){},reduce(){}}}(r):n(r,s,t))}(e,t,q$)}(g,x),r=Z$(r,Fa),u=null==u?void 0:q$("sort",u,x),s=null==s?void 0:W$("filter",s,x),null!=n&&b0(g,"x","x1","x2")&&(n=null),null!=i&&b0(g,"y","y1","y2")&&(i=null);const[C,S]=Kf(e),[O,F]=Kf(e),[$,G]=Kf(t),[Y,J]=Kf(t),[Q,he]=null!=n?[n,"x"]:null!=i?[i,"y"]:[],[ue,we]=Kf(Q),{x:Ie,y:Qe,z:ut,fill:Ct,stroke:At,x1:at,x2:jt,y1:Ht,y2:Ae,domain:Ne,cumulative:ge,thresholds:Re,interval:We,...Ye}=x,[Dt,Bt]=Kf(ut),[Lt]=Xf(Ct),[Dn]=Xf(At),[fn,qi]=Kf(Lt),[Gr,Yt]=Kf(Dn);return{..."z"in x&&{z:Dt||ut},..."fill"in x&&{fill:fn||Ct},..."stroke"in x&&{stroke:Gr||At},...TT(Ye,(hn,ft,pn)=>{const bn=DV(xa(hn,Q),pn?.[he]),bt=xa(hn,ut),Gn=xa(hn,Lt),yi=xa(hn,Dn),wr=function RV(e,t){for(const n in t){const i=t[n];if(void 0!==i&&!e.some(r=>r.name===n))return i}}(g,{z:bt,fill:Gn,stroke:yi}),Ji=[],zn=[],no=bn&&we([]),Vh=bt&&Bt([]),Jc=Gn&&qi([]),YT=yi&&Yt([]),KT=e&&S([]),Ek=e&&F([]),A7=t&&G([]),p_e=t&&J([]),m_e=function Upe(e,t){return e&&t?function*(n){const i=e.bin(n);for(const[r,[s,u]]of e.entries()){const h=t.bin(i[r]);for(const[g,[x,C]]of t.entries())yield[h[g],{x1:s,y1:x,x2:u,y2:C}]}}:e?function*(n){const i=e.bin(n);for(const[r,[s,u]]of e.entries())yield[i[r],{x1:s,x2:u}]}:function*(n){const i=t.bin(n);for(const[r,[s,u]]of t.entries())yield[i[r],{y1:s,y2:u}]}}(e?.(hn),t?.(hn));let g_e=0;for(const z0 of g)z0.initialize(hn);u&&u.initialize(hn),s&&s.initialize(hn);for(const z0 of ft){const P7=[];for(const I1 of g)I1.scope("facet",z0);u&&u.scope("facet",z0),s&&s.scope("facet",z0);for(const[I1,__e]of u1(z0,wr))for(const[y_e,v_e]of u1(__e,bn))for(const[u_,d_]of m_e(v_e))if(!s||s.reduce(u_,d_)){P7.push(g_e++),zn.push(r.reduceIndex(u_,hn,d_)),bn&&no.push(y_e),bt&&Vh.push(wr===bt?I1:bt[u_[0]]),Gn&&Jc.push(wr===Gn?I1:Gn[u_[0]]),yi&&YT.push(wr===yi?I1:yi[u_[0]]),KT&&(KT.push(d_.x1),Ek.push(d_.x2)),A7&&(A7.push(d_.y1),p_e.push(d_.y2));for(const b_e of g)b_e.reduce(u_,d_);u&&u.reduce(u_)}Ji.push(P7)}return function LV(e,t,n){if(t){const i=t.output.transform(),r=(s,u)=>Bd(i[s],i[u]);e.forEach(s=>s.sort(r))}n&&e.forEach(i=>i.reverse())}(Ji,u,h),{data:zn,facets:Ji}}),...!b0(g,"x")&&(C?{x1:C,x2:O,x:uT(C,O)}:{x:Ie,x1:at,x2:jt}),...!b0(g,"y")&&($?{y1:$,y2:Y,y:uT($,Y)}:{y:Qe,y1:Ht,y2:Ae}),...ue&&{[he]:ue},...Object.fromEntries(g.map(({name:hn,output:ft})=>[hn,ft]))}}(function BT(e,{cumulative:t,domain:n,thresholds:i,interval:r},s){return void 0===(e={...l1(e)}).domain&&(e.domain=n),void 0===e.cumulative&&(e.cumulative=t),void 0===e.thresholds&&(e.thresholds=i),void 0===e.interval&&(e.interval=r),void 0===e.value&&(e.value=s),e.thresholds=function Lpe(e,t,n=X$){if(void 0===e)return void 0===t?n:y0(t);if("string"==typeof e){switch(e.toLowerCase()){case"freedman-diaconis":return hie;case"scott":return Cz;case"sturges":return fie;case"auto":return X$}return yV(e)}return e}(e.thresholds,e.interval),e}(n,t,Fa),null,null,i,e,IT(t))}function G$(e){if(null==e)return;const{value:t,cumulative:n,domain:i=Pd,thresholds:r}=e,s=u=>{let g,h=xa(u,t);if(Ud(h)||function zpe(e){return function Bpe(e){return y1(e)&&"function"==typeof e&&e()instanceof Date}(e)||zh(e)&&Ud(e)}(r)){h=qs(h,wV,Float64Array);let[C,S]="function"==typeof i?i(h):i,O="function"!=typeof r||y1(r)?r:r(h,C,S);"number"==typeof O&&(O=y8(C,S,O)),y1(O)&&(i===Pd&&(C=O.floor(C),S=O.offset(O.floor(S))),O=O.range(C,O.offset(S))),g=O}else{h=sT(h);let[C,S]="function"==typeof i?i(h):i,O="function"!=typeof r||y1(r)?r:r(h,C,S);if("number"==typeof O)if(i===Pd){let F=UC(C,S,O);if(isFinite(F))if(F>0){let $=Math.round(C/F),G=Math.round(S/F);$*F<=C||--$,G*F>S||++G;let Y=G-$+1;O=new Float64Array(Y);for(let J=0;J<Y;++J)O[J]=($+J)*F}else if(F<0){F=-F;let $=Math.round(C*F),G=Math.round(S*F);$/F<=C||--$,G/F>S||++G;let Y=G-$+1;O=new Float64Array(Y);for(let J=0;J<Y;++J)O[J]=($+J)/F}else O=[C];else O=[C]}else O=wx(C,S,O);else y1(O)&&(i===Pd&&(C=O.floor(C),S=O.offset(O.floor(S))),O=O.range(C,O.offset(S)));g=O}const x=[];if(1===g.length)x.push([g[0],g[0]]);else for(let C=1;C<g.length;++C)x.push([g[C-1],g[C]]);return x.bin=(n<0?jpe:n>0?Vpe:KO)(x,g,h),x};return s.label=r_(t),s}function q$(e,t,n){return oO(e,t,n,W$)}function W$(e,t,n){return sO(e,t,n,Z$)}function Z$(e,t){return _T(e,t,Npe)}function Npe(e){switch(`${e}`.toLowerCase()){case"x":return $pe;case"x1":return Gpe;case"x2":return qpe;case"y":return Hpe;case"y1":return Wpe;case"y2":return Zpe}throw new Error(`invalid bin reduce: ${e}`)}function X$(e,t,n){return Math.min(200,Cz(e,t,n))}function y1(e){return"function"==typeof e?.range}function KO(e,t,n){return t=sT(t),i=>{const r=e.map(()=>[]);for(const s of i)r[FC(t,n[s])-1]?.push(s);return r}}function Vpe(e,t,n){const i=KO(e,t,n);return r=>{const s=i(r);for(let u=1,h=s.length;u<h;++u){const g=s[u-1],x=s[u];for(const C of g)x.push(C)}return s}}function jpe(e,t,n){const i=KO(e,t,n);return r=>{const s=i(r);for(let u=s.length-2;u>=0;--u){const h=s[u+1],g=s[u];for(const x of h)g.push(x)}return s}}function Y$(e,t){const n=(+e+ +t)/2;return e instanceof Date?new Date(n):n}const $pe={reduceIndex:(e,t,{x1:n,x2:i})=>Y$(n,i)},Hpe={reduceIndex:(e,t,{y1:n,y2:i})=>Y$(n,i)},Gpe={reduceIndex:(e,t,{x1:n})=>n},qpe={reduceIndex:(e,t,{x2:n})=>n},Wpe={reduceIndex:(e,t,{y1:n})=>n},Zpe={reduceIndex:(e,t,{y2:n})=>n};class Xpe extends Bg{constructor(t){super("munis",void 0,t);let n=[],i="TRUE";"high"===this.filters[RC]?(i="(socioeconomic_index >= 8 and socioeconomic_index <= 10)",n.push([">=",["get","socioeconomic_index"],8])):"mid"===this.filters[RC]?(i="(socioeconomic_index >= 4 and socioeconomic_index <= 7)",n.push(["all",[">=",["get","socioeconomic_index"],4],["<=",["get","socioeconomic_index"],7]])):"low"===this.filters[RC]&&(i="(socioeconomic_index >= 1 and socioeconomic_index <= 3)",n.push(["<=",["get","socioeconomic_index"],3]));let r="TRUE";"high"===this.filters.pd?(r="(population_density >= 5000)",n.push([">=",["get","population_density"],5e3])):"mid"===this.filters.pd?(r="(population_density >= 1000 and population_density < 5000)",n.push(["all",[">=",["get","population_density"],1e3],["<",["get","socioeconomic_index"],5e3]])):"low"===this.filters.pd&&(r="(population_density < 1000)",n.push(["<",["get","population_density"],1e3])),this.sql=[`SELECT muni_name, canopy_area_ratio*100 as ratio, canopy_per_capita::numeric as cpc FROM munis WHERE ${i} AND ${r} ORDER BY canopy_area_ratio DESC nulls last`];for(const u of["munis-label","munis-border","munis-fill"])this.layerConfig[u]=new Ad(["all",[">",["get","canopy_area_ratio"],0],...n],null,null);const s=this.filters[Wy]||Sh;this.legend=hm[s],this.layerConfig["munis-fill"].paint={"fill-color":Ug[s],"fill-opacity":.8},this.layerConfig["munis-border"].paint={"line-color":"#155b2e","line-opacity":.4},this.layerConfig.trees=new Ad(null,null,null),this.filterItems=Kne,this.popupLayers={"munis-fill":[{label:"\u05e9\u05dd \u05d4\u05e8\u05e9\u05d5\u05ea",content:u=>u.muni_name},{label:"\u05d0\u05d5\u05db\u05dc\u05d5\u05e1\u05d9\u05d4",content:u=>u.population.toLocaleString()},{label:"\u05db\u05d9\u05e1\u05d5\u05d9 \u05e6\u05d5\u05de\u05d7 \u05dc\u05e0\u05e4\u05e9",content:u=>u.canopy_per_capita.toFixed(1)+' \u05de"\u05e8'}]}}handleData(t){if(this.charts=[],t[0].length){console.log("MUNI DATA",t[0]),this.charts.push(new gx("\u05d4\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05e2\u05dd \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd \u05d4\u05d2\u05d1\u05d5\u05d4 \u05d1\u05d9\u05d5\u05ea\u05e8:",S0({height:250,width:340,y:{axis:null},x:{grid:!0,tickFormat:i=>i+"%",label:"\u05d0\u05d7\u05d5\u05d6 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd",labelAnchor:"center"},marks:[WO(t[0].slice(0,10),{y:"muni_name",x:"ratio",fill:"#204E37",sort:{y:"-x"}}),g1(t[0].slice(0,10),{x:"ratio",y:"muni_name",text:"muni_name",textAnchor:"start",dx:-3,fill:"#fff"}),PT([0])]}))),this.charts.push(new gx("\u05d4\u05ea\u05e4\u05dc\u05d2\u05d5\u05ea \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd \u05d1\u05d9\u05df \u05d4\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea:",S0({height:250,width:340,marginLeft:30,y:{grid:!0,label:"\u05de\u05e1\u05e4\u05e8 \u05e8\u05e9\u05d5\u05d9\u05d5\u05ea",tickPadding:15,labelAnchor:"center",labelOffset:30},x:{label:"\u05d0\u05d7\u05d5\u05d6 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd",tickFormat:i=>i+"%",labelAnchor:"center"},marks:[Ope(t[0],{...$$({y:"count"},{x:"ratio",interval:2.5}),fill:"#204E37"}),FO([0])]})));const n=t[0].filter(i=>i.cpc>0).sort((i,r)=>r.cpc-i.cpc).slice(0,10);this.charts.push(new gx("\u05d4\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05e2\u05dd \u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd \u05dc\u05e0\u05e4\u05e9 \u05d4\u05d2\u05d1\u05d5\u05d4 \u05d1\u05d9\u05d5\u05ea\u05e8:",S0({height:250,width:340,y:{axis:null},x:{grid:!0,label:"\u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd \u05dc\u05e0\u05e4\u05e9 \u05d1\u05de\u05f4\u05e8",labelAnchor:"center"},marks:[WO(n,{y:"muni_name",x:"cpc",fill:"#204E37",sort:{y:"-x"}}),g1(n,{x:"cpc",y:"muni_name",text:"muni_name",textAnchor:"start",dx:-3,fill:"#fff"}),PT([0])]})))}}}class Ype extends Bg{constructor(t,n){super("stat-area",t,n),this.sql=[`SELECT * FROM stat_areas WHERE code = '${this.id}'`,`SELECT "meta-source" as name, count(1) as count FROM trees_processed WHERE "stat_area_code" = '${this.id}' GROUP BY 1 order by 2 desc`,`SELECT count(1) as total_count FROM trees_compact WHERE "stat_area_code" = '${this.id}'`];for(const r of["stat-areas-label","stat-areas-border","stat-areas-fill"])this.layerConfig[r]=new Ad(["==",["get","code"],["literal",this.id]],null,null);let i=this.filters[Wy]||Sh;i===_x&&(i=Sh),this.legend=hm[i],this.layerConfig["stat-areas-fill"].paint={"fill-color":Ug[i],"fill-opacity":.8},this.layerConfig["stat-areas-border"].paint={"line-color":"#ff871f","line-opacity":.4},this.layerConfig.trees=new Ad(["==",["get","stat_area_code"],["literal",this.id]],null,null),this.filterItems=dz}handleData(t){console.log("STAT AREA DATA",this.sql,t),t[0].length&&t[0][0]&&(this.geo={zoom:14,center:t[0][0].center})}}class Kpe extends Bg{constructor(t){super("stat-areas",void 0,t),this.sql=["SELECT round(canopy_area_ratio*20) * 5 as ratio, count(1) as count FROM stat_areas WHERE canopy_area_ratio > 0 GROUP BY 1 ORDER BY 1 "];for(const i of["stat-areas-label","stat-areas-border","stat-areas-fill"])this.layerConfig[i]=new Ad([">",["get","canopy_area_ratio"],0],null,null);this.layerConfig["munis-label"]=new Ad(null,null,null);let n=this.filters[Wy]||Sh;n===_x&&(n=Sh),this.legend=hm[n],this.layerConfig["stat-areas-fill"].paint={"fill-color":Ug[n],"fill-opacity":.8},this.layerConfig["stat-areas-border"].paint={"line-color":"#155b2e","line-opacity":.4},this.layerConfig.trees=new Ad(null,null,null),this.filterItems=dz,this.popupLayers={"stat-areas-fill":[{label:"\u05de\u05d6\u05d4\u05d4 \u05d4\u05d0\u05d6\u05d5\u05e8",content:i=>i.code},{label:"\u05d9\u05d9\u05e9\u05d5\u05d1",content:i=>i.city_name||"\u05dc\u05d0 \u05d9\u05d3\u05d5\u05e2"},{label:"\u05d0\u05d7\u05d5\u05d6 \u05db\u05d9\u05e1\u05d5\u05d9 \u05e6\u05d5\u05de\u05d7",content:i=>(100*i.canopy_area_ratio).toFixed(1)+"%"}]}}handleData(t){this.charts=[],t[0].length&&(console.log("STAT-AREA DATA",t[0]),this.charts.push(new gx("\u05d4\u05ea\u05e4\u05dc\u05d2\u05d5\u05ea \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd \u05d1\u05d9\u05df \u05d4\u05d0\u05d6\u05d5\u05e8\u05d9\u05dd \u05d4\u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9\u05d9\u05dd:",S0({height:250,width:340,marginLeft:50,y:{grid:!0,label:"\u05de\u05e1\u05e4\u05e8 \u05d4\u05d0\u05d6\u05d5\u05e8\u05d9\u05dd",tickPadding:20,labelAnchor:"center",labelOffset:40},x:{label:"\u05d0\u05d7\u05d5\u05d6 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd",tickFormat:n=>n+"%",labelAnchor:"center"},marks:[Ape(t[0],{y:"count",x:"ratio",fill:"#204E37"}),FO([0])]}))))}}const v1="canopies",$d="ts",UT="all",QO="certain",JO="suspected",ek="unreported",b1={};b1[QO]=["==",["get","certainty"],!0],b1[JO]=["==",["get","certainty"],!1],b1[ek]=["==",["get","unreported"],!0];const K$="matched",J$="matched+likely",x1="bd",tk="0-10",nk="10-20",ik="20-30",rk="30-45",ok="45-60",w1="ca",E1="th",dk="5-12",hk="12-18",r7=["case",["get","certainty"],["to-color","#204E37"],["to-color","#64B883"]],o7=new OC("\u05de\u05e7\u05e8\u05d0 \u05d5\u05d5\u05d3\u05d0\u05d5\u05ea \u05d6\u05d9\u05d4\u05d5\u05d9",[new _a("#204E37","\u05e2\u05e5 \u05de\u05d6\u05d5\u05d4\u05d4"),new _a("#64B883","\u05d7\u05e9\u05d3 \u05dc\u05e2\u05e5")]),s7=[new zf($d,"\u05d4\u05e6\u05d2\u05ea \u05e2\u05e6\u05d9\u05dd:",[new Vi(UT,"\u05db\u05dc \u05d4\u05e2\u05e6\u05d9\u05dd"),new Vi(QO,"\u05e8\u05e7 \u05e2\u05e6\u05d9\u05dd \u05de\u05d6\u05d5\u05d4\u05d9\u05dd"),new Vi(JO,"\u05e8\u05e7 \u05e2\u05e6\u05d9\u05dd \u05d7\u05e9\u05d5\u05d3\u05d9\u05dd"),new Vi(ek,"\u05e8\u05e7 \u05e2\u05e6\u05d9\u05dd \u05de\u05d6\u05d5\u05d4\u05d9\u05dd \u05e9\u05dc\u05d0 \u05d3\u05d5\u05d5\u05d7\u05d5 \u05dc\u05e8\u05e9\u05d5\u05ea \u05d4\u05de\u05d9\u05dd")]),new zf(v1,"\u05d4\u05e6\u05d2\u05ea \u05d7\u05d5\u05e4\u05d5\u05ea:",[new Vi("1","\u05d4\u05e6\u05d2\u05ea \u05db\u05dc \u05d4\u05d7\u05d5\u05e4\u05d5\u05ea"),new Vi(K$,"\u05d4\u05e6\u05d2\u05ea \u05e8\u05e7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05e9\u05d4\u05d5\u05ea\u05d0\u05de\u05d5 \u05dc\u05e2\u05e5 \u05de\u05d6\u05d5\u05d4\u05d4"),new Vi("likely","\u05d4\u05e6\u05d2\u05ea \u05e8\u05e7 \u05d4\u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05d7\u05e9\u05d5\u05d3\u05d5\u05ea \u05db\u05e2\u05e5"),new Vi(J$,"\u05d4\u05e6\u05d2\u05ea \u05e8\u05e7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05e9\u05d4\u05d5\u05ea\u05d0\u05de\u05d5 \u05dc\u05e2\u05e5 \u05db\u05dc\u05e9\u05d4\u05d5"),new Vi("0","\u05d4\u05e1\u05ea\u05e8\u05ea \u05db\u05dc \u05d4\u05d7\u05d5\u05e4\u05d5\u05ea")]),new zf(x1,"\u05e7\u05d5\u05d8\u05e8 \u05d2\u05d6\u05e2:",[new Vi("all","\u05d4\u05db\u05dc"),new Vi(tk,'0-10 \u05e1"\u05de'),new Vi(nk,'10-20 \u05e1"\u05de'),new Vi(ik,'20-30 \u05e1"\u05de'),new Vi(rk,'30-45 \u05e1"\u05de'),new Vi(ok,'45-60 \u05e1"\u05de'),new Vi("60",'\u05de\u05e2\u05dc 60 \u05e1"\u05de')]),new zf(w1,"\u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05ea \u05d4\u05e2\u05e5:",[new Vi("all","\u05d4\u05db\u05dc"),new Vi("0-4",'\u05e2\u05d3 4 \u05de"\u05e8'),new Vi("4-8",'4-8 \u05de"\u05e8'),new Vi("8",'\u05de\u05e2\u05dc 8 \u05de"\u05e8')]),new zf(E1,"\u05d2\u05d5\u05d1\u05d4 \u05d4\u05e2\u05e5:",[new Vi("all","\u05d4\u05db\u05dc"),new Vi("0-5",'\u05e2\u05d3 5 \u05de"\u05e8'),new Vi(dk,'5-12 \u05de"\u05e8'),new Vi(hk,'12-18 \u05de"\u05e8'),new Vi("18",'\u05de\u05e2\u05dc 18 \u05de"\u05e8')]),new class qne extends oA{constructor(t,n){super(t,"check"),this.label=n}}("cadaster","\u05d4\u05e6\u05d2\u05ea \u05d2\u05d5\u05e9/\u05d7\u05dc\u05e7\u05d4")],a_={};a_[tk]=["all",[">",["to-number",["get","bark_diameter"]],0],["<=",["to-number",["get","bark_diameter"]],10]],a_[nk]=["all",[">",["to-number",["get","bark_diameter"]],10],["<=",["to-number",["get","bark_diameter"]],20]],a_[ik]=["all",[">",["to-number",["get","bark_diameter"]],20],["<=",["to-number",["get","bark_diameter"]],30]],a_[rk]=["all",[">",["to-number",["get","bark_diameter"]],30],["<=",["to-number",["get","bark_diameter"]],45]],a_[ok]=["all",[">",["to-number",["get","bark_diameter"]],45],["<=",["to-number",["get","bark_diameter"]],60]],a_[60]=[">",["to-number",["get","bark_diameter"]],60];const l_={};l_[tk]='"attributes-bark-diameter" > 0 AND "attributes-bark-diameter" <= 10',l_[nk]='"attributes-bark-diameter" > 10 AND "attributes-bark-diameter" <= 20',l_[ik]='"attributes-bark-diameter" > 20 AND "attributes-bark-diameter" <= 30',l_[rk]='"attributes-bark-diameter" > 30 AND "attributes-bark-diameter" <= 45',l_[ok]='"attributes-bark-diameter" > 45 AND "attributes-bark-diameter" <= 60',l_[60]='"attributes-bark-diameter" > 60';const VT={"0-4":["all",[">",["to-number",["get","canopy_area"]],0],["<=",["to-number",["get","canopy_area"]],4]],"4-8":["all",[">",["to-number",["get","canopy_area"]],4],["<=",["to-number",["get","canopy_area"]],8]],8:[">",["to-number",["get","canopy_area"]],8]},jT={"0-4":'"attributes-canopy-area" > 0 AND "attributes-canopy-area" <= 4',"4-8":'"attributes-canopy-area" > 4 AND "attributes-canopy-area" <= 8',8:'"attributes-canopy-area" > 8'},C1={"0-5":["all",[">",["to-number",["get","height"]],0],["<=",["to-number",["get","height"]],5]]};C1[dk]=["all",[">",["to-number",["get","height"]],5],["<=",["to-number",["get","height"]],12]],C1[hk]=["all",[">",["to-number",["get","height"]],12],["<=",["to-number",["get","height"]],18]],C1[18]=[">",["to-number",["get","height"]],18];const M1={"0-5":'"attributes-height" > 0 AND "attributes-height" <= 5'};M1[dk]='"attributes-height" > 5 AND "attributes-height" <= 12',M1[hk]='"attributes-height" > 12 AND "attributes-height" <= 18',M1[18]='"attributes-height" > 18';class eme extends Bg{constructor(t,n){super("tree",t,n),this.sql=[`SELECT * FROM trees_processed WHERE "meta-tree-id" = '${this.id}'`];for(const i of["trees","canopies"])this.layerConfig[i]=new Ad(null,null,null);this.layerConfig.trees.paint={"circle-color":r7,"circle-stroke-color":"#ff871f","circle-stroke-width":["case",["==",["get","tree-id"],["literal",this.id]],3,0]},this.filters[$d]&&this.filters[$d]!==UT&&(this.layerConfig.trees.filter=["any",b1[this.filters[$d]],["==",["get","tree-id"],["literal",this.id]]]),this.legend=o7,this.filterItems=s7}handleData(t){this.geo={zoom:20,center:[t[0][0]["location-x"],t[0][0]["location-y"]]}}}class tme extends Bg{constructor(t){super("trees",void 0,t);const n=["trees"];let i=null;"0"!==this.filters[v1]&&(n.push("canopies"),this.filters[v1]===K$?i=["==",["get","kind"],["literal","matched"]]:"likely"===this.filters[v1]?i=["==",["get","kind"],["literal","likely"]]:this.filters[v1]===J$&&(i=["!=",["get","kind"],["literal","unknown"]])),"0"!==this.filters.cadaster&&n.push("cadaster-label","cadaster-border"),"road"===this.focus?.kind&&n.push("roads-border");for(const S of n)this.layerConfig[S]=new Ad(null,null,null);i&&(this.layerConfig.canopies.filter=i),this.layerConfig.trees.paint={"circle-color":r7,"circle-stroke-width":["interpolate",["linear"],["zoom"],15,0,18,3],"circle-stroke-color":"#ffffff"};let r="TRUE";this.layerConfig.trees.filter=[],this.filters[$d]=this.filters[$d]||UT,this.filters[$d]!==UT&&(this.layerConfig.trees.filter.push(b1[this.filters[$d]]),this.filters[$d]===QO?r="certainty = TRUE":this.filters[$d]===JO?r="certainty = FALSE":this.filters[$d]===ek&&(r="unreported = TRUE"));let s="TRUE";this.filters.species=(this.filters.species||"").split(";").filter(S=>S.length>0),this.filters.species.length>0&&(s=this.filters.species.map(S=>`'${S}'`).join(","),s=`"attributes-species-clean-en" IN (${s})`,this.layerConfig.trees.filter.push(["in",["get","species_en"],["literal",this.filters.species]]));let u="TRUE";this.filters[x1]&&"all"!==this.filters[x1]&&(u=l_[this.filters[x1]],this.layerConfig.trees.filter.push(a_[this.filters[x1]]));let h="TRUE";this.filters[w1]&&"all"!==this.filters[w1]&&(h=jT[this.filters[w1]],this.layerConfig.trees.filter.push(VT[this.filters[w1]]));let g="TRUE";this.filters[E1]&&"all"!==this.filters[E1]&&(g=M1[this.filters[E1]],this.layerConfig.trees.filter.push(C1[this.filters[E1]]));const x=[u,h,g].join(" AND ");this.sql=[`SELECT count(1) AS count FROM trees_compact WHERE ${this.focusQuery} AND ${r} AND ${s} AND ${x}`,`SELECT jsonb_array_elements("joint-source-type") AS name, count(1) AS count FROM trees_compact WHERE ${this.focusQuery} AND ${r} AND ${s} AND ${x} GROUP BY 1 ORDER BY 2 DESC`,`SELECT "attributes-species-clean-he" AS species_he, "attributes-species-clean-en" AS species_en FROM trees_compact WHERE "attributes-species-clean-he" is not NULL AND ${this.focusQuery} AND ${r} GROUP BY 1, 2 ORDER BY 1`],this.legend=o7,this.filterItems=s7,this.downloadQuery=`SELECT __fields__ FROM trees_processed WHERE "meta-tree-id" in (\n            SELECT "meta-tree-id" FROM trees_compact WHERE ${this.focusQuery} AND ${r}) AND ${s} AND ${x} AND ${"TRUE"===this.focusQuery?"__geo__":"TRUE"} ORDER BY "meta-tree-id" LIMIT 5000`,this.layerConfig.trees.filter=this.layerConfig.trees.filter.length>1?["all",...this.layerConfig.trees.filter]:1===this.layerConfig.trees.filter.length?this.layerConfig.trees.filter[0]:null}handleData(t){this.charts=[];const n={"\u05d7\u05d9\u05e9\u05d4 \u05de\u05e8\u05d7\u05d5\u05e7/\u05de\u05de\u05e9\u05dc\u05ea\u05d9":'\u05e2\u05d9\u05d1\u05d5\u05d3 \u05d7\u05d5\u05e4\u05d5\u05ea \u05e2\u05e6\u05d9\u05dd/(\u05d7\u05d9\u05e9\u05d4 \u05de\u05e8\u05d7\u05d5\u05e7, \u05de\u05e4"\u05d9)',"\u05e1\u05e7\u05e8 \u05e8\u05d2\u05dc\u05d9/\u05de\u05de\u05e9\u05dc\u05ea\u05d9":"\u05e8\u05e9\u05d5\u05ea \u05d4\u05de\u05d9\u05dd/(\u05e0\u05ea\u05d5\u05e0\u05d9 \u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05de\u05e2\u05d5\u05d1\u05d3\u05d9\u05dd)"};if(t[1].length){const i=t[0][0].count,r=t[1];this.charts.push(new gx("\u05de\u05e1\u05e4\u05e8 \u05e2\u05e6\u05d9\u05dd \u05dc\u05e4\u05d9 \u05e1\u05d5\u05d2 \u05de\u05e7\u05d5\u05e8 \u05de\u05d9\u05d3\u05e2:",S0({height:250,width:340,marginRight:100,y:{axis:null},x:{grid:!0},marks:[WO(r,{y:"name",x:"count",fill:"#204E37",sort:{y:"-x"}}),g1(r,{x:"count",y:"name",tip:"x",title:s=>`${s.count.toLocaleString()} \u05e2\u05e6\u05d9\u05dd (${(s.count/i*100).toFixed(1)}%)`,text:s=>(n[s.name]||s.name).replace(/\//,"\n"),textAnchor:"end",dx:3,fill:"#204E37"}),PT([0])]})))}t[2].length&&(this.filterItems=[...this.filterItems.slice(0,2),new Wne("species","\u05e1\u05d9\u05e0\u05d5\u05df \u05dc\u05e4\u05d9 \u05de\u05d9\u05df \u05d4\u05e2\u05e5:","\u05d1\u05d7\u05d9\u05e8\u05ea \u05de\u05d9\u05e0\u05d9 \u05e2\u05e6\u05d9\u05dd...",t[2].map(i=>new Vi(i.species_en,i.species_he))),...this.filterItems.slice(2)])}}class a7{constructor(t,n,i){this.term=t,this.prefix=n,this.display=i}click(t){}render(){return`<span class="prefix">${this.prefix}</span>&nbsp;<span class='result'>${this.display.replace(this.term,"<em>"+this.term+"</em>")}</span>`}}class nme extends a7{constructor(t,n,i={}){super(t.term,t.prefix,t.display),this.params={},this.url=n,this.params=i}click(t){t.navigate(this.url,this.params)}}class $T extends nme{constructor(t,n,i={},r=["trees"]){super(t,r,{queryParams:Object.assign({focus:n.toQueryParam()},i),queryParamsHandling:"merge",replaceUrl:!0})}}class ime extends $T{constructor(t){super(t,new ez(t.code,t.display),{},["munis",t.code])}}class rme extends $T{constructor(t){super(t,new tz(t.code),{},["stat-areas",t.code])}}class ome extends $T{constructor(t){super(t,new nz(t.code),{cadaster:"1"})}}class HT{constructor(t,n,i,r,s){this.kind=t,this.table=n,this.field=i,this.code=r,this.prefix=s}}const sme=[new HT("muni","munis","muni_name","muni_code","\u05e8\u05e9\u05d5\u05ea \u05de\u05e7\u05d5\u05de\u05d9\u05ea:"),new HT("stat-area","stat_areas","code","code","\u05d0\u05d6\u05d5\u05e8 \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9:"),new HT("parcel","parcels","code","code","\u05d2\u05d5\u05e9/\u05d7\u05dc\u05e7\u05d4:"),new HT("roads","roads","road_id","road_id","\u05e8\u05d7\u05d5\u05d1:")];class GT{}class qT{}class Uh{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?"string"==typeof t?this.lazyInit=()=>{this.headers=new Map,t.split("\n").forEach(n=>{const i=n.indexOf(":");if(i>0){const r=n.slice(0,i),s=r.toLowerCase(),u=n.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(u):this.headers.set(s,[u])}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((n,i)=>{this.setHeaderEntries(i,n)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([n,i])=>{this.setHeaderEntries(n,i)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof Uh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new Uh;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Uh?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,n);const r=("a"===t.op?this.headers.get(n):void 0)||[];r.push(...i),this.headers.set(n,r);break;case"d":const s=t.value;if(s){let u=this.headers.get(n);if(!u)return;u=u.filter(h=>-1===s.indexOf(h)),0===u.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,u)}else this.headers.delete(n),this.normalizedNames.delete(n)}}setHeaderEntries(t,n){const i=(Array.isArray(n)?n:[n]).map(s=>s.toString()),r=t.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(t,r)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class ame{encodeKey(t){return l7(t)}encodeValue(t){return l7(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const cme=/%(\d[a-f0-9])/gi,ume={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function l7(e){return encodeURIComponent(e).replace(cme,(t,n)=>ume[n]??t)}function WT(e){return`${e}`}class Mm{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new ame,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function lme(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[u,h]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],g=n.get(u)||[];g.push(h),n.set(u,g)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const i=t.fromObject[n],r=Array.isArray(i)?i.map(WT):[WT(i)];this.map.set(n,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(s=>{n.push({param:i,value:s,op:"a"})}):n.push({param:i,value:r,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(i=>n+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new Mm({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(WT(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(WT(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class dme{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function c7(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function u7(e){return typeof Blob<"u"&&e instanceof Blob}function d7(e){return typeof FormData<"u"&&e instanceof FormData}class T1{constructor(t,n,i,r){let s;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function hme(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new Uh),this.context||(this.context=new dme),this.params){const u=this.params.toString();if(0===u.length)this.urlWithParams=n;else{const h=n.indexOf("?");this.urlWithParams=n+(-1===h?"?":h<n.length-1?"&":"")+u}}else this.params=new Mm,this.urlWithParams=n}serializeBody(){return null===this.body?null:c7(this.body)||u7(this.body)||d7(this.body)||function fme(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Mm?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||d7(this.body)?null:u7(this.body)?this.body.type||null:c7(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Mm?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const n=t.method||this.method,i=t.url||this.url,r=t.responseType||this.responseType,s=void 0!==t.body?t.body:this.body,u=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,h=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let g=t.headers||this.headers,x=t.params||this.params;const C=t.context??this.context;return void 0!==t.setHeaders&&(g=Object.keys(t.setHeaders).reduce((S,O)=>S.set(O,t.setHeaders[O]),g)),t.setParams&&(x=Object.keys(t.setParams).reduce((S,O)=>S.set(O,t.setParams[O]),x)),new T1(n,i,s,{params:x,headers:g,context:C,reportProgress:h,responseType:r,withCredentials:u})}}var Ms=(()=>((Ms=Ms||{})[Ms.Sent=0]="Sent",Ms[Ms.UploadProgress=1]="UploadProgress",Ms[Ms.ResponseHeader=2]="ResponseHeader",Ms[Ms.DownloadProgress=3]="DownloadProgress",Ms[Ms.Response=4]="Response",Ms[Ms.User=5]="User",Ms))();class pk{constructor(t,n=200,i="OK"){this.headers=t.headers||new Uh,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class mk extends pk{constructor(t={}){super(t),this.type=Ms.ResponseHeader}clone(t={}){return new mk({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class P0 extends pk{constructor(t={}){super(t),this.type=Ms.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new P0({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class h7 extends pk{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function gk(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let f7=(()=>{class e{constructor(n){this.handler=n}request(n,i,r={}){let s;if(n instanceof T1)s=n;else{let g,x;g=r.headers instanceof Uh?r.headers:new Uh(r.headers),r.params&&(x=r.params instanceof Mm?r.params:new Mm({fromObject:r.params})),s=new T1(n,i,void 0!==r.body?r.body:null,{headers:g,context:r.context,params:x,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const u=qt(s).pipe(zy(g=>this.handler.handle(g)));if(n instanceof T1||"events"===r.observe)return u;const h=u.pipe(hc(g=>g instanceof P0));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return h.pipe(pi(g=>{if(null!==g.body&&!(g.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return g.body}));case"blob":return h.pipe(pi(g=>{if(null!==g.body&&!(g.body instanceof Blob))throw new Error("Response is not a Blob.");return g.body}));case"text":return h.pipe(pi(g=>{if(null!==g.body&&"string"!=typeof g.body)throw new Error("Response is not a string.");return g.body}));default:return h.pipe(pi(g=>g.body))}case"response":return h;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(n,i={}){return this.request("DELETE",n,i)}get(n,i={}){return this.request("GET",n,i)}head(n,i={}){return this.request("HEAD",n,i)}jsonp(n,i){return this.request("JSONP",n,{params:(new Mm).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,i={}){return this.request("OPTIONS",n,i)}patch(n,i,r={}){return this.request("PATCH",n,gk(r,i))}post(n,i,r={}){return this.request("POST",n,gk(r,i))}put(n,i,r={}){return this.request("PUT",n,gk(r,i))}}return e.\u0275fac=function(n){return new(n||e)(et(GT))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();function g7(e,t){return t(e)}function mme(e,t){return(n,i)=>t.intercept(n,{handle:r=>e(r,i)})}const _me=new sn(""),D1=new sn(""),_7=new sn("");function yme(){let e=null;return(t,n)=>{null===e&&(e=(tn(_me,{optional:!0})??[]).reduceRight(mme,g7));const i=tn(vE),r=i.add();return e(t,n).pipe(ex(()=>i.remove(r)))}}let y7=(()=>{class e extends GT{constructor(n,i){super(),this.backend=n,this.injector=i,this.chain=null,this.pendingTasks=tn(vE)}handle(n){if(null===this.chain){const r=Array.from(new Set([...this.injector.get(D1),...this.injector.get(_7,[])]));this.chain=r.reduceRight((s,u)=>function gme(e,t,n){return(i,r)=>n.runInContext(()=>t(i,s=>e(s,r)))}(s,u,this.injector),g7)}const i=this.pendingTasks.add();return this.chain(n,r=>this.backend.handle(r)).pipe(ex(()=>this.pendingTasks.remove(i)))}}return e.\u0275fac=function(n){return new(n||e)(et(qT),et(xu))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();const wme=/^\)\]\}',?\n/;let b7=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new $e(-2800,!1);const i=this.xhrFactory;return(i.\u0275loadImpl?or(i.\u0275loadImpl()):qt(null)).pipe(qr(()=>new ii(s=>{const u=i.build();if(u.open(n.method,n.urlWithParams),n.withCredentials&&(u.withCredentials=!0),n.headers.forEach((G,Y)=>u.setRequestHeader(G,Y.join(","))),n.headers.has("Accept")||u.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const G=n.detectContentTypeHeader();null!==G&&u.setRequestHeader("Content-Type",G)}if(n.responseType){const G=n.responseType.toLowerCase();u.responseType="json"!==G?G:"text"}const h=n.serializeBody();let g=null;const x=()=>{if(null!==g)return g;const G=u.statusText||"OK",Y=new Uh(u.getAllResponseHeaders()),J=function Eme(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(u)||n.url;return g=new mk({headers:Y,status:u.status,statusText:G,url:J}),g},C=()=>{let{headers:G,status:Y,statusText:J,url:Q}=x(),he=null;204!==Y&&(he=typeof u.response>"u"?u.responseText:u.response),0===Y&&(Y=he?200:0);let ue=Y>=200&&Y<300;if("json"===n.responseType&&"string"==typeof he){const we=he;he=he.replace(wme,"");try{he=""!==he?JSON.parse(he):null}catch(Ie){he=we,ue&&(ue=!1,he={error:Ie,text:he})}}ue?(s.next(new P0({body:he,headers:G,status:Y,statusText:J,url:Q||void 0})),s.complete()):s.error(new h7({error:he,headers:G,status:Y,statusText:J,url:Q||void 0}))},S=G=>{const{url:Y}=x(),J=new h7({error:G,status:u.status||0,statusText:u.statusText||"Unknown Error",url:Y||void 0});s.error(J)};let O=!1;const F=G=>{O||(s.next(x()),O=!0);let Y={type:Ms.DownloadProgress,loaded:G.loaded};G.lengthComputable&&(Y.total=G.total),"text"===n.responseType&&u.responseText&&(Y.partialText=u.responseText),s.next(Y)},$=G=>{let Y={type:Ms.UploadProgress,loaded:G.loaded};G.lengthComputable&&(Y.total=G.total),s.next(Y)};return u.addEventListener("load",C),u.addEventListener("error",S),u.addEventListener("timeout",S),u.addEventListener("abort",S),n.reportProgress&&(u.addEventListener("progress",F),null!==h&&u.upload&&u.upload.addEventListener("progress",$)),u.send(h),s.next({type:Ms.Sent}),()=>{u.removeEventListener("error",S),u.removeEventListener("abort",S),u.removeEventListener("load",C),u.removeEventListener("timeout",S),n.reportProgress&&(u.removeEventListener("progress",F),null!==h&&u.upload&&u.upload.removeEventListener("progress",$)),u.readyState!==u.DONE&&u.abort()}})))}}return e.\u0275fac=function(n){return new(n||e)(et(D5))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();const _k=new sn("XSRF_ENABLED"),x7=new sn("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),w7=new sn("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class E7{}let Tme=(()=>{class e{constructor(n,i,r){this.doc=n,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=m5(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return e.\u0275fac=function(n){return new(n||e)(et(Ki),et(Ra),et(x7))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac}),e})();function Dme(e,t){const n=e.url.toLowerCase();if(!tn(_k)||"GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t(e);const i=tn(E7).getToken(),r=tn(w7);return null!=i&&!e.headers.has(r)&&(e=e.clone({headers:e.headers.set(r,i)})),t(e)}var wo=(()=>((wo=wo||{})[wo.Interceptors=0]="Interceptors",wo[wo.LegacyInterceptors=1]="LegacyInterceptors",wo[wo.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",wo[wo.NoXsrfProtection=3]="NoXsrfProtection",wo[wo.JsonpSupport=4]="JsonpSupport",wo[wo.RequestsMadeViaParent=5]="RequestsMadeViaParent",wo[wo.Fetch=6]="Fetch",wo))();function c_(e,t){return{\u0275kind:e,\u0275providers:t}}function Sme(...e){const t=[f7,b7,y7,{provide:GT,useExisting:y7},{provide:qT,useExisting:b7},{provide:D1,useValue:Dme,multi:!0},{provide:_k,useValue:!0},{provide:E7,useClass:Tme}];for(const n of e)t.push(...n.\u0275providers);return function Q_(e){return{\u0275providers:e}}(t)}const C7=new sn("LEGACY_INTERCEPTOR_FN");let Ame=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({providers:[Sme(c_(wo.LegacyInterceptors,[{provide:C7,useFactory:yme},{provide:D1,useExisting:C7,multi:!0}]))]}),e})(),XT=(()=>{class e{constructor(n){this.http=n,this.cache={}}b64EncodeUnicode(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(i,r)=>String.fromCharCode(parseInt(r,16))))}query(n,i=null){if(i||(i=n),this.cache[i])return or([this.cache[i]]);const s=`https://api.digital-forest.org.il/api/query?query=${encodeURIComponent(this.b64EncodeUnicode(n))}&num_rows=1000`;return this.http.get(s).pipe(lm(u=>(alert("\u05e9\u05d2\u05d9\u05d0\u05d4 \u05d1\u05e9\u05dc\u05d9\u05e4\u05ea \u05d4\u05de\u05d9\u05d3\u05e2"),or([{}]))),pi(u=>u.rows||[]),La(u=>{this.cache[i||n]=u}))}downloadUrl(n){return"https://api.digital-forest.org.il/api/download?format=xlsx&filename="+encodeURIComponent(n)}search(n){const i=[];for(const r of sme){let s=`(SELECT\n          '${r.kind}' AS kind,\n          '${r.prefix}' AS prefix,\n          '${n}' AS term,\n          ${r.code} AS code,\n          ${r.field} AS display\n        FROM ${r.table}\n        WHERE ${r.field} LIKE '${n}%%' LIMIT 10)`;s=s.split(/\s+/g).join(" "),i.push(s)}return this.query(i.join(" UNION ALL "),"search:"+n).pipe(pi(r=>{const s={},u=[];let h=0;r.forEach(C=>{s[C.kind]||(s[C.kind]=[]),s[C.kind].push(C),h+=1,-1===u.indexOf(C.kind)&&u.push(C.kind)});let g=u.length-1;for(;h>10;){const C=u[g];s[C]&&s[C].length>0&&s[C].pop(),h-=1,g=(g+u.length-1)%u.length}const x=[];return u.forEach(C=>{x.push(...s[C])}),x.map(C=>"muni"===C.kind?new ime(C):"parcel"===C.kind?new ome(C):"roads"===C.kind?new $T(C,new iz(C.code)):"stat-area"===C.kind?new rme(C):new a7("","","")).filter(C=>""!==C.term)}))}}return e.\u0275fac=function(n){return new(n||e)(et(f7))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),S1=(()=>{class e{constructor(n,i){this.api=n,this.router=i,this.state=new rA,this.loading=new rA,this.sidebarOpened=!0}initFromUrl(n,i){let r=n[0];const s=n[1]?decodeURIComponent(n[1]):void 0;let u=null;r||(r="about"),"trees"===r&&(u=s?new eme(s,i):new tme(i)),"stat-areas"===r&&(u=s?new Ype(s,i):new Kpe(i)),"munis"===r&&(u=s?new Jne(s,i):new Xpe(i)),"linkto"===r&&this.processLinkto(s||"",i),u=u||new Bg(r,s,i),this.init(u)}processLinkto(n,i){const r=n.split(":");r.length>0&&"tree"===r[0]&&3===r.length&&this.api.query(`SELECT "meta-tree-id" FROM trees_processed WHERE "muni_code" = '${r[1]}' AND "meta-internal-id" = '${r[2]}'`).subscribe(g=>{g.length>0&&this.router.navigate(["/trees",g[0]["meta-tree-id"]],{queryParams:i,replaceUrl:!0})})}init(n){this.loading.next(),console.log("LOADING STATE"),n.process(this.api).subscribe(()=>{console.log("PROCESSED STATE",n),this.state.next(n)})}}return e.\u0275fac=function(n){return new(n||e)(et(XT),et(ga))},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Fme(e,t){if(1&e&&(Rt(0,"h2",4),In(1),kt()),2&e){const n=Rn();Ut("matTooltip",n.legend.tooltip),xt(1),Ar(n.legend.title)}}function Nme(e,t){if(1&e&&(Rt(0,"h2"),In(1),kt()),2&e){const n=Rn();xt(1),Ar(n.legend.title)}}function zme(e,t){if(1&e&&(Rt(0,"div",5),Hi(1,"div",6),Rt(2,"div",7),In(3),kt()()),2&e){const n=t.$implicit;kl("separated",n.separated),xt(1),Cy("background-color",n.color),xt(1),kl("scaled",n.scaled),xt(1),Ar(n.label)}}let Bme=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-legend"]],inputs:{legend:"legend"},decls:4,vars:3,consts:[["class","tooltip",3,"matTooltip",4,"ngIf"],[4,"ngIf"],[1,"items"],["class","item",3,"separated",4,"ngFor","ngForOf"],[1,"tooltip",3,"matTooltip"],[1,"item"],[1,"color"],[1,"label"]],template:function(n,i){1&n&&(jn(0,Fme,2,2,"h2",0),jn(1,Nme,2,1,"h2",1),Rt(2,"div",2),jn(3,zme,4,7,"div",3),kt()),2&n&&(Ut("ngIf",i.legend.tooltip),xt(1),Ut("ngIf",!i.legend.tooltip),xt(2),Ut("ngForOf",i.legend.items))},dependencies:[Tg,dc,Wb],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]{background:#fff;box-shadow:0 4px 8px #0000004d;padding:12px;display:flex;flex-flow:column;align-items:flex-start;gap:20px;margin:20px;border-radius:5px}[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:13px;color:#383838;margin:0}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px;width:100%}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;gap:10px}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:14px;background:#204E37}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;color:#4f4f4f;font-size:16px;line-height:24px}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .label.scaled[_ngcontent-%COMP%]{transform:scale(6);transform-origin:8px 16px;color:#838383}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item.separated[_ngcontent-%COMP%]{border-top:1px dotted #838383;padding-top:7px}']}),e})();var O0;const Ume=["input"];function Vme(e,t){if(1&e){const n=Kp();Rt(0,"div",7),xs("click",function(){const s=Rs(n).$implicit;return Pa(Rn(3).handle(s))}),Hi(1,"div",8),kt()}if(2&e){const n=t.$implicit;xt(1),Ut("innerHTML",n.render(),fh)}}function jme(e,t){if(1&e&&(Rt(0,"div",5),jn(1,Vme,2,1,"div",6),kt()),2&e){const n=Rn(2);xt(1),Ut("ngForOf",n.results)}}function $me(e,t){if(1&e){const n=Kp();Af(0),Rt(1,"div",1)(2,"input",2,3),xs("keyup",function(r){return Rs(n),Pa(Rn().change(r))})("change",function(r){return Rs(n),Pa(Rn().change(r))}),kt()(),jn(4,jme,2,1,"div",4),Pf()}if(2&e){const n=Rn();xt(4),Ut("ngIf",n.results.length>0)}}const Hme=function(){return[]},Gme=function(){return{focus:null}};function qme(e,t){if(1&e&&(Af(0),Rt(1,"div",9),Hi(2,"div",8)(3,"a",10),kt(),Pf()),2&e){const n=Rn();xt(2),Ut("innerHTML",n.focus.display(),fh),xt(1),Ut("routerLink",Tu(3,Hme))("queryParams",Tu(4,Gme))}}let yk=((O0=class{constructor(t,n,i){this.api=t,this.router=n,this.state=i,this.terms=new Yn,this.results=[],this.focus=null,this.terms.pipe(zg(this),Vn(),Q2(700),qr(r=>(this.results=[],this.api.search(r)))).subscribe(r=>{this.results=r}),this.state.state.pipe(zg(this),Vn((r,s)=>r.filters?.focus===s.filters?.focus),pi(r=>r.focus)).subscribe(r=>{this.focus=r})}change(t){const i=t.target.value;Hb(0).subscribe(()=>{this.terms.next(i)})}handle(t){Hb(0).subscribe(()=>{this.results=[],this.input.nativeElement.value="",t.click(this.router)})}}).\u0275fac=function(t){return new(t||O0)(Nt(XT),Nt(ga),Nt(S1))},O0.\u0275cmp=Ni({type:O0,selectors:[["app-search"]],viewQuery:function(t,n){if(1&t&&Eg(Ume,5),2&t){let i;Jp(i=em())&&(n.input=i.first)}},decls:2,vars:2,consts:[[4,"ngIf"],[1,"input-container"],["type","text","placeholder","\u05d7\u05d9\u05e4\u05d5\u05e9 \u05e2\u05d9\u05e8, \u05e8\u05d7\u05d5\u05d1, \u05d0\u05d6\u05d5\u05e8 \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9, \u05d7\u05dc\u05e7\u05d4...",3,"keyup","change"],["input",""],["class","search-results",4,"ngIf"],[1,"search-results"],["class","result",3,"click",4,"ngFor","ngForOf"],[1,"result",3,"click"],[1,"text",3,"innerHTML"],[1,"focused"],["queryParamsHandling","merge",1,"close",3,"routerLink","queryParams"]],template:function(t,n){1&t&&(jn(0,$me,5,1,"ng-container",0),jn(1,qme,4,5,"ng-container",0)),2&t&&(Ut("ngIf",!n.focus),xt(1),Ut("ngIf",!!n.focus))},dependencies:[Tg,dc,dm],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]{display:flex;flex-flow:column;align-items:flex-start;margin:20px;pointer-events:all;gap:4px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{width:340px;border-radius:5px;background-color:#fff;background-repeat:no-repeat;background-position:center;background-size:contain;background-image:url(icon-search.e2939cf8d882a0cd.svg);background-size:24px;background-position:12px center;box-shadow:0 4px 8px #0000004d}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border-radius:5px;border:1px solid #383838;background:transparent;font-style:Normal;font-weight:400;font-size:16px;line-height:24px;color:#383838}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#838383;opacity:1}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-width:2px;padding:7px 11px}[_nghost-%COMP%]   .search-results[_ngcontent-%COMP%]{width:340px;border-radius:5px;background-color:#fff;box-shadow:0 4px 8px #0000004d;display:flex;flex-flow:column}[_nghost-%COMP%]   .search-results[_ngcontent-%COMP%]   .result[_ngcontent-%COMP%]{width:100%;padding:8px 12px;font-style:Normal;font-weight:400;font-size:16px;line-height:24px;color:#383838;cursor:pointer}[_nghost-%COMP%]   .search-results[_ngcontent-%COMP%]   .result[_ngcontent-%COMP%]:hover{background-color:#e1ffcd}[_nghost-%COMP%]   .search-results[_ngcontent-%COMP%]   .result[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{color:#838383}[_nghost-%COMP%]   .search-results[_ngcontent-%COMP%]   .result[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]     em{font-style:Normal;font-weight:600}[_nghost-%COMP%]   .focused[_ngcontent-%COMP%]{min-width:200px;padding:8px 12px;border-radius:5px;border:1px solid #8BA698;background-color:#d1eada;box-shadow:0 4px 8px #0000004d;display:flex;gap:32px;flex-flow:row;align-items:center}[_nghost-%COMP%]   .focused[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;font-size:16px;line-height:24px;color:#383838}[_nghost-%COMP%]   .focused[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]     strong{font-style:Normal;font-weight:600}[_nghost-%COMP%]   .focused[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]     .kind{color:#838383}[_nghost-%COMP%]   .focused[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{width:24px;height:24px;background-repeat:no-repeat;background-position:center;background-size:contain;background-image:url(icon-close.79ffc3486a190a1c.svg);background-size:24px;cursor:pointer}']}),O0);var k0;function Wme(e,t){if(1&e&&(Rt(0,"div",7),Hi(1,"a",8),kt()),2&e){const n=Rn();xt(1),Ut("routerLink",n.back)}}function Zme(e,t){1&e&&bg(0,0,["*ngIf","init"])}function Xme(e,t){1&e&&(Af(0),Hi(1,"div",9)(2,"div",10)(3,"div",10),Pf())}function Yme(e,t){if(1&e){const n=Kp();Rt(0,"div",11),xs("click",function(){Rs(n);const r=Rn();return Pa(r.stateSvc.sidebarOpened=!r.stateSvc.sidebarOpened)}),kt()}2&e&&kl("opened",Rn().stateSvc.sidebarOpened)}function Kme(e,t){if(1&e&&(Af(0),Hi(1,"app-legend",12),Pf()),2&e){const n=Rn();xt(1),Ut("legend",n.state_.legend)}}yk=Ua([mx()],yk);let Tm=((k0=class{constructor(t,n){this.stateSvc=t,this.router=n,this.init=!1,this.mode="empty",this.back=null,this.state=new ma,this.stateSvc.state.pipe(zg(this),hc(i=>i.mode===this.mode),function $ne(e,t=HE){const n=Hb(e,t);return J4(()=>n)}(0)).subscribe(i=>{this.state_=i,this.state.emit(i)}),this.stateSvc.loading.pipe(zg(this)).subscribe(()=>{this.state.emit(null)})}goBack(){this.back&&this.router.navigate(this.back,{queryParamsHandling:"merge"})}}).\u0275fac=function(t){return new(t||k0)(Nt(S1),Nt(ga))},k0.\u0275cmp=Ni({type:k0,selectors:[["app-content"]],hostVars:2,hostBindings:function(t,n){2&t&&kl("opened",n.stateSvc.sidebarOpened||!!n.back)},inputs:{init:"init",mode:"mode",back:"back"},outputs:{state:"state"},ngContentSelectors:["*"],decls:10,vars:7,consts:[[1,"sidebar"],["class","close",4,"ngIf"],[4,"ngIf"],[1,"window",3,"click"],["class","handle",3,"opened","click",4,"ngIf"],[1,"widgets"],[1,"column"],[1,"close"],["queryParamsHandling","merge",3,"routerLink"],[1,"loading","small"],[1,"loading","large"],[1,"handle",3,"click"],[3,"legend"]],template:function(t,n){1&t&&(Eb(),Rt(0,"div",0),jn(1,Wme,2,1,"div",1),jn(2,Zme,1,0,"ng-content",2),jn(3,Xme,4,0,"ng-container",2),kt(),Rt(4,"div",3),xs("click",function(){return n.goBack()}),jn(5,Yme,1,2,"div",4),Rt(6,"div",5)(7,"div",6),Hi(8,"app-search"),jn(9,Kme,2,1,"ng-container",2),kt()()()),2&t&&(xt(1),Ut("ngIf",!!n.back),xt(1),Ut("ngIf",n.init),xt(1),Ut("ngIf",!n.init),xt(1),kl("interactive",!!n.back),xt(1),Ut("ngIf",!n.back),xt(4),Ut("ngIf",n.state_&&n.state_.legend))},dependencies:[dc,dm,Bme,yk],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]{display:flex;flex-flow:row;align-items:stretch;height:100%}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]{flex:0 1 400px;box-shadow:-4px 4px 8px #0000004d;background-color:#fff;padding:30px;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll;height:100%;pointer-events:all;position:relative;margin-right:-400px;transition:margin-right .2s ease-in-out}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:5px;border:1px solid transparent;position:absolute;top:20px;left:20px}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:hover{border:1px solid #64B883}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:inline-block;width:100%;height:100%;background-repeat:no-repeat;background-size:contain;background-size:24px;background-position:center;background-image:url(icon-close.79ffc3486a190a1c.svg)}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited, [_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:none}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]{height:100%;flex:1 1 auto;display:flex;flex-flow:row;align-items:stretch;position:relative}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:20px;background-repeat:no-repeat;background-position:center;background-size:contain;background-size:40px;background-image:url(circle-chevron.8c1cc80016c1d65f.svg);cursor:pointer;pointer-events:all;position:absolute;top:calc(50% - 20px);right:-16px;box-shadow:-4px 0 8px #0000004d;transition:transform .2s ease-in-out}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]   .handle.opened[_ngcontent-%COMP%]{transform:rotate(180deg);box-shadow:4px 0 8px #0000004d}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:space-between;flex:1 1 100%}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .column[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:flex-start;justify-content:space-between;height:100%}[_nghost-%COMP%]   .window.interactive[_ngcontent-%COMP%]{pointer-events:all}.opened[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]{margin-right:0}']}),k0);Tm=Ua([mx()],Tm);const Jme=["chart"];function ege(e,t){if(1&e&&(Rt(0,"h1"),In(1),kt()),2&e){const n=Rn(2);xt(1),Ar(n.name)}}function tge(e,t){if(1&e&&(Rt(0,"div",5)(1,"h2"),In(2),kt(),Hi(3,"div",6,7),kt()),2&e){const n=t.$implicit;xt(2),Ar(n.title)}}function nge(e,t){if(1&e&&(Rt(0,"div",1),jn(1,ege,2,1,"h1",2),bg(2),Rt(3,"div",3),jn(4,tge,5,1,"div",4),kt()()),2&e){const n=Rn();xt(1),Ut("ngIf",n.name),xt(3),Ut("ngForOf",n.state.charts)}}const ige=["*"];let vk=(()=>{class e{constructor(){this.state=null,this.name=""}ngOnChanges(){Hb(0).subscribe(()=>{this.charts.forEach((n,i)=>{console.log("CHART",n,n.nativeElement,this.state?.charts[i].chart),this.state?.charts[i].chart&&n.nativeElement.appendChild(this.state?.charts[i].chart)})})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-summary"]],viewQuery:function(n,i){if(1&n&&Eg(Jme,5),2&n){let r;Jp(r=em())&&(i.charts=r)}},inputs:{state:"state",name:"name"},features:[se],ngContentSelectors:ige,decls:1,vars:1,consts:[["class","content",4,"ngIf"],[1,"content"],[4,"ngIf"],[1,"charts"],["class","chart",4,"ngFor","ngForOf"],[1,"chart"],[1,"chart-container"],["chart",""]],template:function(n,i){1&n&&(Eb(),jn(0,nge,5,2,"div",0)),2&n&&Ut("ngIf",i.state)},dependencies:[Tg,dc],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:12px}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:40px;align-items:center;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:20px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}.charts[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}.charts[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:16px}.charts[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:18px;line-height:22px;color:#383838}']}),e})();function rge(e,t){if(1&e&&(Rt(0,"app-summary",2)(1,"div",3)(2,"div",4),Hi(3,"div",5),Rt(4,"div",6),Hi(5,"h2",7),Rt(6,"div",8)(7,"span",9),In(8),kt(),Hi(9,"span",10),kt()()()()()),2&e){const n=Rn();Ut("state",n.state),xt(3),Cy("background-image","url(assets/img/icon-tree-count.svg)"),xt(2),Ut("innerHTML","\u05e1\u05d4\u05f4\u05db \u05e2\u05e6\u05d9\u05dd \u05d1\u05de\u05d0\u05d2\u05e8"+(n.state.focus?" \u05e2\u05d1\u05d5\u05e8 "+n.state.focus.display():""),fh),xt(3),Ar(n.state.data[0][0].count.toLocaleString())}}let oge=(()=>{class e{constructor(){this.state=null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-trees"]],decls:2,vars:2,consts:[["mode","trees",3,"init","state"],[3,"state",4,"ngIf"],[3,"state"],[1,"icon-infos"],[1,"icon-info","big"],[1,"icon"],[1,"text"],[3,"innerHTML"],[1,"value"],[1,"number"],[1,"units"]],template:function(n,i){1&n&&(Rt(0,"app-content",0),xs("state",function(s){return i.state=s}),jn(1,rge,10,5,"app-summary",1),kt()),2&n&&(Ut("init",!!i.state),xt(1),Ut("ngIf",i.state))},dependencies:[dc,Tm,vk],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:12px}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:40px;align-items:center;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:20px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}']}),e})();const sge=[{description:"\u05e9\u05dd \u05d4\u05d9\u05d9\u05e9\u05d5\u05d1 \u05d1\u05d5 \u05de\u05e6\u05d5\u05d9 \u05d4\u05e2\u05e5",name:"location-city",title:"\u05e9\u05dd \u05d9\u05d9\u05e9\u05d5\u05d1",type:"string"},{description:"\u05de\u05d6\u05d4\u05d4 \u05e4\u05e0\u05d9\u05de\u05d9 \u05e9\u05dc \u05d4\u05e2\u05e5 \u05d1\u05e8\u05e9\u05d5\u05ea \u05d4\u05de\u05e7\u05d5\u05de\u05d9\u05ea",name:"meta-internal-id",title:"\u05de\u05d6\u05d4\u05d4 \u05e4\u05e0\u05d9\u05de\u05d9",type:"string"},{description:"\u05e9\u05dd \u05d4\u05e8\u05d7\u05d5\u05d1 \u05d4\u05e7\u05e8\u05d5\u05d1 \u05d1\u05d9\u05d5\u05ea\u05e8 \u05dc\u05e2\u05e5",name:"location-street",title:"\u05e9\u05dd \u05e8\u05d7\u05d5\u05d1",type:"string"},{description:"\u05de\u05e1\u05e4\u05e8 \u05d4\u05d1\u05d9\u05ea \u05d4\u05e7\u05e8\u05d5\u05d1 \u05d1\u05d9\u05d5\u05ea\u05e8 \u05dc\u05e2\u05e5",name:"location-street-number",title:"\u05de\u05e1\u05e4\u05e8 \u05d1\u05d9\u05ea",type:"string"},{description:"\u05de\u05d9\u05d3\u05e2 \u05e0\u05d5\u05e1\u05e3 \u05d4\u05e0\u05d5\u05d2\u05e2 \u05dc\u05de\u05d9\u05e7\u05d5\u05dd \u05d4\u05e2\u05e5",name:"location-address",title:"\u05e4\u05e8\u05d8\u05d9 \u05db\u05ea\u05d5\u05d1\u05ea",type:"string"},{description:"\u05de\u05d6\u05d4\u05d4 \u05d4\u05d2\u05d5\u05e9 \u05d1\u05d5 \u05de\u05e6\u05d5\u05d9 \u05d4\u05e2\u05e5",name:"location-block",title:"\u05d2\u05d5\u05e9",type:"string"},{description:"\u05de\u05d6\u05d4\u05d4 \u05d4\u05d7\u05dc\u05e7\u05d4 \u05d1\u05d4 \u05de\u05e6\u05d5\u05d9 \u05d4\u05e2\u05e5",name:"location-plot",title:"\u05d7\u05dc\u05e7\u05d4",type:"string"},{description:"\u05d2\u05d5\u05d1\u05d4 \u05d4\u05e7\u05e8\u05e7\u05e2 \u05de\u05e2\u05dc \u05e4\u05e0\u05d9 \u05d4\u05d9\u05dd, \u05d1\u05de\u05d8\u05e8\u05d9\u05dd",name:"location-elevation",title:"\u05d2\u05d5\u05d1\u05d4 \u05de\u05e2\u05dc \u05e4\u05e0\u05d9 \u05d4\u05d9\u05dd",type:"number",unit:"\u05de\u05f3"},{description:"\u05ea\u05d9\u05d0\u05d5\u05e8 \u05d4\u05de\u05e8\u05d7\u05d1 \u05d4\u05de\u05d9\u05d9\u05d3\u05d9 \u05e9\u05dc \u05d4\u05e2\u05e5\n\u05e2\u05e8\u05db\u05d9\u05dd \u05de\u05d5\u05ea\u05e8\u05d9\u05dd: \u05e8\u05d7\u05d5\u05d1, \u05d2\u05d9\u05e0\u05d4/\u05e4\u05d0\u05e8\u05e7 \u05e6\u05d9\u05d1\u05d5\u05e8\u05d9, \u05d7\u05d5\u05e8\u05e9\u05d4, \u05de\u05d5\u05e1\u05d3 \u05e6\u05d9\u05d1\u05d5\u05e8\u05d9, \u05de\u05d2\u05e8\u05e9 \u05e4\u05e8\u05d8\u05d9",name:"environment-type",title:"\u05de\u05e8\u05d7\u05d1 \u05d4\u05e2\u05e5",type:"string"},{description:"\u05e4\u05e8\u05d8\u05d9\u05dd \u05e0\u05d5\u05e1\u05e4\u05d9\u05dd \u05dc\u05d2\u05d1\u05d9 \u05d4\u05de\u05e8\u05d7\u05d1\n\u05e2\u05e8\u05db\u05d9\u05dd \u05de\u05d5\u05ea\u05e8\u05d9\u05dd: \u05d7\u05e6\u05e8 \u05e4\u05e8\u05d8\u05d9\u05ea \u2013 \u05d1\u05dc\u05d1 \u05d4\u05e9\u05d8\u05d7 (4 \u05de' \u05de\u05e9\u05d8\u05d7 \u05e6\u05d9\u05d1\u05d5\u05e8\u05d9)\n\u05d7\u05e6\u05e8 \u05e4\u05e8\u05d8\u05d9\u05ea \u2013 \u05e6\u05de\u05d5\u05d3 \u05d3\u05d5\u05e4\u05df \u05dc\u05e9\u05d8\u05d7 \u05e6\u05d9\u05d1\u05d5\u05e8\u05d9 (\u05e2\u05d3 4 \u05de' \u05de\u05e9\u05d8\u05d7 \u05e6\u05d9\u05d1\u05d5\u05e8\u05d9)\n\u05de\u05d3\u05e8\u05db\u05d4\n\u05d0\u05d9 \u05ea\u05e0\u05d5\u05e2\u05d4\n\u05de\u05ea\u05d7\u05ea \u05dc\u05e7\u05d5 \u05de\u05ea\u05d7 \n\u05e2\u05e5 \u05d1\u05d5\u05d3\u05d3 \u05d1\u05e9\u05d8\u05d7 \u05e4\u05ea\u05d5\u05d7 (\u05de\u05d7\u05d5\u05e5 \u05dc\u05d9\u05e9\u05d5\u05d1)\n\u05e2\u05e5 \u05d1\u05d0\u05d6\u05d5\u05e8 \u05de\u05d3\u05d1\u05e8\u05d9/\u05d9\u05d1\u05e9 \u05d1\u05e9\u05d8\u05d7 \u05e4\u05ea\u05d5\u05d7 (\u05de\u05d7\u05d5\u05e5 \u05dc\u05d9\u05e9\u05d5\u05d1)",name:"environment-description",title:"\u05de\u05e8\u05d7\u05d1 \u05de\u05e4\u05d5\u05e8\u05d8",type:"string"},{description:"\u05d1\u05d9\u05ea \u05d4\u05d2\u05d9\u05d3\u05d5\u05dc \u05e9\u05dc \u05d4\u05e2\u05e5\n\u05e2\u05e8\u05db\u05d9\u05dd \u05de\u05d5\u05ea\u05e8\u05d9\u05dd: \u05e2\u05e8\u05d5\u05d2\u05d4 \u05e4\u05ea\u05d5\u05d7\u05d4\n\u05d2\u05d5\u05de\u05ea \u05e9\u05ea\u05d9\u05dc\u05d4 \u05d1\u05e8\u05d7\u05d5\u05d1\n\u05d1\u05d9\u05ea \u05d2\u05d9\u05d3\u05d5\u05dc \u05de\u05d5\u05d2\u05d1\u05dc (\u05d0\u05e1\u05e4\u05dc\u05d8 \u05d0\u05d5 \u05d7\u05dc\u05d5\u05e7\u05d9 \u05e0\u05d7\u05dc \u05d5\u05db\u05d5')\n\u05de\u05d3\u05e9\u05d0\u05d4\n\u05ea\u05e2\u05dc\u05ea \u05d2\u05d9\u05d3\u05d5\u05dc\n\u05de\u05e6\u05e2 \u05de\u05e0\u05d5\u05ea\u05e7 (\u05de\u05d9\u05db\u05dc)",name:"environment-habitat",title:"\u05d1\u05d9\u05ea \u05d4\u05d2\u05d9\u05d3\u05d5\u05dc",type:"string"},{description:"\u05e0\u05e4\u05d7 \u05d1\u05d9\u05ea \u05d4\u05d2\u05d9\u05d3\u05d5\u05dc \u05e9\u05dc \u05d4\u05e2\u05e5 \u05d1\u05de\u05f4\u05e7",name:"environment-habitat-volume",title:"\u05e0\u05e4\u05d7 \u05d1\u05d9\u05ea \u05d4\u05d2\u05d9\u05d3\u05d5\u05dc",type:"number",unit:"\u05de\u05f4\u05e7"},{description:"\u05d4\u05d0\u05dd \u05d4\u05e2\u05e5 \u05de\u05d5\u05e9\u05e7\u05d4",name:"environment-irrigated",title:"\u05d4\u05e9\u05e7\u05d9\u05d4 \u05e4\u05e2\u05d9\u05dc\u05d4",type:"boolean"},{description:"\u05d8\u05d9\u05d1 \u05d4\u05de\u05d9\u05dd \u05d4\u05de\u05e9\u05e7\u05d9\u05dd \u05d0\u05ea \u05d4\u05e2\u05e5\n\u05e2\u05e8\u05db\u05d9\u05dd \u05de\u05d5\u05ea\u05e8\u05d9\u05dd: TBD",name:"environment-irrigation-water-quality",title:"\u05d0\u05d9\u05db\u05d5\u05ea \u05de\u05d9 \u05d4\u05d4\u05e9\u05e7\u05d9\u05d9\u05d4",type:"string"},{description:"\u05d4\u05d0\u05d5\u05e4\u05df \u05d1\u05d5 \u05d4\u05e2\u05e5 \u05de\u05d5\u05e9\u05e7\u05d4\n\u05e2\u05e8\u05db\u05d9\u05dd \u05de\u05d5\u05ea\u05e8\u05d9\u05dd: \u05e7\u05d5 \u05d9\u05d9\u05d7\u05d5\u05d3\u05d9 \u05dc\u05e2\u05e5 \n\u05de\u05d5\u05e9\u05e7\u05d4 \u05de\u05d4\u05d3\u05e9\u05d0 \n\u05de\u05d5\u05e9\u05e7\u05d4 \u05de\u05e2\u05e8\u05d5\u05d2\u05d4 \u05e1\u05de\u05d5\u05db\u05d4",name:"environment-irrigation-type",title:"\u05e1\u05d5\u05d2 \u05d4\u05d4\u05e9\u05e7\u05d9\u05d4",type:"string"},{description:"\u05d4\u05d0\u05dd \u05d1\u05e1\u05d1\u05d9\u05d1\u05ea \u05d4\u05e2\u05e5 \u05e7\u05d9\u05d9\u05dd \u05d0\u05d9\u05d6\u05d5\u05e8 \u05d9\u05e9\u05d9\u05d1\u05d4",name:"environment-sitting-area",title:"\u05d0\u05d9\u05d6\u05d5\u05e8 \u05d9\u05e9\u05d9\u05d1\u05d4",type:"boolean"},{description:"\u05d4\u05d0\u05dd \u05d1\u05e1\u05d1\u05d9\u05d1\u05ea \u05d4\u05e2\u05e5 \u05d9\u05e9\u05e0\u05d4 \u05ea\u05d0\u05d5\u05e8\u05d4",name:"environment-lighting",title:"\u05ea\u05d0\u05d5\u05e8\u05d4",type:"boolean"},{description:"\u05d4\u05d0\u05dd \u05d1\u05e1\u05d1\u05d9\u05d1\u05ea \u05d4\u05e2\u05e5 \u05e7\u05d9\u05d9\u05dd \u05e9\u05d9\u05dc\u05d5\u05d8",name:"environment-signage",title:"\u05e9\u05d9\u05dc\u05d5\u05d8",type:"boolean"},{description:"\u05d4\u05d0\u05dd \u05d1\u05e1\u05d1\u05d9\u05d1\u05ea \u05d4\u05e2\u05e5 \u05e7\u05d9\u05d9\u05de\u05ea \u05de\u05d3\u05e9\u05d0\u05d4",name:"environment-grass",title:"\u05de\u05d3\u05e9\u05d0\u05d4",type:"boolean"},{description:"\u05d4\u05d0\u05dd \u05d1\u05e1\u05d1\u05d9\u05d1\u05ea \u05d4\u05e2\u05e5 \u05e7\u05d9\u05d9\u05dd \u05e8\u05d9\u05e6\u05d5\u05e3",name:"environment-pavement",title:"\u05e8\u05d9\u05e6\u05d5\u05e3",type:"boolean"},{description:"\u05d4\u05e9\u05e0\u05d4 \u05d1\u05d4 \u05e0\u05d9\u05d8\u05e2 \u05d4\u05e2\u05e5 (\u05d0\u05d5 \u05ea\u05d0\u05e8\u05d9\u05da \u05de\u05d3\u05d5\u05d9\u05e7)",name:"attributes-year-planted",title:"\u05de\u05d5\u05e2\u05d3 \u05e0\u05d8\u05d9\u05e2\u05d4",type:"date"},{description:"\u05d2\u05d9\u05dc \u05d4\u05e2\u05e5",name:"attributes-age",title:"\u05d2\u05d9\u05dc",type:"number",unit:"\u05e9\u05e0\u05d9\u05dd"},{description:"\u05d4\u05d0\u05dd \u05d4\u05d2\u05d9\u05dc \u05de\u05e9\u05d5\u05e2\u05e8 \u05d0\u05d5 \u05de\u05d3\u05d5\u05d9\u05e7",name:"attributes-age-estimated",title:"\u05d2\u05d9\u05dc \u05de\u05e9\u05d5\u05e2\u05e8?",type:"boolean"},{description:"\u05e1\u05d5\u05d2 \u05d4\u05e2\u05e5\n\u05e2\u05e8\u05db\u05d9\u05dd \u05de\u05d5\u05ea\u05e8\u05d9\u05dd: TBD",name:"attributes-genus",title:"\u05e1\u05d5\u05d2 \u05d4\u05e2\u05e5",type:"string"},{description:"\u05de\u05d9\u05df \u05d4\u05e2\u05e5\n\u05e2\u05e8\u05db\u05d9\u05dd \u05de\u05d5\u05ea\u05e8\u05d9\u05dd: TBD",name:"attributes-species",title:"\u05de\u05d9\u05df \u05d4\u05e2\u05e5",type:"string"},{description:"\u05de\u05e1\u05e4\u05e8 \u05d4\u05d2\u05d6\u05e2\u05d9\u05dd",name:"attributes-num-barks",title:"\u05de\u05e1\u05e4\u05e8 \u05d2\u05d6\u05e2\u05d9\u05dd",type:"integer"},{description:"\u05e7\u05d5\u05d8\u05e8 \u05d4\u05d2\u05d6\u05e2, \u05d1\u05e1\u05f4\u05de",name:"attributes-bark-diameter",title:"\u05e7\u05d5\u05d8\u05e8 \u05d4\u05d2\u05d6\u05e2",type:"number",unit:"\u05e1\u05f4\u05de"},{description:"\u05d4\u05d9\u05e7\u05e3 \u05d4\u05d2\u05d6\u05e2, \u05d1\u05e1\u05f4\u05de",name:"attributes-bark-circumference",title:"\u05d4\u05d9\u05e7\u05e3 \u05d4\u05d2\u05d6\u05e2",type:"number",unit:"\u05e1\u05f4\u05de"},{description:"\u05d2\u05d5\u05d1\u05d4 \u05d4\u05e2\u05e5, \u05d1\u05de\u05d8\u05e8\u05d9\u05dd",name:"attributes-height",title:"\u05d2\u05d5\u05d1\u05d4 \u05d4\u05e2\u05e5",type:"number",unit:"\u05de\u05f3"},{description:"\u05e7\u05d5\u05d8\u05e8 \u05d7\u05d5\u05e4\u05ea \u05d4\u05e6\u05de\u05e8\u05ea, \u05d1\u05de\u05d8\u05e8\u05d9\u05dd",name:"attributes-canopy-diameter",title:"\u05e7\u05d5\u05d8\u05e8 \u05d4\u05e6\u05de\u05e8\u05ea",type:"number",unit:"\u05de\u05f3"},{description:"\u05e9\u05d8\u05d7 \u05d4\u05e6\u05de\u05e8\u05ea, \u05d1\u05de\u05d8\u05e8\u05d9\u05dd \u05e8\u05d1\u05d5\u05e2\u05d9\u05dd",name:"attributes-canopy-area",title:"\u05e9\u05d8\u05d7 \u05d4\u05e6\u05de\u05e8\u05ea",type:"number",unit:"\u05de\u05f4\u05e8"},{description:"\u05d0\u05d1\u05d7\u05e0\u05d4 \u05d2\u05e1\u05d4 \u05dc\u05d2\u05d1\u05d9 \u05de\u05e6\u05d1 \u05d5\u05d1\u05e8\u05d9\u05d0\u05d5\u05ea \u05d4\u05e2\u05e5",name:"attributes-good-status",title:"\u05d1\u05de\u05e6\u05d1 \u05d8\u05d5\u05d1?",type:"boolean"},{description:"\u05d0\u05d1\u05d7\u05e0\u05d4 \u05d9\u05d5\u05ea\u05e8 \u05de\u05d3\u05d5\u05d9\u05e7\u05ea \u05dc\u05d2\u05d1\u05d9 \u05d1\u05e8\u05d9\u05d0\u05d5\u05ea \u05d4\u05e2\u05e5\n\u05e2\u05e8\u05db\u05d9\u05dd \u05de\u05d5\u05ea\u05e8\u05d9\u05dd: \u05de-1 \u05e2\u05d3 5",name:"attributes-health-score",title:"\u05d1\u05e8\u05d9\u05d0\u05d5\u05ea \u05d4\u05e2\u05e5",type:"integer"},{description:"\u05ea\u05d9\u05d0\u05d5\u05e8 \u05de\u05d9\u05dc\u05d5\u05dc\u05d9 \u05e9\u05dc \u05de\u05e6\u05d1 \u05d4\u05e2\u05e5\n\u05e2\u05e8\u05db\u05d9\u05dd \u05de\u05d5\u05ea\u05e8\u05d9\u05dd: \u05d3\u05dc\u05d9\u05dc\u05d5\u05ea \u05d7\u05d5\u05e4\u05d4 \n\u05d4\u05ea\u05d5\u05d5\u05e0\u05d5\u05ea \u05e2\u05e0\u05e4\u05d9\u05dd \u05d1\u05e6\u05de\u05e8\u05ea \u05d4\u05e2\u05e5\n\u05e2\u05e0\u05e4\u05d9\u05dd \u05e9\u05d1\u05d5\u05e8\u05d9\u05dd \u05d1\u05d7\u05d5\u05e4\u05d4 \n\u05e9\u05d9\u05e0\u05d5\u05d9\u05d9 \u05e6\u05d1\u05e2 \u05d1\u05e2\u05dc\u05d5\u05d5\u05ea \u05d4\u05e2\u05e5 ( \u05d4\u05e6\u05d4\u05d1\u05d5\u05ea \\ \u05d4\u05d7\u05de\u05d5\u05ea\\ \u05db\u05dc\u05d5\u05e8\u05d5\u05d6\u05d4...)\n\u05de\u05d1\u05e0\u05d4 \u05dc\u05d0 \u05ea\u05e7\u05d9\u05df (\u05db\u05de\u05d5 :\u05e2\u05e0\u05e4\u05d9\u05dd \u05d1\u05e2\u05dc\u05d9 \u05d6\u05d5\u05d5\u05d9\u05d5\u05ea \u05d7\u05d3\u05d5\u05ea, \u05e7\u05dc\u05d9\u05e4\u05d4 \u05db\u05dc\u05d5\u05d0\u05d4)\n\u05e4\u05e6\u05d9\u05e2\u05d5\u05ea \u05de\u05db\u05e0\u05d9\u05d5\u05ea \u05d1\u05d2\u05d6\u05e2 \u05d5\u05d1\u05e2\u05e0\u05e4\u05d9\u05dd\n\u05e1\u05d9\u05de\u05e0\u05d9 \u05e8\u05e7\u05d1\u05d5\u05df , \u05e6\u05de\u05d2 \u05d0\u05d5 \u05e9\u05e8\u05e3\n\u05e1\u05d9\u05de\u05e0\u05d9 \u05d2\u05d5\u05e8\u05de\u05d9 \u05de\u05d7\u05dc\u05d4 ( \u05e4\u05d8\u05e8\u05d9\u05d5\u05ea \u05de\u05d3\u05e3, \u05db\u05ea\u05de\u05d9 \u05e2\u05dc\u05d9\u05dd \u05d5\u05db\u05d5') \n\u05e1\u05d9\u05de\u05e0\u05d9 \u05de\u05d6\u05d9\u05e7\u05d9\u05dd ( \u05d4\u05d9\u05de\u05e6\u05d0\u05d5\u05ea \u05de\u05d6\u05d9\u05e7\u05d9\u05dd \u05d0\u05d5 \u05e1\u05d9\u05de\u05e0\u05d9\u05d4\u05dd) \n\u05d7\u05dc\u05dc\u05d9\u05dd \u05d1\u05d2\u05d6\u05e2 \n\u05d4\u05ea\u05e8\u05d5\u05de\u05de\u05d5\u05ea \u05e9\u05d5\u05e8\u05e9\u05d9\u05dd \n\u05e8\u05e7\u05d1\u05d5\u05df \u05e6\u05d5\u05d5\u05d0\u05e8 \u05e9\u05d5\u05e8\u05e9\n\u05e0\u05d8\u05d9\u05d9\u05d4 \u05d7\u05d3\u05d4 \u05d1\u05de\u05d1\u05e0\u05d4 \u05d4\u05e2\u05e5",name:"attributes-description",title:"\u05ea\u05d9\u05d0\u05d5\u05e8 \u05de\u05d9\u05dc\u05d5\u05dc\u05d9",type:"string"},{description:"\u05d4\u05d0\u05dd \u05dc\u05e2\u05e5 \u05d9\u05e9 \u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05d4\u05d9\u05e1\u05d8\u05d5\u05e8\u05d9\u05ea, \u05d5\u05de\u05d4\u05d9",name:"importance-historic",title:"\u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05d4\u05d9\u05e1\u05d8\u05d5\u05e8\u05d9\u05ea",type:"string"},{description:"\u05d4\u05d0\u05dd \u05dc\u05e2\u05e5 \u05d9\u05e9 \u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05e1\u05de\u05dc\u05d9\u05ea, \u05d5\u05de\u05d4\u05d9",name:"importance-symbolic",title:"\u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05e1\u05de\u05dc\u05d9\u05ea",type:"string"},{description:"\u05d4\u05d0\u05dd \u05dc\u05e2\u05e5 \u05d9\u05e9 \u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05d0\u05e1\u05ea\u05d8\u05d9\u05ea, \u05d5\u05de\u05d4\u05d9",name:"importance-aesthetic",title:"\u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05d0\u05e1\u05ea\u05d8\u05d9\u05ea",type:"string"},{description:"\u05d4\u05d0\u05dd \u05dc\u05e2\u05e5 \u05d9\u05e9 \u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05d1\u05d5\u05d8\u05e0\u05d9\u05ea, \u05d5\u05de\u05d4\u05d9",name:"importance-botanical",title:"\u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05d1\u05d5\u05d8\u05e0\u05d9\u05ea",type:"string"},{description:"\u05d4\u05d0\u05dd \u05dc\u05e2\u05e5 \u05d9\u05e9 \u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05e7\u05d4\u05d9\u05dc\u05ea\u05d9\u05ea, \u05d5\u05de\u05d4\u05d9",name:"importance-community",title:"\u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05e7\u05d4\u05d9\u05dc\u05ea\u05d9\u05ea",type:"string"},{description:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05db\u05dc\u05dc\u05d9\u05d5\u05ea / \u05dc\u05d0 \u05de\u05e7\u05d5\u05d8\u05dc\u05d2\u05d5\u05ea \u05e9\u05dc \u05d4\u05e2\u05e5",name:"photos-general",title:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05db\u05dc\u05dc\u05d9\u05d5\u05ea",type:"string"},{description:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05ea\u05e7\u05e8\u05d9\u05d1 \u05e9\u05dc \u05d2\u05d6\u05e2 \u05d4\u05e2\u05e5",name:"photos-bark",title:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05d2\u05d6\u05e2",type:"string"},{description:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05ea\u05e7\u05e8\u05d9\u05d1 \u05e9\u05dc \u05e2\u05dc\u05d9 \u05d4\u05e2\u05e5",name:"photos-leaf",title:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05e2\u05dc\u05d4",type:"string"},{description:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05ea\u05e7\u05e8\u05d9\u05d1 \u05e9\u05dc \u05e4\u05e8\u05d9 \u05d4\u05e2\u05e5",name:"photos-fruit",title:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05e4\u05e8\u05d9",type:"string"},{description:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05e8\u05d7\u05d1\u05d5\u05ea \u05e9\u05dc \u05d4\u05e2\u05e5",name:"photos-wide-view",title:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05de\u05d1\u05d8 \u05e8\u05d7\u05d1",type:"string"},{description:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05ea\u05e7\u05e8\u05d9\u05d1 \u05e9\u05dc \u05ea\u05d7\u05ea\u05d9\u05ea \u05d4\u05d2\u05d6\u05e2 \u05e9\u05dc \u05d4\u05e2\u05e5",name:"photos-ground",title:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05e7\u05e8\u05e7\u05e2",type:"string"},{description:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05e9\u05dc \u05d4\u05e2\u05e5 \u05d1\u05de\u05d1\u05d8 \u05e2\u05dc",name:"photos-top-view",title:"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05d0\u05d5\u05d5\u05d9\u05e8\u05d9\u05d5\u05ea",type:"string"}];function age(e,t){if(1&e&&(Rt(0,"div",4)(1,"span"),In(2,"\u05e8\u05e9\u05d5\u05ea \u05de\u05e7\u05d5\u05de\u05d9\u05ea"),kt(),Rt(3,"span"),In(4),kt()()),2&e){const n=Rn(2);xt(4),Ar(n.tree.muni_name)}}function lge(e,t){if(1&e&&(Rt(0,"div",4)(1,"span"),In(2,"\u05e8\u05d7\u05d5\u05d1"),kt(),Rt(3,"span"),In(4),kt()()),2&e){const n=Rn(2);xt(4),Ar(n.tree.road_name)}}function cge(e,t){if(1&e&&(Rt(0,"div",4)(1,"span"),In(2,"\u05d2\u05d5\u05e9/\u05d7\u05dc\u05e7\u05d4"),kt(),Rt(3,"span",5),In(4),kt()()),2&e){const n=Rn(2);xt(4),Ar(n.tree.cad_code)}}function uge(e,t){if(1&e&&(Rt(0,"div",4)(1,"span"),In(2),kt(),Rt(3,"span"),In(4),kt()()),2&e){const n=t.$implicit;xt(2),Ar(n.name),xt(2),Ar(n.date)}}function dge(e,t){if(1&e&&(Rt(0,"span",22),In(1),kt()),2&e){const n=Rn().$implicit;Ut("matTooltip","\u05db\u05e4\u05d9 \u05e9\u05d4\u05ea\u05e7\u05d1\u05dc \u05de"+n.source),xt(1),Ar(n.value)}}function hge(e,t){if(1&e&&(Rt(0,"span",22),In(1),kt()),2&e){const n=Rn().$implicit,i=Rn(4);Ut("matTooltip","\u05db\u05e4\u05d9 \u05e9\u05d4\u05ea\u05e7\u05d1\u05dc \u05de"+n.source),xt(1),Ar(i.toNumber(n.value,1))}}function fge(e,t){if(1&e&&(Rt(0,"span",22),In(1),kt()),2&e){const n=Rn().$implicit,i=Rn(4);Ut("matTooltip","\u05db\u05e4\u05d9 \u05e9\u05d4\u05ea\u05e7\u05d1\u05dc \u05de"+n.source),xt(1),Ar(i.toNumber(n.value,0))}}function pge(e,t){if(1&e&&(Rt(0,"span",22),In(1),kt()),2&e){const n=Rn().$implicit,i=Rn(4);Ut("matTooltip","\u05db\u05e4\u05d9 \u05e9\u05d4\u05ea\u05e7\u05d1\u05dc \u05de"+n.source),xt(1),Ar(i.toBoolean(n.value))}}function mge(e,t){if(1&e&&Hi(0,"img",23),2&e){const n=Rn().$implicit;Ut("matTooltip","\u05db\u05e4\u05d9 \u05e9\u05d4\u05ea\u05e7\u05d1\u05dc \u05de"+n.source)("src",n.value,Fp)}}function gge(e,t){if(1&e&&(Rt(0,"span",24),In(1),kt()),2&e){const n=Rn(2).$implicit;xt(1),Md("\xa0",n.unit,"")}}function _ge(e,t){if(1&e&&(Rt(0,"div",18),jn(1,dge,2,2,"span",19),jn(2,hge,2,2,"span",19),jn(3,fge,2,2,"span",19),jn(4,pge,2,2,"span",19),jn(5,mge,1,2,"img",20),jn(6,gge,2,1,"span",21),kt()),2&e){const n=Rn().$implicit;xt(1),Ut("ngIf","string"===n.type),xt(1),Ut("ngIf","number"===n.type),xt(1),Ut("ngIf","integer"===n.type),xt(1),Ut("ngIf","boolean"===n.type),xt(1),Ut("ngIf","photo"===n.type),xt(1),Ut("ngIf",!!n.unit)}}function yge(e,t){if(1&e&&(Rt(0,"div",14)(1,"span",15),In(2),kt(),Rt(3,"div",16),jn(4,_ge,7,6,"div",17),kt()()),2&e){const n=t.$implicit;xt(1),Ut("matTooltip",n.description),xt(1),Ar(n.title),xt(2),Ut("ngForOf",n.values)}}function vge(e,t){if(1&e&&(Rt(0,"div",12)(1,"h2"),In(2,"\u05de\u05d9\u05d3\u05e2 \u05e0\u05d5\u05e1\u05e3"),kt(),jn(3,yge,5,3,"div",13),kt()),2&e){const n=Rn(2);xt(3),Ut("ngForOf",n.extraItems)}}function bge(e,t){if(1&e&&(Rt(0,"div",2)(1,"h1"),In(2),kt(),Rt(3,"div",3)(4,"div",4)(5,"span"),In(6,"\u05de\u05d9\u05df"),kt(),Rt(7,"span"),In(8),kt()(),Rt(9,"div",4)(10,"span"),In(11,"\u05e0.\u05e6"),kt(),Rt(12,"span",5),In(13),FS(14,"number"),FS(15,"number"),kt()(),jn(16,age,5,1,"div",6),jn(17,lge,5,1,"div",6),jn(18,cge,5,1,"div",6),kt(),Rt(19,"div",7)(20,"h2"),In(21,"\u05e8\u05e9\u05d9\u05de\u05ea \u05de\u05e7\u05d5\u05e8\u05d5\u05ea \u05d4\u05de\u05d9\u05d3\u05e2"),kt(),jn(22,uge,5,2,"div",8),kt(),Rt(23,"div",9)(24,"h2"),In(25,"\u05ea\u05e6\u05d5\u05d2\u05ea \u05e8\u05d7\u05d5\u05d1 (\u05e2\u05d3\u05db\u05e0\u05d9\u05d5\u05ea \u05dc\u05e4\u05d9 \u05de\u05e4\u05d5\u05ea Google)"),kt(),Hi(26,"iframe",10),kt(),jn(27,vge,4,1,"div",11),kt()),2&e){const n=Rn();xt(2),Md("\u05de\u05d6\u05e2\u05e5: ",n.tree["meta-tree-id"],""),xt(6),Ar(n.tree["attributes-species-clean-he"]||"\u05dc\u05d0 \u05d9\u05d3\u05d5\u05e2"),xt(5),CS("",NS(14,10,n.tree["location-x"],"1.0-5"),", ",NS(15,13,n.tree["location-y"],"1.0-5"),""),xt(3),Ut("ngIf",n.tree.muni_name),xt(1),Ut("ngIf",n.tree.road_name),xt(1),Ut("ngIf",n.tree.cad_code),xt(4),Ut("ngForOf",n.sources),xt(4),Ut("src",n.streetView,Np),xt(1),Ut("ngIf",n.extraItems.length>0)}}const xge=function(){return["/","trees"]};let M7=(()=>{class e{constructor(n){this.sanitizer=n,this.tree=null,this.treeExtra={},this.sources=[],this.extraItems=[],this.processedData=[]}set state(n){if(null===n)return this.tree=null,void(this.sources=[]);if(n.data[0]!==this.processedData){this.processedData=n.data[0],this.sources=[],this.tree={},this.treeExtra={};for(const i of n.data[0]){i["meta-source"]&&i["meta-date"]&&i["meta-source-type"]&&i["meta-collection-type"]&&this.sources.push({name:i["meta-source"],date:i["meta-date"],type:i["meta-source-type"],collectionType:i["meta-collection-type"]});for(const r of Object.keys(i))if(this.tree[r]=this.tree[r]||i[r],i[r]){this.treeExtra[r]=this.treeExtra[r]||[];let s=!1,u=[i[r]];u[0]?.indexOf&&0===u[0].indexOf("http")&&(u=u[0].split(" ")),console.log("VALUES",r,u);for(const h of u){for(const g of this.treeExtra[r])if(g.value===h){s=!0,g.source=g.source+", "+i["meta-source"];break}s||this.treeExtra[r].push({source:i["meta-source"],value:h})}}}this.sources=this.sources.sort((i,r)=>i.date.localeCompare(r.date)),this.streetView=this.sanitizer.bypassSecurityTrustResourceUrl(`https://www.google.com/maps/embed/v1/streetview?location=${this.tree["location-y"]},${this.tree["location-x"]}&key=AIzaSyAW0_GwE7WPDox5RZnUMkESHGiSe5siWdQ`),this.extraItems=[];for(const i of sge)if(this.tree[i.name]){const r=Object.assign({values:this.treeExtra[i.name]},i);"string"===r.type&&0===r.values[0].value.indexOf("http")&&(r.type="photo",r.values=r.values.map(s=>({source:s.source,value:this.sanitizer.bypassSecurityTrustResourceUrl(s.value)}))),this.extraItems.push(r)}console.log("EXTRA ITEMS"),console.table(this.extraItems)}}toNumber(n,i=1){try{return parseFloat(n).toFixed(i)}catch{return n}}toBoolean(n){return n?"\u05db\u05df":"\u05dc\u05d0"}toImage(n){return this.sanitizer.bypassSecurityTrustResourceUrl(n)}}return e.\u0275fac=function(n){return new(n||e)(Nt(Z5))},e.\u0275cmp=Ni({type:e,selectors:[["app-tree"]],decls:2,vars:4,consts:[["mode","tree",3,"init","back","state"],["class","content",4,"ngIf"],[1,"content"],[1,"main-infos","section"],[1,"info"],[1,"ltr"],["class","info",4,"ngIf"],[1,"sources","section"],["class","info",4,"ngFor","ngForOf"],[1,"street-view","section"],["width","340","height","340","loading","lazy","allowfullscreen","",2,"border","0",3,"src"],["class","extra-info section",4,"ngIf"],[1,"extra-info","section"],["class","item",4,"ngFor","ngForOf"],[1,"item"],[1,"title","tooltip",3,"matTooltip"],[1,"values"],["class","value-tuple",4,"ngFor","ngForOf"],[1,"value-tuple"],["class","value tooltip",3,"matTooltip",4,"ngIf"],["class","value",3,"matTooltip","src",4,"ngIf"],["class","unit",4,"ngIf"],[1,"value","tooltip",3,"matTooltip"],[1,"value",3,"matTooltip","src"],[1,"unit"]],template:function(n,i){1&n&&(Rt(0,"app-content",0),xs("state",function(s){return i.state=s}),jn(1,bge,28,16,"div",1),kt()),2&n&&(Ut("init",!!i.tree)("back",Tu(3,xge)),xt(1),Ut("ngIf",i.tree))},dependencies:[Tg,dc,Wb,Tm,E5],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:12px}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:40px;align-items:center;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:20px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}.content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:15px;line-height:24px;color:#383838}.content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:15px;line-height:24px;color:#383838}.content[_ngcontent-%COMP%]   .extra-info[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:space-between;gap:16px}.content[_ngcontent-%COMP%]   .extra-info[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{flex:0 0 auto;white-space:nowrap}.content[_ngcontent-%COMP%]   .extra-info[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{flex:1 1 100%;font-style:Normal;font-weight:600;font-size:15px;line-height:24px;color:#383838;display:flex;flex-flow:column;align-items:flex-end;gap:2px}.content[_ngcontent-%COMP%]   .extra-info[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;object-fit:contain}.content[_ngcontent-%COMP%]   .extra-info[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   .unit[_ngcontent-%COMP%]{font-size:10px;font-style:Normal;font-weight:400}.content[_ngcontent-%COMP%]   .extra-info[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   .value-tuple[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:flex-end;width:100%}']}),e})();function Ege(e,t){if(1&e&&(Rt(0,"h2",6),In(1),kt()),2&e){const n=Rn().$implicit;Ut("matTooltip",n.tooltip),xt(1),Ar(n.text)}}function Cge(e,t){if(1&e&&(Rt(0,"h2"),In(1),kt()),2&e){const n=Rn().$implicit;xt(1),Ar(n.text)}}function Mge(e,t){if(1&e&&(Rt(0,"div",8),Hi(1,"div",9),Rt(2,"div",10),jn(3,Ege,2,2,"h2",11),jn(4,Cge,2,1,"h2",12),Rt(5,"div",13)(6,"span",14),In(7),kt(),Rt(8,"span",15),In(9),kt()()()()),2&e){const n=t.$implicit;xt(1),Cy("background-image","url(assets/img/icon-"+n.icon+".svg)"),xt(2),Ut("ngIf",n.tooltip),xt(1),Ut("ngIf",!n.tooltip),xt(3),Ar(n.value),xt(2),Ar(n.units)}}function Tge(e,t){if(1&e&&(Rt(0,"div",16)(1,"span"),In(2),kt(),Rt(3,"span")(4,"strong"),In(5),kt(),In(6," \u05e2\u05e6\u05d9\u05dd"),kt()()),2&e){const n=t.$implicit;xt(2),Ar(n.name),xt(3),Ar(n.count.toLocaleString())}}const Dge=function(){return["/trees"]};function Sge(e,t){if(1&e&&(Rt(0,"div",1)(1,"h1"),In(2),kt(),Rt(3,"div",2),jn(4,Mge,10,6,"div",3),kt(),Rt(5,"a",4),In(6),kt(),Rt(7,"div",5)(8,"h2",6),In(9,"\u05e8\u05e9\u05d9\u05de\u05ea \u05de\u05e7\u05d5\u05e8\u05d5\u05ea \u05d4\u05de\u05d9\u05d3\u05e2"),kt(),jn(10,Tge,7,2,"div",7),kt()()),2&e){const n=Rn();xt(2),Ar(n.name),xt(2),Ut("ngForOf",n.iconInfos),xt(1),Ut("routerLink",Tu(8,Dge))("queryParamsHandling","merge")("queryParams",n.focusParams),xt(1),Md("\u05e6\u05e4\u05d9\u05d9\u05d4 \u05d1\u05e2\u05e6\u05d9\u05dd \u05d1",n.focusLink," \xbb"),xt(2),Ut("matTooltip","\u05de\u05e1\u05e4\u05e8 \u05e2\u05e6\u05d9\u05dd \u05dc\u05db\u05dc \u05de\u05e7\u05d5\u05e8 \u05de\u05d9\u05d3\u05e2 \u05dc\u05dc\u05d0 \u05d4\u05e6\u05dc\u05d1\u05d4 \u05dc\u05de\u05e7\u05d5\u05e8\u05d5\u05ea \u05de\u05d9\u05d3\u05e2 \u05d0\u05d7\u05e8\u05d9\u05dd"),xt(2),Ut("ngForOf",n.sources)}}const Ige=[{text:"\u05de\u05e1\u05e4\u05e8 \u05e2\u05e6\u05d9\u05dd",icon:"tree-count",field:"total_count",units:""},{text:"\u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05d5\u05ea",icon:"canopy-area",units:e=>e.city_code?"\u05d3\u05d5\u05e0\u05dd":'\u05e7\u05de"\u05e8',value:e=>(e.canopy_area/(e.city_code?1e3:1e6)).toFixed(1)},{text:"\u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea",icon:"canopy-coverage",tooltip:"\u05e1\u05da \u05d4\u05d7\u05d5\u05e4\u05d5\u05ea \u05de\u05e1\u05da \u05e9\u05d8\u05d7 \u05d4\u05e8\u05e9\u05d5\u05ea",units:"",value:e=>(100*e.canopy_area_ratio).toFixed(0)+"%"},{text:"\u05e9\u05d8\u05d7",icon:"area",units:e=>e.city_code?"\u05d3\u05d5\u05e0\u05dd":'\u05e7\u05de"\u05e8',value:e=>(e.area/(e.city_code?1e3:1e6)).toFixed(1)},{text:"\u05de\u05e1\u05f3 \u05ea\u05d5\u05e9\u05d1\u05d9\u05dd",icon:"population",field:"population",units:""},{text:"\u05de\u05e1\u05f3 \u05e2\u05e6\u05d9\u05dd \u05dc\u05e0\u05e4\u05e9",icon:"trees-per-person",units:"",value:e=>e.total_count&&e.population?(e.total_count/e.population).toLocaleString(void 0,{maximumFractionDigits:2}):null},{text:"\u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05dc\u05e0\u05e4\u05e9",icon:"canopies-per-person",units:"\u05de\u05f4\u05e8",value:e=>e.canopy_area&&e.population?(e.canopy_area/e.population).toFixed(2):null},{text:"\u05d0\u05e9\u05db\u05d5\u05dc \u05d7\u05d1\u05e8\u05ea\u05d9/\u05db\u05dc\u05db\u05dc\u05d9",icon:"socioeconomic-index",tooltip:"\u05dc\u05e4\u05d9 \u05e0\u05ea\u05d5\u05e0\u05d9 \u05dc\u05de\u05f4\u05e1 2020",units:"",value:e=>e.socioeconomic_index?`${e.socioeconomic_index.toFixed(0)}/10`:null},{text:"\u05e6\u05e4\u05d9\u05e4\u05d5\u05ea",icon:"population-density",units:'\u05e0\u05e4\u05e9\u05d5\u05ea \u05dc\u05e7\u05de"\u05e8',value:e=>e.population_density?.toFixed(1)}];let T7=(()=>{class e{constructor(){this.record=null,this.sources=[],this.name="",this.focus="",this.focusLink="",this.iconInfos=[],this.focusParams={}}ngOnChanges(){this.record&&(console.log("REGION RECORD",this.record),this.iconInfos=[],Ige.forEach(n=>{let i=null;n.field?i=this.record[n.field]:"function"==typeof n.value&&(i=n.value(this.record));let r=n.units;"function"==typeof r&&(r=r(this.record)),null!=i&&null!=r&&("number"==typeof i&&(i=i.toLocaleString()),this.iconInfos.push({text:n.text,icon:n.icon,tooltip:n.tooltip,value:i,units:r}))}),console.log("REGION ICON_INFOS",this.iconInfos),this.focusParams={focus:this.focus})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-region"]],inputs:{record:"record",sources:"sources",name:"name",focus:"focus",focusLink:"focusLink"},features:[se],decls:1,vars:1,consts:[["class","content",4,"ngIf"],[1,"content"],[1,"icon-infos"],["class","icon-info",4,"ngFor","ngForOf"],[1,"go-to-trees",3,"routerLink","queryParamsHandling","queryParams"],[1,"sources","section"],[1,"tooltip",3,"matTooltip"],["class","info",4,"ngFor","ngForOf"],[1,"icon-info"],[1,"icon"],[1,"text"],["class","tooltip",3,"matTooltip",4,"ngIf"],[4,"ngIf"],[1,"value"],[1,"number"],[1,"units"],[1,"info"]],template:function(n,i){1&n&&jn(0,Sge,11,9,"div",0),2&n&&Ut("ngIf",i.record)},dependencies:[Tg,dc,dm,Wb],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:12px}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:40px;align-items:center;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:20px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}.content[_ngcontent-%COMP%]   .go-to-trees[_ngcontent-%COMP%]{align-self:flex-end;color:#204e37}']}),e})();function Age(e,t){if(1&e&&Hi(0,"app-region",2),2&e){const n=Rn();Ut("record",n.muni)("sources",n.sources)("name",n.muni.muni_name)("focus","muni:"+n.muni.muni_code+":"+n.muni.muni_name)("focusLink",n.muni.muni_name)}}const Pge=function(){return["/","munis"]};let Oge=(()=>{class e{constructor(){this.muni=null,this.sources=[]}set state(n){if(null===n)return this.muni=null,void(this.sources=[]);this.muni=Object.assign({},n.data[0][0]||{},n.data[2][0]||{}),this.sources=[];for(const i of n.data[1])i.name&&i.count&&this.sources.push({name:i.name,count:i.count})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-muni"]],decls:2,vars:4,consts:[["mode","muni",3,"init","back","state"],[3,"record","sources","name","focus","focusLink",4,"ngIf"],[3,"record","sources","name","focus","focusLink"]],template:function(n,i){1&n&&(Rt(0,"app-content",0),xs("state",function(s){return i.state=s}),jn(1,Age,1,5,"app-region",1),kt()),2&n&&(Ut("init",!!i.muni)("back",Tu(3,Pge)),xt(1),Ut("ngIf",i.muni))},dependencies:[dc,Tm,T7],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:12px}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:40px;align-items:center;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:20px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}']}),e})();function kge(e,t){1&e&&Hi(0,"app-summary",2),2&e&&Ut("state",Rn().state)}let Rge=(()=>{class e{constructor(){this.state=null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-munis"]],decls:2,vars:2,consts:[["mode","munis",3,"init","state"],["name","\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05de\u05e7\u05d5\u05de\u05d9\u05d5\u05ea",3,"state",4,"ngIf"],["name","\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05de\u05e7\u05d5\u05de\u05d9\u05d5\u05ea",3,"state"]],template:function(n,i){1&n&&(Rt(0,"app-content",0),xs("state",function(s){return i.state=s}),jn(1,kge,1,1,"app-summary",1),kt()),2&n&&(Ut("init",!!i.state),xt(1),Ut("ngIf",i.state))},dependencies:[dc,Tm,vk]}),e})();function Lge(e,t){if(1&e&&Hi(0,"app-region",2),2&e){const n=Rn();Ut("record",n.stat_area)("sources",n.sources)("name",n.name)("focus","stat-area:"+n.stat_area.code)("focusLink","\u05d0\u05d9\u05d6\u05d5\u05e8 \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9 "+n.stat_area.code)}}const Fge=function(){return["/","stat-areas"]};let Nge=(()=>{class e{constructor(){this.stat_area=null,this.sources=[],this.name=""}set state(n){if(console.log("GOET STATE",n),null===n)return this.stat_area=null,this.sources=[],void(this.name="");this.stat_area=Object.assign({},n.data[0][0]||{},n.data[2][0]||{}),this.sources=[],this.name=`\u05d0\u05d6\u05d5\u05e8 \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9 ${this.stat_area.city_code}/${this.stat_area.area_code||"0"}`;for(const i of n.data[1])i.name&&i.count&&this.sources.push({name:i.name,count:i.count})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-stat-area"]],decls:2,vars:4,consts:[["mode","stat-area",3,"init","back","state"],[3,"record","sources","name","focus","focusLink",4,"ngIf"],[3,"record","sources","name","focus","focusLink"]],template:function(n,i){1&n&&(Rt(0,"app-content",0),xs("state",function(s){return i.state=s}),jn(1,Lge,1,5,"app-region",1),kt()),2&n&&(Ut("init",!!i.stat_area)("back",Tu(3,Fge)),xt(1),Ut("ngIf",i.stat_area))},dependencies:[dc,Tm,T7],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:12px}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:40px;align-items:center;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:20px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}']}),e})();function zge(e,t){1&e&&Hi(0,"app-summary",2),2&e&&Ut("state",Rn().state)}const Bge=[{path:"trees",component:oge},{path:"trees/:id",component:M7},{path:"linkto/:id",component:M7},{path:"munis",component:Rge},{path:"munis/:id",component:Oge},{path:"stat-areas",component:(()=>{class e{constructor(){this.state=null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-stat-areas"]],decls:2,vars:2,consts:[["mode","stat-areas",3,"init","state"],["name","\u05d0\u05d6\u05d5\u05e8\u05d9\u05dd \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9\u05d9\u05dd",3,"state",4,"ngIf"],["name","\u05d0\u05d6\u05d5\u05e8\u05d9\u05dd \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9\u05d9\u05dd",3,"state"]],template:function(n,i){1&n&&(Rt(0,"app-content",0),xs("state",function(s){return i.state=s}),jn(1,zge,1,1,"app-summary",1),kt()),2&n&&(Ut("init",!!i.state),xt(1),Ut("ngIf",i.state))},dependencies:[dc,Tm,vk]}),e})()},{path:"stat-areas/:id",component:Nge},{path:"",component:Ine}];let Uge=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e}),e.\u0275inj=Er({imports:[j4.forRoot(Bge),j4]}),e})(),Vge=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-header"]],decls:17,vars:0,consts:[["href","/","aria-label","\u05de\u05e2\u05d1\u05e8 \u05dc\u05e2\u05de\u05d5\u05d3 \u05d4\u05d1\u05d9\u05ea",1,"logo-container"],[1,"logo"],[1,"separator"],[1,"links"],["href","https://data-city.my.canva.site/digital-forest-methodology","target","_blank"],["href","https://data-city.my.canva.site/digital-forest-add-trees","target","_blank"],["href","https://www.digital-forest.org.il/","target","_blank"],["href","https://data-city.my.canva.site/terms","target","_blank"],["href","https://www.hasadna.org.il","aria-label","\u05d0\u05ea\u05e8 \u05d4\u05e1\u05d3\u05e0\u05d0 \u05dc\u05d9\u05d3\u05e2 \u05e6\u05d9\u05d1\u05d5\u05e8\u05d9 - \u05de\u05e2\u05d1\u05e8 \u05dc\u05d0\u05ea\u05e8 \u05d7\u05d9\u05e6\u05d5\u05e0\u05d9",1,"pkw-logo"]],template:function(n,i){1&n&&(Rt(0,"a",0),Hi(1,"div",1)(2,"div",2),Rt(3,"h1"),In(4,"\u05d1\u05e1\u05d9\u05e1 \u05e0\u05ea\u05d5\u05e0\u05d9\u05dd \u05dc\u05d0\u05d5\u05de\u05d9"),Hi(5,"br"),In(6,"\u05dc\u05d9\u05e2\u05e8 \u05d4\u05e2\u05d9\u05e8\u05d5\u05e0\u05d9"),kt()(),Rt(7,"div",3)(8,"a",4),In(9,"\u05de\u05ea\u05d5\u05d3\u05d5\u05dc\u05d5\u05d2\u05d9\u05d4"),kt(),Rt(10,"a",5),In(11,"\u05d4\u05d5\u05e1\u05e4\u05ea \u05e2\u05e6\u05d9\u05dd"),kt(),Rt(12,"a",6),In(13,"\u05d0\u05d5\u05d3\u05d5\u05ea"),kt(),Rt(14,"a",7),In(15,"\u05de\u05d3\u05d9\u05e0\u05d9\u05d5\u05ea \u05e9\u05d9\u05de\u05d5\u05e9"),kt()(),Hi(16,"a",8))},styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]{height:80px;width:100%;display:flex;flex-flow:row;align-items:center;padding:0 25px;background-color:#204e37}[_nghost-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   a[_ngcontent-%COMP%]:visited, [_nghost-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:none}[_nghost-%COMP%]   .logo-container[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;gap:20px;height:60px}[_nghost-%COMP%]   .logo-container[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:119px;height:50px;background-repeat:no-repeat;background-position:center;background-size:contain;background-image:url(logo.7343a7219d3b3cca.svg);padding-left:20px}[_nghost-%COMP%]   .logo-container[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{width:1px;height:100%;background-color:#fff}[_nghost-%COMP%]   .logo-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;padding-right:20px;color:#fff;font-family:Rubik,sans-serif;font-style:normal;font-weight:600;text-align:right;font-size:18px;line-height:20px}[_nghost-%COMP%]   .links[_ngcontent-%COMP%]{margin-right:auto;display:flex;flex-flow:row;align-items:center;gap:30px}[_nghost-%COMP%]   .links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;font-family:Rubik,sans-serif;font-style:normal;font-weight:500;font-size:18px;line-height:20px;text-decoration:none}[_nghost-%COMP%]   .links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]   .pkw-logo[_ngcontent-%COMP%]{margin-right:50px;background-repeat:no-repeat;background-position:center;background-size:contain;width:61px;height:59.863px;background-image:url(pkw-logo.b6e22ec9e5fded8c.svg)}']}),e})();function D7(e,t,n,i,r,s,u){try{var h=e[s](u),g=h.value}catch(x){return void n(x)}h.done?t(g):Promise.resolve(g).then(i,r)}function S7(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var s=e.apply(t,n);function u(g){D7(s,i,r,u,h,"next",g)}function h(g){D7(s,i,r,u,h,"throw",g)}u(void 0)})}}let jge=(()=>{class e{constructor(n){this.snackBar=n}mobileShare(){var n=this;return S7(function*(){const i={text:"\u05d9\u05e2\u05f4\u05d3 - \u05d1\u05e1\u05d9\u05e1 \u05e0\u05ea\u05d5\u05e0\u05d9\u05dd \u05dc\u05d0\u05d5\u05de\u05d9 \u05dc\u05d9\u05e2\u05e8 \u05d4\u05e2\u05d9\u05e8\u05d5\u05e0\u05d9",url:window.location.href};try{return yield navigator.share(i),!1}catch{return n.clipboardCopy()}})()}clipboardCopy(){if(!document.queryCommandSupported&&document.queryCommandSupported("copy"))return!1;const n=window.location.href,i=document.createElement("textarea");i.textContent=n,i.classList.add("visually-hidden"),document.body.appendChild(i),i.select();try{return document.execCommand("copy"),!0}catch{}finally{document.body.removeChild(i)}return!1}doShare(){var n=this;return S7(function*(){(yield n.mobileShare())&&n.snackBar.open("\u05e7\u05d9\u05e9\u05d5\u05e8 \u05dc\u05e2\u05de\u05d5\u05d3 \u05d4\u05e0\u05d5\u05db\u05d7\u05d9 \u05d4\u05d5\u05e2\u05ea\u05e7 \u05dc\u05dc\u05d5\u05d7","\u05ea\u05d5\u05d3\u05d4",{duration:5e3})})()}}return e.\u0275fac=function(n){return new(n||e)(Nt(pQ))},e.\u0275cmp=Ni({type:e,selectors:[["app-share"]],decls:1,vars:1,consts:[[3,"matTooltip","click"]],template:function(n,i){1&n&&(Rt(0,"button",0),xs("click",function(){return i.doShare()}),kt()),2&n&&Ut("matTooltip","\u05e9\u05d9\u05ea\u05d5\u05e3 \u05d4\u05e2\u05de\u05d5\u05d3")},dependencies:[Wb],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{pointer-events:all;width:48px;height:48px;border-radius:24px;background-color:#64b883;cursor:pointer;border:none;background-repeat:no-repeat;background-position:center;background-size:contain;background-image:url(icon-share.cf4b9cd6a91ceb5f.svg);background-size:24px}[_nghost-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#638473;box-shadow:0 4px 8px #0000004d;transform:translateY(-2px)}']}),e})();var R0=Zs(574);let I7=(()=>{class e{constructor(){this.ACCESS_TOKEN="pk.eyJ1IjoidHJlZWJhc2UiLCJhIjoiY2xjazVueWFnMHBscDN2bXRkdjh1dHd1cyJ9.zcn36ZZJ9b0RJlYJTSZYOA",this.init=new rA(1),console.log("MAPBOX SERVICE ACCESS TOKEN",this.ACCESS_TOKEN),R0.accessToken=this.ACCESS_TOKEN,R0.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",n=>{console.log("FAILED TO LOAD PLUGIN",n)},!0),this.init.next(),this.init.complete()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),$ge=(()=>{class e{constructor(n,i){this.mapbox=n,this.api=i,this.FIELDS=["meta-tree-id","meta-collection-type","meta-date","meta-internal-id","meta-source","meta-source-type","location-x","location-y","location-x-il","location-y-il","location-elevation","cad_gush","cad_parcel","muni_code","muni_name","muni_name_en","muni_region","road_id","road_type","stat_area_code","location-accuracy","location-address","location-city","location-street","location-street-number","attributes-genus","attributes-species-clean-en","attributes-species-clean-he","attributes-age","attributes-age-estimated","attributes-year-planted","attributes-height","attributes-bark-circumference","attributes-bark-diameter","attributes-num-barks","attributes-canopy-area","attributes-canopy-diameter","attributes-good-status","attributes-health-score","attributes-description","environment-type","environment-description","environment-habitat","environment-habitat-volume","environment-irrigated","environment-irrigation-type","environment-irrigation-water-quality","environment-grass","environment-lighting","environment-pavement","environment-signage","environment-sitting-area","importance-aesthetic","importance-botanical","importance-community","importance-historic","importance-symbolic"],this.HEADERS={"meta-tree-id":"\u05de\u05d6\u05e2\u05e5","meta-collection-type":"\u05d0\u05d5\u05e4\u05df \u05d0\u05d9\u05e1\u05d5\u05e3 \u05d4\u05de\u05d9\u05d3\u05e2","meta-date":"\u05ea\u05d0\u05e8\u05d9\u05da","meta-internal-id":"\u05de\u05d6\u05d4\u05d4 \u05e4\u05e0\u05d9\u05de\u05d9","meta-source":"\u05de\u05e7\u05d5\u05e8 \u05d4\u05de\u05d9\u05d3\u05e2","meta-source-type":"\u05e1\u05d5\u05d2 \u05de\u05e7\u05d5\u05e8 \u05d4\u05de\u05d9\u05d3\u05e2","location-x":"\u05e7\u05d5 \u05d0\u05d5\u05e8\u05da","location-y":"\u05e7\u05d5 \u05e8\u05d5\u05d7\u05d1","location-x-il":"\u05e7\u05d5 \u05d0\u05d5\u05e8\u05da \u05d9\u05e9\u05e8\u05d0\u05dc\u05d9","location-y-il":"\u05e7\u05d5 \u05e8\u05d5\u05d7\u05d1 \u05d9\u05e9\u05e8\u05d0\u05dc\u05d9","location-elevation":"\u05d2\u05d5\u05d1\u05d4 \u05de\u05e2\u05dc \u05e4\u05e0\u05d9 \u05d4\u05d9\u05dd",cad_gush:"\u05d2\u05d5\u05e9",cad_parcel:"\u05d7\u05dc\u05e7\u05d4",muni_code:"\u05e1\u05de\u05dc \u05d4\u05e8\u05e9\u05d5\u05ea",muni_name:"\u05e9\u05dd \u05d4\u05e8\u05e9\u05d5\u05ea",muni_name_en:"\u05e9\u05dd \u05d4\u05e8\u05e9\u05d5\u05ea \u05d1\u05d0\u05e0\u05d2\u05dc\u05d9\u05ea",muni_region:"\u05d0\u05d6\u05d5\u05e8 \u05d4\u05e8\u05e9\u05d5\u05ea",road_id:"\u05e9\u05dd \u05e8\u05d7\u05d5\u05d1",road_type:"\u05e1\u05d5\u05d2 \u05e8\u05d7\u05d5\u05d1",stat_area_code:"\u05e7\u05d5\u05d3 \u05d0\u05d6\u05d5\u05e8 \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9","location-accuracy":"\u05d3\u05d9\u05d5\u05e7 \u05de\u05d9\u05e7\u05d5\u05dd","location-address":"\u05db\u05ea\u05d5\u05d1\u05ea","location-city":"\u05e9\u05dd \u05d4\u05d9\u05d9\u05e9\u05d5\u05d1","location-street":"\u05e8\u05d7\u05d5\u05d1","location-street-number":"\u05de\u05e1\u05e4\u05e8 \u05d1\u05d9\u05ea","attributes-genus":"\u05e1\u05d5\u05d2","attributes-species-clean-en":"\u05e9\u05dd \u05de\u05d3\u05e2\u05d9 \u05d1\u05d0\u05e0\u05d2\u05dc\u05d9\u05ea","attributes-species-clean-he":"\u05e9\u05dd \u05de\u05d3\u05e2\u05d9 \u05d1\u05e2\u05d1\u05e8\u05d9\u05ea","attributes-age":"\u05d2\u05d9\u05dc","attributes-age-estimated":"\u05d2\u05d9\u05dc \u05de\u05e9\u05d5\u05e2\u05e8","attributes-year-planted":"\u05e9\u05e0\u05ea \u05e0\u05d8\u05d9\u05e2\u05d4","attributes-height":"\u05d2\u05d5\u05d1\u05d4","attributes-bark-circumference":"\u05d4\u05d9\u05e7\u05e3 \u05d2\u05d6\u05e2","attributes-bark-diameter":"\u05e7\u05d5\u05d8\u05e8 \u05d2\u05d6\u05e2","attributes-num-barks":"\u05de\u05e1\u05e4\u05e8 \u05d2\u05d6\u05e2\u05d9\u05dd","attributes-canopy-area":"\u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05d4","attributes-canopy-diameter":"\u05e7\u05d5\u05d8\u05e8 \u05d7\u05d5\u05e4\u05d4","attributes-good-status":"\u05de\u05e6\u05d1 \u05d8\u05d5\u05d1","attributes-health-score":"\u05e6\u05d9\u05d5\u05df \u05d1\u05e8\u05d9\u05d0\u05d5\u05ea","attributes-description":"\u05ea\u05d9\u05d0\u05d5\u05e8 \u05db\u05dc\u05dc\u05d9","environment-type":"\u05de\u05e8\u05d7\u05d1 \u05d4\u05e2\u05e5","environment-description":"\u05de\u05e8\u05d7\u05d1 \u05de\u05e4\u05d5\u05e8\u05d8","environment-habitat":"\u05d1\u05d9\u05ea \u05d4\u05d2\u05d9\u05d3\u05d5\u05dc","environment-habitat-volume":"\u05e0\u05e4\u05d7 \u05d1\u05d9\u05ea \u05d4\u05d2\u05d9\u05d3\u05d5\u05dc","environment-irrigated":"\u05d4\u05e9\u05e7\u05d9\u05d4 \u05e4\u05e2\u05d9\u05dc\u05d4","environment-irrigation-type":"\u05e1\u05d5\u05d2 \u05d4\u05e9\u05e7\u05d9\u05d4","environment-irrigation-water-quality":"\u05d0\u05d9\u05db\u05d5\u05ea \u05de\u05d9 \u05d4\u05e9\u05e7\u05d9\u05d4","environment-grass":"\u05de\u05d3\u05e9\u05d0\u05d4","environment-lighting":"\u05ea\u05d0\u05d5\u05e8\u05d4","environment-pavement":"\u05e8\u05d9\u05e6\u05d5\u05e3","environment-signage":"\u05e9\u05d9\u05dc\u05d5\u05d8","environment-sitting-area":"\u05d0\u05d6\u05d5\u05e8 \u05d9\u05e9\u05d9\u05d1\u05d4","importance-aesthetic":"\u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05d0\u05e1\u05ea\u05d8\u05d9\u05ea","importance-botanical":"\u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05d1\u05d5\u05d8\u05e0\u05d9\u05ea","importance-community":"\u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05e7\u05d4\u05d9\u05dc\u05ea\u05d9\u05ea","importance-historic":"\u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05d4\u05d9\u05e1\u05d8\u05d5\u05e8\u05d9\u05ea","importance-symbolic":"\u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05e1\u05de\u05dc\u05d9\u05ea"},this.fields="",this.headers="",this.fields=`"${this.FIELDS.join('","')}"`,this.headers=this.FIELDS.map(r=>`${this.HEADERS[r]||"x"}<${r}`).join(";")}downloadQuery(){if(!this.mapbox.map)return"";const n=this.mapbox.map.getBounds(),i=`"location-x" > ${n.getWest()} AND "location-x" < ${n.getEast()} AND "location-y" > ${n.getSouth()} AND "location-y" < ${n.getNorth()}`;let r=this.query.replace(/__fields__/g,this.fields);return r=r.replace(/__geo__/g,i),r}downloadUrl(){const n="tree-base-download-"+(new Date).toISOString().slice(0,10);return this.api.downloadUrl(n)}}return e.\u0275fac=function(n){return new(n||e)(Nt(I7),Nt(XT))},e.\u0275cmp=Ni({type:e,selectors:[["app-export"]],inputs:{query:"query"},decls:4,vars:4,consts:[["method","post","name","download","ngNoForm","","target","_blank",1,"download",3,"action"],["type","hidden","name","query",3,"value"],["type","hidden","name","headers",3,"value"],["type","submit",3,"matTooltip"]],template:function(n,i){1&n&&(Rt(0,"form",0),Hi(1,"input",1)(2,"input",2)(3,"button",3),kt()),2&n&&(Ut("action",i.downloadUrl(),Fp),xt(1),Ut("value",i.downloadQuery()),xt(1),Ut("value",i.headers),xt(1),Ut("matTooltip","\u05d9\u05d9\u05e6\u05d5\u05d0 \u05e4\u05e8\u05d8\u05d9 \u05d4\u05e2\u05e6\u05d9\u05dd \u05d4\u05de\u05d5\u05e4\u05d9\u05e2\u05d9\u05dd \u05d1\u05ea\u05e6\u05d5\u05d2\u05ea \u05de\u05e4\u05d4 \u05d6\u05d5 \u05dc\u05e7\u05d5\u05d1\u05e5 \u05d0\u05e7\u05e1\u05dc (\u05e2\u05d3 5,000 \u05e2\u05e6\u05d9\u05dd)"))},dependencies:[Wb],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{pointer-events:all;width:48px;height:48px;border-radius:24px;background-color:#64b883;cursor:pointer;border:none;background-repeat:no-repeat;background-position:center;background-size:contain;background-image:url(icon-download.679423e0aa2a21d5.svg);background-size:24px}[_nghost-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#638473;box-shadow:0 4px 8px #0000004d;transform:translateY(-2px)}']}),e})();var L0;function Hge(e,t){if(1&e){const n=Kp();Rt(0,"div",13)(1,"input",14),xs("change",function(r){Rs(n);const s=Rn().$implicit;return Pa(Rn().updateCheck(s.id,r.target))}),kt(),Rt(2,"label",15),In(3),kt()()}if(2&e){const n=Rn().$implicit,i=Rn();xt(1),Ut("id",n.id)("checked",i._checked[n.id]),xt(1),Ut("for",n.id),xt(1),Ar(n.label)}}function Gge(e,t){if(1&e&&(Rt(0,"option",19),In(1),kt()),2&e){const n=t.$implicit,i=Rn(2).$implicit,r=Rn();Ut("value",n.value)("selected",n.value===r._selected[i.id]),xt(1),Ar(n.label)}}function qge(e,t){if(1&e){const n=Kp();Rt(0,"div",16)(1,"label",15),In(2),kt(),Rt(3,"select",17),xs("change",function(r){Rs(n);const s=Rn().$implicit;return Pa(Rn().selectValue(s.id,r))}),jn(4,Gge,2,3,"option",18),kt()()}if(2&e){const n=Rn().$implicit;xt(1),Ut("for",n.id),xt(1),Ar(n.label),xt(1),Ut("id",n.id),xt(1),Ut("ngForOf",n.options)}}function Wge(e,t){if(1&e&&(Rt(0,"option",23),In(1),kt()),2&e){const n=Rn(2).$implicit;xt(1),Ar(n.placeholder)}}function Zge(e,t){if(1&e&&(Rt(0,"option",23),In(1),kt()),2&e){const n=Rn(2).$implicit,i=Rn();xt(1),Md("",i._selected[n.id].length," \u05e0\u05d1\u05d7\u05e8(\u05d5)")}}function Xge(e,t){if(1&e&&(Rt(0,"option",25)(1,"strong"),In(2),kt()()),2&e){const n=Rn().$implicit;Ut("value",n.value),xt(2),Md("- ",n.label,"")}}function Yge(e,t){if(1&e&&(Af(0),jn(1,Xge,3,2,"option",24),Pf()),2&e){const n=t.$implicit,i=Rn(2).$implicit,r=Rn();xt(1),Ut("ngIf",r._selected[i.id]&&r._selected[i.id].includes(n.value))}}function Kge(e,t){1&e&&(Rt(0,"option",26),In(1,"---"),kt())}function Qge(e,t){if(1&e&&(Rt(0,"option",25),In(1),kt()),2&e){const n=Rn().$implicit;Ut("value",n.value),xt(1),Md("+ ",n.label,"")}}function Jge(e,t){if(1&e&&(Af(0),jn(1,Qge,2,2,"option",24),Pf()),2&e){const n=t.$implicit,i=Rn(2).$implicit,r=Rn();xt(1),Ut("ngIf",!r._selected[i.id]||!r._selected[i.id].includes(n.value))}}function e_e(e,t){if(1&e){const n=Kp();Rt(0,"div",16)(1,"label",15),In(2),kt(),Rt(3,"select",17),xs("change",function(r){Rs(n);const s=Rn().$implicit;return Pa(Rn().toggleValue(s.id,r))}),jn(4,Wge,2,1,"option",20),jn(5,Zge,2,1,"option",20),jn(6,Yge,2,1,"ng-container",21),jn(7,Kge,2,0,"option",22),jn(8,Jge,2,1,"ng-container",21),kt()()}if(2&e){const n=Rn().$implicit,i=Rn();xt(1),Ut("for",n.id),xt(1),Ar(n.label),xt(1),Ut("id",n.id),xt(1),Ut("ngIf",0===i._selected[n.id].length),xt(1),Ut("ngIf",i._selected[n.id].length>0),xt(1),Ut("ngForOf",n.options),xt(1),Ut("ngIf",i._selected[n.id]),xt(1),Ut("ngForOf",n.options)}}function t_e(e,t){if(1&e&&(Rt(0,"div",10),jn(1,Hge,4,4,"div",11),jn(2,qge,5,4,"div",12),jn(3,e_e,9,8,"div",12),kt()),2&e){const n=t.$implicit;xt(1),Ut("ngIf","check"===n.kind),xt(1),Ut("ngIf","select"===n.kind),xt(1),Ut("ngIf","multi-select"===n.kind)}}const n_e=function(){return[]},i_e=function(){return{}};function r_e(e,t){1&e&&(Rt(0,"div",27)(1,"a",28),In(2,"\u05e0\u05d9\u05e7\u05d5\u05d9 \u05d4\u05de\u05e1\u05e0\u05e0\u05d9\u05dd"),kt()()),2&e&&(xt(1),Ut("routerLink",Tu(2,n_e))("queryParams",Tu(3,i_e)))}function o_e(e,t){1&e&&Hi(0,"app-export",29),2&e&&Ut("query",Rn().downloadQuery||"")}const s_e=function(){return["/","munis"]},a_e=function(){return["/","stat-areas"]},l_e=function(){return["/","trees"]};let bk=((L0=class{constructor(t,n){this.stateSvc=t,this.router=n,this.controls=[],this.filters={},this._selected={},this._checked={},this._clear=!1,this.downloadQuery=null,this.stateSvc.state.pipe(zg(this)).subscribe(i=>{this.state=i})}set state(t){this.mode=0===t.mode.indexOf("tree")?"trees":0===t.mode.indexOf("muni")?"munis":0===t.mode.indexOf("stat-area")?"stat-areas":"none",this.controls=t.filterItems||[],this.filters=t.filters||{},this.controls.filter(n=>"select"===n.kind).forEach(n=>{this._selected[n.id]=this.filters[n.id]||n.options[0].value}),this.controls.filter(n=>"multi-select"===n.kind).forEach(n=>{this._selected[n.id]=this.filters[n.id]||[]}),this.controls.filter(n=>"check"===n.kind).forEach(n=>{this._checked[n.id]="0"!==this.filters[n.id]}),this.downloadQuery=t.downloadQuery,this._clear=t.clearFilters}updateCheck(t,n){if(!n)return;const r={};r[t]=n.checked?"1":"0",this.router.navigate([],{queryParams:r,replaceUrl:!0,queryParamsHandling:"merge"})}selectValue(t,n){const i=n.target.value;this._selected[t]=i;const r={};r[t]=i,this.router.navigate([],{queryParams:r,replaceUrl:!0,queryParamsHandling:"merge"})}toggleValue(t,n){const i=n.target.value;this._selected[t]=this._selected[t]||[],this._selected[t].indexOf(i)>=0?this._selected[t]=this._selected[t].filter(s=>s!==i):this._selected[t].push(i);const r={};r[t]=this._selected[t].join(";"),this.router.navigate([],{queryParams:r,replaceUrl:!0,queryParamsHandling:"merge"})}}).\u0275fac=function(t){return new(t||L0)(Nt(S1),Nt(ga))},L0.\u0275cmp=Ni({type:L0,selectors:[["app-filter"]],decls:15,vars:17,consts:[[1,"filter"],[1,"selector"],["queryParamsHandling","merge",1,"munis",3,"routerLink"],["queryParamsHandling","merge",1,"stat-areas",3,"routerLink"],["queryParamsHandling","merge",1,"trees",3,"routerLink"],[1,"controls"],["class","control",4,"ngFor","ngForOf"],[1,"last"],["class","clear",4,"ngIf"],[3,"query",4,"ngIf"],[1,"control"],["class","check",4,"ngIf"],["class","select",4,"ngIf"],[1,"check"],["type","checkbox",3,"id","checked","change"],[3,"for"],[1,"select"],[3,"id","change"],[3,"value","selected",4,"ngFor","ngForOf"],[3,"value","selected"],["disabled","","selected","","value","",4,"ngIf"],[4,"ngFor","ngForOf"],["disabled","","value","",4,"ngIf"],["disabled","","selected","","value",""],[3,"value",4,"ngIf"],[3,"value"],["disabled","","value",""],[1,"clear"],[3,"routerLink","queryParams"],[3,"query"]],template:function(t,n){1&t&&(Rt(0,"div",0)(1,"div",1),Hi(2,"span"),Rt(3,"a",2),In(4,"\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea"),kt(),Rt(5,"a",3),In(6,"\u05d0\u05d6\u05d5\u05e8\u05d9\u05dd"),kt(),Rt(7,"a",4),In(8,"\u05e2\u05e6\u05d9\u05dd"),kt()(),Rt(9,"div",5),jn(10,t_e,4,3,"div",6),kt(),Rt(11,"div",7),jn(12,r_e,3,4,"div",8),jn(13,o_e,1,1,"app-export",9),Hi(14,"app-share"),kt()()),2&t&&(xt(2),IR("selected "+n.mode),xt(1),kl("active","munis"===n.mode),Ut("routerLink",Tu(14,s_e)),xt(2),kl("active","stat-areas"===n.mode),Ut("routerLink",Tu(15,a_e)),xt(2),kl("active","trees"===n.mode),Ut("routerLink",Tu(16,l_e)),xt(3),Ut("ngForOf",n.controls),xt(2),Ut("ngIf",n._clear),xt(1),Ut("ngIf",!!n.downloadQuery))},dependencies:[Tg,dc,dm,jge,$ge],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.filter[_ngcontent-%COMP%]{width:100%;min-height:80px;padding:20px;display:flex;align-items:center;justify-content:flex-start;gap:20px;background:#F2F2F2;box-shadow:0 4px 8px #0000004d;z-index:2}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]{flex:0 0 auto;height:40px;border-radius:20px;border:1px solid #204E37;background:#fff;display:flex;flex-flow:row;align-items:center;position:relative;overflow:hidden}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{position:absolute;width:88px;height:32px;right:4px;border-radius:16px;background:#204E37;z-index:0;transition:right .2s ease-in-out;transition-property:right,opacity;opacity:0}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   .selected.munis[_ngcontent-%COMP%]{right:4px;opacity:1}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   .selected.stat-areas[_ngcontent-%COMP%]{right:100px;opacity:1}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   .selected.trees[_ngcontent-%COMP%]{right:196px;opacity:1}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;justify-content:center;width:96px;font-style:Normal;font-weight:400;font-size:20px;color:#383838;z-index:1;text-decoration:none}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus{text-decoration:underline}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;color:#fff}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%], .filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]:hover, .filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]:focus{text-decoration:none}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]{flex:1 1 auto;display:flex;flex-flow:row wrap;align-items:center;justify-content:flex-start;gap:18px 30px}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]{flex:0 0 auto}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:5px}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{-webkit-appearance:none;appearance:none;position:relative;width:18px;height:18px;border:2px solid #838383;border-radius:2px;vertical-align:-2px}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:before{content:"\\2714";position:absolute;font-size:13px;right:1px;top:-2px;visibility:hidden;color:#204e37;font-style:Normal;font-weight:400}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked{border-color:#204e37}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked:before{visibility:visible}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:0;color:#383838;font-style:Normal;font-weight:400;font-size:16px;line-height:24px;white-space:nowrap}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]{display:flex;flex-flow:column}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;line-height:16px;margin:-16px 0 0;color:#838383;white-space:nowrap}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border-radius:5px;border:1px solid #204E37;background:#fff;padding:4px 12px;color:#383838;font-style:Normal;font-weight:400;font-size:16px;line-height:24px}.filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]{flex:0 0 auto;margin-right:auto;display:flex;align-items:center;justify-content:flex-start;gap:12px}.filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{color:#838383;text-decoration:none}.filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited:hover, .filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus, .filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited:focus{color:#383838}']}),L0);bk=Ua([mx()],bk);var F0,c_e=Zs(357);const u_e=["map"];let xk=((F0=class{constructor(t,n,i,r){this.mapboxService=t,this.state=n,this.router=i,this.api=r,this.STYLE="mapbox://styles/treebase/clck61858001514mfunfann6j/draft",this.OWN_LAYERS=["cadaster-label","cadaster-border","stat-areas-label","stat-areas-border","stat-areas-fill","munis-label","munis-border","munis-fill","parcels-label","parcels-border","parcels-fill","roads-border","canopies","trees"],this.POLYGON_LAYERS=["drawn-polygon","drawn-polygon-border"],this.CLICKS=[["trees","trees","tree-id"],["munis-fill","munis","muni_code"],["stat-areas-fill","stat-areas","code"]],this.focus_=null,this.popupQ=new Yn,this.popup=null,this.popupLayers={}}ngAfterViewInit(){this.mapboxService.init.subscribe(()=>{this.initialize()})}initialize(){this.map=new R0.Map({container:this.mapEl.nativeElement,style:this.STYLE,minZoom:6.4,attributionControl:!1,bounds:[[34.578046,32.162327],[35.356111,31.690073]],maxBounds:[[30,27],[40,38]],preserveDrawingBuffer:!0}),this.map.addControl(new R0.AttributionControl,"top-right"),this.map.addControl(new R0.NavigationControl({showCompass:!1}),"top-left");const n=new c_e({defaultMode:"draw_polygon",controls:{polygon:!0,trash:!1,line_string:!1,point:!1,combine_features:!1,uncombine_features:!1}});this.map.addControl(n,"top-left"),n.trash(),this.map.dragRotate.disable(),this.map.touchZoomRotate.disableRotation(),this.map.touchPitch.disable(),this.map.on("load",()=>{this.CLICKS.forEach(([i,r,s])=>{this.map.on("click",i,u=>{const h=u.features;if(h&&h.length>0){const g=h[0];g.properties?.[s]&&this.router.navigate([r,g.properties[s]],{queryParamsHandling:"merge"})}})}),this.OWN_LAYERS.forEach(i=>{this.map.on("mousemove",i,r=>{r.defaultPrevented||(r.preventDefault(),r.features&&r.features.length>0&&(this.map.getCanvas().style.cursor="pointer",this.popupLayers[i]&&this.popupQ.next(Object.assign({},r.features[0],{lngLat:r.lngLat}))))})}),this.map.on("mousemove",i=>{i.defaultPrevented||(i.preventDefault(),this.map.getCanvas().style.cursor="",this.popupQ.next(null))}),this.popupQ.pipe(Q2(100),Vn()).subscribe(i=>{if(null!==this.popup&&(this.popup.remove(),this.popup=null),null!==i){const r=this.popupLayers[i.layer.id].map(s=>`<strong>${s.label}</strong>: ${s.content(i.properties)}`).join("<br/>");this.popup=new R0.Popup({closeButton:!1}).setLngLat(i.lngLat).setHTML(r).addTo(this.map)}}),this.map.addSource("drawn-polygon",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.state.state.pipe(zg(this)).subscribe(i=>{if(i.geo&&this.map.flyTo({center:i.geo.center,zoom:i.geo.zoom}),console.log("STATE",i,this.map.getStyle().layers),i.filters?.focus!==this.focus_){this.focus_=i.filters?.focus;let s=null;if(i.focus){const u=i.focus.boundsQuery();u&&this.api.query(u).subscribe(h=>{this.map.fitBounds(h[0].bounds)}),s=i.focus.polygonGeometry()}s?this.map.getSource("drawn-polygon").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:s,properties:{}}]}):this.map.getSource("drawn-polygon").setData({type:"FeatureCollection",features:[]})}const r=i.focus?.mapFilters()||{};this.map.getStyle().layers.forEach(s=>{if(this.ownLayer(s)){if(!i.isLayerVisible(s.id))return void this.map.setLayoutProperty(s.id,"visibility","none");this.map.setLayoutProperty(s.id,"visibility","visible");const u=i.getLayerConfig(s.id);console.log("OWN LAYER",s.id,u);const h=[];u?.filter&&h.push(u.filter),r[s.id]&&h.push(r[s.id]),console.log("FILTERS",r,u.filter,h.length,["all",...h]),this.map.setFilter(s.id,h.length>1?["all",...h]:1===h.length?h[0]:null),u?.paint&&Object.keys(u.paint).forEach(g=>{this.map.setPaintProperty(s.id,g,u.paint[g])}),u?.layout&&Object.keys(u.layout).forEach(g=>{this.map.setLayoutProperty(s.id,g,u.layout[g])})}}),this.popupLayers=i.popupLayers});for(const i of this.POLYGON_LAYERS){const r=this.map.getStyle().layers.find(s=>s.id===i+"-ref");this.map.addLayer({id:i,type:r.type,source:"drawn-polygon",paint:r.paint,layout:Object.assign(r.layout,{visibility:"visible"})},i+"-ref")}this.map.on("draw.create",i=>{const r=i.features[0];console.log("DRAW",r);const s=r.geometry.coordinates[0].map(u=>u.map(h=>h.toFixed(5)).join(",")).join(";");this.router.navigate(["/trees"],{queryParamsHandling:"merge",queryParams:{focus:`polygon:${s}`}}),n.deleteAll()}),this.map.on("draw.modechange",i=>{console.log("DRAW MODE",i.mode),"draw_polygon"===i.mode&&this.router.navigate(["/trees"],{queryParamsHandling:"preserve"})}),this.mapboxService.map=this.map})}ownLayer(t){return this.OWN_LAYERS.includes(t.id)}}).\u0275fac=function(t){return new(t||F0)(Nt(I7),Nt(S1),Nt(ga),Nt(XT))},F0.\u0275cmp=Ni({type:F0,selectors:[["app-map"]],viewQuery:function(t,n){if(1&t&&Eg(u_e,5),2&t){let i;Jp(i=em())&&(n.mapEl=i.first)}},decls:4,vars:0,consts:[[1,"map-container"],["aria-hidden","true","role","presentation",1,"map"],["map",""],[1,"map-popup-container",2,"display","none"]],template:function(t,n){1&t&&(Rt(0,"div",0),Hi(1,"div",1,2),kt(),Hi(3,"div",3))},styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%]   .map-container[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .map-container[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]{width:100%;height:100%}"]}),F0);xk=Ua([mx()],xk);const d_e=["*"];let h_e=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ni({type:e,selectors:[["app-layout"]],ngContentSelectors:d_e,decls:5,vars:0,consts:[[1,"content"]],template:function(n,i){1&n&&(Eb(),Hi(0,"app-header")(1,"app-filter"),Rt(2,"div",0),Hi(3,"app-map"),bg(4),kt())},dependencies:[Vge,bk,xk],styles:["[_nghost-%COMP%]{display:flex;flex-flow:column;height:100%;width:100%;align-items:stretch}[_nghost-%COMP%]   app-header[_ngcontent-%COMP%], [_nghost-%COMP%]   app-filter[_ngcontent-%COMP%]{flex:0 0 auto}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{flex:1 1 auto;position:relative;overflow:hidden;width:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%] >   *{position:absolute;width:100%;height:100%;top:0;left:0;z-index:1;pointer-events:none}[_nghost-%COMP%]   .content[_ngcontent-%COMP%] > app-map[_ngcontent-%COMP%]{z-index:0;pointer-events:all}"]}),e})();var N0;let wk=((N0=class{constructor(t,n,i){this.route=t,this.router=n,this.state=i,this.router.events.pipe(zg(this),hc(r=>r instanceof um),pi(r=>{const s=r,u=s.url.split("?")[0].split("/").filter(C=>C.length>0),h="?"+(s.url.split("?")[1]||""),g=new URLSearchParams(h);return{segments:u,params:Object.fromEntries(g.entries())}})).subscribe(({segments:r,params:s})=>{this.state.initFromUrl(r,s)})}}).\u0275fac=function(t){return new(t||N0)(Nt(Ng),Nt(ga),Nt(S1))},N0.\u0275cmp=Ni({type:N0,selectors:[["app-root"]],decls:2,vars:0,template:function(t,n){1&t&&(Rt(0,"app-layout"),Hi(1,"router-outlet"),kt())},dependencies:[ZI,h_e]}),N0);wk=Ua([mx()],wk);let f_e=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=pr({type:e,bootstrap:[wk]}),e.\u0275inj=Er({imports:[H5,Uge,Ame,VK,r3,cee]}),e})();TX().bootstrapModule(f_e).catch(e=>console.error(e))},574:function(Dm){Dm.exports=function(){"use strict";var gc,Zs,Ri;function Uu(m,pt){if(gc)if(Zs){var Xs="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+gc+")(sharedChunk); ("+Zs+")(sharedChunk); self.onerror = null;",ss={};gc(ss),Ri=pt(ss),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Ri.workerUrl=window.URL.createObjectURL(new Blob([Xs],{type:"text/javascript"})))}else Zs=pt;else gc=pt}return Uu(0,function(m){var pt=typeof self<"u"?self:{},Xs="2.15.0";let ss;const An={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ss){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ss=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch{ss=a}}return ss},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!An.API_URL)return null;try{const a=new URL(An.API_URL);return"api.mapbox.cn"===a.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===a.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Pn={supported:!1,testSupport:function(a){!_n&&hr&&(ti?Eo(a):di=a)}};let di,hr,_n=!1,ti=!1;function Eo(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,hr),a.isContextLost())return;Pn.supported=!0}catch{}a.deleteTexture(o),_n=!0}pt.document&&(hr=pt.document.createElement("img"),hr.onload=function(){di&&Eo(di),di=null,ti=!0},hr.onerror=function(){_n=!0,di=null},hr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ul="01";function fr(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var rr=Ho;function Ho(a,o,l,d){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(d-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=d}Ho.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,d=0;d<8;d++){var p=this.sampleCurveX(l)-a;if(Math.abs(p)<o)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=p/y}var b=0,E=1;for(l=a,d=0;d<20&&(p=this.sampleCurveX(l),!(Math.abs(p-a)<o));d++)a>p?b=l:E=l,l=.5*(E-b)+b;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var ul=fr(rr),dl=Ys;function Ys(a,o){this.x=a,this.y=o}Ys.prototype={clone:function(){return new Ys(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),d=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=d,this},_rotateAround:function(a,o){var l=Math.cos(a),d=Math.sin(a),p=o.y+d*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-d*(this.y-o.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ys.convert=function(a){return a instanceof Ys?a:Array.isArray(a)?new Ys(a[0],a[1]):a};var Gt=fr(dl);const Hd=Math.PI/180,Vl=180/Math.PI;function Nn(a){return a*Hd}function _o(a){return a*Vl}const Na=[[0,0],[1,0],[1,1],[0,1]];function Vu(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function za(a,o,l,d){const p=new ul(a,o,l,d);return function(y){return p.solve(y)}}const Ts=za(.25,.1,.25,1);function ni(a,o,l){return Math.min(l,Math.max(o,a))}function hl(a,o,l){return(l=ni((l-a)/(o-a),0,1))*l*(3-2*l)}function ii(a,o,l){const d=l-o,p=((a-o)%d+d)%d+o;return p===o?l:p}function Yr(a,o,l){if(!a.length)return l(null,[]);let d=a.length;const p=new Array(a.length);let y=null;a.forEach((b,E)=>{o(b,(T,D)=>{T&&(y=T),p[E]=D,0==--d&&l(y,p)})})}function Ba(a){const o=[];for(const l in a)o.push(a[l]);return o}function Ti(a,...o){for(const l of o)for(const d in l)a[d]=l[d];return a}let as=1;function Yn(){return as++}function io(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Kr(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function jl(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function hi(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function yn(a,o){return-1!==a.indexOf(o,a.length-o.length)}function fi(a,o,l){const d={};for(const p in a)d[p]=o.call(l||this,a[p],p,a);return d}function pi(a,o,l){const d={};for(const p in a)o.call(l||this,a[p],p,a)&&(d[p]=a[p]);return d}function Go(a){return Array.isArray(a)?a.map(Go):"object"==typeof a&&a?fi(a,Go):a}const fl={};function _r(a){fl[a]||(typeof console<"u"&&console.warn(a),fl[a]=!0)}function wi(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function Ua(a){let o=0;for(let l,d,p=0,y=a.length,b=y-1;p<y;b=p++)l=a[p],d=a[b],o+=(d.x-l.x)*(l.y+d.y);return o}function pl(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ks(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,p,y)=>{const b=p||y;return o[d]=!b||b.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let Ea=null;function ju(a){if(null==Ea){const o=a.navigator?a.navigator.userAgent:null;Ea=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Ea}function Gd(a){try{const o=pt[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}}function ml(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const Va="mapbox-tiles";let ls,Ds,$u=500,Qs=50;function $l(){try{return pt.caches}catch{}}function Ca(){$l()&&!ls&&(ls=pt.caches.open(Va))}function gl(a){const o=a.indexOf("?");if(o<0)return a;const d=function(p){const y=p.indexOf("?");return y>0?p.slice(y+1).split("&"):[]}(a).filter(p=>{const y=p.split("=");return"language"===y[0]||"worldview"===y[0]});return d.length?`${a.slice(0,o)}?${d.join("&")}`:a.slice(0,o)}let Hl=1/0;const Co={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Co);class _l extends Error{constructor(o,l,d){401===l&&Ve(d)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const _c=pl()?()=>self.worker&&self.worker.referrer:()=>("blob:"===pt.location.protocol?pt.parent:pt).location.href,Ss=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(_c())&&!/^\w+:/.test(l))){if(pt.fetch&&pt.Request&&pt.AbortController&&pt.Request.prototype.hasOwnProperty("signal"))return function(d,p){const y=new pt.AbortController,b=new pt.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:_c(),referrerPolicy:d.referrerPolicy,signal:y.signal});let E=!1,T=!1;const D=(R=b.url).indexOf("sku=")>0&&Ve(R);var R;"json"===d.type&&b.headers.set("Accept","application/json");const N=(j,H,X)=>{if(T)return;if(j&&"SecurityError"!==j.message&&_r(j.toString()),H&&X)return B(H);const ie=Date.now();pt.fetch(b).then(ce=>{if(ce.ok){const be=D?ce.clone():null;return B(ce,be,ie)}return p(new _l(ce.statusText,ce.status,d.url))}).catch(ce=>{"AbortError"!==ce.name&&p(new Error(`${ce.message} ${d.url}`))})},B=(j,H,X)=>{("arrayBuffer"===d.type?j.arrayBuffer():"json"===d.type?j.json():j.text()).then(ie=>{T||(H&&X&&function(ce,be,de){if(Ca(),!ls)return;const ve={status:be.status,statusText:be.statusText,headers:new pt.Headers};be.headers.forEach((Xe,Ge)=>ve.headers.set(Ge,Xe));const xe=Ks(be.headers.get("Cache-Control")||"");if(xe["no-store"])return;xe["max-age"]&&ve.headers.set("Expires",new Date(de+1e3*xe["max-age"]).toUTCString());const Ce=ve.headers.get("Expires");Ce&&(new Date(Ce).getTime()-de<42e4||function(Xe,Ge){if(void 0===Ds)try{new Response(new ReadableStream),Ds=!0}catch{Ds=!1}Ds?Ge(Xe.body):Xe.blob().then(Ge)}(be,Xe=>{const Ge=new pt.Response(Xe,ve);Ca(),ls&&ls.then(st=>st.put(gl(ce.url),Ge)).catch(st=>_r(st.message))}))}(b,H,X),E=!0,p(null,ie,j.headers.get("Cache-Control"),j.headers.get("Expires")))}).catch(ie=>{T||p(new Error(ie.message))})};return D?function(j,H){if(Ca(),!ls)return H(null);const X=gl(j.url);ls.then(ie=>{ie.match(X).then(ce=>{const be=function(de){if(!de)return!1;const ve=new Date(de.headers.get("Expires")||0),xe=Ks(de.headers.get("Cache-Control")||"");return ve>Date.now()&&!xe["no-cache"]}(ce);ie.delete(X),be&&ie.put(X,ce.clone()),H(null,ce,be)}).catch(H)}).catch(H)}(b,N):N(null,null),{cancel:()=>{T=!0,E||y.abort()}}}(a,o);if(pl()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(d,p){const y=new pt.XMLHttpRequest;y.open(d.method||"GET",d.url,!0),"arrayBuffer"===d.type&&(y.responseType="arraybuffer");for(const b in d.headers)y.setRequestHeader(b,d.headers[b]);return"json"===d.type&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials="include"===d.credentials,y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||0===y.status)&&null!==y.response){let b=y.response;if("json"===d.type)try{b=JSON.parse(y.response)}catch(E){return p(E)}p(null,b,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else p(new _l(y.statusText,y.status,d.url))},y.send(d.body),{cancel:()=>y.abort()}}(a,o)},eu=function(a,o){return Ss(Ti(a,{type:"arrayBuffer"}),o)};function tu(a){const o=pt.document.createElement("a");return o.href=a,o.protocol===pt.document.location.protocol&&o.host===pt.document.location.host}const ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let K,ee;K=[],ee=0;const me=function(a,o){if(Pn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),ee>=An.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return K.push(y),y}ee++;let l=!1;const d=()=>{if(!l)for(l=!0,ee--;K.length&&ee<An.MAX_PARALLEL_IMAGE_REQUESTS;){const y=K.shift(),{requestParameters:b,callback:E,cancelled:T}=y;T||(y.cancel=me(b,E).cancel)}},p=eu(a,(y,b,E,T)=>{d(),y?o(y):b&&(pt.createImageBitmap?function(D,R){const N=new pt.Blob([new Uint8Array(D)],{type:"image/png"});pt.createImageBitmap(N).then(B=>{R(null,B)}).catch(B=>{R(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(D,R)=>o(D,R,E,T)):function(D,R){const N=new pt.Image,B=pt.URL;N.onload=()=>{R(null,N),B.revokeObjectURL(N.src),N.onload=null,pt.requestAnimationFrame(()=>{N.src=ye})},N.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new pt.Blob([new Uint8Array(D)],{type:"image/png"});N.src=D.byteLength?B.createObjectURL(j):ye}(b,(D,R)=>o(D,R,E,T)))});return{cancel:()=>{p.cancel(),d()}}},Me="NO_ACCESS_TOKEN";function Pe(a){return 0===a.indexOf("mapbox:")}function Ve(a){return An.API_URL_REGEX.test(a)}function Ue(a){return An.API_CDN_URL_REGEX.test(a)}function Oe(a){return An.API_STYLE_REGEX.test(a)&&!Ke(a)}function Ke(a){return An.API_SPRITE_REGEX.test(a)}const St=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Vt(a){const o=a.match(St);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Tt(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}const $n="mapbox.eventData";function Fn(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(pt.atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Un{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const l=Fn(An.ACCESS_TOKEN);let d="";return d=l&&l.u?pt.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(p,y)=>String.fromCharCode(+("0x"+y)))):An.ACCESS_TOKEN||"",o?`${$n}.${o}:${d}`:`${$n}:${d}`}fetchEventData(){const o=Gd("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(o)try{const p=pt.localStorage.getItem(l);p&&(this.eventData=JSON.parse(p));const y=pt.localStorage.getItem(d);y&&(this.anonId=y)}catch{_r("Unable to read from LocalStorage")}}saveEventData(){const o=Gd("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(o)try{pt.localStorage.setItem(d,this.anonId),Object.keys(this.eventData).length>=1&&pt.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{_r("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,d,p){if(!An.EVENTS_URL)return;const y=Vt(An.EVENTS_URL);y.params.push(`access_token=${p||An.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(o).toISOString()},E=l?Ti(b,l):b,T={url:Tt(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};var R;this.pendingRequest=(R=D=>{this.pendingRequest=null,d(D),this.saveEventData(),this.processRequests(p)},Ss(Ti(T,{method:"POST"}),R))}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}const Kn=new class extends Un{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){An.EVENTS_URL&&An.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>Pe(l)||Ve(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Fn(An.ACCESS_TOKEN),l=o?o.u:An.ACCESS_TOKEN;let d=l!==this.eventData.tokenU;jl(this.anonId)||(this.anonId=io(),d=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),b=new Date(p),E=(p-this.eventData.lastSuccess)/864e5;d=d||E>=1||E<-1||y.getDate()!==b.getDate()}else d=!0;d?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Xs,skuId:Ul,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=p,this.eventData.tokenU=l)},a):this.processRequests()}},ri=Kn.postTurnstileEvent.bind(Kn),Wi=new class extends Un{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,d){this.skuToken=o,this.errorCb=d,An.EVENTS_URL&&(l||An.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Me)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),jl(this.anonId)||(this.anonId=io()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Xs,skuId:Ul,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):o&&(this.success[o]=!0)},a))}},bi=Wi.postMapLoadEvent.bind(Wi),co=new class extends Un{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){An.EVENTS_URL&&(a||An.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:l}=this.queue.shift(),d=function(p){const y=pt.performance.getEntriesByType("resource"),b=pt.performance.getEntriesByType("mark"),E=function(B){const j={};if(B)for(const H in B)if("other"!==H)for(const X of B[H]){const ie=`${H}ResolveRangeMin`,ce=`${H}ResolveRangeMax`,be=`${H}RequestCount`,de=`${H}RequestCachedCount`;j[ie]=Math.min(j[ie]||1/0,X.startTime),j[ce]=Math.max(j[ce]||-1/0,X.responseEnd);const ve=xe=>{void 0===j[xe]&&(j[xe]=0),++j[xe]};void 0!==X.transferSize&&0===X.transferSize&&ve(de),ve(be)}return j}(function(B,j){const H={};if(B)for(const X of B){const ie=j(X);void 0===H[ie]&&(H[ie]=[]),H[ie].push(X)}return H}(y,$a)),T=pt.devicePixelRatio,D=pt.navigator.connection||pt.navigator.mozConnection||pt.navigator.webkitConnection,R={counters:[],metadata:[],attributes:[]},N=(B,j,H)=>{null!=H&&B.push({name:j,value:H.toString()})};for(const B in E)N(R.counters,B,E[B]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(N(R.counters,"interactionRangeMin",p.interactionRange[0]),N(R.counters,"interactionRangeMax",p.interactionRange[1])),b)for(const B of Object.keys(nu)){const j=nu[B],H=b.find(X=>X.name===j);H&&N(R.counters,j,H.startTime)}return N(R.counters,"visibilityHidden",p.visibilityHidden),N(R.attributes,"style",function(B){if(B)for(const j of B){const H=j.name.split("?")[0];if(Oe(H)){const X=H.split("/").slice(-2);if(2===X.length)return`mapbox://styles/${X[0]}/${X[1]}`}}}(y)),N(R.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),N(R.attributes,"fogEnabled",p.fogEnabled?"true":"false"),N(R.attributes,"projection",p.projection),N(R.attributes,"zoom",p.zoom),N(R.metadata,"devicePixelRatio",T),N(R.metadata,"connectionEffectiveType",D?D.effectiveType:void 0),N(R.metadata,"navigatorUserAgent",pt.navigator.userAgent),N(R.metadata,"screenWidth",pt.screen.width),N(R.metadata,"screenHeight",pt.screen.height),N(R.metadata,"windowWidth",pt.innerWidth),N(R.metadata,"windowHeight",pt.innerHeight),N(R.metadata,"mapWidth",p.width/T),N(R.metadata,"mapHeight",p.height/T),N(R.metadata,"webglRenderer",p.renderer),N(R.metadata,"webglVendor",p.vendor),N(R.metadata,"sdkVersion",Xs),N(R.metadata,"sdkIdentifier","mapbox-gl-js"),R}(l);for(const p of d.metadata);for(const p of d.counters);for(const p of d.attributes);this.postEvent(o,d,()=>{},a)}},Nr=co.postPerformanceEvent.bind(co),ja=new class extends Un{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,d){if(!An.API_URL||!An.SESSION_PATH)return;const p=Vt(An.API_URL+An.SESSION_PATH);p.params.push(`sku=${o||""}`),p.params.push(`access_token=${d||An.ACCESS_TOKEN||""}`);const y={url:Tt(p),headers:{"Content-Type":"text/plain"}};var E;this.pendingRequest=(E=b=>{this.pendingRequest=null,l(b),this.saveEventData(),this.processRequests(d)},Ss(Ti(y,{method:"GET"}),E))}getSessionAPI(a,o,l,d){this.skuToken=o,this.errorCb=d,An.SESSION_PATH&&An.API_URL&&(l||An.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Me)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,d=>{d?this.errorCb(d):o&&(this.success[o]=!0)},a)}},yo=ja.getSessionAPI.bind(ja),er=new Set,nu={create:"create",load:"load",fullLoad:"fullLoad"},Im={mark(a){pt.performance.mark(a)},measure(a,o,l){pt.performance.measure(a,o,l)}};function $a(a){const o=a.name.split("?")[0];return Ue(o)&&o.includes("mapbox-gl.js")?"javascript":Ue(o)&&o.includes("mapbox-gl.css")?"css":An.API_FONTS_REGEX.test(o)?"fontRange":Ke(o)?"sprite":Oe(o)?"style":An.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const Di=pt.performance;function zr(a){const o=a?a.url.toString():void 0;return Di.getEntriesByName(o)}let Js,Is,iu,ea;const ta={now:()=>void 0!==iu?iu:pt.performance.now(),setNow(a){iu=a},restoreNow(){iu=void 0},frame(a){const o=pt.requestAnimationFrame(a);return{cancel:()=>pt.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:l,height:d}=a;ea||(ea=pt.document.createElement("canvas"));const p=ea.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>ea.width||d>ea.height)&&(ea.width=l,ea.height=d),p.clearRect(-o,-o,l+2*o,d+2*o),p.drawImage(a,0,0,l,d),p.getImageData(-o,-o,l+2*o,d+2*o)},resolveURL:a=>(Js||(Js=pt.document.createElement("a")),Js.href=a,Js.href),get devicePixelRatio(){return pt.devicePixelRatio},get prefersReducedMotion(){return!!pt.matchMedia&&(null==Is&&(Is=pt.matchMedia("(prefers-reduced-motion: reduce)")),Is.matches)}};function Br(a,o,l){l[a]&&-1!==l[a].indexOf(o)||(l[a]=l[a]||[],l[a].push(o))}function Hu(a,o,l){if(l&&l[a]){const d=l[a].indexOf(o);-1!==d&&l[a].splice(d,1)}}class na{constructor(o,l={}){Ti(this,l),this.type=o}}class Oo extends na{constructor(o,l={}){super("error",Ti({error:o},l))}}class qo{on(o,l){return this._listeners=this._listeners||{},Br(o,l,this._listeners),this}off(o,l){return Hu(o,l,this._listeners),Hu(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Br(o,l,this._oneTimeListeners),this):new Promise(d=>this.once(o,d))}fire(o,l){"string"==typeof o&&(o=new na(o,l||{}));const d=o.type;if(this.listens(d)){o.target=this;const p=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const E of p)E.call(this,o);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const E of y)Hu(d,E,this._oneTimeListeners),E.call(this,o);const b=this._eventedParent;b&&(Ti(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(o))}else o instanceof Oo&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var nt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Wo(a,...o){for(const l of o)for(const d in l)a[d]=l[d];return a}function yr(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function uo(a){if(Array.isArray(a))return a.map(uo);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const l in a)o[l]=uo(a[l]);return o}return yr(a)}class op extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}var Ma=op;class jh{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[d,p]of l)this.bindings[d]=p}concat(o){return new jh(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var $h=jh;const or={kind:"null"},Kt={kind:"number"},qt={kind:"string"},oi={kind:"boolean"},Zo={kind:"color"},qr={kind:"object"},Vn={kind:"value"},P={kind:"collator"},z={kind:"formatted"},te={kind:"resolvedImage"};function pe(a,o){return{kind:"array",itemType:a,N:o}}function Ee(a){if("array"===a.kind){const o=Ee(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const ke=[or,Kt,qt,oi,Zo,z,qr,pe(Vn),te];function ze(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!ze(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const l of ke)if(!ze(l,o))return null}return`Expected ${Ee(a)} but found ${Ee(o)} instead.`}function tt(a,o){return o.some(l=>l.kind===a.kind)}function zt(a,o){return o.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var rn,on={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Wt(a){return(a=Math.round(a))<0?0:a>255?255:a}function $e(a){return Wt("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function sr(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function $t(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{rn={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in on)return on[l].slice();if("#"===l[0])return 4===l.length?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===l.length&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var d=l.indexOf("("),p=l.indexOf(")");if(-1!==d&&p+1===l.length){var y=l.substr(0,d),b=l.substr(d+1,p-(d+1)).split(","),E=1;switch(y){case"rgba":if(4!==b.length)return null;E=sr(b.pop());case"rgb":return 3!==b.length?null:[$e(b[0]),$e(b[1]),$e(b[2]),E];case"hsla":if(4!==b.length)return null;E=sr(b.pop());case"hsl":if(3!==b.length)return null;var T=(parseFloat(b[0])%360+360)%360/360,D=sr(b[1]),R=sr(b[2]),N=R<=.5?R*(D+1):R+D-R*D,B=2*R-N;return[Wt(255*$t(B,N,T+1/3)),Wt(255*$t(B,N,T)),Wt(255*$t(B,N,T-1/3)),E];default:return null}}return null}}catch{}class Cn{constructor(o,l,d,p=1){this.r=o,this.g=l,this.b=d,this.a=p}static parse(o){if(!o)return;if(o instanceof Cn)return o;if("string"!=typeof o)return;const l=rn(o);return l?new Cn(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,d,p]=this.toArray();return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(d)},${p})`}toArray(){const{r:o,g:l,b:d,a:p}=this;return 0===p?[0,0,0,0]:[255*o/p,255*l/p,255*d/p,p]}toArray01(){const{r:o,g:l,b:d,a:p}=this;return 0===p?[0,0,0,0]:[o/p,l/p,d/p,p]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:d,a:p}=this;return[o,l,d,p]}}Cn.black=new Cn(0,0,0,1),Cn.white=new Cn(1,1,1,1),Cn.transparent=new Cn(0,0,0,0),Cn.red=new Cn(1,0,0,1),Cn.blue=new Cn(0,0,1,1);var lt=Cn;class xn{constructor(o,l,d){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zi{constructor(o,l,d,p,y){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=d,this.fontStack=p,this.textColor=y}}class Li{constructor(o){this.sections=o}static fromString(o){return new Li([new Zi(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof Li?o:Li.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.name]);continue}o.push(l.text);const d={};l.fontStack&&(d["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(d["font-scale"]=l.scale),l.textColor&&(d["text-color"]=["rgba"].concat(l.textColor.toArray())),o.push(d)}return o}}class si{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new si({name:o,available:!1}):null}serialize(){return["image",this.name]}}function Hh(a,o,l,d){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===d||"number"==typeof d&&d>=0&&d<=1?null:`Invalid rgba value [${[a,o,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof d?[a,o,l,d]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gu(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof lt||a instanceof xn||a instanceof Li||a instanceof si)return!0;if(Array.isArray(a)){for(const o of a)if(!Gu(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!Gu(a[o]))return!1;return!0}return!1}function Qn(a){if(null===a)return or;if("string"==typeof a)return qt;if("boolean"==typeof a)return oi;if("number"==typeof a)return Kt;if(a instanceof lt)return Zo;if(a instanceof xn)return P;if(a instanceof Li)return z;if(a instanceof si)return te;if(Array.isArray(a)){const o=a.length;let l;for(const d of a){const p=Qn(d);if(l){if(l===p)continue;l=Vn;break}l=p}return pe(l||Vn,o)}return qr}function As(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof lt||a instanceof Li||a instanceof si?a.toString():JSON.stringify(a)}class sp{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Gu(o[1]))return l.error("invalid value");const d=o[1];let p=Qn(d);const y=l.expectedType;return"array"!==p.kind||0!==p.N||!y||"array"!==y.kind||"number"==typeof y.N&&0!==y.N||(p=y),new sp(p,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof lt?["rgba"].concat(this.value.toArray()):this.value instanceof Li?this.value.serialize():this.value}}var cs=sp,Mo=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const Gh={string:qt,number:Kt,boolean:oi,object:qr};class qd{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let d,p=1;const y=o[0];if("array"===y){let E,T;if(o.length>2){const D=o[1];if("string"!=typeof D||!(D in Gh)||"object"===D)return l.error('The item type argument of "array" must be one of string, number, boolean',1);E=Gh[D],p++}else E=Vn;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);T=o[2],p++}d=pe(E,T)}else d=Gh[y];const b=[];for(;p<o.length;p++){const E=l.parse(o[p],p,Vn);if(!E)return null;b.push(E)}return new qd(d,b)}evaluate(o){for(let l=0;l<this.args.length;l++){const d=this.args[l].evaluate(o);if(!ze(this.type,Qn(d)))return d;if(l===this.args.length-1)throw new Mo(`Expected value to be of type ${Ee(this.type)}, but found ${Ee(Qn(d))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const d=o.itemType;if("string"===d.kind||"number"===d.kind||"boolean"===d.kind){l.push(d.kind);const p=o.N;("number"==typeof p||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(d=>d.serialize()))}}var Ha=qd;class yl{constructor(o){this.type=z,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const d=o[1];if(!Array.isArray(d)&&"object"==typeof d)return l.error("First argument must be an image or text section.");const p=[];let y=!1;for(let b=1;b<=o.length-1;++b){const E=o[b];if(y&&"object"==typeof E&&!Array.isArray(E)){y=!1;let T=null;if(E["font-scale"]&&(T=l.parse(E["font-scale"],1,Kt),!T))return null;let D=null;if(E["text-font"]&&(D=l.parse(E["text-font"],1,pe(qt)),!D))return null;let R=null;if(E["text-color"]&&(R=l.parse(E["text-color"],1,Zo),!R))return null;const N=p[p.length-1];N.scale=T,N.font=D,N.textColor=R}else{const T=l.parse(o[b],1,Vn);if(!T)return null;const D=T.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:T,scale:null,font:null,textColor:null})}}return new yl(p)}evaluate(o){return new Li(this.sections.map(l=>{const d=l.content.evaluate(o);return Qn(d)===te?new Zi("",d,null,null,null):new Zi(As(d),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const d={};l.scale&&(d["font-scale"]=l.scale.serialize()),l.font&&(d["text-font"]=l.font.serialize()),l.textColor&&(d["text-color"]=l.textColor.serialize()),o.push(d)}return o}}class Wd{constructor(o){this.type=te,this.input=o}static parse(o,l){if(2!==o.length)return l.error("Expected two arguments.");const d=l.parse(o[1],1,qt);return d?new Wd(d):l.error("No image name provided.")}evaluate(o){const l=this.input.evaluate(o),d=si.fromString(l);return d&&o.availableImages&&(d.available=o.availableImages.indexOf(l)>-1),d}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ia={"to-boolean":oi,"to-color":Zo,"to-number":Kt,"to-string":qt};class $i{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const d=o[0];if(("to-boolean"===d||"to-string"===d)&&2!==o.length)return l.error("Expected one argument.");const p=ia[d],y=[];for(let b=1;b<o.length;b++){const E=l.parse(o[b],b,Vn);if(!E)return null;y.push(E)}return new $i(p,y)}evaluate(o){if("boolean"===this.type.kind)return!!this.args[0].evaluate(o);if("color"===this.type.kind){let l,d;for(const p of this.args){if(l=p.evaluate(o),d=null,l instanceof lt)return l;if("string"==typeof l){const y=o.parseColor(l);if(y)return y}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Hh(l[0],l[1],l[2],l[3]),!d))return new lt(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Mo(d||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const d of this.args){if(l=d.evaluate(o),null===l)return 0;const p=Number(l);if(!isNaN(p))return p}throw new Mo(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Li.fromString(As(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?si.fromString(As(this.args[0].evaluate(o))):As(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new yl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Wd(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}var qu=$i;const Ga=["Unknown","Point","LineString","Polygon"];var qh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ga[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:l,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*o-a[0])+this.featureDistanceData.bearing[1]*(d*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=lt.parse(a)),o}};class Zt{constructor(o,l,d,p){this.name=o,this.type=l,this._evaluate=d,this.args=p}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const d=o[0],p=Zt.definitions[d];if(!p)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,E=b.filter(([D])=>!Array.isArray(D)||D.length===o.length-1);let T=null;for(const[D,R]of E){T=new Wh(l.registry,l.path,null,l.scope);const N=[];let B=!1;for(let j=1;j<o.length;j++){const H=o[j],X=Array.isArray(D)?D[j-1]:D.type,ie=T.parse(H,1+N.length,X);if(!ie){B=!0;break}N.push(ie)}if(!B)if(Array.isArray(D)&&D.length!==N.length)T.error(`Expected ${D.length} arguments, but found ${N.length} instead.`);else{for(let j=0;j<N.length;j++){const H=Array.isArray(D)?D[j]:D.type,X=N[j];T.concat(j+1).checkSubtype(H,X.type)}if(0===T.errors.length)return new Zt(d,y,R,N)}}if(1===E.length)l.errors.push(...T.errors);else{const D=(E.length?E:b).map(([N])=>{return B=N,Array.isArray(B)?`(${B.map(Ee).join(", ")})`:`(${Ee(B.type)}...)`;var B}).join(" | "),R=[];for(let N=1;N<o.length;N++){const B=l.parse(o[N],1+R.length);if(!B)return null;R.push(Ee(B.type))}l.error(`Expected arguments of type ${D}, but found (${R.join(", ")}) instead.`)}return null}static register(o,l){Zt.definitions=l;for(const d in l)o[d]=Zt}}var Gl=Zt;class Er{constructor(o,l,d){this.type=P,this.locale=d,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const d=o[1];if("object"!=typeof d||Array.isArray(d))return l.error("Collator options argument must be an object.");const p=l.parse(void 0!==d["case-sensitive"]&&d["case-sensitive"],1,oi);if(!p)return null;const y=l.parse(void 0!==d["diacritic-sensitive"]&&d["diacritic-sensitive"],1,oi);if(!y)return null;let b=null;return d.locale&&(b=l.parse(d.locale,1,qt),!b)?null:new Er(p,y,b)}evaluate(o){return new xn(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const Xo=8192;function ru(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function ql(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function us(a,o){const l=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,o.z);return[Math.round(l*p*Xo),Math.round(d*p*Xo)]}function Zd(a,o,l){const d=a[0]-o[0],p=a[1]-o[1],y=a[0]-l[0],b=a[1]-l[1];return d*b-y*p==0&&d*y<=0&&p*b<=0}function Wl(a,o){let l=!1;for(let b=0,E=o.length;b<E;b++){const T=o[b];for(let D=0,R=T.length;D<R-1;D++){if(Zd(a,T[D],T[D+1]))return!1;(p=T[D])[1]>(d=a)[1]!=(y=T[D+1])[1]>d[1]&&d[0]<(y[0]-p[0])*(d[1]-p[1])/(y[1]-p[1])+p[0]&&(l=!l)}}var d,p,y;return l}function Wu(a,o){for(let l=0;l<o.length;l++)if(Wl(a,o[l]))return!0;return!1}function Zu(a,o,l,d){const p=d[0]-l[0],y=d[1]-l[1],b=(a[0]-l[0])*y-p*(a[1]-l[1]),E=(o[0]-l[0])*y-p*(o[1]-l[1]);return b>0&&E<0||b<0&&E>0}function vl(a,o,l){for(const D of l)for(let R=0;R<D.length-1;++R)if((E=[(b=D[R+1])[0]-(y=D[R])[0],b[1]-y[1]])[0]*(T=[(p=o)[0]-(d=a)[0],p[1]-d[1]])[1]-E[1]*T[0]!=0&&Zu(d,p,y,b)&&Zu(y,b,d,p))return!0;var d,p,y,b,E,T;return!1}function en(a,o){for(let l=0;l<a.length;++l)if(!Wl(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(vl(a[l],a[l+1],o))return!1;return!0}function Xd(a,o){for(let l=0;l<o.length;l++)if(en(a,o[l]))return!0;return!1}function Yd(a,o,l){const d=[];for(let p=0;p<a.length;p++){const y=[];for(let b=0;b<a[p].length;b++){const E=us(a[p][b],l);ru(o,E),y.push(E)}d.push(y)}return d}function Qr(a,o,l){const d=[];for(let p=0;p<a.length;p++){const y=Yd(a[p],o,l);d.push(y)}return d}function Xu(a,o,l,d){if(a[0]<l[0]||a[0]>l[2]){const p=.5*d;let y=a[0]-l[0]>p?-d:l[0]-a[0]>p?d:0;0===y&&(y=a[0]-l[2]>p?-d:l[2]-a[0]>p?d:0),a[0]+=y}ru(o,a)}function Am(a,o,l,d){const p=Math.pow(2,d.z)*Xo,y=[d.x*Xo,d.y*Xo],b=[];if(!a)return b;for(const E of a)for(const T of E){const D=[T.x+y[0],T.y+y[1]];Xu(D,o,l,p),b.push(D)}return b}function ar(a,o,l,d){const p=Math.pow(2,d.z)*Xo,y=[d.x*Xo,d.y*Xo],b=[];if(!a)return b;for(const T of a){const D=[];for(const R of T){const N=[R.x+y[0],R.y+y[1]];ru(o,N),D.push(N)}b.push(D)}if(o[2]-o[0]<=p/2){(E=o)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const T of b)for(const D of T)Xu(D,o,l,p)}var E;return b}class yc{constructor(o,l){this.type=oi,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Gu(o[1])){const d=o[1];if("FeatureCollection"===d.type)for(let p=0;p<d.features.length;++p){const y=d.features[p].geometry.type;if("Polygon"===y||"MultiPolygon"===y)return new yc(d,d.features[p].geometry)}else if("Feature"===d.type){const p=d.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new yc(d,d.geometry)}else if("Polygon"===d.type||"MultiPolygon"===d.type)return new yc(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,d){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===d.type){const E=Yd(d.coordinates,y,b),T=Am(l.geometry(),p,y,b);if(!ql(p,y))return!1;for(const D of T)if(!Wl(D,E))return!1}if("MultiPolygon"===d.type){const E=Qr(d.coordinates,y,b),T=Am(l.geometry(),p,y,b);if(!ql(p,y))return!1;for(const D of T)if(!Wu(D,E))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,d){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===d.type){const E=Yd(d.coordinates,y,b),T=ar(l.geometry(),p,y,b);if(!ql(p,y))return!1;for(const D of T)if(!en(D,E))return!1}if("MultiPolygon"===d.type){const E=Qr(d.coordinates,y,b),T=ar(l.geometry(),p,y,b);if(!ql(p,y))return!1;for(const D of T)if(!Xd(D,E))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var vc=yc;function bc(a){if(a instanceof Gl&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof vc)return!1;let o=!0;return a.eachChild(l=>{o&&!bc(l)&&(o=!1)}),o}function Yo(a){if(a instanceof Gl&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(l=>{o&&!Yo(l)&&(o=!1)}),o}function Ta(a,o){if(a instanceof Gl&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(d=>{l&&!Ta(d,o)&&(l=!1)}),l}class Da{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const d=o[1];return l.scope.has(d)?new Da(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ap=Da;class Yu{constructor(o,l=[],d,p=new $h,y=[]){this.registry=o,this.path=l,this.key=l.map(b=>`[${b}]`).join(""),this.scope=p,this.errors=y,this.expectedType=d}parse(o,l,d,p,y={}){return l?this.concat(l,d,p)._parse(o,y):this._parse(o,y)}_parse(o,l){function d(p,y,b){return"assert"===b?new Ha(y,[p]):"coerce"===b?new qu(y,[p]):p}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=o[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let b=y.parse(o,this);if(!b)return null;if(this.expectedType){const E=this.expectedType,T=b.type;if("string"!==E.kind&&"number"!==E.kind&&"boolean"!==E.kind&&"object"!==E.kind&&"array"!==E.kind||"value"!==T.kind)if("color"!==E.kind&&"formatted"!==E.kind&&"resolvedImage"!==E.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(E,T))return null}else b=d(b,E,l.typeAnnotation||"coerce");else b=d(b,E,l.typeAnnotation||"assert")}if(!(b instanceof cs)&&"resolvedImage"!==b.type.kind&&Kd(b)){const E=new qh;try{b=new cs(b.type,b.evaluate(E))}catch(T){return this.error(T.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,d){const p="number"==typeof o?this.path.concat(o):this.path,y=d?this.scope.concat(d):this.scope;return new Yu(this.registry,p,l||null,y,this.errors)}error(o,...l){const d=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ma(d,o))}checkSubtype(o,l){const d=ze(o,l);return d&&this.error(d),d}}var Wh=Yu;function Kd(a){if(a instanceof ap)return Kd(a.boundExpression);if(a instanceof Gl&&"error"===a.name||a instanceof Er||a instanceof vc)return!1;const o=a instanceof qu||a instanceof Ha;let l=!0;return a.eachChild(d=>{l=o?l&&Kd(d):l&&d instanceof cs}),!!l&&bc(a)&&Ta(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function bl(a,o){const l=a.length-1;let d,p,y=0,b=l,E=0;for(;y<=b;)if(E=Math.floor((y+b)/2),d=a[E],p=a[E+1],d<=o){if(E===l||o<p)return E;y=E+1}else{if(!(d>o))throw new Mo("Input is not a number.");b=E-1}return 0}class Ku{constructor(o,l,d){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[p,y]of d)this.labels.push(p),this.outputs.push(y)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const d=l.parse(o[1],1,Kt);if(!d)return null;const p=[];let y=null;l.expectedType&&"value"!==l.expectedType.kind&&(y=l.expectedType);for(let b=1;b<o.length;b+=2){const E=1===b?-1/0:o[b],T=o[b+1],D=b,R=b+1;if("number"!=typeof E)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=E)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const N=l.parse(T,R,y);if(!N)return null;y=y||N.type,p.push([E,N])}return new Ku(y,d,p)}evaluate(o){const l=this.labels,d=this.outputs;if(1===l.length)return d[0].evaluate(o);const p=this.input.evaluate(o);if(p<=l[0])return d[0].evaluate(o);const y=l.length;return p>=l[y-1]?d[y-1].evaluate(o):d[bl(l,p)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}var ra=Ku;function ai(a,o,l){return a*(1-l)+o*l}var et=Object.freeze({__proto__:null,array:function(a,o,l){return a.map((d,p)=>ai(d,o[p],l))},color:function(a,o,l){return new lt(ai(a.r,o.r,l),ai(a.g,o.g,l),ai(a.b,o.b,l),ai(a.a,o.a,l))},number:ai});const oa=4/29,wl=6/29,qa=3*wl*wl,Qu=wl*wl*wl,lp=Math.PI/180,cp=180/Math.PI;function Sa(a){return a>Qu?Math.pow(a,1/3):a/qa+oa}function sa(a){return a>wl?a*a*a:qa*(a-oa)}function To(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function ds(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Ei(a){const o=ds(a.r),l=ds(a.g),d=ds(a.b),p=Sa((.4124564*o+.3575761*l+.1804375*d)/.95047),y=Sa((.2126729*o+.7151522*l+.072175*d)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-Sa((.0193339*o+.119192*l+.9503041*d)/1.08883)),alpha:a.a}}function Wa(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,d=isNaN(a.b)?o:o-a.b/200;return o=1*sa(o),l=.95047*sa(l),d=1.08883*sa(d),new lt(To(3.2404542*l-1.5371385*o-.4985314*d),To(-.969266*l+1.8760108*o+.041556*d),To(.0556434*l-.2040259*o+1.0572252*d),a.alpha)}function Zh(a,o,l){const d=o-a;return a+l*(d>180||d<-180?d-360*Math.round(d/360):d)}const Ko={forward:Ei,reverse:Wa,interpolate:function(a,o,l){return{l:ai(a.l,o.l,l),a:ai(a.a,o.a,l),b:ai(a.b,o.b,l),alpha:ai(a.alpha,o.alpha,l)}}},xc={forward:function(a){const{l:o,a:l,b:d}=Ei(a),p=Math.atan2(d,l)*cp;return{h:p<0?p+360:p,c:Math.sqrt(l*l+d*d),l:o,alpha:a.a}},reverse:function(a){const o=a.h*lp,l=a.c;return Wa({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:Zh(a.h,o.h,l),c:ai(a.c,o.c,l),l:ai(a.l,o.l,l),alpha:ai(a.alpha,o.alpha,l)}}};var Do=Object.freeze({__proto__:null,hcl:xc,lab:Ko});class Za{constructor(o,l,d,p,y){this.type=o,this.operator=l,this.interpolation=d,this.input=p,this.labels=[],this.outputs=[];for(const[b,E]of y)this.labels.push(b),this.outputs.push(E)}static interpolationFactor(o,l,d,p){let y=0;if("exponential"===o.name)y=Qd(l,o.base,d,p);else if("linear"===o.name)y=Qd(l,1,d,p);else if("cubic-bezier"===o.name){const b=o.controlPoints;y=new ul(b[0],b[1],b[2],b[3]).solve(Qd(l,1,d,p))}return y}static parse(o,l){let[d,p,y,...b]=o;if(!Array.isArray(p)||0===p.length)return l.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const D=p[1];if("number"!=typeof D)return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:D}}else{if("cubic-bezier"!==p[0])return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const D=p.slice(1);if(4!==D.length||D.some(R=>"number"!=typeof R||R<0||R>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:D}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(y=l.parse(y,2,Kt),!y)return null;const E=[];let T=null;"interpolate-hcl"===d||"interpolate-lab"===d?T=Zo:l.expectedType&&"value"!==l.expectedType.kind&&(T=l.expectedType);for(let D=0;D<b.length;D+=2){const R=b[D],N=b[D+1],B=D+3,j=D+4;if("number"!=typeof R)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(E.length&&E[E.length-1][0]>=R)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const H=l.parse(N,j,T);if(!H)return null;T=T||H.type,E.push([R,H])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new Za(T,d,p,y,E):l.error(`Type ${Ee(T)} is not interpolatable.`)}evaluate(o){const l=this.labels,d=this.outputs;if(1===l.length)return d[0].evaluate(o);const p=this.input.evaluate(o);if(p<=l[0])return d[0].evaluate(o);const y=l.length;if(p>=l[y-1])return d[y-1].evaluate(o);const b=bl(l,p),E=Za.interpolationFactor(this.interpolation,p,l[b],l[b+1]),T=d[b].evaluate(o),D=d[b+1].evaluate(o);return"interpolate"===this.operator?et[this.type.kind.toLowerCase()](T,D,E):"interpolate-hcl"===this.operator?xc.reverse(xc.interpolate(xc.forward(T),xc.forward(D),E)):Ko.reverse(Ko.interpolate(Ko.forward(T),Ko.forward(D),E))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let d=0;d<this.labels.length;d++)l.push(this.labels[d],this.outputs[d].serialize());return l}}function Qd(a,o,l,d){const p=d-l,y=a-l;return 0===p?0:1===o?y/p:(Math.pow(o,y)-1)/(Math.pow(o,p)-1)}var hs=Za;class Zl{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let d=null;const p=l.expectedType;p&&"value"!==p.kind&&(d=p);const y=[];for(const E of o.slice(1)){const T=l.parse(E,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!T)return null;d=d||T.type,y.push(T)}const b=p&&y.some(E=>ze(p,E.type));return new Zl(b?Vn:d,y)}evaluate(o){let l,d=null,p=0;for(const y of this.args){if(p++,d=y.evaluate(o),d&&d instanceof si&&!d.available&&(l||(l=d),d=null,p===this.args.length))return l;if(null!==d)break}return d}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Ju=Zl;class ou{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const d=[];for(let y=1;y<o.length-1;y+=2){const b=o[y];if("string"!=typeof b)return l.error(`Expected string, but found ${typeof b} instead.`,y);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",y);const E=l.parse(o[y+1],y+1);if(!E)return null;d.push([b,E])}const p=l.parse(o[o.length-1],o.length-1,l.expectedType,d);return p?new ou(d,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,d]of this.bindings)o.push(l,d.serialize());return o.push(this.result.serialize()),o}}var wc=ou;class Xl{constructor(o,l,d){this.type=o,this.index=l,this.input=d}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,Kt),p=l.parse(o[2],2,pe(l.expectedType||Vn));return d&&p?new Xl(p.type.itemType,d,p):null}evaluate(o){const l=this.index.evaluate(o),d=this.input.evaluate(o);if(l<0)throw new Mo(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new Mo(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new Mo(`Array index must be an integer, but found ${l} instead.`);return d[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Xh=Xl;class Yh{constructor(o,l){this.type=oi,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,Vn),p=l.parse(o[2],2,Vn);return d&&p?tt(d.type,[oi,qt,Kt,or,Vn])?new Yh(d,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(d.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(null==d)return!1;if(!zt(l,["boolean","string","number","null"]))throw new Mo(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(Qn(l))} instead.`);if(!zt(d,["string","array"]))throw new Mo(`Expected second argument to be of type array or string, but found ${Ee(Qn(d))} instead.`);return d.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Be=Yh;class ot{constructor(o,l,d){this.type=Kt,this.needle=o,this.haystack=l,this.fromIndex=d}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,Vn),p=l.parse(o[2],2,Vn);if(!d||!p)return null;if(!tt(d.type,[oi,qt,Kt,or,Vn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(d.type)} instead`);if(4===o.length){const y=l.parse(o[3],3,Kt);return y?new ot(d,p,y):null}return new ot(d,p)}evaluate(o){const l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!zt(l,["boolean","string","number","null"]))throw new Mo(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(Qn(l))} instead.`);if(!zt(d,["string","array"]))throw new Mo(`Expected second argument to be of type array or string, but found ${Ee(Qn(d))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(o);return d.indexOf(l,p)}return d.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var nn=ot;class mn{constructor(o,l,d,p,y,b){this.inputType=o,this.type=l,this.input=d,this.cases=p,this.outputs=y,this.otherwise=b}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let d,p;l.expectedType&&"value"!==l.expectedType.kind&&(p=l.expectedType);const y={},b=[];for(let D=2;D<o.length-1;D+=2){let R=o[D];const N=o[D+1];Array.isArray(R)||(R=[R]);const B=l.concat(D);if(0===R.length)return B.error("Expected at least one branch label.");for(const H of R){if("number"!=typeof H&&"string"!=typeof H)return B.error("Branch labels must be numbers or strings.");if("number"==typeof H&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof H&&Math.floor(H)!==H)return B.error("Numeric branch labels must be integer values.");if(d){if(B.checkSubtype(d,Qn(H)))return null}else d=Qn(H);if(void 0!==y[String(H)])return B.error("Branch labels must be unique.");y[String(H)]=b.length}const j=l.parse(N,D,p);if(!j)return null;p=p||j.type,b.push(j)}const E=l.parse(o[1],1,Vn);if(!E)return null;const T=l.parse(o[o.length-1],o.length-1,p);return T?"value"!==E.type.kind&&l.concat(1).checkSubtype(d,E.type)?null:new mn(d,p,E,y,b,T):null}evaluate(o){const l=this.input.evaluate(o);return(Qn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),d=[],p={};for(const b of l){const E=p[this.cases[b]];void 0===E?(p[this.cases[b]]=d.length,d.push([this.cases[b],[b]])):d[E][1].push(b)}const y=b=>"number"===this.inputType.kind?Number(b):b;for(const[b,E]of d)o.push(1===E.length?y(E[0]):E.map(y)),o.push(this.outputs[b].serialize());return o.push(this.otherwise.serialize()),o}}var Or=mn;class gi{constructor(o,l,d){this.type=o,this.branches=l,this.otherwise=d}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&"value"!==l.expectedType.kind&&(d=l.expectedType);const p=[];for(let b=1;b<o.length-1;b+=2){const E=l.parse(o[b],b,oi);if(!E)return null;const T=l.parse(o[b+1],b+1,d);if(!T)return null;p.push([E,T]),d=d||T.type}const y=l.parse(o[o.length-1],o.length-1,d);return y?new gi(d,p,y):null}evaluate(o){for(const[l,d]of this.branches)if(l.evaluate(o))return d.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,d]of this.branches)o(l),o(d);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Ur=gi;class Lr{constructor(o,l,d,p){this.type=o,this.input=l,this.beginIndex=d,this.endIndex=p}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,Vn),p=l.parse(o[2],2,Kt);if(!d||!p)return null;if(!tt(d.type,[pe(Vn),qt,Vn]))return l.error(`Expected first argument to be of type array or string, but found ${Ee(d.type)} instead`);if(4===o.length){const y=l.parse(o[3],3,Kt);return y?new Lr(d.type,d,p,y):null}return new Lr(d.type,d,p)}evaluate(o){const l=this.input.evaluate(o),d=this.beginIndex.evaluate(o);if(!zt(l,["string","array"]))throw new Mo(`Expected first argument to be of type array or string, but found ${Ee(Qn(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(o);return l.slice(d,p)}return l.slice(d)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var aa=Lr;function Wr(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Jr(a,o,l,d){return 0===d.compare(o,l)}function Qo(a,o,l){const d="=="!==a&&"!="!==a;return class O7{constructor(y,b,E){this.type=oi,this.lhs=y,this.rhs=b,this.collator=E,this.hasUntypedArgument="value"===y.type.kind||"value"===b.type.kind}static parse(y,b){if(3!==y.length&&4!==y.length)return b.error("Expected two or three arguments.");const E=y[0];let T=b.parse(y[1],1,Vn);if(!T)return null;if(!Wr(E,T.type))return b.concat(1).error(`"${E}" comparisons are not supported for type '${Ee(T.type)}'.`);let D=b.parse(y[2],2,Vn);if(!D)return null;if(!Wr(E,D.type))return b.concat(2).error(`"${E}" comparisons are not supported for type '${Ee(D.type)}'.`);if(T.type.kind!==D.type.kind&&"value"!==T.type.kind&&"value"!==D.type.kind)return b.error(`Cannot compare types '${Ee(T.type)}' and '${Ee(D.type)}'.`);d&&("value"===T.type.kind&&"value"!==D.type.kind?T=new Ha(D.type,[T]):"value"!==T.type.kind&&"value"===D.type.kind&&(D=new Ha(T.type,[D])));let R=null;if(4===y.length){if("string"!==T.type.kind&&"string"!==D.type.kind&&"value"!==T.type.kind&&"value"!==D.type.kind)return b.error("Cannot use collator to compare non-string types.");if(R=b.parse(y[3],3,P),!R)return null}return new O7(T,D,R)}evaluate(y){const b=this.lhs.evaluate(y),E=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const T=Qn(b),D=Qn(E);if(T.kind!==D.kind||"string"!==T.kind&&"number"!==T.kind)throw new Mo(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${D.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const T=Qn(b),D=Qn(E);if("string"!==T.kind||"string"!==D.kind)return o(y,b,E)}return this.collator?l(y,b,E,this.collator.evaluate(y)):o(y,b,E)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[a];return this.eachChild(b=>{y.push(b.serialize())}),y}}}const El=Qo("==",function(a,o,l){return o===l},Jr),Jo=Qo("!=",function(a,o,l){return o!==l},function(a,o,l,d){return!Jr(0,o,l,d)}),Ni=Qo("<",function(a,o,l){return o<l},function(a,o,l,d){return d.compare(o,l)<0}),su=Qo(">",function(a,o,l){return o>l},function(a,o,l,d){return d.compare(o,l)>0}),Jd=Qo("<=",function(a,o,l){return o<=l},function(a,o,l,d){return d.compare(o,l)<=0}),Ec=Qo(">=",function(a,o,l){return o>=l},function(a,o,l,d){return d.compare(o,l)>=0});class pr{constructor(o,l,d,p,y,b){this.type=qt,this.number=o,this.locale=l,this.currency=d,this.unit=p,this.minFractionDigits=y,this.maxFractionDigits=b}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const d=l.parse(o[1],1,Kt);if(!d)return null;const p=o[2];if("object"!=typeof p||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=l.parse(p.locale,1,qt),!y))return null;let b=null;if(p.currency&&(b=l.parse(p.currency,1,qt),!b))return null;let E=null;if(p.unit&&(E=l.parse(p.unit,1,qt),!E))return null;let T=null;if(p["min-fraction-digits"]&&(T=l.parse(p["min-fraction-digits"],1,Kt),!T))return null;let D=null;return p["max-fraction-digits"]&&(D=l.parse(p["max-fraction-digits"],1,Kt),!D)?null:new pr(d,y,b,E,T,D)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Cc{constructor(o){this.type=Kt,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const d=l.parse(o[1],1);return d?"array"!==d.type.kind&&"string"!==d.type.kind&&"value"!==d.type.kind?l.error(`Expected argument of type string or array, but found ${Ee(d.type)} instead.`):new Cc(d):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new Mo(`Expected value to be of type string or array, but found ${Ee(Qn(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}const Kh={"==":El,"!=":Jo,">":su,"<":Ni,">=":Ec,"<=":Jd,array:Ha,at:Xh,boolean:Ha,case:Ur,coalesce:Ju,collator:Er,format:yl,image:Wd,in:Be,"index-of":nn,interpolate:hs,"interpolate-hcl":hs,"interpolate-lab":hs,length:Cc,let:wc,literal:cs,match:Or,number:Ha,"number-format":pr,object:Ha,slice:aa,step:ra,string:Ha,"to-boolean":qu,"to-color":qu,"to-number":qu,"to-string":qu,var:ap,within:vc};function Cr(a,[o,l,d,p]){o=o.evaluate(a),l=l.evaluate(a),d=d.evaluate(a);const y=p?p.evaluate(a):1,b=Hh(o,l,d,y);if(b)throw new Mo(b);return new lt(o/255*y,l/255*y,d/255*y,y)}function Hn(a,o){return a in o}function Mn(a,o){const l=o[a];return void 0===l?null:l}function tr(a){return{type:a}}Gl.register(Kh,{error:[{kind:"error"},[qt],(a,[o])=>{throw new Mo(o.evaluate(a))}],typeof:[qt,[Vn],(a,[o])=>Ee(Qn(o.evaluate(a)))],"to-rgba":[pe(Kt,4),[Zo],(a,[o])=>o.evaluate(a).toArray()],rgb:[Zo,[Kt,Kt,Kt],Cr],rgba:[Zo,[Kt,Kt,Kt,Kt],Cr],has:{type:oi,overloads:[[[qt],(a,[o])=>Hn(o.evaluate(a),a.properties())],[[qt,qr],(a,[o,l])=>Hn(o.evaluate(a),l.evaluate(a))]]},get:{type:Vn,overloads:[[[qt],(a,[o])=>Mn(o.evaluate(a),a.properties())],[[qt,qr],(a,[o,l])=>Mn(o.evaluate(a),l.evaluate(a))]]},"feature-state":[Vn,[qt],(a,[o])=>Mn(o.evaluate(a),a.featureState||{})],properties:[qr,[],a=>a.properties()],"geometry-type":[qt,[],a=>a.geometryType()],id:[Vn,[],a=>a.id()],zoom:[Kt,[],a=>a.globals.zoom],pitch:[Kt,[],a=>a.globals.pitch||0],"distance-from-center":[Kt,[],a=>a.distanceFromCenter()],"heatmap-density":[Kt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Kt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[Kt,[],a=>a.globals.skyRadialProgress||0],accumulated:[Vn,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[Kt,tr(Kt),(a,o)=>{let l=0;for(const d of o)l+=d.evaluate(a);return l}],"*":[Kt,tr(Kt),(a,o)=>{let l=1;for(const d of o)l*=d.evaluate(a);return l}],"-":{type:Kt,overloads:[[[Kt,Kt],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[Kt],(a,[o])=>-o.evaluate(a)]]},"/":[Kt,[Kt,Kt],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[Kt,[Kt,Kt],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[Kt,[],()=>Math.LN2],pi:[Kt,[],()=>Math.PI],e:[Kt,[],()=>Math.E],"^":[Kt,[Kt,Kt],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[Kt,[Kt],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[Kt,[Kt],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[Kt,[Kt],(a,[o])=>Math.log(o.evaluate(a))],log2:[Kt,[Kt],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[Kt,[Kt],(a,[o])=>Math.sin(o.evaluate(a))],cos:[Kt,[Kt],(a,[o])=>Math.cos(o.evaluate(a))],tan:[Kt,[Kt],(a,[o])=>Math.tan(o.evaluate(a))],asin:[Kt,[Kt],(a,[o])=>Math.asin(o.evaluate(a))],acos:[Kt,[Kt],(a,[o])=>Math.acos(o.evaluate(a))],atan:[Kt,[Kt],(a,[o])=>Math.atan(o.evaluate(a))],min:[Kt,tr(Kt),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[Kt,tr(Kt),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[Kt,[Kt],(a,[o])=>Math.abs(o.evaluate(a))],round:[Kt,[Kt],(a,[o])=>{const l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[Kt,[Kt],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[Kt,[Kt],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[oi,[qt,Vn],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[oi,[Vn],(a,[o])=>a.id()===o.value],"filter-type-==":[oi,[qt],(a,[o])=>a.geometryType()===o.value],"filter-<":[oi,[qt,Vn],(a,[o,l])=>{const d=a.properties()[o.value],p=l.value;return typeof d==typeof p&&d<p}],"filter-id-<":[oi,[Vn],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l<d}],"filter->":[oi,[qt,Vn],(a,[o,l])=>{const d=a.properties()[o.value],p=l.value;return typeof d==typeof p&&d>p}],"filter-id->":[oi,[Vn],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l>d}],"filter-<=":[oi,[qt,Vn],(a,[o,l])=>{const d=a.properties()[o.value],p=l.value;return typeof d==typeof p&&d<=p}],"filter-id-<=":[oi,[Vn],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l<=d}],"filter->=":[oi,[qt,Vn],(a,[o,l])=>{const d=a.properties()[o.value],p=l.value;return typeof d==typeof p&&d>=p}],"filter-id->=":[oi,[Vn],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l>=d}],"filter-has":[oi,[Vn],(a,[o])=>o.value in a.properties()],"filter-has-id":[oi,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[oi,[pe(qt)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[oi,[pe(Vn)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[oi,[qt,pe(Vn)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[oi,[qt,pe(Vn)],(a,[o,l])=>function(d,p,y,b){for(;y<=b;){const E=y+b>>1;if(p[E]===d)return!0;p[E]>d?b=E-1:y=E+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:oi,overloads:[[[oi,oi],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[tr(oi),(a,o)=>{for(const l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:oi,overloads:[[[oi,oi],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[tr(oi),(a,o)=>{for(const l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[oi,[oi],(a,[o])=>!o.evaluate(a)],"is-supported-script":[oi,[qt],(a,[o])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[qt,[qt],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[qt,[qt],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[qt,tr(Vn),(a,o)=>o.map(l=>As(l.evaluate(a))).join("")],"resolved-locale":[qt,[P],(a,[o])=>o.evaluate(a).resolvedLocale()]});var kr=Kh;function Cl(a){return{result:"success",value:a}}function nr(a){return{result:"error",value:a}}function es(a){return"data-driven"===a["property-type"]}function la(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Ia(a){return!!a.expression&&a.expression.interpolated}function _i(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Xa(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function Mr(a){return a}function dn(a,o){const l="color"===o.type,d=a.stops&&"object"==typeof a.stops[0][0],p=d||!(d||void 0!==a.property),y=a.type||(Ia(o)?"exponential":"interval");if(l&&((a=Wo({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],lt.parse(D[1])])),a.default=lt.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!Do[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,E,T;if("exponential"===y)b=ko;else if("interval"===y)b=So;else if("categorical"===y){b=Tr,E=Object.create(null);for(const D of a.stops)E[D[0]]=D[1];T=typeof a.stops[0][0]}else{if("identity"!==y)throw new Error(`Unknown function type "${y}"`);b=vo}if(d){const D={},R=[];for(let j=0;j<a.stops.length;j++){const H=a.stops[j],X=H[0].zoom;void 0===D[X]&&(D[X]={zoom:X,type:a.type,property:a.property,default:a.default,stops:[]},R.push(X)),D[X].stops.push([H[0].value,H[1]])}const N=[];for(const j of R)N.push([D[j].zoom,dn(D[j],o)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:hs.interpolationFactor.bind(void 0,B),zoomStops:N.map(j=>j[0]),evaluate:({zoom:j},H)=>ko({stops:N,base:a.base},o,j).evaluate(j,H)}}if(p){const D="exponential"===y?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:hs.interpolationFactor.bind(void 0,D),zoomStops:a.stops.map(R=>R[0]),evaluate:({zoom:R})=>b(a,o,R,E,T)}}return{kind:"source",evaluate(D,R){const N=R&&R.properties?R.properties[a.property]:void 0;return void 0===N?Bn(a.default,o.default):b(a,o,N,E,T)}}}function Bn(a,o,l){return void 0!==a?a:void 0!==o?o:void 0!==l?l:void 0}function Tr(a,o,l,d,p){return Bn(typeof l===p?d[l]:void 0,a.default,o.default)}function So(a,o,l){if("number"!==_i(l))return Bn(a.default,o.default);const d=a.stops.length;if(1===d||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[d-1][0])return a.stops[d-1][1];const p=bl(a.stops.map(y=>y[0]),l);return a.stops[p][1]}function ko(a,o,l){const d=void 0!==a.base?a.base:1;if("number"!==_i(l))return Bn(a.default,o.default);const p=a.stops.length;if(1===p||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[p-1][0])return a.stops[p-1][1];const y=bl(a.stops.map(R=>R[0]),l),b=function(R,N,B,j){const H=j-B,X=R-B;return 0===H?0:1===N?X/H:(Math.pow(N,X)-1)/(Math.pow(N,H)-1)}(l,d,a.stops[y][0],a.stops[y+1][0]),E=a.stops[y][1],T=a.stops[y+1][1];let D=et[o.type]||Mr;if(a.colorSpace&&"rgb"!==a.colorSpace){const R=Do[a.colorSpace];D=(N,B)=>R.reverse(R.interpolate(R.forward(N),R.forward(B),b))}return"function"==typeof E.evaluate?{evaluate(...R){const N=E.evaluate.apply(void 0,R),B=T.evaluate.apply(void 0,R);if(void 0!==N&&void 0!==B)return D(N,B,b)}}:D(E,T,b)}function vo(a,o,l){return"color"===o.type?l=lt.parse(l):"formatted"===o.type?l=Li.fromString(l.toString()):"resolvedImage"===o.type?l=si.fromString(l.toString()):_i(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),Bn(l,a.default,o.default)}class ca{constructor(o,l){var d;this.expression=o,this._warningHistory={},this._evaluator=new qh,this._defaultValue=l?"color"===(d=l).type&&(Xa(d.default)||Array.isArray(d.default))?new lt(0,0,0,0):"color"===d.type?lt.parse(d.default)||null:void 0===d.default?null:d.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(o,l,d,p,y,b,E,T){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=E||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,d,p,y,b,E,T){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=E||null,this._evaluator.featureDistanceData=T||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Mo(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function mr(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in kr}function Ml(a,o){const l=new Wh(kr,[],o?function(p){const y={color:Zo,string:qt,number:Kt,enum:qt,boolean:oi,formatted:z,resolvedImage:te};return"array"===p.type?pe(y[p.value]||Vn,p.length):y[p.type]}(o):void 0),d=l.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return d?Cl(new ca(d,o)):nr(l.errors)}class Mc{constructor(o,l){this.kind=o,this._styleExpression=l,this.isStateDependent="constant"!==o&&!Yo(l.expression)}evaluateWithoutErrorHandling(o,l,d,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,p,y,b)}evaluate(o,l,d,p,y,b){return this._styleExpression.evaluate(o,l,d,p,y,b)}}class Jn{constructor(o,l,d,p){this.kind=o,this.zoomStops=d,this._styleExpression=l,this.isStateDependent="camera"!==o&&!Yo(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(o,l,d,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,p,y,b)}evaluate(o,l,d,p,y,b){return this._styleExpression.evaluate(o,l,d,p,y,b)}interpolationFactor(o,l,d){return this.interpolationType?hs.interpolationFactor(this.interpolationType,o,l,d):0}}function Tc(a,o){if("error"===(a=Ml(a,o)).result)return a;const l=a.value.expression,d=bc(l);if(!d&&!es(o))return nr([new Ma("","data expressions not supported")]);const p=Ta(l,["zoom","pitch","distance-from-center"]);if(!p&&!la(o))return nr([new Ma("","zoom expressions not supported")]);const y=Dc(l);return y||p?y instanceof Ma?nr([y]):y instanceof hs&&!Ia(o)?nr([new Ma("",'"interpolate" expressions cannot be used with this property')]):Cl(y?new Jn(d?"camera":"composite",a.value,y.labels,y instanceof hs?y.interpolation:void 0):new Mc(d?"constant":"source",a.value)):nr([new Ma("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Qh{constructor(o,l){this._parameters=o,this._specification=l,Wo(this,dn(this._parameters,this._specification))}static deserialize(o){return new Qh(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Dc(a){let o=null;if(a instanceof wc)o=Dc(a.result);else if(a instanceof Ju){for(const l of a.args)if(o=Dc(l),o)break}else(a instanceof ra||a instanceof hs)&&a.input instanceof Gl&&"zoom"===a.input.name&&(o=a);return o instanceof Ma||a.eachChild(l=>{const d=Dc(l);d instanceof Ma?o=d:!o&&d?o=new Ma("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&d&&o!==d&&(o=new Ma("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class Ft{constructor(o,l,d,p){this.message=(o?`${o}: `:"")+d,p&&(this.identifier=p),null!=l&&l.__line__&&(this.line=l.__line__)}}function Ps(a){const o=a.key,l=a.value,d=a.valueSpec||{},p=a.objectElementValidators||{},y=a.style,b=a.styleSpec;let E=[];const T=_i(l);if("object"!==T)return[new Ft(o,l,`object expected, ${T} found`)];for(const D in l){const R=D.split(".")[0];let N;p[R]?N=p[R]:d[R]?N=Os:p["*"]?N=p["*"]:d["*"]&&(N=Os),N?E=E.concat(N({key:(o&&`${o}.`)+D,value:l[D],valueSpec:d[R]||d["*"],style:y,styleSpec:b,object:l,objectKey:D},l)):E.push(new Ft(o,l[D],`unknown property "${D}"`))}for(const D in d)p[D]||d[D].required&&void 0===d[D].default&&void 0===l[D]&&E.push(new Ft(o,l,`missing required property "${D}"`));return E}function ed(a){const o=a.value,l=a.valueSpec,d=a.style,p=a.styleSpec,y=a.key,b=a.arrayElementValidator||Os;if("array"!==_i(o))return[new Ft(y,o,`array expected, ${_i(o)} found`)];if(l.length&&o.length!==l.length)return[new Ft(y,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new Ft(y,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let E={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};p.$version<7&&(E.function=l.function),"object"===_i(l.value)&&(E=l.value);let T=[];for(let D=0;D<o.length;D++)T=T.concat(b({array:o,arrayIndex:D,value:o[D],valueSpec:E,style:d,styleSpec:p,key:`${y}[${D}]`}));return T}function ua(a){const o=a.key,l=a.value,d=a.valueSpec;let p=_i(l);if("number"===p&&l!=l&&(p="NaN"),"number"!==p)return[new Ft(o,l,`number expected, ${p} found`)];if("minimum"in d){let y=d.minimum;if("array"===_i(d.minimum)&&(y=d.minimum[a.arrayIndex]),l<y)return[new Ft(o,l,`${l} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if("array"===_i(d.maximum)&&(y=d.maximum[a.arrayIndex]),l>y)return[new Ft(o,l,`${l} is greater than the maximum value ${y}`)]}return[]}function Sc(a){const o=a.valueSpec,l=yr(a.value.type);let d,p,y,b={};const E="categorical"!==l&&void 0===a.value.property,T=!E,D="array"===_i(a.value.stops)&&"array"===_i(a.value.stops[0])&&"object"===_i(a.value.stops[0][0]),R=Ps({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(j){if("identity"===l)return[new Ft(j.key,j.value,'identity function may not have a "stops" property')];let H=[];const X=j.value;return H=H.concat(ed({key:j.key,value:X,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:N})),"array"===_i(X)&&0===X.length&&H.push(new Ft(j.key,X,"array must have at least one stop")),H},default:function(j){return Os({key:j.key,value:j.value,valueSpec:o,style:j.style,styleSpec:j.styleSpec})}}});return"identity"===l&&E&&R.push(new Ft(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||R.push(new Ft(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!Ia(a.valueSpec)&&R.push(new Ft(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(T&&!es(a.valueSpec)?R.push(new Ft(a.key,a.value,"property functions not supported")):E&&!la(a.valueSpec)&&R.push(new Ft(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!D||void 0!==a.value.property||R.push(new Ft(a.key,a.value,'"property" property is required')),R;function N(j){let H=[];const X=j.value,ie=j.key;if("array"!==_i(X))return[new Ft(ie,X,`array expected, ${_i(X)} found`)];if(2!==X.length)return[new Ft(ie,X,`array length 2 expected, length ${X.length} found`)];if(D){if("object"!==_i(X[0]))return[new Ft(ie,X,`object expected, ${_i(X[0])} found`)];if(void 0===X[0].zoom)return[new Ft(ie,X,"object stop key must have zoom")];if(void 0===X[0].value)return[new Ft(ie,X,"object stop key must have value")];const ce=yr(X[0].zoom);if("number"!=typeof ce)return[new Ft(ie,X[0].zoom,"stop zoom values must be numbers")];if(y&&y>ce)return[new Ft(ie,X[0].zoom,"stop zoom values must appear in ascending order")];ce!==y&&(y=ce,p=void 0,b={}),H=H.concat(Ps({key:`${ie}[0]`,value:X[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:ua,value:B}}))}else H=H.concat(B({key:`${ie}[0]`,value:X[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},X));return mr(uo(X[1]))?H.concat([new Ft(`${ie}[1]`,X[1],"expressions are not allowed in function stops.")]):H.concat(Os({key:`${ie}[1]`,value:X[1],valueSpec:o,style:j.style,styleSpec:j.styleSpec}))}function B(j,H){const X=_i(j.value),ie=yr(j.value),ce=null!==j.value?j.value:H;if(d){if(X!==d)return[new Ft(j.key,ce,`${X} stop domain type must match previous stop domain type ${d}`)]}else d=X;if("number"!==X&&"string"!==X&&"boolean"!==X&&"number"!=typeof ie&&"string"!=typeof ie&&"boolean"!=typeof ie)return[new Ft(j.key,ce,"stop domain value must be a number, string, or boolean")];if("number"!==X&&"categorical"!==l){let be=`number expected, ${X} found`;return es(o)&&void 0===l&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ft(j.key,ce,be)]}return"categorical"!==l||"number"!==X||"number"==typeof ie&&isFinite(ie)&&Math.floor(ie)===ie?"categorical"!==l&&"number"===X&&"number"==typeof ie&&"number"==typeof p&&void 0!==p&&ie<p?[new Ft(j.key,ce,"stop domain values must appear in ascending order")]:(p=ie,"categorical"===l&&ie in b?[new Ft(j.key,ce,"stop domain values must be unique")]:(b[ie]=!0,[])):[new Ft(j.key,ce,`integer expected, found ${String(ie)}`)]}}function Io(a){const o=("property"===a.expressionContext?Tc:Ml)(uo(a.value),a.valueSpec);if("error"===o.result)return o.value.map(d=>new Ft(`${a.key}${d.key}`,a.value,d.message));const l=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Ft(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!Yo(l))return[new Ft(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return Ya(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Ta(l,["zoom","feature-state"]))return[new Ft(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!bc(l))return[new Ft(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ya(a,o){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const p of o.valueSpec.expression.parameters)l.delete(p);if(0===l.size)return[];const d=[];return a instanceof Gl&&l.has(a.name)?[new Ft(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(p=>{d.push(...Ya(p,o))}),d)}function Ka(a){const o=a.key,l=a.value,d=a.valueSpec,p=[];return Array.isArray(d.values)?-1===d.values.indexOf(yr(l))&&p.push(new Ft(o,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(d.values).indexOf(yr(l))&&p.push(new Ft(o,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function eh(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!eh(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function td(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};eh(a)||(a=Tl(a));const l=a;let d=!0;try{d=function(D){if(!au(D))return D;let R=uo(D);return Pm(R),R=Si(R),R}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const p=nt[`filter_${o}`],y=Ml(d,p);let b=null;if("error"===y.result)throw new Error(y.value.map(D=>`${D.key}: ${D.message}`).join(", "));b=(D,R,N)=>y.value.evaluate(D,R,{},N);let E=null,T=null;if(d!==l){const D=Ml(l,p);if("error"===D.result)throw new Error(D.value.map(R=>`${R.key}: ${R.message}`).join(", "));E=(R,N,B,j,H)=>D.value.evaluate(R,N,{},B,void 0,void 0,j,H),T=!bc(D.value.expression)}return{filter:b,dynamicFilter:E||void 0,needGeometry:Jh(d),needFeature:!!T}}function Si(a){if(!Array.isArray(a))return a;const o=function(l){if(up.has(l[0]))for(let d=1;d<l.length;d++)if(au(l[d]))return!0;return l}(a);return!0===o?o:o.map(l=>Si(l))}function Pm(a){let o=!1;const l=[];if("case"===a[0]){for(let d=1;d<a.length-1;d+=2)o=o||au(a[d]),l.push(a[d+1]);l.push(a[a.length-1])}else if("match"===a[0]){o=o||au(a[1]);for(let d=2;d<a.length-1;d+=2)l.push(a[d+1]);l.push(a[a.length-1])}else if("step"===a[0]){o=o||au(a[1]);for(let d=1;d<a.length-1;d+=2)l.push(a[d+1])}o&&(a.length=0,a.push("any",...l));for(let d=1;d<a.length;d++)Pm(a[d])}function au(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<a.length;l++)if(au(a[l]))return!0;return!1}const up=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Yl(a,o){return a<o?-1:a>o?1:0}function Jh(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(Jh(a[o]))return!0;return!1}function Tl(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?nd(a[1],a[2],"=="):"!="===o?fs(nd(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?nd(a[1],a[2],o):"any"===o?(l=a.slice(1),["any"].concat(l.map(Tl))):"all"===o?["all"].concat(a.slice(1).map(Tl)):"none"===o?["all"].concat(a.slice(1).map(Tl).map(fs)):"in"===o?Ro(a[1],a.slice(2)):"!in"===o?fs(Ro(a[1],a.slice(2))):"has"===o?h_(a[1]):"!has"===o?fs(h_(a[1])):"within"!==o||a;var l}function nd(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function Ro(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort(Yl)]]:["filter-in-small",a,["literal",o]]}}function h_(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function fs(a){return["!",a]}function Lo(a){return eh(uo(a.value))?Io(Wo({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):id(a)}function id(a){const o=a.value,l=a.key;if("array"!==_i(o))return[new Ft(l,o,`array expected, ${_i(o)} found`)];const d=a.styleSpec;let p,y=[];if(o.length<1)return[new Ft(l,o,"filter array must have at least 1 element")];switch(y=y.concat(Ka({key:`${l}[0]`,value:o[0],valueSpec:d.filter_operator,style:a.style,styleSpec:a.styleSpec})),yr(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===yr(o[1])&&y.push(new Ft(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&y.push(new Ft(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(p=_i(o[1]),"string"!==p&&y.push(new Ft(`${l}[1]`,o[1],`string expected, ${p} found`)));for(let b=2;b<o.length;b++)p=_i(o[b]),"$type"===yr(o[1])?y=y.concat(Ka({key:`${l}[${b}]`,value:o[b],valueSpec:d.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&y.push(new Ft(`${l}[${b}]`,o[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<o.length;b++)y=y.concat(id({key:`${l}[${b}]`,value:o[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":p=_i(o[1]),2!==o.length?y.push(new Ft(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==p&&y.push(new Ft(`${l}[1]`,o[1],`string expected, ${p} found`));break;case"within":p=_i(o[1]),2!==o.length?y.push(new Ft(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==p&&y.push(new Ft(`${l}[1]`,o[1],`object expected, ${p} found`))}return y}function Ic(a,o){const l=a.key,d=a.style,p=a.styleSpec,y=a.value,b=a.objectKey,E=p[`${o}_${a.layerType}`];if(!E)return[];const T=b.match(/^(.*)-transition$/);if("paint"===o&&T&&E[T[1]]&&E[T[1]].transition)return Os({key:l,value:y,valueSpec:p.transition,style:d,styleSpec:p});const D=a.valueSpec||E[b];if(!D)return[new Ft(l,y,`unknown property "${b}"`)];let R;if("string"===_i(y)&&es(D)&&!D.tokens&&(R=/^{([^}]+)}$/.exec(y))){const B=`\`{ "type": "identity", "property": ${R?JSON.stringify(R[1]):'"_"'} }\``;return[new Ft(l,y,`"${b}" does not support interpolation syntax\nUse an identity property function instead: ${B}.`)]}const N=[];return"symbol"===a.layerType&&("text-field"===b&&d&&!d.glyphs&&N.push(new Ft(l,y,'use of "text-field" requires a style "glyphs" property')),"text-font"===b&&Xa(uo(y))&&"identity"===yr(y.type)&&N.push(new Ft(l,y,'"text-font" does not support identity functions'))),N.concat(Os({key:a.key,value:y,valueSpec:D,style:d,styleSpec:p,expressionContext:"property",propertyType:o,propertyKey:b}))}function ef(a){return Ic(a,"paint")}function Aa(a){return Ic(a,"layout")}function dp(a){let o=[];const l=a.value,d=a.key,p=a.style,y=a.styleSpec;l.type||l.ref||o.push(new Ft(d,l,'either "type" or "ref" is required'));let b=yr(l.type);const E=yr(l.ref);if(l.id){const T=yr(l.id);for(let D=0;D<a.arrayIndex;D++){const R=p.layers[D];yr(R.id)===T&&o.push(new Ft(d,l.id,`duplicate layer id "${l.id}", previously used at line ${R.id.__line__}`))}}if("ref"in l){let T;["type","source","source-layer","filter","layout"].forEach(D=>{D in l&&o.push(new Ft(d,l[D],`"${D}" is prohibited for ref layers`))}),p.layers.forEach(D=>{yr(D.id)===E&&(T=D)}),T?T.ref?o.push(new Ft(d,l.ref,"ref cannot reference another ref layer")):b=yr(T.type):"string"==typeof E&&o.push(new Ft(d,l.ref,`ref layer "${E}" not found`))}else if("background"!==b&&"sky"!==b)if(l.source){const T=p.sources&&p.sources[l.source],D=T&&yr(T.type);T?"vector"===D&&"raster"===b?o.push(new Ft(d,l.source,`layer "${l.id}" requires a raster source`)):"raster"===D&&"raster"!==b?o.push(new Ft(d,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==D||l["source-layer"]?"raster-dem"===D&&"hillshade"!==b?o.push(new Ft(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==b||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===D&&T.lineMetrics||o.push(new Ft(d,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new Ft(d,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new Ft(d,l.source,`source "${l.source}" not found`))}else o.push(new Ft(d,l,'missing required property "source"'));return o=o.concat(Ps({key:d,value:l,valueSpec:y.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Os({key:`${d}.type`,value:l.type,valueSpec:y.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:T=>Lo(Wo({layerType:b},T)),layout:T=>Ps({layer:l,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":D=>Aa(Wo({layerType:b},D))}}),paint:T=>Ps({layer:l,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":D=>ef(Wo({layerType:b},D))}})}})),o}function lu(a){const o=a.value,l=a.key,d=_i(o);return"string"!==d?[new Ft(l,o,`string expected, ${d} found`)]:[]}const f_={promoteId:function({key:a,value:o}){if("string"===_i(o))return lu({key:a,value:o});{const l=[];for(const d in o)l.push(...lu({key:`${a}.${d}`,value:o[d]}));return l}}};function B0(a){const o=a.value,l=a.key,d=a.styleSpec,p=a.style;if(!o.type)return[new Ft(l,o,'"type" is required')];const y=yr(o.type);let b;switch(y){case"vector":case"raster":case"raster-dem":return b=Ps({key:l,value:o,valueSpec:d[`source_${y.replace("-","_")}`],style:a.style,styleSpec:d,objectElementValidators:f_}),b;case"geojson":if(b=Ps({key:l,value:o,valueSpec:d.source_geojson,style:p,styleSpec:d,objectElementValidators:f_}),o.cluster)for(const E in o.clusterProperties){const[T,D]=o.clusterProperties[E],R="string"==typeof T?[T,["accumulated"],["get",E]]:T;b.push(...Io({key:`${l}.${E}.map`,value:D,expressionContext:"cluster-map"})),b.push(...Io({key:`${l}.${E}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return b;case"video":return Ps({key:l,value:o,valueSpec:d.source_video,style:p,styleSpec:d});case"image":return Ps({key:l,value:o,valueSpec:d.source_image,style:p,styleSpec:d});case"canvas":return[new Ft(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ka({key:`${l}.type`,value:o.type,valueSpec:{values:U0(d)},style:p,styleSpec:d})}}function U0(a){return a.source.reduce((o,l)=>{const d=a[l];return"enum"===d.type.type&&(o=o.concat(Object.keys(d.type.values))),o},[])}function p_(a){const o=a.value,l=a.styleSpec,d=l.light,p=a.style;let y=[];const b=_i(o);if(void 0===o)return y;if("object"!==b)return y=y.concat([new Ft("light",o,`object expected, ${b} found`)]),y;for(const E in o){const T=E.match(/^(.*)-transition$/);y=y.concat(T&&d[T[1]]&&d[T[1]].transition?Os({key:E,value:o[E],valueSpec:l.transition,style:p,styleSpec:l}):d[E]?Os({key:E,value:o[E],valueSpec:d[E],style:p,styleSpec:l}):[new Ft(E,o[E],`unknown property "${E}"`)])}return y}function m_(a){const o=a.value,l=a.key,d=a.style,p=a.styleSpec,y=p.terrain;let b=[];const E=_i(o);if(void 0===o)return b;if("object"!==E)return b=b.concat([new Ft("terrain",o,`object expected, ${E} found`)]),b;for(const T in o){const D=T.match(/^(.*)-transition$/);b=b.concat(D&&y[D[1]]&&y[D[1]].transition?Os({key:T,value:o[T],valueSpec:p.transition,style:d,styleSpec:p}):y[T]?Os({key:T,value:o[T],valueSpec:y[T],style:d,styleSpec:p}):[new Ft(T,o[T],`unknown property "${T}"`)])}if(o.source){const T=d.sources&&d.sources[o.source],D=T&&yr(T.type);T?"raster-dem"!==D&&b.push(new Ft(l,o.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):b.push(new Ft(l,o.source,`source "${o.source}" not found`))}else b.push(new Ft(l,o,'terrain is missing required property "source"'));return b}function V0(a){const o=a.value,l=a.style,d=a.styleSpec,p=d.fog;let y=[];const b=_i(o);if(void 0===o)return y;if("object"!==b)return y=y.concat([new Ft("fog",o,`object expected, ${b} found`)]),y;for(const E in o){const T=E.match(/^(.*)-transition$/);y=y.concat(T&&p[T[1]]&&p[T[1]].transition?Os({key:E,value:o[E],valueSpec:d.transition,style:l,styleSpec:d}):p[E]?Os({key:E,value:o[E],valueSpec:p[E],style:l,styleSpec:d}):[new Ft(E,o[E],`unknown property "${E}"`)])}return y}const j0={"*":()=>[],array:ed,boolean:function(a){const o=a.value,l=a.key,d=_i(o);return"boolean"!==d?[new Ft(l,o,`boolean expected, ${d} found`)]:[]},number:ua,color:function(a){const o=a.key,l=a.value,d=_i(l);return"string"!==d?[new Ft(o,l,`color expected, ${d} found`)]:null===rn(l)?[new Ft(o,l,`color expected, "${l}" found`)]:[]},enum:Ka,filter:Lo,function:Sc,layer:dp,object:Ps,source:B0,light:p_,terrain:m_,fog:V0,string:lu,formatted:function(a){return 0===lu(a).length?[]:Io(a)},resolvedImage:function(a){return 0===lu(a).length?[]:Io(a)},projection:function(a){const o=a.value,l=a.styleSpec,d=l.projection,p=a.style;let y=[];const b=_i(o);if("object"===b)for(const E in o)y=y.concat(Os({key:E,value:o[E],valueSpec:d[E],style:p,styleSpec:l}));else"string"!==b&&(y=y.concat([new Ft("projection",o,`object or string expected, ${b} found`)]));return y}};function Os(a){const o=a.value,l=a.valueSpec,d=a.styleSpec;return l.expression&&Xa(yr(o))?Sc(a):l.expression&&mr(uo(o))?Io(a):l.type&&j0[l.type]?j0[l.type](a):Ps(Wo({},a,{valueSpec:l.type?d[l.type]:l}))}function A1(a){const o=a.value,l=a.key,d=lu(a);return d.length||(-1===o.indexOf("{fontstack}")&&d.push(new Ft(l,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&d.push(new Ft(l,o,'"glyphs" url must include a "{range}" token'))),d}function $0(a,o=nt){return Dl(Os({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:A1,"*":()=>[]}}))}const P1=a=>Dl(ef(a)),O1=a=>Dl(Aa(a));function Dl(a){return a.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function H0(a,o){let l=!1;if(o&&o.length)for(const d of o)a.fire(new Oo(new Error(d.message))),l=!0;return l}var k1=Sl,Kl=3;function Sl(a,o,l){var d=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var p=new Int32Array(this.arrayBuffer);a=p[0],this.d=(o=p[1])+2*(l=p[2]);for(var y=0;y<this.d*this.d;y++){var b=p[Kl+y],E=p[Kl+y+1];d.push(b===E?null:p.subarray(b,E))}var T=p[Kl+d.length+1];this.keys=p.subarray(p[Kl+d.length],T),this.bboxes=p.subarray(T),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var D=0;D<this.d*this.d;D++)d.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var R=l/o*a;this.min=-R,this.max=a+R}Sl.prototype.insert=function(a,o,l,d,p){this._forEachCell(o,l,d,p,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(p)},Sl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Sl.prototype._insertCell=function(a,o,l,d,p,y){this.cells[p].push(y)},Sl.prototype.query=function(a,o,l,d,p){var y=this.min,b=this.max;if(a<=y&&o<=y&&b<=l&&b<=d&&!p)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(a,o,l,d,this._queryCell,E,{},p),E},Sl.prototype._queryCell=function(a,o,l,d,p,y,b,E){var T=this.cells[p];if(null!==T)for(var D=this.keys,R=this.bboxes,N=0;N<T.length;N++){var B=T[N];if(void 0===b[B]){var j=4*B;(E?E(R[j+0],R[j+1],R[j+2],R[j+3]):a<=R[j+2]&&o<=R[j+3]&&l>=R[j+0]&&d>=R[j+1])?(b[B]=!0,y.push(D[B])):b[B]=!1}}},Sl.prototype._forEachCell=function(a,o,l,d,p,y,b,E){for(var T=this._convertToCellCoord(a),D=this._convertToCellCoord(o),R=this._convertToCellCoord(l),N=this._convertToCellCoord(d),B=T;B<=R;B++)for(var j=D;j<=N;j++){var H=this.d*j+B;if((!E||E(this._convertFromCellCoord(B),this._convertFromCellCoord(j),this._convertFromCellCoord(B+1),this._convertFromCellCoord(j+1)))&&p.call(this,a,o,l,d,H,y,b,E))return}},Sl.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Sl.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Sl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=Kl+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var p=new Int32Array(o+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var y=o,b=0;b<a.length;b++){var E=a[b];p[Kl+b]=y,p.set(E,y),y+=E.length}return p[Kl+a.length]=y,p.set(this.keys,y),p[Kl+a.length+1]=y+=this.keys.length,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer};var cu=fr(k1);const Om={};function an(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),Om[o]={klass:a,omit:l.omit||[]}}an(Object,"Object"),cu.serialize=function(a,o){const l=a.toArrayBuffer();return o&&o.push(l),{buffer:l}},cu.deserialize=function(a){return new cu(a.buffer)},Object.defineProperty(cu,"name",{value:"Grid"}),an(cu,"Grid"),an(lt,"Color"),an(Error,"Error"),an(_l,"AJAXError"),an(si,"ResolvedImage"),an(Qh,"StylePropertyFunction"),an(ca,"StyleExpression",{omit:["_evaluator"]}),an(Jn,"ZoomDependentExpression"),an(Mc,"ZoomConstantExpression"),an(Gl,"CompoundExpression",{omit:["_evaluate"]});for(const a in kr)Om[kr[a]._classRegistryKey]||an(kr[a],`Expression${a}`);function g_(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Ac(a){return pt.ImageBitmap&&a instanceof pt.ImageBitmap}function rd(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(g_(a)||Ac(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return o&&o.push(l.buffer),l}if(a instanceof pt.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const d of a)l.push(rd(d,o));return l}if("object"==typeof a){const l=a.constructor,d=l._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);const p=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(const y in a)a.hasOwnProperty(y)&&(Om[d].omit.indexOf(y)>=0||(p[y]=rd(a[y],o)));a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==d&&(p.$name=d),p}throw new Error("can't serialize object of type "+typeof a)}function th(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||g_(a)||Ac(a)||ArrayBuffer.isView(a)||a instanceof pt.ImageData)return a;if(Array.isArray(a))return a.map(th);if("object"==typeof a){const o=a.$name||"Object",{klass:l}=Om[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);const d=Object.create(l.prototype);for(const p of Object.keys(a))"$name"!==p&&(d[p]=th(a[p]));return d}throw new Error("can't deserialize object of type "+typeof a)}const Qt={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function hp(a){for(const o of a)if(km(o.charCodeAt(0)))return!0;return!1}function G0(a){for(const o of a)if(!__(o.charCodeAt(0)))return!1;return!0}function __(a){return!(Qt.Arabic(a)||Qt["Arabic Supplement"](a)||Qt["Arabic Extended-A"](a)||Qt["Arabic Presentation Forms-A"](a)||Qt["Arabic Presentation Forms-B"](a))}function km(a){return!(746!==a&&747!==a&&(a<4352||!(Qt["Bopomofo Extended"](a)||Qt.Bopomofo(a)||Qt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Qt["CJK Compatibility Ideographs"](a)||Qt["CJK Compatibility"](a)||Qt["CJK Radicals Supplement"](a)||Qt["CJK Strokes"](a)||!(!Qt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||Qt["CJK Unified Ideographs Extension A"](a)||Qt["CJK Unified Ideographs"](a)||Qt["Enclosed CJK Letters and Months"](a)||Qt["Hangul Compatibility Jamo"](a)||Qt["Hangul Jamo Extended-A"](a)||Qt["Hangul Jamo Extended-B"](a)||Qt["Hangul Jamo"](a)||Qt["Hangul Syllables"](a)||Qt.Hiragana(a)||Qt["Ideographic Description Characters"](a)||Qt.Kanbun(a)||Qt["Kangxi Radicals"](a)||Qt["Katakana Phonetic Extensions"](a)||Qt.Katakana(a)&&12540!==a||!(!Qt["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!Qt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Qt["Unified Canadian Aboriginal Syllabics"](a)||Qt["Unified Canadian Aboriginal Syllabics Extended"](a)||Qt["Vertical Forms"](a)||Qt["Yijing Hexagram Symbols"](a)||Qt["Yi Syllables"](a)||Qt["Yi Radicals"](a))))}function q0(a){return!(km(a)||(o=a,Qt["Latin-1 Supplement"](o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||Qt["General Punctuation"](o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||Qt["Letterlike Symbols"](o)||Qt["Number Forms"](o)||Qt["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||Qt["Control Pictures"](o)&&9251!==o||Qt["Optical Character Recognition"](o)||Qt["Enclosed Alphanumerics"](o)||Qt["Geometric Shapes"](o)||Qt["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Qt["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Qt["CJK Symbols and Punctuation"](o)||Qt.Katakana(o)||Qt["Private Use Area"](o)||Qt["CJK Compatibility Forms"](o)||Qt["Small Form Variants"](o)||Qt["Halfwidth and Fullwidth Forms"](o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function y_(a){return a>=1424&&a<=2303||Qt["Arabic Presentation Forms-A"](a)||Qt["Arabic Presentation Forms-B"](a)}function Ql(a,o){return!(!o&&y_(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Qt.Khmer(a))}function fp(a){for(const o of a)if(y_(o.charCodeAt(0)))return!0;return!1}const bo="deferred",pp="loading",v_="loaded";let uu=null,_="unavailable",c=null;const f=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(_="error"),uu&&uu(a)};function v(){w.fire(new na("pluginStateChange",{pluginStatus:_,pluginURL:c}))}const w=new qo,M=function(){return _},I=function(){if(_!==bo||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_=pp,v(),c&&eu({url:c},a=>{a?f(a):(_=v_,v())})},k={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_===v_||null!=k.applyArabicShaping,isLoading:()=>_===pp,setState(a){_=a.pluginStatus,c=a.pluginURL},isParsed:()=>null!=k.applyArabicShaping&&null!=k.processBidirectionalText&&null!=k.processStyledBidirectionalText,getPluginURL:()=>c};class L{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(l,d){for(const p of l)if(!Ql(p.charCodeAt(0),d))return!1;return!0}(o,k.isLoaded())}}class V{constructor(o,l){this.property=o,this.value=l,this.expression=function(d,p){if(Xa(d))return new Qh(d,p);if(mr(d)){const y=Tc(d,p);if("error"===y.result)throw new Error(y.value.map(b=>`${b.key}: ${b.message}`).join(", "));return y.value}{let y=d;return"string"==typeof d&&"color"===p.type&&(y=lt.parse(d)),{kind:"constant",evaluate:()=>y}}}(void 0===l?o.specification.default:l,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,d){return this.property.possiblyEvaluate(this,o,l,d)}}class U{constructor(o){this.property=o,this.value=new V(o,void 0)}transitioned(o,l){return new ne(this.property,this.value,l,Ti({},o.transition,this.transition),o.now)}untransitioned(){return new ne(this.property,this.value,null,{},0)}}class q{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Go(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new U(this._values[o].property)),this._values[o].value=new V(this._values[o].property,null===l?void 0:Go(l))}getTransition(o){return Go(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new U(this._values[o].property)),this._values[o].transition=Go(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const d=this.getValue(l);void 0!==d&&(o[l]=d);const p=this.getTransition(l);void 0!==p&&(o[`${l}-transition`]=p)}return o}transitioned(o,l){const d=new oe(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].transitioned(o,l._values[p]);return d}untransitioned(){const o=new oe(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class ne{constructor(o,l,d,p,y){const b=p.delay||0,E=p.duration||0;y=y||0,this.property=o,this.value=l,this.begin=y+b,this.end=this.begin+E,o.specification.transition&&(p.delay||p.duration)&&(this.prior=d)}possiblyEvaluate(o,l,d){const p=o.now||0,y=this.value.possiblyEvaluate(o,l,d),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(o,l,d);{const E=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(o,l,d),y,Vu(E))}}return y}}class oe{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,d){const p=new le(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(o,l,d);return p}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class ae{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return Go(this._values[o].value)}setValue(o,l){this._values[o]=new V(this._values[o].property,null===l?void 0:Go(l))}serialize(){const o={};for(const l of Object.keys(this._values)){const d=this.getValue(l);void 0!==d&&(o[l]=d)}return o}possiblyEvaluate(o,l,d){const p=new le(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(o,l,d);return p}}class se{constructor(o,l,d){this.property=o,this.value=l,this.parameters=d}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,d,p){return this.property.evaluate(this.value,this.parameters,o,l,d,p)}}class le{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class W{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,d){const p=et[this.specification.type];return p?p(o,l,d):o}}class re{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,d,p){return new se(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},d,p)}:o.expression,l)}interpolate(o,l,d){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new se(this,{kind:"constant",value:void 0},o.parameters);const p=et[this.specification.type];return p?new se(this,{kind:"constant",value:p(o.value.value,l.value.value,d)},o.parameters):o}evaluate(o,l,d,p,y,b){return"constant"===o.kind?o.value:o.evaluate(l,d,p,y,b)}}class fe{constructor(o){this.specification=o}possiblyEvaluate(o,l,d,p){return!!o.expression.evaluate(l,null,{},d,p)}interpolate(){return!1}}class _e{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new L(0,{});for(const d in o){const p=o[d];p.specification.overridable&&this.overridableProperties.push(d);const y=this.defaultPropertyValues[d]=new V(p,void 0),b=this.defaultTransitionablePropertyValues[d]=new U(p);this.defaultTransitioningPropertyValues[d]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=y.possiblyEvaluate(l)}}}function Te(a,o){return 256*(a=ni(Math.floor(a),0,255))+ni(Math.floor(o),0,255)}an(re,"DataDrivenProperty"),an(W,"DataConstantProperty"),an(fe,"ColorRampProperty");const De={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Se{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Le{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Fe(a,o=1){let l=0,d=0;return{members:a.map(p=>{const y=De[p.type].BYTES_PER_ELEMENT,b=l=Ze(l,Math.max(o,y)),E=p.components||1;return d=Math.max(d,y),l+=y*E,{name:p.name,type:p.type,components:E,offset:b}}),size:Ze(l,Math.max(d,o)),alignment:o}}function Ze(a,o){return Math.ceil(a/o)*o}class ht extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const p=2*o;return this.int16[p+0]=l,this.int16[p+1]=d,o}}ht.prototype.bytesPerElement=4,an(ht,"StructArrayLayout2i4");class je extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const y=3*o;return this.int16[y+0]=l,this.int16[y+1]=d,this.int16[y+2]=p,o}}je.prototype.bytesPerElement=6,an(je,"StructArrayLayout3i6");class dt extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p)}emplace(o,l,d,p,y){const b=4*o;return this.int16[b+0]=l,this.int16[b+1]=d,this.int16[b+2]=p,this.int16[b+3]=y,o}}dt.prototype.bytesPerElement=8,an(dt,"StructArrayLayout4i8");class He extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,E){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,p,y,b,E)}emplace(o,l,d,p,y,b,E,T){const D=6*o,R=12*o,N=3*o;return this.int16[D+0]=l,this.int16[D+1]=d,this.uint8[R+4]=p,this.uint8[R+5]=y,this.uint8[R+6]=b,this.uint8[R+7]=E,this.float32[N+2]=T,o}}He.prototype.bytesPerElement=12,an(He,"StructArrayLayout2i4ub1f12");class Et extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p)}emplace(o,l,d,p,y){const b=4*o;return this.float32[b+0]=l,this.float32[b+1]=d,this.float32[b+2]=p,this.float32[b+3]=y,o}}Et.prototype.bytesPerElement=16,an(Et,"StructArrayLayout4f16");class qe extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,p,y)}emplace(o,l,d,p,y,b){const E=6*o,T=3*o;return this.uint16[E+0]=l,this.uint16[E+1]=d,this.uint16[E+2]=p,this.uint16[E+3]=y,this.float32[T+2]=b,o}}qe.prototype.bytesPerElement=12,an(qe,"StructArrayLayout4ui1f12");class ct extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p)}emplace(o,l,d,p,y){const b=4*o;return this.uint16[b+0]=l,this.uint16[b+1]=d,this.uint16[b+2]=p,this.uint16[b+3]=y,o}}ct.prototype.bytesPerElement=8,an(ct,"StructArrayLayout4ui8");class _t extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,d,p,y,b)}emplace(o,l,d,p,y,b,E){const T=6*o;return this.int16[T+0]=l,this.int16[T+1]=d,this.int16[T+2]=p,this.int16[T+3]=y,this.int16[T+4]=b,this.int16[T+5]=E,o}}_t.prototype.bytesPerElement=12,an(_t,"StructArrayLayout6i12");class yt extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,E,T,D,R,N,B){const j=this.length;return this.resize(j+1),this.emplace(j,o,l,d,p,y,b,E,T,D,R,N,B)}emplace(o,l,d,p,y,b,E,T,D,R,N,B,j){const H=12*o;return this.int16[H+0]=l,this.int16[H+1]=d,this.int16[H+2]=p,this.int16[H+3]=y,this.uint16[H+4]=b,this.uint16[H+5]=E,this.uint16[H+6]=T,this.uint16[H+7]=D,this.int16[H+8]=R,this.int16[H+9]=N,this.int16[H+10]=B,this.int16[H+11]=j,o}}yt.prototype.bytesPerElement=24,an(yt,"StructArrayLayout4i4ui4i24");class It extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,d,p,y,b)}emplace(o,l,d,p,y,b,E){const T=10*o,D=5*o;return this.int16[T+0]=l,this.int16[T+1]=d,this.int16[T+2]=p,this.float32[D+2]=y,this.float32[D+3]=b,this.float32[D+4]=E,o}}It.prototype.bytesPerElement=20,an(It,"StructArrayLayout3i3f20");class wn extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}wn.prototype.bytesPerElement=4,an(wn,"StructArrayLayout1ul4");class kn extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,E,T,D,R,N,B,j){const H=this.length;return this.resize(H+1),this.emplace(H,o,l,d,p,y,b,E,T,D,R,N,B,j)}emplace(o,l,d,p,y,b,E,T,D,R,N,B,j,H){const X=20*o,ie=10*o;return this.int16[X+0]=l,this.int16[X+1]=d,this.int16[X+2]=p,this.int16[X+3]=y,this.int16[X+4]=b,this.float32[ie+3]=E,this.float32[ie+4]=T,this.float32[ie+5]=D,this.float32[ie+6]=R,this.int16[X+14]=N,this.uint32[ie+8]=B,this.uint16[X+18]=j,this.uint16[X+19]=H,o}}kn.prototype.bytesPerElement=40,an(kn,"StructArrayLayout5i4f1i1ul2ui40");class ln extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,E){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,p,y,b,E)}emplace(o,l,d,p,y,b,E,T){const D=8*o;return this.int16[D+0]=l,this.int16[D+1]=d,this.int16[D+2]=p,this.int16[D+4]=y,this.int16[D+5]=b,this.int16[D+6]=E,this.int16[D+7]=T,o}}ln.prototype.bytesPerElement=16,an(ln,"StructArrayLayout3i2i2i16");class Sn extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,p,y)}emplace(o,l,d,p,y,b){const E=4*o,T=8*o;return this.float32[E+0]=l,this.float32[E+1]=d,this.float32[E+2]=p,this.int16[T+6]=y,this.int16[T+7]=b,o}}Sn.prototype.bytesPerElement=16,an(Sn,"StructArrayLayout2f1f2i16");class ui extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p)}emplace(o,l,d,p,y){const b=12*o,E=3*o;return this.uint8[b+0]=l,this.uint8[b+1]=d,this.float32[E+1]=p,this.float32[E+2]=y,o}}ui.prototype.bytesPerElement=12,an(ui,"StructArrayLayout2ub2f12");class li extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const y=3*o;return this.float32[y+0]=l,this.float32[y+1]=d,this.float32[y+2]=p,o}}li.prototype.bytesPerElement=12,an(li,"StructArrayLayout3f12");class gn extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const y=3*o;return this.uint16[y+0]=l,this.uint16[y+1]=d,this.uint16[y+2]=p,o}}gn.prototype.bytesPerElement=6,an(gn,"StructArrayLayout3ui6");class Xi extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,E,T,D,R,N,B,j,H,X,ie,ce,be,de,ve,xe){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,o,l,d,p,y,b,E,T,D,R,N,B,j,H,X,ie,ce,be,de,ve,xe)}emplace(o,l,d,p,y,b,E,T,D,R,N,B,j,H,X,ie,ce,be,de,ve,xe,Ce){const Xe=30*o,Ge=15*o,st=60*o;return this.int16[Xe+0]=l,this.int16[Xe+1]=d,this.int16[Xe+2]=p,this.float32[Ge+2]=y,this.float32[Ge+3]=b,this.uint16[Xe+8]=E,this.uint16[Xe+9]=T,this.uint32[Ge+5]=D,this.uint32[Ge+6]=R,this.uint32[Ge+7]=N,this.uint16[Xe+16]=B,this.uint16[Xe+17]=j,this.uint16[Xe+18]=H,this.float32[Ge+10]=X,this.float32[Ge+11]=ie,this.uint8[st+48]=ce,this.uint8[st+49]=be,this.uint8[st+50]=de,this.uint32[Ge+13]=ve,this.int16[Xe+28]=xe,this.uint8[st+58]=Ce,o}}Xi.prototype.bytesPerElement=60,an(Xi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class cn extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,E,T,D,R,N,B,j,H,X,ie,ce,be,de,ve,xe,Ce,Xe,Ge,st,Mt,Je,mt,gt,wt){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,o,l,d,p,y,b,E,T,D,R,N,B,j,H,X,ie,ce,be,de,ve,xe,Ce,Xe,Ge,st,Mt,Je,mt,gt,wt)}emplace(o,l,d,p,y,b,E,T,D,R,N,B,j,H,X,ie,ce,be,de,ve,xe,Ce,Xe,Ge,st,Mt,Je,mt,gt,wt,Pt){const rt=38*o,Xt=19*o;return this.int16[rt+0]=l,this.int16[rt+1]=d,this.int16[rt+2]=p,this.float32[Xt+2]=y,this.float32[Xt+3]=b,this.int16[rt+8]=E,this.int16[rt+9]=T,this.int16[rt+10]=D,this.int16[rt+11]=R,this.int16[rt+12]=N,this.int16[rt+13]=B,this.uint16[rt+14]=j,this.uint16[rt+15]=H,this.uint16[rt+16]=X,this.uint16[rt+17]=ie,this.uint16[rt+18]=ce,this.uint16[rt+19]=be,this.uint16[rt+20]=de,this.uint16[rt+21]=ve,this.uint16[rt+22]=xe,this.uint16[rt+23]=Ce,this.uint16[rt+24]=Xe,this.uint16[rt+25]=Ge,this.uint16[rt+26]=st,this.uint16[rt+27]=Mt,this.uint16[rt+28]=Je,this.uint32[Xt+15]=mt,this.float32[Xt+16]=gt,this.float32[Xt+17]=wt,this.float32[Xt+18]=Pt,o}}cn.prototype.bytesPerElement=76,an(cn,"StructArrayLayout3i2f6i15ui1ul3f76");class lr extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}lr.prototype.bytesPerElement=4,an(lr,"StructArrayLayout1f4");class vr extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,p,y)}emplace(o,l,d,p,y,b){const E=5*o;return this.float32[E+0]=l,this.float32[E+1]=d,this.float32[E+2]=p,this.float32[E+3]=y,this.float32[E+4]=b,o}}vr.prototype.bytesPerElement=20,an(vr,"StructArrayLayout5f20");class ps extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p)}emplace(o,l,d,p,y){const b=6*o;return this.uint32[3*o+0]=l,this.uint16[b+2]=d,this.uint16[b+3]=p,this.uint16[b+4]=y,o}}ps.prototype.bytesPerElement=12,an(ps,"StructArrayLayout1ul3ui12");class Fo extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const p=2*o;return this.uint16[p+0]=l,this.uint16[p+1]=d,o}}Fo.prototype.bytesPerElement=4,an(Fo,"StructArrayLayout2ui4");class Qa extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}Qa.prototype.bytesPerElement=2,an(Qa,"StructArrayLayout1ui2");class Il extends Le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const p=2*o;return this.float32[p+0]=l,this.float32[p+1]=d,o}}Il.prototype.bytesPerElement=8,an(Il,"StructArrayLayout2f8");class cr extends Se{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}cr.prototype.size=40;class gr extends kn{get(o){return new cr(this,o)}}an(gr,"CollisionBoxArray");class zi extends Se{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}zi.prototype.size=60;class ho extends Xi{get(o){return new zi(this,o)}}an(ho,"PlacedSymbolArray");class ks extends Se{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ks.prototype.size=76;class Rr extends cn{get(o){return new ks(this,o)}}an(Rr,"SymbolInstanceArray");class vt extends lr{getoffsetX(o){return this.float32[1*o+0]}}an(vt,"GlyphOffsetArray");class Ii extends ht{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}an(Ii,"SymbolLineVertexArray");class Rs extends Se{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Rs.prototype.size=12;class Pa extends ps{get(o){return new Rs(this,o)}}an(Pa,"FeatureIndexArray");class Vr extends Fo{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}an(Vr,"FillExtrusionCentroidArray");const Pc=Fe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Al=Fe([{name:"a_dash",components:4,type:"Uint16"}]);var Oa={exports:{}},QT=function(a,o){var l,d,p,y,b,E,T,D;for(d=a.length-(l=3&a.length),p=o,b=3432918353,E=461845907,D=0;D<d;)T=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,p=27492+(65535&(y=5*(65535&(p=(p^=T=(65535&(T=(T=(65535&T)*b+(((T>>>16)*b&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(T=0,l){case 3:T^=(255&a.charCodeAt(D+2))<<16;case 2:T^=(255&a.charCodeAt(D+1))<<8;case 1:p^=T=(65535&(T=(T=(65535&(T^=255&a.charCodeAt(D)))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295}return p^=a.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0},L1=function(a,o){for(var l,d=a.length,p=o^d,y=0;d>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(y)|(255&a.charCodeAt(++y))<<8|(255&a.charCodeAt(++y))<<16|(255&a.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:p^=(255&a.charCodeAt(y+2))<<16;case 2:p^=(255&a.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&a.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};Oa.exports=QT,Oa.exports.murmur3=QT,Oa.exports.murmur2=L1;var Ls=fr(Oa.exports);class Jl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,l,d,p){this.ids.push(W0(o)),this.positions.push(l,d,p)}getPositions(o){const l=W0(o);let d=0,p=this.ids.length-1;for(;d<p;){const b=d+p>>1;this.ids[b]>=l?p=b:d=b+1}const y=[];for(;this.ids[d]===l;)y.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return y}static serialize(o,l){const d=new Float64Array(o.ids),p=new Uint32Array(o.positions);return nh(d,p,0,d.length-1),l&&l.push(d.buffer,p.buffer),{ids:d,positions:p}}static deserialize(o){const l=new Jl;return l.ids=o.ids,l.positions=o.positions,l.indexed=!0,l}}function W0(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Ls(String(a))}function nh(a,o,l,d){for(;l<d;){const p=a[l+d>>1];let y=l-1,b=d+1;for(;;){do{y++}while(a[y]<p);do{b--}while(a[b]>p);if(y>=b)break;ec(a,y,b),ec(o,3*y,3*b),ec(o,3*y+1,3*b+1),ec(o,3*y+2,3*b+2)}b-l<d-b?(nh(a,o,l,b),l=b+1):(nh(a,o,b+1,d),d=b)}}function ec(a,o,l){const d=a[o];a[o]=a[l],a[l]=d}an(Jl,"FeaturePositionMap");class sd{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}}class Rm extends sd{constructor(o){super(o),this.current=0}set(o,l,d){this.fetchUniformLocation(o,l)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class F1 extends sd{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class N1 extends sd{constructor(o){super(o),this.current=lt.transparent}set(o,l,d){this.fetchUniformLocation(o,l)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const Z0=new Float32Array(16),X0=new Float32Array(9),z1=new Float32Array(4);function Lm(a){return[Te(255*a.r,255*a.g),Te(255*a.b,255*a.a)]}class Fm{constructor(o,l,d){this.value=o,this.uniformNames=l.map(p=>`u_${p}`),this.type=d}setUniform(o,l,d,p,y){l.set(o,y,p.constantOr(this.value))}getBinding(o,l){return"color"===this.type?new N1(o):new Rm(o)}}class nf{constructor(o,l){this.uniformNames=l.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,d,p,y){const b="u_pattern"===y||"u_dash"===y?this.pattern:"u_pixel_ratio"===y?this.pixelRatio:null;b&&l.set(o,y,b)}getBinding(o,l){return"u_pattern"===l||"u_dash"===l?new F1(o):new Rm(o)}}class Oc{constructor(o,l,d,p){this.expression=o,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===d?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(o,l,d,p,y,b){const E=this.paintVertexArray.length,T=this.expression.evaluate(new L(0),l,{},y,p,b);this.paintVertexArray.resize(o),this._setPaintValue(E,o,T)}updatePaintArray(o,l,d,p,y){const b=this.expression.evaluate({zoom:0},d,p,void 0,y);this._setPaintValue(o,l,b)}_setPaintValue(o,l,d){if("color"===this.type){const p=Lm(d);for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=o;p<l;p++)this.paintVertexArray.emplace(p,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tc{constructor(o,l,d,p,y,b){this.expression=o,this.uniformNames=l.map(E=>`u_${E}_t`),this.type=d,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=l.map(E=>({name:`a_${E}`,type:"Float32",components:"color"===d?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(o,l,d,p,y,b){const E=this.expression.evaluate(new L(this.zoom),l,{},y,p,b),T=this.expression.evaluate(new L(this.zoom+1),l,{},y,p,b),D=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(D,o,E,T)}updatePaintArray(o,l,d,p,y){const b=this.expression.evaluate({zoom:this.zoom},d,p,void 0,y),E=this.expression.evaluate({zoom:this.zoom+1},d,p,void 0,y);this._setPaintValue(o,l,b,E)}_setPaintValue(o,l,d,p){if("color"===this.type){const y=Lm(d),b=Lm(p);for(let E=o;E<l;E++)this.paintVertexArray.emplace(E,y[0],y[1],b[0],b[1])}else{for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,d,p);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,d,p,y){const b=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,E=ni(this.expression.interpolationFactor(b,this.zoom,this.zoom+1),0,1);l.set(o,y,E)}getBinding(o,l){return new Rm(o)}}class ad{constructor(o,l,d,p,y){this.expression=o,this.layerId=y,this.paintVertexAttributes=("array"===d?Al:Pc).members;for(let b=0;b<l.length;++b);this.paintVertexArray=new p}populatePaintArray(o,l,d){const p=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(p,o,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(o,l,d,p,y,b){this._setPaintValues(o,l,d.patterns&&d.patterns[this.layerId],b)}_setPaintValues(o,l,d,p){if(!p||!d)return;const y=p[d];if(!y)return;const{tl:b,br:E,pixelRatio:T}=y;for(let D=o;D<l;D++)this.paintVertexArray.emplace(D,b[0],b[1],E[0],E[1],T)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ld{constructor(o,l,d=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const y in o.paint._values){if(!d(y))continue;const b=o.paint.get(y);if(!(b instanceof se&&es(b.property.specification)))continue;const E=JT(y,o.type),T=b.value,D=b.property.specification.type,R=!!b.property.useIntegerZoom,N="line-dasharray"===y||y.endsWith("pattern"),B="line-dasharray"===y&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==T.kind||B)if("source"===T.kind||B||N){const j=rh(y,D,"source");this.binders[y]=N?new ad(T,E,D,j,o.id):new Oc(T,E,D,j),p.push(`/a_${y}`)}else{const j=rh(y,D,"composite");this.binders[y]=new tc(T,E,D,R,l,j),p.push(`/z_${y}`)}else this.binders[y]=N?new nf(T.value,E):new Fm(T.value,E,D),p.push(`/u_${y}`)}this.cacheKey=p.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof Oc||l instanceof tc?l.maxValue:0}populatePaintArrays(o,l,d,p,y,b){for(const E in this.binders){const T=this.binders[E];(T instanceof Oc||T instanceof tc||T instanceof ad)&&T.populatePaintArray(o,l,d,p,y,b)}}setConstantPatternPositions(o){for(const l in this.binders){const d=this.binders[l];d instanceof nf&&d.setConstantPatternPositions(o)}}updatePaintArrays(o,l,d,p,y,b){let E=!1;for(const T in o){const D=l.getPositions(T);for(const R of D){const N=d.feature(R.index);for(const B in this.binders){const j=this.binders[B];if((j instanceof Oc||j instanceof tc||j instanceof ad)&&!0===j.expression.isStateDependent){const H=p.paint.get(B);j.expression=H.value,j.updatePaintArray(R.start,R.end,N,o[T],y,b),E=!0}}}}return E}defines(){const o=[];for(const l in this.binders){const d=this.binders[l];(d instanceof Fm||d instanceof nf)&&o.push(...d.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Oc||d instanceof tc||d instanceof ad)for(let p=0;p<d.paintVertexAttributes.length;p++)o.push(d.paintVertexAttributes[p].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Fm||d instanceof nf||d instanceof tc)for(const p of d.uniformNames)o.push(p)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const d in this.binders){const p=this.binders[d];if(p instanceof Fm||p instanceof nf||p instanceof tc)for(const y of p.uniformNames)l.push({name:y,property:d,binding:p.getBinding(o,y)})}return l}setUniforms(o,l,d,p,y){for(const{name:b,property:E,binding:T}of d)this.binders[E].setUniform(o,T,y,p.get(E),b)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof Oc||l instanceof tc||l instanceof ad)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const d=this.binders[l];(d instanceof Oc||d instanceof tc||d instanceof ad)&&d.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof Oc||l instanceof tc||l instanceof ad)&&l.destroy()}}}class ih{constructor(o,l,d=(()=>!0)){this.programConfigurations={};for(const p of o)this.programConfigurations[p.id]=new ld(p,l,d);this.needsUpload=!1,this._featureMap=new Jl,this._bufferOffset=0}populatePaintArrays(o,l,d,p,y,b,E){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(o,l,p,y,b,E);void 0!==l.id&&this._featureMap.add(l.id,d,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,d,p,y){for(const b of d)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(o,this._featureMap,l,b,p,y)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const Y0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function JT(a,o){return Y0[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const eD={"line-pattern":{source:qe,composite:qe},"fill-pattern":{source:qe,composite:qe},"fill-extrusion-pattern":{source:qe,composite:qe},"line-dasharray":{source:ct,composite:ct}},ka={color:{source:Il,composite:Et},number:{source:lr,composite:Il}};function rh(a,o,l){const d=eD[a];return d&&d[l]||ka[o][l]}an(Fm,"ConstantBinder"),an(nf,"PatternConstantBinder"),an(Oc,"SourceExpressionBinder"),an(ad,"PatternCompositeBinder"),an(tc,"CompositeExpressionBinder"),an(ld,"ProgramConfiguration",{omit:["_buffers"]}),an(ih,"ProgramConfigurationSet");const ro="-transition";class kc extends qo{constructor(o,l){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),l.layout&&(this._unevaluatedLayout=new ae(l.layout)),l.paint)){this._transitionablePaint=new q(l.paint);for(const d in o.paint)this.setPaintProperty(d,o.paint[d],{validate:!1});for(const d in o.layout)this.setLayoutProperty(d,o.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new le(l.paint)}}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l,d={}){null!=l&&this._validate(O1,`layers.${this.id}.layout.${o}`,o,l,d)||("visibility"!==o?this._unevaluatedLayout.setValue(o,l):this.visibility=l)}getPaintProperty(o){return yn(o,ro)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l,d={}){if(null!=l&&this._validate(P1,`layers.${this.id}.paint.${o}`,o,l,d))return!1;if(yn(o,ro))return this._transitionablePaint.setTransition(o.slice(0,-11),l||void 0),!1;{const p=this._transitionablePaint._values[o],y=p.value.isDataDriven(),b=p.value;this._transitionablePaint.setValue(o,l),this._handleSpecialPaintPropertyUpdate(o);const E=this._transitionablePaint._values[o].value,T=E.isDataDriven(),D=yn(o,"pattern")||"line-dasharray"===o;return T||y||D||this._handleOverridablePaintPropertyUpdate(o,b,E)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,l,d){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),pi(o,(l,d)=>!(void 0===l||"layout"===d&&!Object.keys(l).length||"paint"===d&&!Object.keys(l).length))}_validate(o,l,d,p,y={}){return(!y||!1!==y.validate)&&H0(this,o.call($0,{key:l,layerType:this.type,objectKey:d,value:p,styleSpec:nt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof se&&es(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=td(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const tD=Fe([{name:"a_pos",components:2,type:"Int16"}],4),nD=Fe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class fo{constructor(o=[]){this.segments=o}prepareSegment(o,l,d,p){let y=this.segments[this.segments.length-1];return o>fo.MAX_VERTEX_ARRAY_LENGTH&&_r(`Max vertices per segment is ${fo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!y||y.vertexLength+o>fo.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:l.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},void 0!==p&&(y.sortKey=p),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,d,p){return new fo([{vertexOffset:o,primitiveOffset:l,vertexLength:d,primitiveLength:p,vaos:{},sortKey:0}])}}fo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,an(fo,"SegmentVector");var Tn=8192;class cd{constructor(o,l){o&&(l?this.setSouthWest(o).setNorthEast(l):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Bi?new Bi(o.lng,o.lat):Bi.convert(o),this}setSouthWest(o){return this._sw=o instanceof Bi?new Bi(o.lng,o.lat):Bi.convert(o),this}extend(o){const l=this._sw,d=this._ne;let p,y;if(o instanceof Bi)p=o,y=o;else{if(!(o instanceof cd))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(cd.convert(o)):this.extend(Bi.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(Bi.convert(o)):this;if(p=o._sw,y=o._ne,!p||!y)return this}return l||d?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new Bi(p.lng,p.lat),this._ne=new Bi(y.lng,y.lat)),this}getCenter(){return new Bi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Bi(this.getWest(),this.getNorth())}getSouthEast(){return new Bi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:d}=Bi.convert(o);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}static convert(o){return!o||o instanceof cd?o:new cd(o)}}var rf=1e-6,Ao=typeof Float32Array<"u"?Float32Array:Array;function B1(){var a=new Ao(9);return Ao!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Nm(a,o,l){var d=o[0],p=o[1],y=o[2],b=o[3],E=o[4],T=o[5],D=o[6],R=o[7],N=o[8],B=l[0],j=l[1],H=l[2],X=l[3],ie=l[4],ce=l[5],be=l[6],de=l[7],ve=l[8];return a[0]=B*d+j*b+H*D,a[1]=B*p+j*E+H*R,a[2]=B*y+j*T+H*N,a[3]=X*d+ie*b+ce*D,a[4]=X*p+ie*E+ce*R,a[5]=X*y+ie*T+ce*N,a[6]=be*d+de*b+ve*D,a[7]=be*p+de*E+ve*R,a[8]=be*y+de*T+ve*N,a}function Ja(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function mp(a,o){var l=o[0],d=o[1],p=o[2],y=o[3],b=o[4],E=o[5],T=o[6],D=o[7],R=o[8],N=o[9],B=o[10],j=o[11],H=o[12],X=o[13],ie=o[14],ce=o[15],be=l*E-d*b,de=l*T-p*b,ve=l*D-y*b,xe=d*T-p*E,Ce=d*D-y*E,Xe=p*D-y*T,Ge=R*X-N*H,st=R*ie-B*H,Mt=R*ce-j*H,Je=N*ie-B*X,mt=N*ce-j*X,gt=B*ce-j*ie,wt=be*gt-de*mt+ve*Je+xe*Mt-Ce*st+Xe*Ge;return wt?(a[0]=(E*gt-T*mt+D*Je)*(wt=1/wt),a[1]=(p*mt-d*gt-y*Je)*wt,a[2]=(X*Xe-ie*Ce+ce*xe)*wt,a[3]=(B*Ce-N*Xe-j*xe)*wt,a[4]=(T*Mt-b*gt-D*st)*wt,a[5]=(l*gt-p*Mt+y*st)*wt,a[6]=(ie*ve-H*Xe-ce*de)*wt,a[7]=(R*Xe-B*ve+j*de)*wt,a[8]=(b*mt-E*Mt+D*Ge)*wt,a[9]=(d*Mt-l*mt-y*Ge)*wt,a[10]=(H*Ce-X*ve+ce*be)*wt,a[11]=(N*ve-R*Ce-j*be)*wt,a[12]=(E*st-b*Je-T*Ge)*wt,a[13]=(l*Je-d*st+p*Ge)*wt,a[14]=(X*de-H*xe-ie*be)*wt,a[15]=(R*xe-N*de+B*be)*wt,a):null}function ud(a,o,l){var d=o[0],p=o[1],y=o[2],b=o[3],E=o[4],T=o[5],D=o[6],R=o[7],N=o[8],B=o[9],j=o[10],H=o[11],X=o[12],ie=o[13],ce=o[14],be=o[15],de=l[0],ve=l[1],xe=l[2],Ce=l[3];return a[0]=de*d+ve*E+xe*N+Ce*X,a[1]=de*p+ve*T+xe*B+Ce*ie,a[2]=de*y+ve*D+xe*j+Ce*ce,a[3]=de*b+ve*R+xe*H+Ce*be,a[4]=(de=l[4])*d+(ve=l[5])*E+(xe=l[6])*N+(Ce=l[7])*X,a[5]=de*p+ve*T+xe*B+Ce*ie,a[6]=de*y+ve*D+xe*j+Ce*ce,a[7]=de*b+ve*R+xe*H+Ce*be,a[8]=(de=l[8])*d+(ve=l[9])*E+(xe=l[10])*N+(Ce=l[11])*X,a[9]=de*p+ve*T+xe*B+Ce*ie,a[10]=de*y+ve*D+xe*j+Ce*ce,a[11]=de*b+ve*R+xe*H+Ce*be,a[12]=(de=l[12])*d+(ve=l[13])*E+(xe=l[14])*N+(Ce=l[15])*X,a[13]=de*p+ve*T+xe*B+Ce*ie,a[14]=de*y+ve*D+xe*j+Ce*ce,a[15]=de*b+ve*R+xe*H+Ce*be,a}function gp(a,o,l){var d,p,y,b,E,T,D,R,N,B,j,H,X=l[0],ie=l[1],ce=l[2];return o===a?(a[12]=o[0]*X+o[4]*ie+o[8]*ce+o[12],a[13]=o[1]*X+o[5]*ie+o[9]*ce+o[13],a[14]=o[2]*X+o[6]*ie+o[10]*ce+o[14],a[15]=o[3]*X+o[7]*ie+o[11]*ce+o[15]):(p=o[1],y=o[2],b=o[3],E=o[4],T=o[5],D=o[6],R=o[7],N=o[8],B=o[9],j=o[10],H=o[11],a[0]=d=o[0],a[1]=p,a[2]=y,a[3]=b,a[4]=E,a[5]=T,a[6]=D,a[7]=R,a[8]=N,a[9]=B,a[10]=j,a[11]=H,a[12]=d*X+E*ie+N*ce+o[12],a[13]=p*X+T*ie+B*ce+o[13],a[14]=y*X+D*ie+j*ce+o[14],a[15]=b*X+R*ie+H*ce+o[15]),a}function oh(a,o,l){var d=l[0],p=l[1],y=l[2];return a[0]=o[0]*d,a[1]=o[1]*d,a[2]=o[2]*d,a[3]=o[3]*d,a[4]=o[4]*p,a[5]=o[5]*p,a[6]=o[6]*p,a[7]=o[7]*p,a[8]=o[8]*y,a[9]=o[9]*y,a[10]=o[10]*y,a[11]=o[11]*y,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function K0(a,o,l){var d=Math.sin(l),p=Math.cos(l),y=o[4],b=o[5],E=o[6],T=o[7],D=o[8],R=o[9],N=o[10],B=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=y*p+D*d,a[5]=b*p+R*d,a[6]=E*p+N*d,a[7]=T*p+B*d,a[8]=D*p-y*d,a[9]=R*p-b*d,a[10]=N*p-E*d,a[11]=B*p-T*d,a}function dd(a,o,l){var d=Math.sin(l),p=Math.cos(l),y=o[0],b=o[1],E=o[2],T=o[3],D=o[8],R=o[9],N=o[10],B=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=y*p-D*d,a[1]=b*p-R*d,a[2]=E*p-N*d,a[3]=T*p-B*d,a[8]=y*d+D*p,a[9]=b*d+R*p,a[10]=E*d+N*p,a[11]=T*d+B*p,a}function _p(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function U1(a,o,l){var d,p,y,b=l[0],E=l[1],T=l[2],D=Math.hypot(b,E,T);return D<rf?null:(b*=D=1/D,E*=D,T*=D,d=Math.sin(o),p=Math.cos(o),a[0]=b*b*(y=1-p)+p,a[1]=E*b*y+T*d,a[2]=T*b*y-E*d,a[3]=0,a[4]=b*E*y-T*d,a[5]=E*E*y+p,a[6]=T*E*y+b*d,a[7]=0,a[8]=b*T*y+E*d,a[9]=E*T*y-b*d,a[10]=T*T*y+p,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var Ck=ud;function zm(){var a=new Ao(3);return Ao!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function iD(a){var o=new Ao(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function Bm(a){return Math.hypot(a[0],a[1],a[2])}function yp(a,o,l){var d=new Ao(3);return d[0]=a,d[1]=o,d[2]=l,d}function sh(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a}function V1(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function Q0(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function ah(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a}function Um(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a}function da(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a}function sf(a,o,l,d){return a[0]=o[0]+l[0]*d,a[1]=o[1]+l[1]*d,a[2]=o[2]+l[2]*d,a}function ts(a,o){var l=o[0],d=o[1],p=o[2],y=l*l+d*d+p*p;return y>0&&(y=1/Math.sqrt(y)),a[0]=o[0]*y,a[1]=o[1]*y,a[2]=o[2]*y,a}function Rc(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function b_(a,o,l){var d=o[0],p=o[1],y=o[2],b=l[0],E=l[1],T=l[2];return a[0]=p*T-y*E,a[1]=y*b-d*T,a[2]=d*E-p*b,a}function eo(a,o,l){var d=o[0],p=o[1],y=o[2],b=l[3]*d+l[7]*p+l[11]*y+l[15];return a[0]=(l[0]*d+l[4]*p+l[8]*y+l[12])/(b=b||1),a[1]=(l[1]*d+l[5]*p+l[9]*y+l[13])/b,a[2]=(l[2]*d+l[6]*p+l[10]*y+l[14])/b,a}function j1(a,o,l){var d=l[0],p=l[1],y=l[2],b=o[0],E=o[1],T=o[2],D=p*T-y*E,R=y*b-d*T,N=d*E-p*b,B=p*N-y*R,j=y*D-d*N,H=d*R-p*D,X=2*l[3];return R*=X,N*=X,j*=2,H*=2,a[0]=b+(D*=X)+(B*=2),a[1]=E+R+j,a[2]=T+N+H,a}var el,Lc=V1,x_=Q0,J0=Bm;function ev(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a}function w_(a,o){var l=o[0],d=o[1],p=o[2],y=o[3],b=l*l+d*d+p*p+y*y;return b>0&&(b=1/Math.sqrt(b)),a[0]=l*b,a[1]=d*b,a[2]=p*b,a[3]=y*b,a}function hd(a,o,l){var d=o[0],p=o[1],y=o[2],b=o[3];return a[0]=l[0]*d+l[4]*p+l[8]*y+l[12]*b,a[1]=l[1]*d+l[5]*p+l[9]*y+l[13]*b,a[2]=l[2]*d+l[6]*p+l[10]*y+l[14]*b,a[3]=l[3]*d+l[7]*p+l[11]*y+l[15]*b,a}function $1(){var a=new Ao(4);return Ao!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function tv(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function nv(a,o,l){l*=.5;var d=o[0],p=o[1],y=o[2],b=o[3],E=Math.sin(l),T=Math.cos(l);return a[0]=d*T+b*E,a[1]=p*T+y*E,a[2]=y*T-p*E,a[3]=b*T-d*E,a}function iv(a,o,l){l*=.5;var d=o[0],p=o[1],y=o[2],b=o[3],E=Math.sin(l),T=Math.cos(l);return a[0]=d*T-y*E,a[1]=p*T+b*E,a[2]=y*T+d*E,a[3]=b*T-p*E,a}zm(),el=new Ao(4),Ao!=Float32Array&&(el[0]=0,el[1]=0,el[2]=0,el[3]=0);var H1=w_;zm(),yp(1,0,0),yp(0,1,0),$1(),$1(),B1();const rD=Fe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Vm}=rD,lh=Fe([{name:"a_pos_3",components:3,type:"Int16"}]);var jm=Fe([{name:"a_pos",type:"Int16",components:2}]);class E_{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,d){const p=Rc(l,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/p;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,d[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(o,l,d){if(X=(j=this.pos)[0],ie=j[1],ce=j[2],be=(H=o)[0],de=H[1],ve=H[2],Math.abs(X-be)<=rf*Math.max(1,Math.abs(X),Math.abs(be))&&Math.abs(ie-de)<=rf*Math.max(1,Math.abs(ie),Math.abs(de))&&Math.abs(ce-ve)<=rf*Math.max(1,Math.abs(ce),Math.abs(ve))||0===l)return d[0]=d[1]=d[2]=0,!1;var j,H,X,ie,ce,be,de,ve;const[p,y,b]=this.dir,E=this.pos[0]-o[0],T=this.pos[1]-o[1],D=this.pos[2]-o[2],R=p*p+y*y+b*b,N=2*(E*p+T*y+D*b),B=N*N-4*R*(E*E+T*T+D*D-l*l);if(B<0){const j=Math.max(-N/2,0),H=E+p*j,X=T+y*j,ie=D+b*j,ce=Math.hypot(H,X,ie);return d[0]=H*l/ce,d[1]=X*l/ce,d[2]=ie*l/ce,!1}{const j=(-N-Math.sqrt(B))/(2*R);if(j<0){const H=Math.hypot(E,T,D);return d[0]=E*l/H,d[1]=T*l/H,d[2]=D*l/H,!1}return d[0]=E+p*j,d[1]=T+y*j,d[2]=D+b*j,!0}}}class C_{constructor(o,l,d,p,y){this.TL=o,this.TR=l,this.BR=d,this.BL=p,this.horizon=y}static fromInvProjectionMatrix(o,l,d){const p=[-1,1,1],y=[1,1,1],b=[1,-1,1],E=[-1,-1,1],T=eo(p,p,o),D=eo(y,y,o),R=eo(b,b,o),N=eo(E,E,o);return new C_(T,D,R,N,l/d)}}class ch{constructor(o,l){this.points=o,this.planes=l}static fromInvProjectionMatrix(o,l,d,p){const y=Math.pow(2,d),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const D=hd([],T,o),R=1/D[3]/l*y;return(N=D)[0]=(B=D)[0]*(j=[R,R,p?1/D[3]:R,R])[0],N[1]=B[1]*j[1],N[2]=B[2]*j[2],N[3]=B[3]*j[3],N;var N,B,j}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const D=ts([],b_([],Lc([],b[T[0]],b[T[1]]),Lc([],b[T[2]],b[T[1]]))),R=-Rc(D,b[T[1]]);return D.concat(R)});return new ch(b,E)}}class ha{static fromPoints(o){const l=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const p of o)ah(l,l,p),Um(d,d,p);return new ha(l,d)}static applyTransform(o,l){const d=o.getCorners();for(let p=0;p<d.length;++p)eo(d[p],d[p],l);return ha.fromPoints(d)}constructor(o,l){this.min=o,this.max=l,this.center=da([],sh([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],d=iD(this.min),p=iD(this.max);for(let y=0;y<l.length;y++)d[y]=l[y]?this.min[y]:this.center[y],p[y]=l[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new ha(d,p)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){const l=this.getCorners();let d=!0;for(let p=0;p<o.planes.length;p++){const y=o.planes[p];let b=0;for(let E=0;E<l.length;E++)b+=Rc(y,l[E])+y[3]>=0;if(0===b)return 0;b!==l.length&&(d=!1)}if(d)return 2;for(let p=0;p<3;p++){let y=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let E=0;E<o.points.length;E++){const T=o.points[E][p]-this.min[p];y=Math.min(y,T),b=Math.max(b,T)}if(b<0||y>this.max[p]-this.min[p])return 0}return 1}}const $m=5,M_=6,du=Tn/Math.PI/2,G1=16383,fu=[64,32,16],Fs=-du,Ns=du,q1=[new ha([Fs,Fs,Fs],[Ns,Ns,Ns]),new ha([Fs,Fs,Fs],[0,0,Ns]),new ha([0,Fs,Fs],[Ns,0,Ns]),new ha([Fs,0,Fs],[0,Ns,Ns]),new ha([0,0,Fs],[Ns,Ns,Ns])];function vp(a){return a*du/D_}function af(a,o,l,d=!0){const p=da([],a._camera.position,a.worldSize),y=[o,l,1,1];hd(y,y,a.pixelMatrixInverse),ev(y,y,1/y[3]);const b=ts([],Lc([],y,p)),E=a.globeMatrix,T=[E[12],E[13],E[14]],D=Lc([],T,p),R=Bm(D),N=ts([],D),B=a.worldSize/(2*Math.PI),j=Rc(N,b),H=Math.asin(B/R);if(H<Math.acos(j)){if(!d)return null;const Mt=[],Je=[];da(Mt,b,R/j),ts(Je,Lc(Je,Mt,D)),ts(b,sh(b,D,da(b,Je,Math.tan(H)*R)))}const X=[];new E_(p,b).closestPointOnSphere(T,B,X);const ie=ts([],ml(E,0)),ce=ts([],ml(E,1)),be=ts([],ml(E,2)),de=Rc(ie,X),ve=Rc(ce,X),xe=Rc(be,X),Ce=_o(Math.asin(-ve/B));let Xe=_o(Math.atan2(de,xe));Xe=a.center.lng+function(Mt,Je){const mt=(Je-Mt+180)%360-180;return mt<-180?mt+360:mt}(a.center.lng,Xe);const Ge=Fc(Xe),st=ni(mu(Ce),0,1);return new pd(Ge,st)}class Mk{constructor(o,l,d){this.a=Lc([],o,d),this.b=Lc([],l,d),this.center=d;const p=ts([],this.a),y=ts([],this.b);this.angle=Math.acos(Rc(p,y))}}function rv(a,o){if(0===a.angle)return null;let l;return l=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(d,p,y,b){const E=Math.sin(y);return d*(Math.sin((1-b)*y)/E)+p*(Math.sin(b*y)/E)}(a.a[o],a.b[o],a.angle,ni(l,0,1))+a.center[o]}function fd(a){if(a.z<=1)return q1[a.z+2*a.y+a.x];const o=lf(ov(a));return ha.fromPoints(o)}function bp(a,o,l){return da(a,a,1-l),sf(a,a,o,l)}function oD(a,o){const l=cf(o.zoom);if(0===l)return fd(a);const d=ov(a),p=lf(d),y=Fc(d.getWest())*o.worldSize,b=Fc(d.getEast())*o.worldSize,E=mu(d.getNorth())*o.worldSize,T=mu(d.getSouth())*o.worldSize,D=[y,E,0],R=[b,E,0],N=[y,T,0],B=[b,T,0],j=mp([],o.globeMatrix);return eo(D,D,j),eo(R,R,j),eo(N,N,j),eo(B,B,j),p[0]=bp(p[0],N,l),p[1]=bp(p[1],B,l),p[2]=bp(p[2],R,l),p[3]=bp(p[3],D,l),ha.fromPoints(p)}function sD(a,o,l){for(const d of a)eo(d,d,o),da(d,d,l)}function ov({x:a,y:o,z:l}){const d=1/(1<<l),p=new Bi(Pl(a*d),ms((o+1)*d)),y=new Bi(Pl((a+1)*d),ms(o*d));return new cd(p,y)}function lf(a){const o=Nn(a.getNorth()),l=Nn(a.getSouth()),d=Math.cos(o),p=Math.cos(l),y=Math.sin(o),b=Math.sin(l),E=a.getWest(),T=a.getEast();return[Hm(p,b,E),Hm(p,b,T),Hm(d,y,T),Hm(d,y,E)]}function Hm(a,o,l,d=du){return l=Nn(l),[a*Math.sin(l)*d,-o*d,a*Math.cos(l)*d]}function Gm(a,o,l){return Hm(Math.cos(Nn(a)),Math.sin(Nn(a)),o,l)}function po(a,o,l,d){const p=1<<l.z,y=(a/Tn+l.x)/p;return Gm(ms((o/Tn+l.y)/p),Pl(y),d)}function T_({min:a,max:o}){return G1/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const xp=new Float64Array(16);function qm(a){const o=T_(a),l=_p(xp,[o,o,o]);return gp(l,l,((d=[])[0]=-(p=a.min)[0],d[1]=-p[1],d[2]=-p[2],d));var d,p}function tl(a){const o=(d=a.min,(l=xp)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=d[0],l[13]=d[1],l[14]=d[2],l[15]=1,l);var l,d;const p=1/T_(a);return oh(o,o,[p,p,p])}function wp(a,o,l,d,p){const y=function(T){const D=Tn/(2*Math.PI);return T/(2*Math.PI)/D}(l),b=[a,o,-l/(2*Math.PI)],E=Ja(new Float64Array(16));return gp(E,E,b),oh(E,E,[y,y,y]),K0(E,E,Nn(-p)),dd(E,E,Nn(-d)),E}function cf(a){return hl($m,M_,a)}function Wm(a,o){const l=Gm(o.lat,o.lng);return b=(p=V1([],function(H){const X=Gm(H._center.lat,H._center.lng);let ie=b_([],yp(0,1,0),X);const ce=U1([],-H.angle,X);ie=eo(ie,ie,ce),U1(ce,-H._pitch,ie);const be=ts([],X);return da(be,be,vp(H.cameraToCenterDistance/H.pixelsPerMeter)),eo(be,be,ce),sh([],X,be)}(a),l))[0],E=p[1],T=p[2],D=(y=l)[0],R=y[1],N=y[2],j=(B=Math.sqrt(b*b+E*E+T*T)*Math.sqrt(D*D+R*R+N*N))&&Rc(p,y)/B,Math.acos(Math.min(Math.max(j,-1),1));var p,y,b,E,T,D,R,N,B,j}function uf(a,o){return Wm(a,o)>Math.PI/2*1.01}const W1=Nn(85),Dk=Math.cos(W1),aD=Math.sin(W1),D_=6371008.8,nl=2*Math.PI*D_;class pu{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pu(ii(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,d=this.lat*l,p=o.lat*l,y=Math.sin(d)*Math.sin(p)+Math.cos(d)*Math.cos(p)*Math.cos((o.lng-this.lng)*l);return D_*Math.acos(Math.min(y,1))}toBounds(o=0){const l=360*o/40075017,d=l/Math.cos(Math.PI/180*this.lat);return new cd(new pu(this.lng-d,this.lat-l),new pu(this.lng+d,this.lat+l))}toEcef(o){const l=vp(o);return Gm(this.lat,this.lng,du+l)}static convert(o){if(o instanceof pu)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new pu(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new pu(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Bi=pu;function Z1(a){return nl*Math.cos(a*Math.PI/180)}function Fc(a){return(180+a)/360}function mu(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Nc(a,o){return a/Z1(o)}function Pl(a){return 360*a-180}function ms(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function X1(a,o){return a*Z1(ms(o))}const gs=85.051129;function S_(a){return 1/Math.cos(a*Math.PI/180)}class pd{constructor(o,l,d=0){this.x=+o,this.y=+l,this.z=+d}static fromLngLat(o,l=0){const d=Bi.convert(o);return new pd(Fc(d.lng),mu(d.lat),Nc(l,d.lat))}toLngLat(){return new Bi(Pl(this.x),ms(this.y))}toAltitude(){return X1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/nl*S_(ms(this.y))}}function sv(a,o,l,d,p,y,b,E,T){const D=(o+d)/2,R=(l+p)/2,N=new Gt(D,R);E(N),function(B,j,H,X,ie,ce){const be=H-ie,de=X-ce;return Math.abs((X-j)*be-(H-B)*de)/Math.hypot(be,de)}(N.x,N.y,y.x,y.y,b.x,b.y)>=T?(sv(a,o,l,D,R,y,N,E,T),sv(a,D,R,d,p,N,b,E,T)):a.push(b)}function Zm(a,o,l){let d=a[0],p=d.x,y=d.y;o(d);const b=[d];for(let E=1;E<a.length;E++){const T=a[E],{x:D,y:R}=T;o(T),sv(b,p,y,D,R,d,T,o,l),p=D,y=R,d=T}return b}function av(a,o,l,d){if(d(o,l)){const p=o.add(l)._mult(.5);av(a,o,p,d),av(a,p,l,d)}else a.push(l)}function I_(a,o){let l=a[0];const d=[l];for(let p=1;p<a.length;p++){const y=a[p];av(d,l,y,o),l=y}return d}const lv=Math.pow(2,14)-1,cv=-lv-1;function uv(a,o){const l=Math.round(a.x*o),d=Math.round(a.y*o);return a.x=ni(l,cv,lv),a.y=ni(d,cv,lv),(l<a.x||l>a.x+1||d<a.y||d>a.y+1)&&_r("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function nc(a,o,l){const d=a.loadGeometry(),p=a.extent,y=Tn/p;if(o&&l&&l.projection.isReprojectedInTileSpace){const b=1<<o.z,{scale:E,x:T,y:D,projection:R}=l,N=B=>{const j=Pl((o.x+B.x/p)/b),H=ms((o.y+B.y/p)/b),X=R.project(j,H);B.x=(X.x*E-T)*p,B.y=(X.y*E-D)*p};for(let B=0;B<d.length;B++)if(1!==a.type)d[B]=Zm(d[B],N,1);else{const j=[];for(const H of d[B])H.x<0||H.x>=p||H.y<0||H.y>=p||(N(H),j.push(H));d[B]=j}}for(const b of d)for(const E of b)uv(E,y);return d}function uh(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?nc(a):[]}}function A_(a,o,l,d,p){a.emplaceBack(2*o+(d+1)/2,2*l+(p+1)/2)}function P_(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class dh{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new ht,this.indexArray=new gn,this.segments=new fo,this.programConfigurations=new ih(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,d,p){const y=this.layers[0],b=[];let E=null;"circle"===y.type&&(E=y.layout.get("circle-sort-key"));for(const{feature:D,id:R,index:N,sourceLayerIndex:B}of o){const j=this.layers[0]._featureFilter.needGeometry,H=uh(D,j);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),H,d))continue;const X=E?E.evaluate(H,{},d):void 0,ie={id:R,properties:D.properties,type:D.type,sourceLayerIndex:B,index:N,geometry:j?H.geometry:nc(D,d,p),patterns:{},sortKey:X};b.push(ie)}E&&b.sort((D,R)=>D.sortKey-R.sortKey);let T=null;"globe"===p.projection.name&&(this.globeExtVertexArray=new _t,T=p.projection);for(const D of b){const{geometry:R,index:N,sourceLayerIndex:B}=D,j=o[N].feature;this.addFeature(D,R,N,l.availableImages,d,T),l.featureIndex.insert(j,R,N,B,this.index)}}update(o,l,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,tD.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,nD.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,d,p,y,b){for(const E of l)for(const T of E){const D=T.x,R=T.y;if(D<0||D>=Tn||R<0||R>=Tn)continue;if(b){const j=b.projectTilePoint(D,R,y),H=b.upVector(y,D,R),X=this.globeExtVertexArray;P_(X,j,H),P_(X,j,H),P_(X,j,H),P_(X,j,H)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),B=N.vertexLength;A_(this.layoutVertexArray,D,R,-1,-1),A_(this.layoutVertexArray,D,R,1,-1),A_(this.layoutVertexArray,D,R,1,1),A_(this.layoutVertexArray,D,R,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,{},p,y)}}function Ep(a,o){for(let l=0;l<a.length;l++)if(gu(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(gu(a,o[l]))return!0;return!!dv(a,o)}function lD(a,o,l){return!!gu(a,o)||!!hv(o,a,l)}function cD(a,o){if(1===a.length)return Q1(o,a[0]);for(let l=0;l<o.length;l++){const d=o[l];for(let p=0;p<d.length;p++)if(gu(a,d[p]))return!0}for(let l=0;l<a.length;l++)if(Q1(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(dv(a,o[l]))return!0;return!1}function Y1(a,o,l){if(a.length>1){if(dv(a,o))return!0;for(let d=0;d<o.length;d++)if(hv(o[d],a,l))return!0}for(let d=0;d<a.length;d++)if(hv(a[d],o,l))return!0;return!1}function dv(a,o){if(0===a.length||0===o.length)return!1;for(let l=0;l<a.length-1;l++){const d=a[l],p=a[l+1];for(let y=0;y<o.length-1;y++)if(Sk(d,p,o[y],o[y+1]))return!0}return!1}function Sk(a,o,l,d){return wi(a,l,d)!==wi(o,l,d)&&wi(a,o,l)!==wi(a,o,d)}function hv(a,o,l){const d=l*l;if(1===o.length)return a.distSqr(o[0])<d;for(let p=1;p<o.length;p++)if(K1(a,o[p-1],o[p])<d)return!0;return!1}function K1(a,o,l){const d=o.distSqr(l);if(0===d)return a.distSqr(o);const p=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/d;return a.distSqr(p<0?o:p>1?l:l.sub(o)._mult(p)._add(o))}function Q1(a,o){let l,d,p,y=!1;for(let b=0;b<a.length;b++){l=a[b];for(let E=0,T=l.length-1;E<l.length;T=E++)d=l[E],p=l[T],d.y>o.y!=p.y>o.y&&o.x<(p.x-d.x)*(o.y-d.y)/(p.y-d.y)+d.x&&(y=!y)}return y}function gu(a,o){let l=!1;for(let d=0,p=a.length-1;d<a.length;p=d++){const y=a[d],b=a[p];y.y>o.y!=b.y>o.y&&o.x<(b.x-y.x)*(o.y-y.y)/(b.y-y.y)+y.x&&(l=!l)}return l}function fv(a,o,l,d,p){for(const b of a)if(o<=b.x&&l<=b.y&&d>=b.x&&p>=b.y)return!0;const y=[new Gt(o,l),new Gt(o,p),new Gt(d,p),new Gt(d,l)];if(a.length>2)for(const b of y)if(gu(a,b))return!0;for(let b=0;b<a.length-1;b++)if(uD(a[b],a[b+1],y))return!0;return!1}function uD(a,o,l){const d=l[0],p=l[2];if(a.x<d.x&&o.x<d.x||a.x>p.x&&o.x>p.x||a.y<d.y&&o.y<d.y||a.y>p.y&&o.y>p.y)return!1;const y=wi(a,o,l[0]);return y!==wi(a,o,l[1])||y!==wi(a,o,l[2])||y!==wi(a,o,l[3])}function df(a,o,l){const d=o.paint.get(a).value;return"constant"===d.kind?d.value:l.programConfigurations.get(o.id).getMaxValue(a)}function pv(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function mv(a,o,l,d,p){if(!o[0]&&!o[1])return a;const y=Gt.convert(o)._mult(p);"viewport"===l&&y._rotate(-d);const b=[];for(let E=0;E<a.length;E++)b.push(a[E].sub(y));return b}function dD(a,o,l,d){const p=Gt.convert(a)._mult(d);return"viewport"===o&&p._rotate(-l),p}an(dh,"CircleBucket",{omit:["layers"]});const hD=new _e({"circle-sort-key":new re(nt.layout_circle["circle-sort-key"])});var fD={paint:new _e({"circle-radius":new re(nt.paint_circle["circle-radius"]),"circle-color":new re(nt.paint_circle["circle-color"]),"circle-blur":new re(nt.paint_circle["circle-blur"]),"circle-opacity":new re(nt.paint_circle["circle-opacity"]),"circle-translate":new W(nt.paint_circle["circle-translate"]),"circle-translate-anchor":new W(nt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new W(nt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new W(nt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new re(nt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new re(nt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new re(nt.paint_circle["circle-stroke-opacity"])}),layout:hD};function O_(a,o,l,d,p,y,b,E,T){if(y&&a.queryGeometry.isAboveHorizon)return!1;y&&(T*=a.pixelToTileUnitsFactor);const D=a.tileID.canonical,R=l.projection.upVectorScale(D,l.center.lat,l.worldSize).metersToTile;for(const N of o)for(const B of N){const j=B.add(E),H=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(j.x,j.y,!0):0,X=l.projection.projectTilePoint(j.x,j.y,D);if(H>0){const de=l.projection.upVector(D,j.x,j.y);X.x+=de[0]*R*H,X.y+=de[1]*R*H,X.z+=de[2]*R*H}const ie=y?j:Ik(X.x,X.y,X.z,d),ce=y?a.tilespaceRays.map(de=>Ak(de,H)):a.queryGeometry.screenGeometry,be=hd([],[X.x,X.y,X.z,1],d);if(!b&&y?T*=be[3]/l.cameraToCenterDistance:b&&!y&&(T*=l.cameraToCenterDistance/be[3]),y){const de=ms((B.y/Tn+D.y)/(1<<D.z));T/=l.projection.pixelsPerMeter(de,1)/Nc(1,de)}if(lD(ce,ie,T))return!0}return!1}function Ik(a,o,l,d){const p=hd([],[a,o,l,1],d);return new Gt(p[0]/p[3],p[1]/p[3])}const pD=yp(0,0,0),gv=yp(0,0,1);function Ak(a,o){const l=zm();return pD[2]=o,a.intersectsPlane(pD,gv,l),new Gt(l[0],l[1])}class mD extends dh{}function gD(a,{width:o,height:l},d,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==o*l*d)throw new RangeError("mismatched image size")}else p=new Uint8Array(o*l*d);return a.width=o,a.height=l,a.data=p,a}function _D(a,o,l){const{width:d,height:p}=o;d===a.width&&p===a.height||(J1(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,d),height:Math.min(a.height,p)},l),a.width=d,a.height=p,a.data=o.data)}function J1(a,o,l,d,p,y){if(0===p.width||0===p.height)return o;if(p.width>a.width||p.height>a.height||l.x>a.width-p.width||l.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>o.width||p.height>o.height||d.x>o.width-p.width||d.y>o.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,E=o.data;for(let T=0;T<p.height;T++){const D=((l.y+T)*a.width+l.x)*y,R=((d.y+T)*o.width+d.x)*y;for(let N=0;N<p.width*y;N++)E[R+N]=b[D+N]}return o}an(mD,"HeatmapBucket",{omit:["layers"]});class md{constructor(o,l){gD(this,o,1,l)}resize(o){_D(this,new md(o),1)}clone(){return new md({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,p,y){J1(o,l,d,p,y,1)}}class zs{constructor(o,l){gD(this,o,4,l)}resize(o){_D(this,new zs(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new zs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,p,y){J1(o,l,d,p,y,4)}}an(md,"AlphaImage"),an(zs,"RGBAImage");var _v={paint:new _e({"heatmap-radius":new re(nt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new re(nt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new W(nt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fe(nt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new W(nt.paint_heatmap["heatmap-opacity"])})};function k_(a){const o={},l=a.resolution||256,d=a.clips?a.clips.length:1,p=a.image||new zs({width:l,height:d}),y=(b,E,T)=>{o[a.evaluationKey]=T;const D=a.expression.evaluate(o);p.data[b+E+0]=Math.floor(255*D.r/D.a),p.data[b+E+1]=Math.floor(255*D.g/D.a),p.data[b+E+2]=Math.floor(255*D.b/D.a),p.data[b+E+3]=Math.floor(255*D.a)};if(a.clips)for(let b=0,E=0;b<d;++b,E+=4*l)for(let T=0,D=0;T<l;T++,D+=4){const R=T/(l-1),{start:N,end:B}=a.clips[b];y(E,D,N*(1-R)+B*R)}else for(let b=0,E=0;b<l;b++,E+=4)y(0,E,b/(l-1));return p}var ew={paint:new _e({"hillshade-illumination-direction":new W(nt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new W(nt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new W(nt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new W(nt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new W(nt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new W(nt.paint_hillshade["hillshade-accent-color"])})};const tw=Fe([{name:"a_pos",components:2,type:"Int16"}],4),{members:Cp}=tw;var R_={exports:{}};function Xm(a,o,l){l=l||2;var d,p,y,b,E,T,D,R=o&&o.length,N=R?o[0]*l:a.length,B=Ym(a,0,N,l,!0),j=[];if(!B||B.next===B.prev)return j;if(R&&(B=function(X,ie,ce,be){var de,ve,xe,Ce=[];for(de=0,ve=ie.length;de<ve;de++)(xe=Ym(X,ie[de]*be,de<ve-1?ie[de+1]*be:X.length,be,!1))===xe.next&&(xe.steiner=!0),Ce.push(iw(xe));for(Ce.sort(yv),de=0;de<Ce.length;de++)ce=xD(Ce[de],ce);return ce}(a,o,B,l)),a.length>80*l){d=y=a[0],p=b=a[1];for(var H=l;H<N;H+=l)(E=a[H])<d&&(d=E),(T=a[H+1])<p&&(p=T),E>y&&(y=E),T>b&&(b=T);D=0!==(D=Math.max(y-d,b-p))?32767/D:0}return _s(B,j,l,d,p,D,0),j}function Ym(a,o,l,d,p){var y,b;if(p===Ev(a,o,l,d)>0)for(y=o;y<l;y+=d)b=wv(y,a[y],a[y+1],b);else for(y=l-d;y>=o;y-=d)b=wv(y,a[y],a[y+1],b);return b&&Tp(b,b.next)&&(Km(b),b=b.next),b}function _u(a,o){if(!a)return a;o||(o=a);var l,d=a;do{if(l=!1,d.steiner||!Tp(d,d.next)&&0!==Ui(d.prev,d,d.next))d=d.next;else{if(Km(d),(d=o=d.prev)===d.next)break;l=!0}}while(l||d!==o);return o}function _s(a,o,l,d,p,y,b){if(a){!b&&y&&function(R,N,B,j){var H=R;do{0===H.z&&(H.z=vv(H.x,H.y,N,B,j)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next}while(H!==R);H.prevZ.nextZ=null,H.prevZ=null,function(X){var ie,ce,be,de,ve,xe,Ce,Xe,Ge=1;do{for(ce=X,X=null,ve=null,xe=0;ce;){for(xe++,be=ce,Ce=0,ie=0;ie<Ge&&(Ce++,be=be.nextZ);ie++);for(Xe=Ge;Ce>0||Xe>0&&be;)0!==Ce&&(0===Xe||!be||ce.z<=be.z)?(de=ce,ce=ce.nextZ,Ce--):(de=be,be=be.nextZ,Xe--),ve?ve.nextZ=de:X=de,de.prevZ=ve,ve=de;ce=be}ve.nextZ=null,Ge*=2}while(xe>1)}(H)}(a,d,p,y);for(var E,T,D=a;a.prev!==a.next;)if(E=a.prev,T=a.next,y?vD(a,d,p,y):yD(a))o.push(E.i/l|0),o.push(a.i/l|0),o.push(T.i/l|0),Km(a),a=T.next,D=T.next;else if((a=T)===D){b?1===b?_s(a=bD(_u(a),o,l),o,l,d,p,y,2):2===b&&nw(a,o,l,d,p,y):_s(_u(a),o,l,d,p,y,1);break}}}function yD(a){var o=a.prev,l=a,d=a.next;if(Ui(o,l,d)>=0)return!1;for(var p=o.x,y=l.x,b=d.x,E=o.y,T=l.y,D=d.y,R=p<y?p<b?p:b:y<b?y:b,N=E<T?E<D?E:D:T<D?T:D,B=p>y?p>b?p:b:y>b?y:b,j=E>T?E>D?E:D:T>D?T:D,H=d.next;H!==o;){if(H.x>=R&&H.x<=B&&H.y>=N&&H.y<=j&&Mp(p,E,y,T,b,D,H.x,H.y)&&Ui(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function vD(a,o,l,d){var p=a.prev,y=a,b=a.next;if(Ui(p,y,b)>=0)return!1;for(var E=p.x,T=y.x,D=b.x,R=p.y,N=y.y,B=b.y,j=E<T?E<D?E:D:T<D?T:D,H=R<N?R<B?R:B:N<B?N:B,X=E>T?E>D?E:D:T>D?T:D,ie=R>N?R>B?R:B:N>B?N:B,ce=vv(j,H,o,l,d),be=vv(X,ie,o,l,d),de=a.prevZ,ve=a.nextZ;de&&de.z>=ce&&ve&&ve.z<=be;){if(de.x>=j&&de.x<=X&&de.y>=H&&de.y<=ie&&de!==p&&de!==b&&Mp(E,R,T,N,D,B,de.x,de.y)&&Ui(de.prev,de,de.next)>=0||(de=de.prevZ,ve.x>=j&&ve.x<=X&&ve.y>=H&&ve.y<=ie&&ve!==p&&ve!==b&&Mp(E,R,T,N,D,B,ve.x,ve.y)&&Ui(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;de&&de.z>=ce;){if(de.x>=j&&de.x<=X&&de.y>=H&&de.y<=ie&&de!==p&&de!==b&&Mp(E,R,T,N,D,B,de.x,de.y)&&Ui(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;ve&&ve.z<=be;){if(ve.x>=j&&ve.x<=X&&ve.y>=H&&ve.y<=ie&&ve!==p&&ve!==b&&Mp(E,R,T,N,D,B,ve.x,ve.y)&&Ui(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function bD(a,o,l){var d=a;do{var p=d.prev,y=d.next.next;!Tp(p,y)&&bv(p,d,d.next,y)&&gd(p,y)&&gd(y,p)&&(o.push(p.i/l|0),o.push(d.i/l|0),o.push(y.i/l|0),Km(d),Km(d.next),d=a=y),d=d.next}while(d!==a);return _u(d)}function nw(a,o,l,d,p,y){var b=a;do{for(var E=b.next.next;E!==b.prev;){if(b.i!==E.i&&ED(b,E)){var T=xv(b,E);return b=_u(b,b.next),T=_u(T,T.next),_s(b,o,l,d,p,y,0),void _s(T,o,l,d,p,y,0)}E=E.next}b=b.next}while(b!==a)}function yv(a,o){return a.x-o.x}function xD(a,o){var l=function(p,y){var b,E=y,T=p.x,D=p.y,R=-1/0;do{if(D<=E.y&&D>=E.next.y&&E.next.y!==E.y){var N=E.x+(D-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(N<=T&&N>R&&(R=N,b=E.x<E.next.x?E:E.next,N===T))return b}E=E.next}while(E!==y);if(!b)return null;var B,j=b,H=b.x,X=b.y,ie=1/0;E=b;do{T>=E.x&&E.x>=H&&T!==E.x&&Mp(D<X?T:R,D,H,X,D<X?R:T,D,E.x,E.y)&&(B=Math.abs(D-E.y)/(T-E.x),gd(E,p)&&(B<ie||B===ie&&(E.x>b.x||E.x===b.x&&wD(b,E)))&&(b=E,ie=B)),E=E.next}while(E!==j);return b}(a,o);if(!l)return o;var d=xv(l,a);return _u(d,d.next),_u(l,l.next)}function wD(a,o){return Ui(a.prev,a,o.prev)<0&&Ui(o.next,a,a.next)<0}function vv(a,o,l,d,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*p|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-d)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function iw(a){var o=a,l=a;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==a);return l}function Mp(a,o,l,d,p,y,b,E){return(p-b)*(o-E)>=(a-b)*(y-E)&&(a-b)*(d-E)>=(l-b)*(o-E)&&(l-b)*(y-E)>=(p-b)*(d-E)}function ED(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,d){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==d.i&&p.next.i!==d.i&&bv(p,p.next,l,d))return!0;p=p.next}while(p!==l);return!1}(a,o)&&(gd(a,o)&&gd(o,a)&&function(l,d){var p=l,y=!1,b=(l.x+d.x)/2,E=(l.y+d.y)/2;do{p.y>E!=p.next.y>E&&p.next.y!==p.y&&b<(p.next.x-p.x)*(E-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next}while(p!==l);return y}(a,o)&&(Ui(a.prev,a,o.prev)||Ui(a,o.prev,o))||Tp(a,o)&&Ui(a.prev,a,a.next)>0&&Ui(o.prev,o,o.next)>0)}function Ui(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function Tp(a,o){return a.x===o.x&&a.y===o.y}function bv(a,o,l,d){var p=ns(Ui(a,o,l)),y=ns(Ui(a,o,d)),b=ns(Ui(l,d,a)),E=ns(Ui(l,d,o));return p!==y&&b!==E||!(0!==p||!Dp(a,l,o))||!(0!==y||!Dp(a,d,o))||!(0!==b||!Dp(l,a,d))||!(0!==E||!Dp(l,o,d))}function Dp(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function ns(a){return a>0?1:a<0?-1:0}function gd(a,o){return Ui(a.prev,a,a.next)<0?Ui(a,o,a.next)>=0&&Ui(a,a.prev,o)>=0:Ui(a,o,a.prev)<0||Ui(a,a.next,o)<0}function xv(a,o){var l=new L_(a.i,a.x,a.y),d=new L_(o.i,o.x,o.y),p=a.next,y=o.prev;return a.next=o,o.prev=a,l.next=p,p.prev=l,d.next=l,l.prev=d,y.next=d,d.prev=y,d}function wv(a,o,l,d){var p=new L_(a,o,l);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function Km(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function L_(a,o,l){this.i=a,this.x=o,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ev(a,o,l,d){for(var p=0,y=o,b=l-d;y<l;y+=d)p+=(a[b]-a[y])*(a[y+1]+a[b+1]),b=y;return p}R_.exports=Xm,R_.exports.default=Xm,Xm.deviation=function(a,o,l,d){var p=o&&o.length,y=Math.abs(Ev(a,0,p?o[0]*l:a.length,l));if(p)for(var b=0,E=o.length;b<E;b++)y-=Math.abs(Ev(a,o[b]*l,b<E-1?o[b+1]*l:a.length,l));var T=0;for(b=0;b<d.length;b+=3){var D=d[b]*l,R=d[b+1]*l,N=d[b+2]*l;T+=Math.abs((a[D]-a[N])*(a[R+1]-a[D+1])-(a[D]-a[R])*(a[N+1]-a[D+1]))}return 0===y&&0===T?0:Math.abs((T-y)/y)},Xm.flatten=function(a){for(var o=a[0][0].length,l={vertices:[],holes:[],dimensions:o},d=0,p=0;p<a.length;p++){for(var y=0;y<a[p].length;y++)for(var b=0;b<o;b++)l.vertices.push(a[p][y][b]);p>0&&l.holes.push(d+=a[p-1].length)}return l};var F_=fr(R_.exports);function CD(a,o,l,d,p){Cv(a,o,l||0,d||a.length-1,p||MD)}function Cv(a,o,l,d,p){for(;d>l;){if(d-l>600){var y=d-l+1,b=o-l+1,E=Math.log(y),T=.5*Math.exp(2*E/3),D=.5*Math.sqrt(E*T*(y-T)/y)*(b-y/2<0?-1:1);Cv(a,o,Math.max(l,Math.floor(o-b*T/y+D)),Math.min(d,Math.floor(o+(y-b)*T/y+D)),p)}var R=a[o],N=l,B=d;for(Qm(a,l,o),p(a[d],R)>0&&Qm(a,l,d);N<B;){for(Qm(a,N,B),N++,B--;p(a[N],R)<0;)N++;for(;p(a[B],R)>0;)B--}0===p(a[l],R)?Qm(a,l,B):Qm(a,++B,d),B<=o&&(l=B+1),o<=B&&(d=B-1)}}function Qm(a,o,l){var d=a[o];a[o]=a[l],a[l]=d}function MD(a,o){return a<o?-1:a>o?1:0}function Jm(a,o){const l=a.length;if(l<=1)return[a];const d=[];let p,y;for(let b=0;b<l;b++){const E=Ua(a[b]);0!==E&&(a[b].area=Math.abs(E),void 0===y&&(y=E<0),y===E<0?(p&&d.push(p),p=[a[b]]):p.push(a[b]))}if(p&&d.push(p),o>1)for(let b=0;b<d.length;b++)d[b].length<=o||(CD(d[b],o,1,d[b].length-1,Mv),d[b]=d[b].slice(0,o));return d}function Mv(a,o){return o.area-a.area}function Tv(a,o,l){const d=l.patternDependencies;let p=!1;for(const y of o){const b=y.paint.get(`${a}-pattern`);b.isConstant()||(p=!0);const E=b.constantOr(null);E&&(p=!0,d[E]=!0)}return p}function hf(a,o,l,d,p){const y=p.patternDependencies;for(const b of o){const E=b.paint.get(`${a}-pattern`).value;if("constant"!==E.kind){let T=E.evaluate({zoom:d},l,{},p.availableImages);T=T&&T.name?T.name:T,y[T]=!0,l.patterns[b.id]=T}}return l}class N_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ht,this.indexArray=new gn,this.indexArray2=new Fo,this.programConfigurations=new ih(o.layers,o.zoom),this.segments=new fo,this.segments2=new fo,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}populate(o,l,d,p){this.hasPattern=Tv("fill",this.layers,l);const y=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:E,id:T,index:D,sourceLayerIndex:R}of o){const N=this.layers[0]._featureFilter.needGeometry,B=uh(E,N);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),B,d))continue;const j=y?y.evaluate(B,{},d,l.availableImages):void 0,H={id:T,properties:E.properties,type:E.type,sourceLayerIndex:R,index:D,geometry:N?B.geometry:nc(E,d,p),patterns:{},sortKey:j};b.push(H)}y&&b.sort((E,T)=>E.sortKey-T.sortKey);for(const E of b){const{geometry:T,index:D,sourceLayerIndex:R}=E;if(this.hasPattern){const N=hf("fill",this.layers,E,this.zoom,l);this.patternFeatures.push(N)}else this.addFeature(E,T,D,d,{},l.availableImages);l.featureIndex.insert(o[D].feature,T,D,R,this.index)}}update(o,l,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,p)}addFeatures(o,l,d,p,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,d,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Cp),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,d,p,y,b=[]){for(const E of Jm(l,500)){let T=0;for(const H of E)T+=H.length;const D=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),R=D.vertexLength,N=[],B=[];for(const H of E){if(0===H.length)continue;H!==E[0]&&B.push(N.length/2);const X=this.segments2.prepareSegment(H.length,this.layoutVertexArray,this.indexArray2),ie=X.vertexLength;this.layoutVertexArray.emplaceBack(H[0].x,H[0].y),this.indexArray2.emplaceBack(ie+H.length-1,ie),N.push(H[0].x),N.push(H[0].y);for(let ce=1;ce<H.length;ce++)this.layoutVertexArray.emplaceBack(H[ce].x,H[ce].y),this.indexArray2.emplaceBack(ie+ce-1,ie+ce),N.push(H[ce].x),N.push(H[ce].y);X.vertexLength+=H.length,X.primitiveLength+=H.length}const j=F_(N,B);for(let H=0;H<j.length;H+=3)this.indexArray.emplaceBack(R+j[H],R+j[H+1],R+j[H+2]);D.vertexLength+=T,D.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,y,b,p)}}an(N_,"FillBucket",{omit:["layers","patternFeatures"]});const TD=new _e({"fill-sort-key":new re(nt.layout_fill["fill-sort-key"])});var rw={paint:new _e({"fill-antialias":new W(nt.paint_fill["fill-antialias"]),"fill-opacity":new re(nt.paint_fill["fill-opacity"]),"fill-color":new re(nt.paint_fill["fill-color"]),"fill-outline-color":new re(nt.paint_fill["fill-outline-color"]),"fill-translate":new W(nt.paint_fill["fill-translate"]),"fill-translate-anchor":new W(nt.paint_fill["fill-translate-anchor"]),"fill-pattern":new re(nt.paint_fill["fill-pattern"])}),layout:TD};const ow=Fe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sw=Fe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Sp=Fe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:z_}=ow;var eg={},Dv=dl,tg=Ip;function Ip(a,o,l,d,p){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=p,a.readFields(DD,this,o)}function DD(a,o,l){1==a?o.id=l.readVarint():2==a?function(d,p){for(var y=d.readVarint()+d.pos;d.pos<y;){var b=p._keys[d.readVarint()],E=p._values[d.readVarint()];p.properties[b]=E}}(l,o):3==a?o.type=l.readVarint():4==a&&(o._geometry=l.pos)}function SD(a){for(var o,l,d=0,p=0,y=a.length,b=y-1;p<y;b=p++)d+=((l=a[b]).x-(o=a[p]).x)*(o.y+l.y);return d}Ip.types=["Unknown","Point","LineString","Polygon"],Ip.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,d=1,p=0,y=0,b=0,E=[];a.pos<l;){if(p<=0){var T=a.readVarint();d=7&T,p=T>>3}if(p--,1===d||2===d)y+=a.readSVarint(),b+=a.readSVarint(),1===d&&(o&&E.push(o),o=[]),o.push(new Dv(y,b));else{if(7!==d)throw new Error("unknown command "+d);o&&o.push(o[0].clone())}}return o&&E.push(o),E},Ip.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,d=0,p=0,y=0,b=1/0,E=-1/0,T=1/0,D=-1/0;a.pos<o;){if(d<=0){var R=a.readVarint();l=7&R,d=R>>3}if(d--,1===l||2===l)(p+=a.readSVarint())<b&&(b=p),p>E&&(E=p),(y+=a.readSVarint())<T&&(T=y),y>D&&(D=y);else if(7!==l)throw new Error("unknown command "+l)}return[b,T,E,D]},Ip.prototype.toGeoJSON=function(a,o,l){var d,p,y=this.extent*Math.pow(2,l),b=this.extent*a,E=this.extent*o,T=this.loadGeometry(),D=Ip.types[this.type];function R(j){for(var H=0;H<j.length;H++){var X=j[H];j[H]=[360*(X.x+b)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+E)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(d=0;d<T.length;d++)N[d]=T[d][0];R(T=N);break;case 2:for(d=0;d<T.length;d++)R(T[d]);break;case 3:for(T=function(j){var H=j.length;if(H<=1)return[j];for(var X,ie,ce=[],be=0;be<H;be++){var de=SD(j[be]);0!==de&&(void 0===ie&&(ie=de<0),ie===de<0?(X&&ce.push(X),X=[j[be]]):X.push(j[be]))}return X&&ce.push(X),ce}(T),d=0;d<T.length;d++)for(p=0;p<T[d].length;p++)R(T[d][p])}1===T.length?T=T[0]:D="Multi"+D;var B={type:"Feature",geometry:{type:D,coordinates:T},properties:this.properties};return"id"in this&&(B.id=this.id),B};var ID=tg,aw=lw;function lw(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(cw,this,o),this.length=this._features.length}function cw(a,o,l){15===a?o.version=l.readVarint():1===a?o.name=l.readString():5===a?o.extent=l.readVarint():2===a?o._features.push(l.pos):3===a?o._keys.push(l.readString()):4===a&&o._values.push(function(d){for(var p=null,y=d.readVarint()+d.pos;d.pos<y;){var b=d.readVarint()>>3;p=1===b?d.readString():2===b?d.readFloat():3===b?d.readDouble():4===b?d.readVarint64():5===b?d.readVarint():6===b?d.readSVarint():7===b?d.readBoolean():null}return p}(l))}lw.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new ID(this._pbf,o,this.extent,this._keys,this._values)};var Sv=aw;function uw(a,o,l){if(3===a){var d=new Sv(l,l.readVarint()+l.pos);d.length&&(o[d.name]=d)}}var ng=eg.VectorTile=function(a,o){this.layers=a.readFields(uw,{},o)},B_=eg.VectorTileFeature=tg;function U_(a,o,l,d){const p=[],y=0===d?(b,E,T,D,R,N)=>{b.push(new Gt(N,T+(N-E)/(D-E)*(R-T)))}:(b,E,T,D,R,N)=>{b.push(new Gt(E+(N-T)/(R-T)*(D-E),N))};for(const b of a){const E=[];for(const T of b){if(T.length<=2)continue;const D=[];for(let B=0;B<T.length-1;B++){const j=T[B].x,H=T[B].y,X=T[B+1].x,ie=T[B+1].y,ce=0===d?j:H,be=0===d?X:ie;ce<o?be>o&&y(D,j,H,X,ie,o):ce>l?be<l&&y(D,j,H,X,ie,l):D.push(T[B]),be<o&&ce>=o&&y(D,j,H,X,ie,o),be>l&&ce<=l&&y(D,j,H,X,ie,l)}let R=T[T.length-1];const N=0===d?R.x:R.y;N>=o&&N<=l&&D.push(R),D.length&&(R=D[D.length-1],D[0].x===R.x&&D[0].y===R.y||D.push(D[0]),E.push(D))}E.length&&p.push(E)}return p}eg.VectorTileLayer=aw;const Iv=B_.types,dw=Math.pow(2,13);function zc(a,o,l,d,p,y,b,E){a.emplaceBack((o<<1)+b,(l<<1)+y,(Math.floor(d*dw)<<1)+p,Math.round(E))}function Ap(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Av{constructor(){this.acc=new Gt(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Gt(o.x,o.y),this.max=new Gt(o.x,o.y))}append(o,l){this.currentPolyCount.edges++,this.acc._add(o);const d=this.min,p=this.max;o.x<d.x?d.x=o.x:o.x>p.x&&(p.x=o.x),o.y<d.y?d.y=o.y:o.y>p.y&&(p.y=o.y),((0===o.x||o.x===Tn)&&o.x===l.x)!=((0===o.y||o.y===Tn)&&o.y===l.y)&&this.processBorderOverlap(o,l),l.x<0!=o.x<0&&this.addBorderIntersection(0,ai(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Tn!=o.x>Tn&&this.addBorderIntersection(1,ai(l.y,o.y,(Tn-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,ai(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Tn!=o.y>Tn&&this.addBorderIntersection(3,ai(l.x,o.x,(Tn-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[o];l<d[0]&&(d[0]=l),l>d[1]&&(d[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const d=0===o.x?0:1;this.addBorderIntersection(d,l.y),this.addBorderIntersection(d,o.y)}else{const d=0===o.y?2:3;this.addBorderIntersection(d,l.x),this.addBorderIntersection(d,o.x)}}centroid(){const o=this.polyCount.reduce((l,d)=>l+d.edges,0);return 0!==o?this.acc.div(o)._round():new Gt(0,0)}span(){return new Gt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0)}}class ig{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new dt,this.centroidVertexArray=new Vr,this.indexArray=new gn,this.programConfigurations=new ih(o.layers,o.zoom),this.segments=new fo,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=o.enableTerrain}populate(o,l,d,p){this.features=[],this.hasPattern=Tv("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(y){const b=Math.exp(Math.PI*(1-y.y/(1<<y.z)*2));return 80150034*b/(b*b+1)/Tn/(1<<y.z)}(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:y,id:b,index:E,sourceLayerIndex:T}of o){const D=this.layers[0]._featureFilter.needGeometry,R=uh(y,D);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),R,d))continue;const N={id:b,sourceLayerIndex:T,index:E,geometry:D?R.geometry:nc(y,d,p),properties:y.properties,type:y.type,patterns:{}},B=this.layoutVertexArray.length;this.hasPattern?this.features.push(hf("fill-extrusion",this.layers,N,this.zoom,l)):this.addFeature(N,N.geometry,E,d,{},l.availableImages,p),l.featureIndex.insert(y,N.geometry,E,T,this.index,B)}this.sortBorders()}addFeatures(o,l,d,p,y){for(const b of this.features){const{geometry:E}=b;this.addFeature(b,E,b.index,l,d,p,y)}this.sortBorders()}update(o,l,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,z_),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,Sp.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,sw.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,d,p,y,b,E){const T=[new Gt(0,0),new Gt(Tn,Tn)],D=E.projection,R="globe"===D.name,N=this.enableTerrain&&!R?new Av:null,B="Polygon"===Iv[o.type];R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new _t);const j=Jm(l,500);for(let ce=j.length-1;ce>=0;ce--){const be=j[ce];(0===be.length||(H=be[0]).every(de=>de.x<=0)||H.every(de=>de.x>=Tn)||H.every(de=>de.y<=0)||H.every(de=>de.y>=Tn))&&j.splice(ce,1)}var H;let X;if(R)X=Rv(j,T,p);else{X=[];for(const ce of j)X.push({polygon:ce,bounds:T})}const ie=B?this.edgeRadius:0;for(const{polygon:ce,bounds:be}of X){let de=0,ve=0;for(const Ce of ce)B&&!Ce[0].equals(Ce[Ce.length-1])&&Ce.push(Ce[0]),ve+=B?Ce.length-1:Ce.length;const xe=this.segments.prepareSegment((B?5:4)*ve,this.layoutVertexArray,this.indexArray);if(B){const Ce=[],Xe=[];de=xe.vertexLength;for(const st of ce){let Mt,Je;st.length&&st!==ce[0]&&Xe.push(Ce.length/2),Mt=st[1].sub(st[0])._perp()._unit();for(let mt=1;mt<st.length;mt++){const gt=st[mt],wt=st[mt===st.length-1?1:mt+1];let{x:Pt,y:rt}=gt;if(ie){Je=wt.sub(gt)._perp()._unit();const Xt=Mt.add(Je)._unit(),un=ie*Math.min(4,1/(Mt.x*Xt.x+Mt.y*Xt.y));Pt+=un*Xt.x,rt+=un*Xt.y,Mt=Je}zc(this.layoutVertexArray,Pt,rt,0,0,1,1,0),xe.vertexLength++,Ce.push(gt.x,gt.y),R&&Ap(this.layoutVertexExtArray,D.projectTilePoint(Pt,rt,p),D.upVector(p,Pt,rt))}}const Ge=F_(Ce,Xe);for(let st=0;st<Ge.length;st+=3)this.indexArray.emplaceBack(de+Ge[st],de+Ge[st+2],de+Ge[st+1]),xe.primitiveLength++}for(const Ce of ce){N&&Ce.length&&N.startRing(Ce[0]);let Xe,Ge,st,Mt=Ce.length>4&&Ov(Ce[Ce.length-2],Ce[0],Ce[1]),Je=ie?V_(Ce[Ce.length-2],Ce[0],Ce[1],ie):0;Ge=Ce[1].sub(Ce[0])._perp()._unit();let mt=!0;for(let gt=1,wt=0;gt<Ce.length;gt++){let Pt=Ce[gt-1],rt=Ce[gt];const Xt=Ce[gt===Ce.length-1?1:gt+1];if(N&&B&&N.currentPolyCount.top++,Pv(rt,Pt,be)){ie&&(Ge=Xt.sub(rt)._perp()._unit(),mt=!mt);continue}N&&N.append(rt,Pt);const un=rt.sub(Pt)._perp(),Jt=un.x/(Math.abs(un.x)+Math.abs(un.y)),qn=un.y>0?1:0,Ot=Pt.dist(rt);if(wt+Ot>32768&&(wt=0),ie){st=Xt.sub(rt)._perp()._unit();let Wn=hw(Pt,rt,Xt,AD(Ge,st),ie);isNaN(Wn)&&(Wn=0);const On=rt.sub(Pt)._unit();Pt=Pt.add(On.mult(Je))._round(),rt=rt.add(On.mult(-Wn))._round(),Je=Wn,Ge=st}const En=xe.vertexLength,Ln=Ce.length>4&&Ov(Pt,rt,Xt);let Ci=kv(wt,Mt,mt);if(zc(this.layoutVertexArray,Pt.x,Pt.y,Jt,qn,0,0,Ci),zc(this.layoutVertexArray,Pt.x,Pt.y,Jt,qn,0,1,Ci),wt+=Ot,Ci=kv(wt,Ln,!mt),Mt=Ln,zc(this.layoutVertexArray,rt.x,rt.y,Jt,qn,0,0,Ci),zc(this.layoutVertexArray,rt.x,rt.y,Jt,qn,0,1,Ci),xe.vertexLength+=4,this.indexArray.emplaceBack(En+0,En+1,En+2),this.indexArray.emplaceBack(En+1,En+3,En+2),xe.primitiveLength+=2,ie){const Wn=de+(1===gt?Ce.length-2:gt-2),On=1===gt?de:Wn+1;if(this.indexArray.emplaceBack(En+1,Wn,En+3),this.indexArray.emplaceBack(Wn,On,En+3),xe.primitiveLength+=2,void 0===Xe&&(Xe=En),!Pv(Xt,Ce[gt],be)){const Dr=gt===Ce.length-1?Xe:xe.vertexLength;this.indexArray.emplaceBack(En+2,En+3,Dr),this.indexArray.emplaceBack(En+3,Dr+1,Dr),this.indexArray.emplaceBack(En+3,On,Dr+1),xe.primitiveLength+=3}mt=!mt}if(R){const Wn=this.layoutVertexExtArray,On=D.projectTilePoint(Pt.x,Pt.y,p),Dr=D.projectTilePoint(rt.x,rt.y,p),Zn=D.upVector(p,Pt.x,Pt.y),Xn=D.upVector(p,rt.x,rt.y);Ap(Wn,On,Zn),Ap(Wn,On,Zn),Ap(Wn,Dr,Xn),Ap(Wn,Dr,Xn)}}B&&(de+=Ce.length-1)}}if(N&&N.polyCount.length>0){if(N.borders){N.vertexArrayOffset=this.centroidVertexArray.length;const ce=N.borders,be=this.featuresOnBorder.push(N)-1;for(let de=0;de<4;de++)ce[de][0]!==Number.MAX_VALUE&&this.borders[de].push(be)}this.encodeCentroid(N.borders?void 0:N.centroid(),N)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,y,b,p)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((l,d)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[d].borders[o][0])}encodeCentroid(o,l,d=!0){let p,y;if(o)if(0!==o.y){const E=l.span()._mult(this.tileToMeter);p=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(E.x/10)),y=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(E.y/10))}else p=Math.ceil(7*(o.x+450)),y=0;else p=0,y=+d;let b=d?this.centroidVertexArray.length:l.vertexArrayOffset;for(const E of l.polyCount){d&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*E.edges+E.top);for(let T=0;T<E.top;T++)this.centroidVertexArray.emplace(b++,p,y);for(let T=0;T<2*E.edges;T++)this.centroidVertexArray.emplace(b++,0,y),this.centroidVertexArray.emplace(b++,p,y)}}}function AD(a,o){const l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function V_(a,o,l,d){const p=o.sub(a)._perp()._unit(),y=l.sub(o)._perp()._unit();return hw(a,o,l,AD(p,y),d)}function hw(a,o,l,d,p){const y=Math.sqrt(1-d*d);return Math.min(a.dist(o)/3,o.dist(l)/3,p*y/d)}function Pv(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function Ov(a,o,l){if(a.x<0||a.x>=Tn||o.x<0||o.x>=Tn||l.x<0||l.x>=Tn)return!1;const d=l.sub(o),p=d.perp(),y=a.sub(o);return(d.x*y.x+d.y*y.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(y.x*y.x+y.y*y.y))>-.866&&p.x*y.x+p.y*y.y<0}function kv(a,o,l){const d=o?2|a:-3&a;return l?1|d:-2&d}function j_(){const a=Math.PI/32,o=Math.tan(a),l=D_;return l*Math.sqrt(1+2*o*o)-l}function Rv(a,o,l){const d=1<<l.z,p=Pl(l.x/d),y=Pl((l.x+1)/d),b=ms(l.y/d),E=ms((l.y+1)/d);return function(T,D,R,N,B=0,j){const H=[];if(!T.length||!R||!N)return H;const X=(Ce,Xe)=>{for(const Ge of Ce)H.push({polygon:Ge,bounds:Xe})},ie=Math.ceil(Math.log2(R)),ce=Math.ceil(Math.log2(N)),be=ie-ce,de=[];for(let Ce=0;Ce<Math.abs(be);Ce++)de.push(be>0?0:1);for(let Ce=0;Ce<Math.min(ie,ce);Ce++)de.push(0),de.push(1);let ve=T;if(ve=U_(ve,D[0].y-B,D[1].y+B,1),ve=U_(ve,D[0].x-B,D[1].x+B,0),!ve.length)return H;const xe=[];for(de.length?xe.push({polygons:ve,bounds:D,depth:0}):X(ve,D);xe.length;){const Ce=xe.pop(),Xe=Ce.depth,Ge=de[Xe],st=Ce.bounds[0],Mt=Ce.bounds[1],Je=0===Ge?st.x:st.y,mt=0===Ge?Mt.x:Mt.y,gt=j?j(Ge,Je,mt):.5*(Je+mt),wt=U_(Ce.polygons,Je-B,gt+B,Ge),Pt=U_(Ce.polygons,gt-B,mt+B,Ge);if(wt.length){const rt=[st,new Gt(0===Ge?gt:Mt.x,1===Ge?gt:Mt.y)];de.length>Xe+1?xe.push({polygons:wt,bounds:rt,depth:Xe+1}):X(wt,rt)}if(Pt.length){const rt=[new Gt(0===Ge?gt:st.x,1===Ge?gt:st.y),Mt];de.length>Xe+1?xe.push({polygons:Pt,bounds:rt,depth:Xe+1}):X(Pt,rt)}}return H}(a,o,Math.ceil((y-p)/11.25),Math.ceil((b-E)/11.25),1,(T,D,R)=>{if(0===T)return.5*(D+R);{const N=ms((l.y+D/Tn)/d);return(mu(.5*(ms((l.y+R/Tn)/d)+N))*d-l.y)*Tn}})}an(ig,"FillExtrusionBucket",{omit:["layers","features"]}),an(Av,"PartMetadata");const $_=new _e({"fill-extrusion-edge-radius":new W(nt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var rg={paint:new _e({"fill-extrusion-opacity":new W(nt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new re(nt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new W(nt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new W(nt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new re(nt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new re(nt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new re(nt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new W(nt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new W(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new W(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new W(nt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:$_};function Lv(a,o,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[a*d-2*Math.PI*6378137/2,o*d-2*Math.PI*6378137/2]}class Pp{constructor(o,l,d){this.z=o,this.x=l,this.y=d,this.key=ff(0,o,o,l,d)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const d=(b=this.y,E=this.z,T=Lv(256*(y=this.x),256*(b=Math.pow(2,E)-b-1),E),D=Lv(256*(y+1),256*(b+1),E),T[0]+","+T[1]+","+D[0]+","+D[1]),p=function(y,b,E){let T,D="";for(let R=y;R>0;R--)T=1<<R-1,D+=(b&T?1:0)+(E&T?2:0);return D}(this.z,this.x,this.y);var y,b,E,T,D;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class og{constructor(o,l){this.wrap=o,this.canonical=l,this.key=ff(o,l.z,l.z,l.x,l.y)}}class Bs{constructor(o,l,d,p,y){this.overscaledZ=o,this.wrap=l,this.canonical=new Pp(d,+p,+y),this.key=0===l&&o===d?this.canonical.key:ff(l,o,d,p,y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new Bs(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bs(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return ff(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-o;return ff(this.wrap*+l,o,o,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new Bs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,d=2*this.canonical.x,p=2*this.canonical.y;return[new Bs(l,this.wrap,l,d,p),new Bs(l,this.wrap,l,d+1,p),new Bs(l,this.wrap,l,d,p+1),new Bs(l,this.wrap,l,d+1,p+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Bs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Bs(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new og(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ff(a,o,l,d,p){const y=1<<Math.min(l,22);let b=y*(p%y)+d%y;return a&&l<22&&(b+=y*y*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*b+l)+(o-l)}an(Pp,"CanonicalTileID"),an(Bs,"OverscaledTileID",{omit:["projMatrix"]});class yu extends Gt{constructor(o,l,d){super(o,l),this.z=d}}function sg(a,o){return a.x*o.x+a.y*o.y}function Fv(a,o){if(1===a.length){let l=0;const d=o[l++];let p;for(;!p||d.equals(p);)if(p=o[l++],!p)return 1/0;for(;l<o.length;l++){const y=o[l],b=a[0],E=p.sub(d),T=y.sub(d),D=b.sub(d),R=sg(E,E),N=sg(E,T),B=sg(T,T),j=sg(D,E),H=sg(D,T),X=R*B-N*N,ie=(B*j-N*H)/X,ce=(R*H-N*j)/X,be=d.z*(1-ie-ce)+p.z*ie+y.z*ce;if(isFinite(be))return be}return 1/0}{let l=1/0;for(const d of o)l=Math.min(l,d.z);return l}}function fw(a,o,l,d,p,y,b,E){const T=b*p.getElevationAt(a,o,!0,!0),D=0!==y[0],R=D?0===y[1]?b*(y[0]/7-450):b*function(N,B,j){const H=Math.floor(B[0]/8),X=Math.floor(B[1]/8),ie=10*(B[0]-8*H),ce=10*(B[1]-8*X),be=N.getElevationAt(H,X,!0,!0),de=N.getMeterToDEM(j),ve=Math.floor(.5*(ie*de-1)),xe=Math.floor(.5*(ce*de-1)),Ce=N.tileCoordToPixel(H,X),Xe=2*ve+1,Ge=2*xe+1,st=(un=Xe,Jt=Ge,[(Pt=N).getElevationAtPixel(rt=Ce.x-ve,Xt=Ce.y-xe,!0),Pt.getElevationAtPixel(rt+Jt,Xt,!0),Pt.getElevationAtPixel(rt,Xt+Jt,!0),Pt.getElevationAtPixel(rt+un,Xt+Jt,!0)]),Mt=Math.abs(st[0]-st[1]),Je=Math.abs(st[2]-st[3]),mt=Math.abs(st[0]-st[2])+Math.abs(st[1]-st[3]),gt=Math.min(.25,.5*de*(Mt+Je)/Xe),wt=Math.min(.25,.5*de*mt/Ge);var Pt,rt,Xt,un,Jt;return be+Math.max(gt*ie,wt*ce)}(p,y,E):T;return{base:T+(0===l)?-1:l,top:D?Math.max(R+d,T+l+2):T+d}}const PD=Fe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:OD}=PD,pw=Fe([{name:"a_packed",components:4,type:"Float32"}]),{members:mw}=pw,H_=B_.types,Nv=Math.cos(Math.PI/180*37.5);class _d{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new He,this.layoutVertexArray2=new Et,this.indexArray=new gn,this.programConfigurations=new ih(o.layers,o.zoom),this.segments=new fo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,d,p){this.hasPattern=Tv("line",this.layers,l);const y=this.layers[0].layout.get("line-sort-key"),b=[];for(const{feature:R,id:N,index:B,sourceLayerIndex:j}of o){const H=this.layers[0]._featureFilter.needGeometry,X=uh(R,H);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),X,d))continue;const ie=y?y.evaluate(X,{},d):void 0,ce={id:N,properties:R.properties,type:R.type,sourceLayerIndex:j,index:B,geometry:H?X.geometry:nc(R,d,p),patterns:{},sortKey:ie};b.push(ce)}y&&b.sort((R,N)=>R.sortKey-N.sortKey);const{lineAtlas:E,featureIndex:T}=l,D=this.addConstantDashes(E);for(const R of b){const{geometry:N,index:B,sourceLayerIndex:j}=R;if(D&&this.addFeatureDashes(R,E),this.hasPattern){const H=hf("line",this.layers,R,this.zoom,l);this.patternFeatures.push(H)}else this.addFeature(R,N,B,d,E.positions,l.availableImages);T.insert(o[B].feature,N,B,j,this.index)}}addConstantDashes(o){let l=!1;for(const d of this.layers){const p=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==y.kind)l=!0;else{const b=y.value,E=p.value;if(!E)continue;o.addDash(E,b)}}return l}addFeatureDashes(o,l){const d=this.zoom;for(const p of this.layers){const y=p.paint.get("line-dasharray").value,b=p.layout.get("line-cap").value;if("constant"===y.kind&&"constant"===b.kind)continue;let E,T;if("constant"===y.kind){if(E=y.value,!E)continue}else E=y.evaluate({zoom:d},o);T="constant"===b.kind?b.value:b.evaluate({zoom:d},o),l.addDash(E,T),o.patterns[p.id]=l.getKey(E,T)}}update(o,l,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,p)}addFeatures(o,l,d,p,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,d,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,mw)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,OD),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,d,p,y,b){const E=this.layers[0].layout,T=E.get("line-join").evaluate(o,{}),D=E.get("line-cap").evaluate(o,{}),R=E.get("line-miter-limit"),N=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const B of l)this.addLine(B,o,T,D,R,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,y,b,p)}addLine(o,l,d,p,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ce=0;ce<o.length-1;ce++)this.totalDistance+=o[ce].dist(o[ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E="Polygon"===H_[l.type];let T=o.length;for(;T>=2&&o[T-1].equals(o[T-2]);)T--;let D=0;for(;D<T-1&&o[D].equals(o[D+1]);)D++;if(T<(E?3:2))return;"bevel"===d&&(y=1.05);const R=this.overscaling<=16?15*Tn/(512*this.overscaling):0,N=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let B,j,H,X,ie;this.e1=this.e2=-1,E&&(B=o[T-2],ie=o[D].sub(B)._unit()._perp());for(let ce=D;ce<T;ce++){if(H=ce===T-1?E?o[D+1]:void 0:o[ce+1],H&&o[ce].equals(H))continue;ie&&(X=ie),B&&(j=B),B=o[ce],ie=H?H.sub(B)._unit()._perp():X,X=X||ie;let be=X.add(ie);0===be.x&&0===be.y||be._unit();const de=X.x*ie.x+X.y*ie.y,ve=be.x*ie.x+be.y*ie.y,xe=0!==ve?1/ve:1/0,Ce=2*Math.sqrt(2-2*ve),Xe=ve<Nv&&j&&H,Ge=X.x*ie.y-X.y*ie.x>0;if(Xe&&ce>D){const Je=B.dist(j);if(Je>2*R){const mt=B.sub(B.sub(j)._mult(R/Je)._round());this.updateDistance(j,mt),this.addCurrentVertex(mt,X,0,0,N),j=mt}}const st=j&&H;let Mt=st?d:E?"butt":p;if(st&&"round"===Mt&&(xe<b?Mt="miter":xe<=2&&(Mt="fakeround")),"miter"===Mt&&xe>y&&(Mt="bevel"),"bevel"===Mt&&(xe>2&&(Mt="flipbevel"),xe<y&&(Mt="miter")),j&&this.updateDistance(j,B),"miter"===Mt)be._mult(xe),this.addCurrentVertex(B,be,0,0,N);else if("flipbevel"===Mt){if(xe>100)be=ie.mult(-1);else{const Je=xe*X.add(ie).mag()/X.sub(ie).mag();be._perp()._mult(Je*(Ge?-1:1))}this.addCurrentVertex(B,be,0,0,N),this.addCurrentVertex(B,be.mult(-1),0,0,N)}else if("bevel"===Mt||"fakeround"===Mt){const Je=-Math.sqrt(xe*xe-1),mt=Ge?Je:0,gt=Ge?0:Je;if(j&&this.addCurrentVertex(B,X,mt,gt,N),"fakeround"===Mt){const wt=Math.round(180*Ce/Math.PI/20);for(let Pt=1;Pt<wt;Pt++){let rt=Pt/wt;if(.5!==rt){const un=rt-.5;rt+=rt*un*(rt-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*un*un+(.848013+de*(.215638*de-1.06021)))}const Xt=ie.sub(X)._mult(rt)._add(X)._unit()._mult(Ge?-1:1);this.addHalfVertex(B,Xt.x,Xt.y,!1,Ge,0,N)}}H&&this.addCurrentVertex(B,ie,-mt,-gt,N)}else if("butt"===Mt)this.addCurrentVertex(B,be,0,0,N);else if("square"===Mt){const Je=j?1:-1;j||this.addCurrentVertex(B,be,Je,Je,N),this.addCurrentVertex(B,be,0,0,N),j&&this.addCurrentVertex(B,be,Je,Je,N)}else"round"===Mt&&(j&&(this.addCurrentVertex(B,X,0,0,N),this.addCurrentVertex(B,X,1,1,N,!0)),H&&(this.addCurrentVertex(B,ie,-1,-1,N,!0),this.addCurrentVertex(B,ie,0,0,N)));if(Xe&&ce<T-1){const Je=B.dist(H);if(Je>2*R){const mt=B.add(H.sub(B)._mult(R/Je)._round());this.updateDistance(B,mt),this.addCurrentVertex(mt,ie,0,0,N),B=mt}}}}addCurrentVertex(o,l,d,p,y,b=!1){const E=l.y*p-l.x,T=-l.y-l.x*p;this.addHalfVertex(o,l.x+l.y*d,l.y-l.x*d,b,!1,d,y),this.addHalfVertex(o,E,T,b,!0,-p,y)}addHalfVertex({x:o,y:l},d,p,y,b,E,T){this.layoutVertexArray.emplaceBack((o<<1)+(y?1:0),(l<<1)+(b?1:0),Math.round(63*d)+128,Math.round(63*p)+128,1+(0===E?0:E<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const D=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),T.primitiveLength++),b?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}an(_d,"LineBucket",{omit:["layers","patternFeatures"]});const kD=new _e({"line-cap":new re(nt.layout_line["line-cap"]),"line-join":new re(nt.layout_line["line-join"]),"line-miter-limit":new W(nt.layout_line["line-miter-limit"]),"line-round-limit":new W(nt.layout_line["line-round-limit"]),"line-sort-key":new re(nt.layout_line["line-sort-key"])});var gw={paint:new _e({"line-opacity":new re(nt.paint_line["line-opacity"]),"line-color":new re(nt.paint_line["line-color"]),"line-translate":new W(nt.paint_line["line-translate"]),"line-translate-anchor":new W(nt.paint_line["line-translate-anchor"]),"line-width":new re(nt.paint_line["line-width"]),"line-gap-width":new re(nt.paint_line["line-gap-width"]),"line-offset":new re(nt.paint_line["line-offset"]),"line-blur":new re(nt.paint_line["line-blur"]),"line-dasharray":new re(nt.paint_line["line-dasharray"]),"line-pattern":new re(nt.paint_line["line-pattern"]),"line-gradient":new fe(nt.paint_line["line-gradient"]),"line-trim-offset":new W(nt.paint_line["line-trim-offset"])}),layout:kD};const RD=new class extends re{possiblyEvaluate(a,o){return o=new L(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,l,d){return o=Ti({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,l,d)}}(gw.paint.properties["line-width"].specification);function _w(a,o){return o>0?o+2*a:a}RD.useIntegerZoom=!0;const zv=Fe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),LD=Fe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ag=Fe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Fe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const G_=Fe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Bv=Fe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Fe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Uv=Fe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),yw=Fe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Fe([{name:"triangle",components:3,type:"Uint16"}]),Fe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Fe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Fe([{type:"Float32",name:"offsetX"}]),Fe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var No=24;const Us=128;function Vv(a,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new L(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:d,interpolationType:p}=l;let y=0;for(;y<d.length&&d[y]<=a;)y++;y=Math.max(0,y-1);let b=y;for(;b<d.length&&d[b]<a+1;)b++;b=Math.min(d.length-1,b);const E=d[y],T=d[b];return"composite"===l.kind?{kind:"composite",minZoom:E,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:E,maxZoom:T,minSize:l.evaluate(new L(E)),maxSize:l.evaluate(new L(T)),interpolationType:p}}}function q_(a,{uSize:o,uSizeT:l},{lowerSize:d,upperSize:p}){return"source"===a.kind?d/Us:"composite"===a.kind?ai(d/Us,p/Us,l):o}function Op(a,o){let l=0,d=0;if("constant"===a.kind)d=a.layoutSize;else if("source"!==a.kind){const{interpolationType:p,minZoom:y,maxZoom:b}=a,E=p?ni(hs.interpolationFactor(p,o,y,b),0,1):0;"camera"===a.kind?d=ai(a.minSize,a.maxSize,E):l=E}return{uSizeT:l,uSize:d}}var FD=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Us,evaluateSizeForFeature:q_,evaluateSizeForZoom:Op,getSizeData:Vv});function ND(a,o,l){return a.sections.forEach(d=>{d.text=function(p,y,b){const E=y.layout.get("text-transform").evaluate(b,{});return"uppercase"===E?p=p.toLocaleUpperCase():"lowercase"===E&&(p=p.toLocaleLowerCase()),k.applyArabicShaping&&(p=k.applyArabicShaping(p)),p}(d.text,o,l)}),a}const Vs={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function vu(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function zD(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var vw=br,bw=function(a,o,l,d,p){var y,b,E=8*p-d-1,T=(1<<E)-1,D=T>>1,R=-7,N=l?p-1:0,B=l?-1:1,j=a[o+N];for(N+=B,y=j&(1<<-R)-1,j>>=-R,R+=E;R>0;y=256*y+a[o+N],N+=B,R-=8);for(b=y&(1<<-R)-1,y>>=-R,R+=d;R>0;b=256*b+a[o+N],N+=B,R-=8);if(0===y)y=1-D;else{if(y===T)return b?NaN:1/0*(j?-1:1);b+=Math.pow(2,d),y-=D}return(j?-1:1)*b*Math.pow(2,y-d)},xw=function(a,o,l,d,p,y){var b,E,T,D=8*y-p-1,R=(1<<D)-1,N=R>>1,B=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,j=d?0:y-1,H=d?1:-1,X=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(E=isNaN(o)?1:0,b=R):(b=Math.floor(Math.log(o)/Math.LN2),o*(T=Math.pow(2,-b))<1&&(b--,T*=2),(o+=b+N>=1?B/T:B*Math.pow(2,1-N))*T>=2&&(b++,T/=2),b+N>=R?(E=0,b=R):b+N>=1?(E=(o*T-1)*Math.pow(2,p),b+=N):(E=o*Math.pow(2,N-1)*Math.pow(2,p),b=0));p>=8;a[l+j]=255&E,j+=H,E/=256,p-=8);for(b=b<<p|E,D+=p;D>0;a[l+j]=255&b,j+=H,b/=256,D-=8);a[l+j-H]|=128*X};function br(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}br.Varint=0,br.Fixed64=1,br.Bytes=2,br.Fixed32=5;var jv=4294967296,$v=1/jv,ww=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function yd(a){return a.type===br.Bytes?a.readVarint()+a.pos:a.pos+1}function Ew(a,o,l){var d=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(d);for(var p=l.pos-1;p>=a;p--)l.buf[p+d]=l.buf[p]}function W_(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function vd(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function lg(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function Cw(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function Mw(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function Tw(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function Pk(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function Ok(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function kk(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function Rp(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function hh(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function BD(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}br.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),p=d>>3,y=this.pos;this.type=7&d,a(p,o,this),this.pos===y&&this.skip(d)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=Rp(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=BD(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Rp(this.buf,this.pos)+Rp(this.buf,this.pos+4)*jv;return this.pos+=8,a},readSFixed64:function(){var a=Rp(this.buf,this.pos)+BD(this.buf,this.pos+4)*jv;return this.pos+=8,a},readFloat:function(){var a=bw(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=bw(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,d=this.buf;return o=127&(l=d[this.pos++]),l<128?o:(o|=(127&(l=d[this.pos++]))<<7,l<128?o:(o|=(127&(l=d[this.pos++]))<<14,l<128?o:(o|=(127&(l=d[this.pos++]))<<21,l<128?o:function(p,y,b){var E,T,D=b.buf;if(E=(112&(T=D[b.pos++]))>>4,T<128||(E|=(127&(T=D[b.pos++]))<<3,T<128)||(E|=(127&(T=D[b.pos++]))<<10,T<128)||(E|=(127&(T=D[b.pos++]))<<17,T<128)||(E|=(127&(T=D[b.pos++]))<<24,T<128)||(E|=(1&(T=D[b.pos++]))<<31,T<128))return function kp(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(p,E,y);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=d[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&ww?ww.decode(this.buf.subarray(o,a)):function(l,d,p){for(var y="",b=d;b<p;){var E,T,D,R=l[b],N=null,B=R>239?4:R>223?3:R>191?2:1;if(b+B>p)break;1===B?R<128&&(N=R):2===B?128==(192&(E=l[b+1]))&&(N=(31&R)<<6|63&E)<=127&&(N=null):3===B?(T=l[b+2],128==(192&(E=l[b+1]))&&128==(192&T)&&((N=(15&R)<<12|(63&E)<<6|63&T)<=2047||N>=55296&&N<=57343)&&(N=null)):4===B&&(T=l[b+2],D=l[b+3],128==(192&(E=l[b+1]))&&128==(192&T)&&128==(192&D)&&((N=(15&R)<<18|(63&E)<<12|(63&T)<<6|63&D)<=65535||N>=1114112)&&(N=null)),null===N?(N=65533,B=1):N>65535&&(N-=65536,y+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),y+=String.fromCharCode(N),b+=B}return y}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==br.Bytes)return a.push(this.readVarint(o));var l=yd(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==br.Bytes)return a.push(this.readSVarint());var o=yd(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==br.Bytes)return a.push(this.readBoolean());var o=yd(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==br.Bytes)return a.push(this.readFloat());var o=yd(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==br.Bytes)return a.push(this.readDouble());var o=yd(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==br.Bytes)return a.push(this.readFixed32());var o=yd(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==br.Bytes)return a.push(this.readSFixed32());var o=yd(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==br.Bytes)return a.push(this.readFixed64());var o=yd(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==br.Bytes)return a.push(this.readSFixed64());var o=yd(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===br.Varint)for(;this.buf[this.pos++]>127;);else if(o===br.Bytes)this.pos=this.readVarint()+this.pos;else if(o===br.Fixed32)this.pos+=4;else{if(o!==br.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),hh(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),hh(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),hh(this.buf,-1&a,this.pos),hh(this.buf,Math.floor(a*$v),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),hh(this.buf,-1&a,this.pos),hh(this.buf,Math.floor(a*$v),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var d,p,y,E;if(o>=0?(d=o%4294967296|0,p=o/4294967296|0):(p=~(-o/4294967296),4294967295^(d=~(-o%4294967296))?d=d+1|0:(d=0,p=p+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),y=d,(E=l).buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,E.buf[E.pos]=127&(y>>>=7),function(y,b){var E=(7&y)<<4;b.buf[b.pos++]|=E|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))}(p,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(d,p,y){for(var b,E,T=0;T<p.length;T++){if((b=p.charCodeAt(T))>55295&&b<57344){if(!E){b>56319||T+1===p.length?(d[y++]=239,d[y++]=191,d[y++]=189):E=b;continue}if(b<56320){d[y++]=239,d[y++]=191,d[y++]=189,E=b;continue}b=E-55296<<10|b-56320|65536,E=null}else E&&(d[y++]=239,d[y++]=191,d[y++]=189,E=null);b<128?d[y++]=b:(b<2048?d[y++]=b>>6|192:(b<65536?d[y++]=b>>12|224:(d[y++]=b>>18|240,d[y++]=b>>12&63|128),d[y++]=b>>6&63|128),d[y++]=63&b|128)}return y}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&Ew(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),xw(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),xw(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var d=this.pos-l;d>=128&&Ew(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,o,l){this.writeTag(a,br.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,W_,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,vd,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,Mw,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,lg,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,Cw,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,Tw,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,Pk,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,Ok,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,kk,o)},writeBytesField:function(a,o){this.writeTag(a,br.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,br.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,br.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,br.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,br.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,br.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,br.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,br.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,br.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,br.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,!!o)}};var Hv=fr(vw);const Z_=3;function UD(a,o,l){o.glyphs=[],1===a&&l.readMessage(VD,o)}function VD(a,o,l){if(3===a){const{id:d,bitmap:p,width:y,height:b,left:E,top:T,advance:D}=l.readMessage(jD,{});o.glyphs.push({id:d,bitmap:new md({width:y+2*Z_,height:b+2*Z_},p),metrics:{width:y,height:b,left:E,top:T,advance:D}})}else 4===a?o.ascender=l.readSVarint():5===a&&(o.descender=l.readSVarint())}function jD(a,o,l){1===a?o.id=l.readVarint():2===a?o.bitmap=l.readBytes():3===a?o.width=l.readVarint():4===a?o.height=l.readVarint():5===a?o.left=l.readSVarint():6===a?o.top=l.readSVarint():7===a&&(o.advance=l.readVarint())}const Dw=Z_;function X_(a){let o=0,l=0;for(const b of a)o+=b.w*b.h,l=Math.max(l,b.w);a.sort((b,E)=>E.h-b.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let p=0,y=0;for(const b of a)for(let E=d.length-1;E>=0;E--){const T=d[E];if(!(b.w>T.w||b.h>T.h)){if(b.x=T.x,b.y=T.y,y=Math.max(y,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===T.w&&b.h===T.h){const D=d.pop();E<d.length&&(d[E]=D)}else b.h===T.h?(T.x+=b.w,T.w-=b.w):b.w===T.w?(T.y+=b.h,T.h-=b.h):(d.push({x:T.x+b.w,y:T.y,w:T.w-b.w,h:b.h}),T.y+=b.h,T.h-=b.h);break}}return{w:p,h:y,fill:o/(p*y)||0}}const ys=1;class Y_{constructor(o,{pixelRatio:l,version:d,stretchX:p,stretchY:y,content:b}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=p,this.stretchY=y,this.content=b,this.version=d}get tl(){return[this.paddedRect.x+ys,this.paddedRect.y+ys]}get br(){return[this.paddedRect.x+this.paddedRect.w-ys,this.paddedRect.y+this.paddedRect.h-ys]}get displaySize(){return[(this.paddedRect.w-2*ys)/this.pixelRatio,(this.paddedRect.h-2*ys)/this.pixelRatio]}}class K_{constructor(o,l){const d={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(o,d,y),this.addImages(l,p,y);const{w:b,h:E}=X_(y),T=new zs({width:b||1,height:E||1});for(const D in o){const R=o[D],N=d[D].paddedRect;zs.copy(R.data,T,{x:0,y:0},{x:N.x+ys,y:N.y+ys},R.data)}for(const D in l){const R=l[D],N=p[D].paddedRect,B=N.x+ys,j=N.y+ys,H=R.data.width,X=R.data.height;zs.copy(R.data,T,{x:0,y:0},{x:B,y:j},R.data),zs.copy(R.data,T,{x:0,y:X-1},{x:B,y:j-1},{width:H,height:1}),zs.copy(R.data,T,{x:0,y:0},{x:B,y:j+X},{width:H,height:1}),zs.copy(R.data,T,{x:H-1,y:0},{x:B-1,y:j},{width:1,height:X}),zs.copy(R.data,T,{x:0,y:0},{x:B+H,y:j},{width:1,height:X})}this.image=T,this.iconPositions=d,this.patternPositions=p}addImages(o,l,d){for(const p in o){const y=o[p],b={x:0,y:0,w:y.data.width+2*ys,h:y.data.height+2*ys};d.push(b),l[p]=new Y_(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>o.hasImage(d)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in o.updatedImages)this.patchUpdatedImage(this.iconPositions[d],o.getImage(d),l),this.patchUpdatedImage(this.patternPositions[d],o.getImage(d),l)}patchUpdatedImage(o,l,d){if(!o||!l||o.version===l.version)return;o.version=l.version;const[p,y]=o.tl;d.update(l.data,void 0,{x:p,y})}}an(Y_,"ImagePosition"),an(K_,"ImageAtlas");const Ol={horizontal:1,vertical:2,horizontalOnly:3},jr=-17;class fh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const d=new fh;return d.scale=o||1,d.fontStack=l,d}static forImage(o){const l=new fh;return l.imageName=o,l}}class Lp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const d=new Lp;for(let p=0;p<o.sections.length;p++){const y=o.sections[p];y.image?d.addImageSection(y):d.addTextSection(y,l)}return d}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(l,d){let p="";for(let y=0;y<l.length;y++){const b=l.charCodeAt(y+1)||null,E=l.charCodeAt(y-1)||null;p+=!d&&(b&&q0(b)&&!Vs[l[y+1]]||E&&q0(E)&&!Vs[l[y-1]])||!Vs[l[y]]?l[y]:Vs[l[y]]}return p}(this.text,o)}trim(){let o=0;for(let d=0;d<this.text.length&&Np[this.text.charCodeAt(d)];d++)o++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=o&&Np[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const d=new Lp;return d.text=this.text.substring(o,l),d.sectionIndex=this.sectionIndex.slice(o,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(fh.forText(o.scale,o.fontStack||l));const d=this.sections.length-1;for(let p=0;p<o.text.length;++p)this.sectionIndex.push(d)}addImageSection(o){const l=o.image?o.image.name:"";if(0===l.length)return void _r("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(fh.forImage(l)),this.sectionIndex.push(this.sections.length-1)):_r("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fp(a,o,l,d,p,y,b,E,T,D,R,N,B,j,H){const X=Lp.fromFeature(a,p);N===Ol.vertical&&X.verticalizePunctuation(B);let ie=[];const ce=function(Ce,Xe,Ge,st,Mt,Je){if(!Ce)return[];const mt=[],gt=function(Xt,un,Jt,qn,Ot,En){let Ln=0;for(let Ci=0;Ci<Xt.length();Ci++){const Wn=Xt.getSection(Ci);Ln+=Sw(Xt.getCharCode(Ci),Wn,qn,Ot,un,En)}return Ln/Math.max(1,Math.ceil(Ln/Jt))}(Ce,Xe,Ge,st,Mt,Je),wt=Ce.text.indexOf("\u200b")>=0;let Pt=0;for(let Xt=0;Xt<Ce.length();Xt++){const un=Ce.getSection(Xt),Jt=Ce.getCharCode(Xt);if(Np[Jt]||(Pt+=Sw(Jt,un,st,Mt,Xe,Je)),Xt<Ce.length()-1){const qn=!((rt=Jt)<11904||!(Qt["Bopomofo Extended"](rt)||Qt.Bopomofo(rt)||Qt["CJK Compatibility Forms"](rt)||Qt["CJK Compatibility Ideographs"](rt)||Qt["CJK Compatibility"](rt)||Qt["CJK Radicals Supplement"](rt)||Qt["CJK Strokes"](rt)||Qt["CJK Symbols and Punctuation"](rt)||Qt["CJK Unified Ideographs Extension A"](rt)||Qt["CJK Unified Ideographs"](rt)||Qt["Enclosed CJK Letters and Months"](rt)||Qt["Halfwidth and Fullwidth Forms"](rt)||Qt.Hiragana(rt)||Qt["Ideographic Description Characters"](rt)||Qt["Kangxi Radicals"](rt)||Qt["Katakana Phonetic Extensions"](rt)||Qt.Katakana(rt)||Qt["Vertical Forms"](rt)||Qt["Yi Radicals"](rt)||Qt["Yi Syllables"](rt)));($D[Jt]||qn||un.imageName)&&mt.push(Gv(Xt+1,Pt,gt,mt,HD(Jt,Ce.getCharCode(Xt+1),qn&&wt),!1))}}var rt;return GD(Gv(Ce.length(),Pt,gt,mt,0,!0))}(X,D,y,o,d,j),{processBidirectionalText:be,processStyledBidirectionalText:de}=k;if(be&&1===X.sections.length){const Ce=be(X.toString(),ce);for(const Xe of Ce){const Ge=new Lp;Ge.text=Xe,Ge.sections=X.sections;for(let st=0;st<Xe.length;st++)Ge.sectionIndex.push(0);ie.push(Ge)}}else if(de){const Ce=de(X.text,X.sectionIndex,ce);for(const Xe of Ce){const Ge=new Lp;Ge.text=Xe[0],Ge.sectionIndex=Xe[1],Ge.sections=X.sections,ie.push(Ge)}}else ie=function(Ce,Xe){const Ge=[],st=Ce.text;let Mt=0;for(const Je of Xe)Ge.push(Ce.substring(Mt,Je)),Mt=Je;return Mt<st.length&&Ge.push(Ce.substring(Mt,st.length)),Ge}(X,ce);const ve=[],xe={positionedLines:ve,text:X.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:N,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ce,Xe,Ge,st,Mt,Je,mt,gt,wt,Pt,rt,Xt){let un=0,Jt=0,qn=0;const Ot="right"===gt?1:"left"===gt?0:.5;let En=!1;for(const Zn of Mt){const Xn=Zn.getSections();for(const Yi of Xn){if(Yi.imageName)continue;const ur=Xe[Yi.fontStack];if(ur&&(En=void 0!==ur.ascender&&void 0!==ur.descender,!En))break}if(!En)break}let Ln=0;for(const Zn of Mt){Zn.trim();const Xn=Zn.getMaxScale(),Yi=(Xn-1)*No,ur={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[Ln]=ur;const Sr=ur.positionedGlyphs;let dr=0;if(!Zn.length()){Jt+=Je,++Ln;continue}let Fr=0,Zr=0;for(let ir=0;ir<Zn.length();ir++){const Ir=Zn.getSection(ir),mo=Zn.getSectionIndex(ir),Xr=Zn.getCharCode(ir);let Ai=Ir.scale,go=null,xr=null,pa=null,xo=No,zo=0;const Bo=!(wt===Ol.horizontal||!rt&&!km(Xr)||rt&&(Np[Xr]||(Ci=Xr,Qt.Arabic(Ci)||Qt["Arabic Supplement"](Ci)||Qt["Arabic Extended-A"](Ci)||Qt["Arabic Presentation Forms-A"](Ci)||Qt["Arabic Presentation Forms-B"](Ci))));if(Ir.imageName){const is=st[Ir.imageName];if(!is)continue;pa=Ir.imageName,Ce.iconsInText=Ce.iconsInText||!0,xr=is.paddedRect;const so=is.displaySize;Ai=Ai*No/Xt,go={width:so[0],height:so[1],left:ys,top:-Dw,advance:Bo?so[1]:so[0],localGlyph:!1},zo=En?-go.height*Ai:jr+Xn*No-so[1]*Ai,xo=go.advance;const il=(Bo?so[0]:so[1])*Ai-No*Xn;il>0&&il>dr&&(dr=il)}else{const is=Ge[Ir.fontStack];if(!is)continue;is[Xr]&&(xr=is[Xr]);const so=Xe[Ir.fontStack];if(!so)continue;const il=so.glyphs[Xr];if(!il)continue;if(go=il.metrics,xo=8203!==Xr?No:0,En){const gg=void 0!==so.ascender?Math.abs(so.ascender):0,_g=void 0!==so.descender?Math.abs(so.descender):0,Yp=(gg+_g)*Ai;Fr<Yp&&(Fr=Yp,Zr=(gg-_g)/2*Ai),zo=-gg*Ai}else zo=jr+(Xn-Ai)*No}Bo?(Ce.verticalizable=!0,Sr.push({glyph:Xr,imageName:pa,x:un,y:Jt+zo,vertical:Bo,scale:Ai,localGlyph:go.localGlyph,fontStack:Ir.fontStack,sectionIndex:mo,metrics:go,rect:xr}),un+=xo*Ai+Pt):(Sr.push({glyph:Xr,imageName:pa,x:un,y:Jt+zo,vertical:Bo,scale:Ai,localGlyph:go.localGlyph,fontStack:Ir.fontStack,sectionIndex:mo,metrics:go,rect:xr}),un+=go.advance*Ai+Pt)}0!==Sr.length&&(qn=Math.max(un-Pt,qn),En?zp(Sr,Ot,dr,Zr,Je*Xn/2):zp(Sr,Ot,dr,0,Je/2)),un=0;const oo=Je*Xn+dr;ur.lineOffset=Math.max(dr,Yi),Jt+=oo,++Ln}var Ci;const Wn=Jt,{horizontalAlign:On,verticalAlign:Dr}=Aw(mt);(function(Zn,Xn,Yi,ur,Sr,dr){const Fr=(Xn-Yi)*Sr,Zr=-dr*ur;for(const oo of Zn)for(const ir of oo.positionedGlyphs)ir.x+=Fr,ir.y+=Zr})(Ce.positionedLines,Ot,On,Dr,qn,Wn),Ce.top+=-Dr*Wn,Ce.bottom=Ce.top+Wn,Ce.left+=-On*qn,Ce.right=Ce.left+qn,Ce.hasBaseline=En}(xe,o,l,d,ie,b,E,T,N,D,B,H),!function(Ce){for(const Xe of Ce)if(0!==Xe.positionedGlyphs.length)return!1;return!0}(ve)&&xe}const Np={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$D={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sw(a,o,l,d,p,y){if(o.imageName){const b=d[o.imageName];return b?b.displaySize[0]*o.scale*No/y+p:0}{const b=l[o.fontStack],E=b&&b.glyphs[a];return E?E.metrics.advance*o.scale+p:0}}function Iw(a,o,l,d){const p=Math.pow(a-o,2);return d?a<o?p/2:2*p:p+Math.abs(l)*l}function HD(a,o,l){let d=0;return 10===a&&(d-=1e4),l&&(d+=150),40!==a&&65288!==a||(d+=50),41!==o&&65289!==o||(d+=50),d}function Gv(a,o,l,d,p,y){let b=null,E=Iw(o,l,p,y);for(const T of d){const D=Iw(o-T.x,l,p,y)+T.badness;D<=E&&(b=T,E=D)}return{index:a,x:o,priorBreak:b,badness:E}}function GD(a){return a?GD(a.priorBreak).concat(a.index):[]}function Aw(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function zp(a,o,l,d,p){if(!(o||l||d||p))return;const y=a.length-1,b=a[y],E=(b.x+b.metrics.advance*b.scale)*o;for(let T=0;T<=y;T++)a[T].x-=E,a[T].y+=l+d+p}function sn(a,o,l){const{horizontalAlign:d,verticalAlign:p}=Aw(l),y=o[0]-a.displaySize[0]*d,b=o[1]-a.displaySize[1]*p;return{image:a,top:b,bottom:b+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function Bp(a,o,l,d,p,y){const b=a.image;let E;if(b.content){const ie=b.content,ce=b.pixelRatio||1;E=[ie[0]/ce,ie[1]/ce,b.displaySize[0]-ie[2]/ce,b.displaySize[1]-ie[3]/ce]}const T=o.left*y,D=o.right*y;let R,N,B,j;"width"===l||"both"===l?(j=p[0]+T-d[3],N=p[0]+D+d[1]):(j=p[0]+(T+D-b.displaySize[0])/2,N=j+b.displaySize[0]);const H=o.top*y,X=o.bottom*y;return"height"===l||"both"===l?(R=p[1]+H-d[0],B=p[1]+X+d[2]):(R=p[1]+(H+X-b.displaySize[1])/2,B=R+b.displaySize[1]),{image:b,top:R,right:N,bottom:B,left:j,collisionPadding:E}}class bu extends Gt{constructor(o,l,d,p,y){super(o,l),this.angle=p,this.z=d,void 0!==y&&(this.segment=y)}clone(){return new bu(this.x,this.y,this.z,this.angle,this.segment)}}function qv(a,o,l,d,p){if(void 0===o.segment)return!0;let y=o,b=o.segment+1,E=0;for(;E>-l/2;){if(b--,b<0)return!1;E-=a[b].dist(y),y=a[b]}E+=a[b].dist(a[b+1]),b++;const T=[];let D=0;for(;E<l/2;){const R=a[b],N=a[b+1];if(!N)return!1;let B=a[b-1].angleTo(R)-R.angleTo(N);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:E,angleDelta:B}),D+=B;E-T[0].distance>d;)D-=T.shift().angleDelta;if(D>p)return!1;b++,E+=R.dist(N)}return!0}function Wv(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function Q_(a,o,l){return a?.6*o*l:0}function Pw(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function Ow(a,o,l,d,p,y){const b=Q_(l,p,y),E=Pw(l,d)*y;let T=0;const D=Wv(a)/2;for(let R=0;R<a.length-1;R++){const N=a[R],B=a[R+1],j=N.dist(B);if(T+j>D){const H=(D-T)/j,X=ai(N.x,B.x,H),ie=ai(N.y,B.y,H),ce=new bu(X,ie,0,B.angleTo(N),R);return!b||qv(a,ce,E,b,o)?ce:void 0}T+=j}}function kw(a,o,l,d,p,y,b,E,T){const D=Q_(d,y,b),R=Pw(d,p),N=R*b,B=0===a[0].x||a[0].x===T||0===a[0].y||a[0].y===T;return o-N<o/4&&(o=N+o/4),J_(a,B?o/2*E%o:(R/2+2*y)*b*E%o,o,D,l,N,B,!1,T)}function J_(a,o,l,d,p,y,b,E,T){const D=y/2,R=Wv(a);let N=0,B=o-l,j=[];for(let H=0;H<a.length-1;H++){const X=a[H],ie=a[H+1],ce=X.dist(ie),be=ie.angleTo(X);for(;B+l<N+ce;){B+=l;const de=(B-N)/ce,ve=ai(X.x,ie.x,de),xe=ai(X.y,ie.y,de);if(ve>=0&&ve<T&&xe>=0&&xe<T&&B-D>=0&&B+D<=R){const Ce=new bu(ve,xe,0,be,H);Ce._round(),d&&!qv(a,Ce,y,d,p)||j.push(Ce)}}N+=ce}return E||j.length||b||(j=J_(a,N/2,l,d,p,y,b,!0,T)),j}function qD(a,o,l,d,p){const y=[];for(let b=0;b<a.length;b++){const E=a[b];let T;for(let D=0;D<E.length-1;D++){let R=E[D],N=E[D+1];R.x<o&&N.x<o||(R.x<o?R=new Gt(o,R.y+(o-R.x)/(N.x-R.x)*(N.y-R.y))._round():N.x<o&&(N=new Gt(o,R.y+(o-R.x)/(N.x-R.x)*(N.y-R.y))._round()),R.y<l&&N.y<l||(R.y<l?R=new Gt(R.x+(l-R.y)/(N.y-R.y)*(N.x-R.x),l)._round():N.y<l&&(N=new Gt(R.x+(l-R.y)/(N.y-R.y)*(N.x-R.x),l)._round()),R.x>=d&&N.x>=d||(R.x>=d?R=new Gt(d,R.y+(d-R.x)/(N.x-R.x)*(N.y-R.y))._round():N.x>=d&&(N=new Gt(d,R.y+(d-R.x)/(N.x-R.x)*(N.y-R.y))._round()),R.y>=p&&N.y>=p||(R.y>=p?R=new Gt(R.x+(p-R.y)/(N.y-R.y)*(N.x-R.x),p)._round():N.y>=p&&(N=new Gt(R.x+(p-R.y)/(N.y-R.y)*(N.x-R.x),p)._round()),T&&R.equals(T[T.length-1])||(T=[R],y.push(T)),T.push(N)))))}}return y}an(bu,"Anchor");const pf=1e20;function Rw(a,o,l,d,p,y,b,E,T){for(let D=o;D<o+d;D++)ey(a,l*y+D,y,p,b,E,T);for(let D=l;D<l+p;D++)ey(a,D*y+o,1,d,b,E,T)}function ey(a,o,l,d,p,y,b){y[0]=0,b[0]=-pf,b[1]=pf,p[0]=a[o];for(let E=1,T=0,D=0;E<d;E++){p[E]=a[o+E*l];const R=E*E;do{const N=y[T];D=(p[E]-p[N]+R-N*N)/(E-N)/2}while(D<=b[T]&&--T>-1);T++,y[T]=E,b[T]=D,b[T+1]=pf}for(let E=0,T=0;E<d;E++){for(;b[T+1]<E;)T++;const D=y[T],R=E-D;a[o+E*l]=p[D]+R*R}}const ic=2,ty={none:0,ideographs:1,all:2};class rc{constructor(o,l,d){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=d,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,l){const d=[];for(const p in o)for(const y of o[p])d.push({stack:p,id:y});Yr(d,({stack:p,id:y},b)=>{let E=this.entries[p];E||(E=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=E.glyphs[y];if(void 0!==T)return void b(null,{stack:p,id:y,glyph:T});if(T=this._tinySDF(E,p,y),T)return E.glyphs[y]=T,void b(null,{stack:p,id:y,glyph:T});const D=Math.floor(y/256);if(256*D>65535)return void b(new Error("glyphs > 65535 not supported"));if(E.ranges[D])return void b(null,{stack:p,id:y,glyph:T});let R=E.requests[D];R||(R=E.requests[D]=[],rc.loadGlyphRange(p,D,this.url,this.requestManager,(N,B)=>{if(B){E.ascender=B.ascender,E.descender=B.descender;for(const j in B.glyphs)this._doesCharSupportLocalGlyph(+j)||(E.glyphs[+j]=B.glyphs[+j]);E.ranges[D]=!0}for(const j of R)j(N,B);delete E.requests[D]})),R.push((N,B)=>{N?b(N):B&&b(null,{stack:p,id:y,glyph:B.glyphs[y]||null})})},(p,y)=>{if(p)l(p);else if(y){const b={};for(const{stack:E,id:T,glyph:D}of y)void 0===b[E]&&(b[E]={}),void 0===b[E].glyphs&&(b[E].glyphs={}),b[E].glyphs[T]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},b[E].ascender=this.entries[E].ascender,b[E].descender=this.entries[E].descender;l(null,b)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==ty.none&&(this.localGlyphMode===ty.all?!!this.localFontFamily:!!this.localFontFamily&&(Qt["CJK Unified Ideographs"](o)||Qt["Hangul Syllables"](o)||Qt.Hiragana(o)||Qt.Katakana(o)||Qt["CJK Symbols and Punctuation"](o)))}_tinySDF(o,l,d){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(d))return;let y=o.tinySDF;if(!y){let X="400";/bold/i.test(l)?X="900":/medium/i.test(l)?X="500":/light/i.test(l)&&(X="200"),y=o.tinySDF=new rc.TinySDF({fontFamily:p,fontWeight:X,fontSize:24*ic,buffer:3*ic,radius:8*ic}),y.fontWeight=X}if(this.localGlyphs[y.fontWeight][d])return this.localGlyphs[y.fontWeight][d];const b=String.fromCharCode(d),{data:E,width:T,height:D,glyphWidth:R,glyphHeight:N,glyphLeft:B,glyphTop:j,glyphAdvance:H}=y.draw(b);return this.localGlyphs[y.fontWeight][d]={id:d,bitmap:new md({width:T,height:D},E),metrics:{width:R/ic,height:N/ic,left:B/ic,top:j/ic-27,advance:H/ic,localGlyph:!0}}}}rc.loadGlyphRange=function(a,o,l,d,p){const y=256*o,b=y+255,E=d.transformRequest(d.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${y}-${b}`),Co.Glyphs);eu(E,(T,D)=>{if(T)p(T);else if(D){const R={},N=new Hv(D).readFields(UD,{});for(const B of N.glyphs)R[B.id]=B;p(null,{glyphs:R,ascender:N.ascender,descender:N.descender})}})},rc.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:b="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=l;const E=this.size=a+4*o,T=this._createCanvas(E),D=this.ctx=T.getContext("2d",{willReadFrequently:!0});D.font=`${b} ${y} ${a}px ${p}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(a),b=Math.ceil(l),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),T=Math.min(this.size-this.buffer,b+Math.ceil(d)),D=E+2*this.buffer,R=T+2*this.buffer,N=Math.max(D*R,0),B=new Uint8ClampedArray(N),j={data:B,width:D,height:R,glyphWidth:E,glyphHeight:T,glyphTop:b,glyphLeft:0,glyphAdvance:o};if(0===E||0===T)return j;const{ctx:H,buffer:X,gridInner:ie,gridOuter:ce}=this;H.clearRect(X,X,E,T),H.fillText(a,X,X+b);const be=H.getImageData(X,X,E,T);ce.fill(pf,0,N),ie.fill(0,0,N);for(let de=0;de<T;de++)for(let ve=0;ve<E;ve++){const xe=be.data[4*(de*E+ve)+3]/255;if(0===xe)continue;const Ce=(de+X)*D+ve+X;if(1===xe)ce[Ce]=0,ie[Ce]=pf;else{const Xe=.5-xe;ce[Ce]=Xe>0?Xe*Xe:0,ie[Ce]=Xe<0?Xe*Xe:0}}Rw(ce,0,0,D,R,D,this.f,this.v,this.z),Rw(ie,X,X,E,T,D,this.f,this.v,this.z);for(let de=0;de<N;de++){const ve=Math.sqrt(ce[de])-Math.sqrt(ie[de]);B[de]=Math.round(255-255*(ve/this.radius+this.cutoff))}return j}};const Up=ys;function ny(a,o,l,d){const p=[],y=a.image,b=y.pixelRatio,E=y.paddedRect.w-2*Up,T=y.paddedRect.h-2*Up,D=a.right-a.left,R=a.bottom-a.top,N=y.stretchX||[[0,E]],B=y.stretchY||[[0,T]],j=(Je,mt)=>Je+mt[1]-mt[0],H=N.reduce(j,0),X=B.reduce(j,0),ie=E-H,ce=T-X;let be=0,de=H,ve=0,xe=X,Ce=0,Xe=ie,Ge=0,st=ce;if(y.content&&d){const Je=y.content;be=mf(N,0,Je[0]),ve=mf(B,0,Je[1]),de=mf(N,Je[0],Je[2]),xe=mf(B,Je[1],Je[3]),Ce=Je[0]-be,Ge=Je[1]-ve,Xe=Je[2]-Je[0]-de,st=Je[3]-Je[1]-xe}const Mt=(Je,mt,gt,wt)=>{const Pt=Vp(Je.stretch-be,de,D,a.left),rt=gf(Je.fixed-Ce,Xe,Je.stretch,H),Xt=Vp(mt.stretch-ve,xe,R,a.top),un=gf(mt.fixed-Ge,st,mt.stretch,X),Jt=Vp(gt.stretch-be,de,D,a.left),qn=gf(gt.fixed-Ce,Xe,gt.stretch,H),Ot=Vp(wt.stretch-ve,xe,R,a.top),En=gf(wt.fixed-Ge,st,wt.stretch,X),Ln=new Gt(Pt,Xt),Ci=new Gt(Jt,Xt),Wn=new Gt(Jt,Ot),On=new Gt(Pt,Ot),Dr=new Gt(rt/b,un/b),Zn=new Gt(qn/b,En/b),Xn=o*Math.PI/180;if(Xn){const Sr=Math.sin(Xn),dr=Math.cos(Xn),Fr=[dr,-Sr,Sr,dr];Ln._matMult(Fr),Ci._matMult(Fr),On._matMult(Fr),Wn._matMult(Fr)}const Yi=Je.stretch+Je.fixed,ur=mt.stretch+mt.fixed;return{tl:Ln,tr:Ci,bl:On,br:Wn,tex:{x:y.paddedRect.x+Up+Yi,y:y.paddedRect.y+Up+ur,w:gt.stretch+gt.fixed-Yi,h:wt.stretch+wt.fixed-ur},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Dr,pixelOffsetBR:Zn,minFontScaleX:Xe/b/D,minFontScaleY:st/b/R,isSDF:l}};if(d&&(y.stretchX||y.stretchY)){const Je=Lw(N,ie,H),mt=Lw(B,ce,X);for(let gt=0;gt<Je.length-1;gt++){const wt=Je[gt],Pt=Je[gt+1];for(let rt=0;rt<mt.length-1;rt++)p.push(Mt(wt,mt[rt],Pt,mt[rt+1]))}}else p.push(Mt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:T+1}));return p}function mf(a,o,l){let d=0;for(const p of a)d+=Math.max(o,Math.min(l,p[1]))-Math.max(o,Math.min(l,p[0]));return d}function Lw(a,o,l){const d=[{fixed:-Up,stretch:0}];for(const[p,y]of a){const b=d[d.length-1];d.push({fixed:p-b.stretch,stretch:b.stretch}),d.push({fixed:p-b.stretch,stretch:b.stretch+(y-p)})}return d.push({fixed:o+Up,stretch:l}),d}function Vp(a,o,l,d){return a/o*l+d}function gf(a,o,l,d){return a-o*l/d}function xu(a,o,l,d){const p=o+a.positionedLines[d].lineOffset;return 0===d?l+p/2:l+(p+(o+a.positionedLines[d-1].lineOffset))/2}class Zv{constructor(o=[],l=Xv){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:d}=this,p=l[o];for(;o>0;){const y=o-1>>1,b=l[y];if(d(p,b)>=0)break;l[o]=b,o=y}l[o]=p}_down(o){const{data:l,compare:d}=this,p=this.length>>1,y=l[o];for(;o<p;){let b=1+(o<<1),E=l[b];const T=b+1;if(T<this.length&&d(l[T],E)<0&&(b=T,E=l[T]),d(E,y)>=0)break;l[o]=E,o=b}l[o]=y}}function Xv(a,o){return a<o?-1:a>o?1:0}function WD(a,o=1,l=!1){let d=1/0,p=1/0,y=-1/0,b=-1/0;const E=a[0];for(let j=0;j<E.length;j++){const H=E[j];(!j||H.x<d)&&(d=H.x),(!j||H.y<p)&&(p=H.y),(!j||H.x>y)&&(y=H.x),(!j||H.y>b)&&(b=H.y)}const T=Math.min(y-d,b-p);let D=T/2;const R=new Zv([],ZD);if(0===T)return new Gt(d,p);for(let j=d;j<y;j+=T)for(let H=p;H<b;H+=T)R.push(new _f(j+D,H+D,D,a));let N=function(j){let H=0,X=0,ie=0;const ce=j[0];for(let be=0,de=ce.length,ve=de-1;be<de;ve=be++){const xe=ce[be],Ce=ce[ve],Xe=xe.x*Ce.y-Ce.x*xe.y;X+=(xe.x+Ce.x)*Xe,ie+=(xe.y+Ce.y)*Xe,H+=3*Xe}return new _f(X/H,ie/H,0,j)}(a),B=R.length;for(;R.length;){const j=R.pop();(j.d>N.d||!N.d)&&(N=j,l&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,B)),j.max-N.d<=o||(D=j.h/2,R.push(new _f(j.p.x-D,j.p.y-D,D,a)),R.push(new _f(j.p.x+D,j.p.y-D,D,a)),R.push(new _f(j.p.x-D,j.p.y+D,D,a)),R.push(new _f(j.p.x+D,j.p.y+D,D,a)),B+=4)}return l&&(console.log(`num probes: ${B}`),console.log(`best distance: ${N.d}`)),N.p}function ZD(a,o){return o.max-a.max}class _f{constructor(o,l,d,p){this.p=new Gt(o,l),this.h=d,this.d=function(y,b){let E=!1,T=1/0;for(let D=0;D<b.length;D++){const R=b[D];for(let N=0,B=R.length,j=B-1;N<B;j=N++){const H=R[N],X=R[j];H.y>y.y!=X.y>y.y&&y.x<(X.x-H.x)*(y.y-H.y)/(X.y-H.y)+H.x&&(E=!E),T=Math.min(T,K1(y,H,X))}}return(E?1:-1)*Math.sqrt(T)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Bc=7,Yv=Number.POSITIVE_INFINITY,XD=Math.sqrt(2);function Fw(a,[o,l]){let d=0,p=0;if(l===Yv){o<0&&(o=0);const y=o/XD;switch(a){case"top-right":case"top-left":p=y-Bc;break;case"bottom-right":case"bottom-left":p=-y+Bc;break;case"bottom":p=-o+Bc;break;case"top":p=o-Bc}switch(a){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=o;break;case"right":d=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),a){case"top-right":case"top-left":case"top":p=l-Bc;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+Bc}switch(a){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}}return[d,p]}function Kv(a,o,l,d,p,y,b,E,T,D){a.createArrays(),a.tilePixelRatio=Tn/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const R=a.layers[0].layout,N=a.layers[0]._unevaluatedLayout._values,B={};if("composite"===a.textSizeData.kind){const{minZoom:X,maxZoom:ie}=a.textSizeData;B.compositeTextSizes=[N["text-size"].possiblyEvaluate(new L(X),E),N["text-size"].possiblyEvaluate(new L(ie),E)]}if("composite"===a.iconSizeData.kind){const{minZoom:X,maxZoom:ie}=a.iconSizeData;B.compositeIconSizes=[N["icon-size"].possiblyEvaluate(new L(X),E),N["icon-size"].possiblyEvaluate(new L(ie),E)]}B.layoutTextSize=N["text-size"].possiblyEvaluate(new L(T+1),E),B.layoutIconSize=N["icon-size"].possiblyEvaluate(new L(T+1),E),B.textMaxSize=N["text-size"].possiblyEvaluate(new L(18),E);const j="map"===R.get("text-rotation-alignment")&&"point"!==R.get("symbol-placement"),H=R.get("text-size");for(const X of a.features){const ie=R.get("text-font").evaluate(X,{},E).join(","),ce=H.evaluate(X,{},E),be=B.layoutTextSize.evaluate(X,{},E),de=(B.layoutIconSize.evaluate(X,{},E),{horizontal:{},vertical:void 0}),ve=X.text;let xe,Ce=[0,0];if(ve){const st=ve.toString(),Mt=R.get("text-letter-spacing").evaluate(X,{},E)*No,Je=R.get("text-line-height").evaluate(X,{},E)*No,mt=G0(st)?Mt:0,gt=R.get("text-anchor").evaluate(X,{},E),wt=R.get("text-variable-anchor");if(!wt){const Jt=R.get("text-radial-offset").evaluate(X,{},E);Ce=Jt?Fw(gt,[Jt*No,Yv]):R.get("text-offset").evaluate(X,{},E).map(qn=>qn*No)}let Pt=j?"center":R.get("text-justify").evaluate(X,{},E);const rt="point"===R.get("symbol-placement"),Xt=rt?R.get("text-max-width").evaluate(X,{},E)*No:1/0,un=Jt=>{a.allowVerticalPlacement&&hp(st)&&(de.vertical=Fp(ve,o,l,p,ie,Xt,Je,gt,Jt,mt,Ce,Ol.vertical,!0,be,ce))};if(!j&&wt){const Jt="auto"===Pt?wt.map(Ot=>yf(Ot)):[Pt];let qn=!1;for(let Ot=0;Ot<Jt.length;Ot++){const En=Jt[Ot];if(!de.horizontal[En])if(qn)de.horizontal[En]=de.horizontal[0];else{const Ln=Fp(ve,o,l,p,ie,Xt,Je,"center",En,mt,Ce,Ol.horizontal,!1,be,ce);Ln&&(de.horizontal[En]=Ln,qn=1===Ln.positionedLines.length)}}un("left")}else{if("auto"===Pt&&(Pt=yf(gt)),rt||R.get("text-writing-mode").indexOf("horizontal")>=0||!hp(st)){const Jt=Fp(ve,o,l,p,ie,Xt,Je,gt,Pt,mt,Ce,Ol.horizontal,!1,be,ce);Jt&&(de.horizontal[Pt]=Jt)}un(rt?"left":Pt)}}let Xe=!1;if(X.icon&&X.icon.name){const st=d[X.icon.name];st&&(xe=sn(p[X.icon.name],R.get("icon-offset").evaluate(X,{},E),R.get("icon-anchor").evaluate(X,{},E)),Xe=st.sdf,void 0===a.sdfIcons?a.sdfIcons=st.sdf:a.sdfIcons!==st.sdf&&_r("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(st.pixelRatio!==a.pixelRatio||0!==R.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const Ge=bd(de.horizontal)||de.vertical;a.iconsInText||(a.iconsInText=!!Ge&&Ge.iconsInText),(Ge||xe)&&YD(a,X,de,xe,d,B,be,0,Ce,Xe,b,E,D)}y&&a.generateCollisionDebugBuffers(T,a.collisionBoxArray)}function yf(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function YD(a,o,l,d,p,y,b,E,T,D,R,N,B){let j=y.textMaxSize.evaluate(o,{},N);void 0===j&&(j=b);const H=a.layers[0].layout,X=H.get("icon-offset").evaluate(o,{},N),ie=bd(l.horizontal)||l.vertical,ce="globe"===B.name,be=No,de=b/be,ve=a.tilePixelRatio*j/be,xe=(gt=a.overscaling,a.zoom>18&&gt>2&&(gt>>=1),Math.max(Tn/(512*gt),1)*H.get("symbol-spacing")),Ce=H.get("text-padding")*a.tilePixelRatio,Xe=H.get("icon-padding")*a.tilePixelRatio,Ge=Nn(H.get("text-max-angle")),st="map"===H.get("text-rotation-alignment")&&"point"!==H.get("symbol-placement"),Mt="map"===H.get("icon-rotation-alignment")&&"point"!==H.get("symbol-placement"),Je=H.get("symbol-placement"),mt=xe/2;var gt;const wt=H.get("icon-text-fit");let Pt;d&&"none"!==wt&&(a.allowVerticalPlacement&&l.vertical&&(Pt=Bp(d,l.vertical,wt,H.get("icon-text-fit-padding"),X,de)),ie&&(d=Bp(d,ie,wt,H.get("icon-text-fit-padding"),X,de)));const rt=(Xt,un,Jt)=>{if(un.x<0||un.x>=Tn||un.y<0||un.y>=Tn)return;let qn=null;if(ce){const{x:Ot,y:En,z:Ln}=B.projectTilePoint(un.x,un.y,Jt);qn={anchor:new bu(Ot,En,Ln,0,void 0),up:B.upVector(Jt,un.x,un.y)}}!function(Ot,En,Ln,Ci,Wn,On,Dr,Zn,Xn,Yi,ur,Sr,dr,Fr,Zr,oo,ir,Ir,mo,Xr,Ai,go,xr,pa,xo){const zo=Ot.addToLineVertexArray(En,Ci);let Bo,is,so,il,gg,_g,Yp,db=0,tE=0,nE=0,hb=0,fy=-1,Df=-1;const Cu={};let fb=Ls("");const vh=Ln?Ln.anchor:En;let pb=0,mb=0;if(void 0===Xn._unevaluatedLayout.getValue("text-radial-offset")?[pb,mb]=Xn.layout.get("text-offset").evaluate(Ai,{},xo).map(rl=>rl*No):(pb=Xn.layout.get("text-radial-offset").evaluate(Ai,{},xo)*No,mb=Yv),Ot.allowVerticalPlacement&&Wn.vertical){const rl=Wn.vertical;if(Zr)_g=Qv(rl),Zn&&(Yp=Qv(Zn));else{const ol=Xn.layout.get("text-rotate").evaluate(Ai,{},xo)+90;so=$p(Yi,vh,En,ur,Sr,dr,rl,Fr,ol,oo),Zn&&(il=$p(Yi,vh,En,ur,Sr,dr,Zn,Ir,ol))}}if(On){const rl=Xn.layout.get("icon-rotate").evaluate(Ai,{},xo),ol="none"!==Xn.layout.get("icon-text-fit"),yg=ny(On,rl,xr,ol),_b=Zn?ny(Zn,rl,xr,ol):void 0;is=$p(Yi,vh,En,ur,Sr,dr,On,Ir,rl),db=4*yg.length;const iE=Ot.iconSizeData;let Sf=null;"source"===iE.kind?(Sf=[Us*Xn.layout.get("icon-size").evaluate(Ai,{},xo)],Sf[0]>Ra&&_r(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${jp}. Reduce your "icon-size".`)):"composite"===iE.kind&&(Sf=[Us*go.compositeIconSizes[0].evaluate(Ai,{},xo),Us*go.compositeIconSizes[1].evaluate(Ai,{},xo)],(Sf[0]>Ra||Sf[1]>Ra)&&_r(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${jp}. Reduce your "icon-size".`)),Ot.addSymbols(Ot.icon,yg,Sf,Xr,mo,Ai,!1,Ln,En,zo.lineStartIndex,zo.lineLength,-1,pa,xo),fy=Ot.icon.placedSymbolArray.length-1,_b&&(tE=4*_b.length,Ot.addSymbols(Ot.icon,_b,Sf,Xr,mo,Ai,Ol.vertical,Ln,En,zo.lineStartIndex,zo.lineLength,-1,pa,xo),Df=Ot.icon.placedSymbolArray.length-1)}for(const rl in Wn.horizontal){const ol=Wn.horizontal[rl];Bo||(fb=Ls(ol.text),Zr?gg=Qv(ol):Bo=$p(Yi,vh,En,ur,Sr,dr,ol,Fr,Xn.layout.get("text-rotate").evaluate(Ai,{},xo),oo));const yg=1===ol.positionedLines.length;if(nE+=KD(Ot,Ln,En,ol,Dr,Xn,Zr,Ai,oo,zo,Wn.vertical?Ol.horizontal:Ol.horizontalOnly,yg?Object.keys(Wn.horizontal):[rl],Cu,fy,go,pa,xo),yg)break}Wn.vertical&&(hb+=KD(Ot,Ln,En,Wn.vertical,Dr,Xn,Zr,Ai,oo,zo,Ol.vertical,["vertical"],Cu,Df,go,pa,xo));let cc=-1;const gb=(rl,ol)=>rl?Math.max(rl,ol):ol;cc=gb(gg,cc),cc=gb(_g,cc),cc=gb(Yp,cc);const Uk=cc>-1?1:0;Ot.glyphOffsetArray.length>=Uc.MAX_GLYPHS&&_r("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ai.sortKey&&Ot.addToSortKeyRanges(Ot.symbolInstances.length,Ai.sortKey),Ot.symbolInstances.emplaceBack(vh.x,vh.y,vh.z,En.x,En.y,Cu.right>=0?Cu.right:-1,Cu.center>=0?Cu.center:-1,Cu.left>=0?Cu.left:-1,Cu.vertical>=0?Cu.vertical:-1,fy,Df,fb,void 0!==Bo?Bo:Ot.collisionBoxArray.length,void 0!==Bo?Bo+1:Ot.collisionBoxArray.length,void 0!==so?so:Ot.collisionBoxArray.length,void 0!==so?so+1:Ot.collisionBoxArray.length,void 0!==is?is:Ot.collisionBoxArray.length,void 0!==is?is+1:Ot.collisionBoxArray.length,il||Ot.collisionBoxArray.length,il?il+1:Ot.collisionBoxArray.length,ur,nE,hb,db,tE,Uk,0,pb,mb,cc)}(a,un,qn,Xt,l,d,p,Pt,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,Ce,st,T,0,Xe,Mt,X,o,y,D,R,N)};if("line"===Je)for(const Xt of qD(o.geometry,0,0,Tn,Tn)){const un=kw(Xt,xe,Ge,l.vertical||ie,d,be,ve,a.overscaling,Tn);for(const Jt of un)ie&&Rk(a,ie.text,mt,Jt)||rt(Xt,Jt,N)}else if("line-center"===Je){for(const Xt of o.geometry)if(Xt.length>1){const un=Ow(Xt,Ge,l.vertical||ie,d,be,ve);un&&rt(Xt,un,N)}}else if("Polygon"===o.type)for(const Xt of Jm(o.geometry,0)){const un=WD(Xt,16);rt(Xt[0],new bu(un.x,un.y,0,0,void 0),N)}else if("LineString"===o.type)for(const Xt of o.geometry)rt(Xt,new bu(Xt[0].x,Xt[0].y,0,0,void 0),N);else if("Point"===o.type)for(const Xt of o.geometry)for(const un of Xt)rt([un],new bu(un.x,un.y,0,0,void 0),N)}const jp=255,Ra=jp*Us;function KD(a,o,l,d,p,y,b,E,T,D,R,N,B,j,H,X,ie){const ce=function(ve,xe,Ce,Xe,Ge,st,Mt,Je){const mt=[];if(0===xe.positionedLines.length)return mt;const gt=Xe.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,wt=function(Jt){const qn=Jt[0],Ot=Jt[1],En=qn*Ot;return En>0?[qn,-Ot]:En<0?[-qn,Ot]:0===qn?[Ot,qn]:[Ot,-qn]}(Ce);let Pt=Math.abs(xe.top-xe.bottom);for(const Jt of xe.positionedLines)Pt-=Jt.lineOffset;const rt=xe.positionedLines.length,Xt=Pt/rt;let un=xe.top-Ce[1];for(let Jt=0;Jt<rt;++Jt){const qn=xe.positionedLines[Jt];un=xu(xe,Xt,un,Jt);for(const Ot of qn.positionedGlyphs){if(!Ot.rect)continue;const En=Ot.rect||{};let Ln=Dw+1,Ci=!0,Wn=1,On=0;if(Ot.imageName){const xr=Mt[Ot.imageName];if(!xr)continue;if(xr.sdf){_r("SDF images are not supported in formatted text and will be ignored.");continue}Ci=!1,Wn=xr.pixelRatio,Ln=ys/Wn}const Dr=(Ge||Je)&&Ot.vertical,Zn=Ot.metrics.advance*Ot.scale/2,Xn=Ot.metrics,Yi=Ot.rect;if(null===Yi)continue;Je&&xe.verticalizable&&(On=Ot.imageName?Zn-Ot.metrics.width*Ot.scale/2:0);const ur=Ge?[Ot.x+Zn,Ot.y]:[0,0];let Sr=[0,0],dr=[0,0],Fr=!1;Ge||(Dr?(dr=[Ot.x+Zn+wt[0],Ot.y+wt[1]-On],Fr=!0):Sr=[Ot.x+Zn+Ce[0],Ot.y+Ce[1]-On]);const Zr=Yi.w*Ot.scale/(Wn*(Ot.localGlyph?ic:1)),oo=Yi.h*Ot.scale/(Wn*(Ot.localGlyph?ic:1));let ir,Ir,mo,Xr;if(Dr){const xr=Ot.y-un,pa=new Gt(-Zn,Zn-xr),xo=-Math.PI/2,zo=new Gt(...dr);ir=new Gt(-Zn+Sr[0],Sr[1]),ir._rotateAround(xo,pa)._add(zo),ir.x+=-xr+Zn,ir.y-=(Xn.left-Ln)*Ot.scale;const Bo=Ot.imageName?Xn.advance*Ot.scale:No*Ot.scale,is=String.fromCharCode(Ot.glyph);vu(is)?ir.x+=(1-Ln)*Ot.scale:zD(is)?ir.x+=Bo-Xn.height*Ot.scale+(-Ln-1)*Ot.scale:ir.x+=Ot.imageName||Xn.width+2*Ln===Yi.w&&Xn.height+2*Ln===Yi.h?(Bo-oo)/2:(Bo-(Xn.height+2*Ln)*Ot.scale)/2,Ir=new Gt(ir.x,ir.y-Zr),mo=new Gt(ir.x+oo,ir.y),Xr=new Gt(ir.x+oo,ir.y-Zr)}else{const xr=(Xn.left-Ln)*Ot.scale-Zn+Sr[0],pa=(-Xn.top-Ln)*Ot.scale+Sr[1],xo=xr+Zr,zo=pa+oo;ir=new Gt(xr,pa),Ir=new Gt(xo,pa),mo=new Gt(xr,zo),Xr=new Gt(xo,zo)}if(gt){let xr;xr=Ge?new Gt(0,0):Fr?new Gt(wt[0],wt[1]):new Gt(Ce[0],Ce[1]),ir._rotateAround(gt,xr),Ir._rotateAround(gt,xr),mo._rotateAround(gt,xr),Xr._rotateAround(gt,xr)}const Ai=new Gt(0,0),go=new Gt(0,0);mt.push({tl:ir,tr:Ir,bl:mo,br:Xr,tex:En,writingMode:xe.writingMode,glyphOffset:ur,sectionIndex:Ot.sectionIndex,isSDF:Ci,pixelOffsetTL:Ai,pixelOffsetBR:go,minFontScaleX:0,minFontScaleY:0})}}return mt}(0,d,T,y,b,E,p,a.allowVerticalPlacement),be=a.textSizeData;let de=null;"source"===be.kind?(de=[Us*y.layout.get("text-size").evaluate(E,{},ie)],de[0]>Ra&&_r(`${a.layerIds[0]}: Value for "text-size" is >= ${jp}. Reduce your "text-size".`)):"composite"===be.kind&&(de=[Us*H.compositeTextSizes[0].evaluate(E,{},ie),Us*H.compositeTextSizes[1].evaluate(E,{},ie)],(de[0]>Ra||de[1]>Ra)&&_r(`${a.layerIds[0]}: Value for "text-size" is >= ${jp}. Reduce your "text-size".`)),a.addSymbols(a.text,ce,de,T,b,E,R,o,l,D.lineStartIndex,D.lineLength,j,X,ie);for(const ve of N)B[ve]=a.text.placedSymbolArray.length-1;return 4*ce.length}function bd(a){for(const o in a)return a[o];return null}function $p(a,o,l,d,p,y,b,E,T,D){let R=b.top,N=b.bottom,B=b.left,j=b.right;const H=b.collisionPadding;if(H&&(B-=H[0],R-=H[1],j+=H[2],N+=H[3]),T){const X=new Gt(B,R),ie=new Gt(j,R),ce=new Gt(B,N),be=new Gt(j,N),de=Nn(T);let ve=new Gt(0,0);D&&(ve=new Gt(D[0],D[1])),X._rotateAround(de,ve),ie._rotateAround(de,ve),ce._rotateAround(de,ve),be._rotateAround(de,ve),B=Math.min(X.x,ie.x,ce.x,be.x),j=Math.max(X.x,ie.x,ce.x,be.x),R=Math.min(X.y,ie.y,ce.y,be.y),N=Math.max(X.y,ie.y,ce.y,be.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,B,R,j,N,E,d,p,y),a.length-1}function Qv(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function Rk(a,o,l,d){const p=a.compareText;if(o in p){const y=p[o];for(let b=y.length-1;b>=0;b--)if(d.dist(y[b])<l)return!0}else p[o]=[];return p[o].push(d),!1}function QD(a,o){const l=a.fovAboveCenter,d=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,p=(a._camera.position[2]*a.worldSize-d)/Math.cos(a._pitch),y=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),b=Math.sin(a._pitch)*y+p;return Math.min(1.01*b,p*(1/a._horizonShift))}function wu(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const l=Math.pow(2,-a.z),d=a.x*l,p=(a.x+1)*l,y=a.y*l,b=(a.y+1)*l,E=Pl(d),T=Pl(p),D=ms(y),R=ms(b),N=o.project(E,D),B=o.project(T,D),j=o.project(T,R),H=o.project(E,R);let X=Math.min(N.x,B.x,j.x,H.x),ie=Math.min(N.y,B.y,j.y,H.y),ce=Math.max(N.x,B.x,j.x,H.x),be=Math.max(N.y,B.y,j.y,H.y);const de=l/16;function ve(Ce,Xe,Ge,st,Mt,Je){const mt=(Ge+Mt)/2,gt=(st+Je)/2,wt=o.project(Pl(mt),ms(gt)),Pt=Math.max(0,X-wt.x,ie-wt.y,wt.x-ce,wt.y-be);X=Math.min(X,wt.x),ce=Math.max(ce,wt.x),ie=Math.min(ie,wt.y),be=Math.max(be,wt.y),Pt>de&&(ve(Ce,wt,Ge,st,mt,gt),ve(wt,Xe,mt,gt,Mt,Je))}ve(N,B,d,y,p,y),ve(B,j,p,y,p,b),ve(j,H,p,b,d,b),ve(H,N,d,b,d,y),X-=de,ie-=de,ce+=de,be+=de;const xe=1/Math.max(ce-X,be-ie);return{scale:xe,x:X*xe,y:ie*xe,x2:ce*xe,y2:be*xe,projection:o}}const JD=Ja(new Float32Array(16));class Eu{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new Bi(0,0)}projectTilePoint(o,l,d){return{x:o,y:l,z:0}}locationPoint(o,l,d=!0){return o._coordinatePoint(o.locationCoordinate(l),d)}pixelsPerMeter(o,l){return Nc(1,o)*l}pixelSpaceConversion(o,l,d){return 1}farthestPixelDistance(o){return QD(o,o.pixelsPerMeter)}pointCoordinate(o,l,d,p){const y=o.horizonLineFromTop(!1),b=new Gt(l,Math.max(y,d));return o.rayIntersectionCoordinate(o.pointRayIntersection(b,p))}pointCoordinate3D(o,l,d){const p=new Gt(l,d);if(o.elevation)return o.elevation.pointCoordinate(p);{const y=this.pointCoordinate(o,p.x,p.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(o,l){if(o.elevation)return!this.pointCoordinate3D(o,l.x,l.y);const d=o.horizonLineFromTop();return l.y<d}createInversionMatrix(o,l){return JD}createTileMatrix(o,l,d){let p,y,b;const E=d.canonical,T=Ja(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=wu(E,this);p=1,y=D.x+d.wrap*D.scale,b=D.y,oh(T,T,[p/D.scale,p/D.scale,o.pixelsPerMeter/l])}else p=l/o.zoomScale(E.z),y=(E.x+Math.pow(2,E.z)*d.wrap)*p,b=E.y*p;return gp(T,T,[y,b,0]),oh(T,T,[p/Tn,p/Tn,1]),T}upVector(o,l,d){return[0,0,1]}upVectorScale(o,l,d){return{metersToTile:1}}}class Jv extends Eu{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,d]=this.parallels=o.parallels||[29.5,45.5],p=Math.sin(Nn(l));this.n=(p+Math.sin(Nn(d)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:d,c:p,r0:y}=this,b=Nn(o-this.center[0]),E=Nn(l),T=Math.sqrt(p-2*d*Math.sin(E))/d;return{x:T*Math.sin(b*d),y:T*Math.cos(b*d)-y,z:0}}unproject(o,l){const{n:d,c:p,r0:y}=this,b=y+l;let E=Math.atan2(o,Math.abs(b))*Math.sign(b);b*d<0&&(E-=Math.PI*Math.sign(o)*Math.sign(b));const T=Nn(this.center[0])*d;E=ii(E,-Math.PI-T,Math.PI-T);const D=ni(_o(E/d)+this.center[0],-180,180),R=Math.asin(ni((p-(o*o+b*b)*d*d)/(2*d),-1,1)),N=ni(_o(R),-gs,gs);return new Bi(D,N)}}const xd=1.340264,vf=-.081106,bf=893e-6,wd=.003796,xf=Math.sqrt(3)/2;class cg extends Eu{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const d=Math.asin(xf*Math.sin(l)),p=d*d,y=p*p*p;return{x:.5*(o*Math.cos(d)/(xf*(xd+3*vf*p+y*(7*bf+9*wd*p)))/Math.PI+.5),y:1-.5*(d*(xd+vf*p+y*(bf+wd*p))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,p=d*d,y=p*p*p;for(let R,N,B,j=0;j<12&&(N=d*(xd+vf*p+y*(bf+wd*p))-l,B=xd+3*vf*p+y*(7*bf+9*wd*p),R=N/B,d=ni(d-R,-Math.PI/3,Math.PI/3),p=d*d,y=p*p*p,!(Math.abs(R)<1e-12));++j);const b=xf*o*(xd+3*vf*p+y*(7*bf+9*wd*p))/Math.cos(d),E=Math.asin(Math.sin(d)/xf),T=ni(180*b/Math.PI,-180,180),D=ni(180*E/Math.PI,-gs,gs);return new Bi(T,D)}}class Nw extends Eu{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const d=360*(o-.5),p=ni(360*(.5-l),-gs,gs);return new Bi(d,p)}}const ph=Math.PI/2;function wf(a){return Math.tan((ph+a)/2)}class Lk extends Eu{constructor(o){super(o),this.center=o.center||[0,30];const[l,d]=this.parallels=o.parallels||[30,30];let p=Nn(l),y=Nn(d);this.southernCenter=p+y<0,this.southernCenter&&(p=-p,y=-y);const b=Math.cos(p),E=wf(p);this.n=p===y?Math.sin(p):Math.log(b/Math.cos(y))/Math.log(wf(y)/E),this.f=b*Math.pow(wf(p),this.n)/this.n}project(o,l){l=Nn(l),this.southernCenter&&(l=-l),o=Nn(o-this.center[0]);const d=1e-6,{n:p,f:y}=this;y>0?l<-ph+d&&(l=-ph+d):l>ph-d&&(l=ph-d);const b=y/Math.pow(wf(l),p);let E=b*Math.sin(p*o),T=y-b*Math.cos(p*o);return E=.5*(E/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:E,y:this.southernCenter?T:1-T,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:d,f:p}=this,y=p-l,b=Math.sign(y),E=Math.sign(d)*Math.sqrt(o*o+y*y);let T=Math.atan2(o,Math.abs(y))*b;y*d<0&&(T-=Math.PI*Math.sign(o)*b);const D=ni(_o(T/d)+this.center[0],-180,180),R=ni(_o(2*Math.atan(Math.pow(p/E,1/d))-ph),-gs,gs);return new Bi(D,this.southernCenter?-R:R)}}class iy extends Eu{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:Fc(o),y:mu(l),z:0}}unproject(o,l){const d=Pl(o),p=ms(l);return new Bi(d,p)}}const ry=Nn(gs);class zw extends Eu{project(o,l){const d=(l=Nn(l))*l,p=d*d;return{x:.5*((o=Nn(o))*(.8707-.131979*d+p*(p*(.003971*d-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+d*(.015085+p*(.028874*d-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,p=25,y=0,b=d*d;do{b=d*d;const D=b*b;y=(d*(1.007226+b*(.015085+D*(.028874*b-.044475-.005916*D)))-l)/(1.007226+b*(.045255+D*(.259866*b-.311325-.005916*11*D))),d=ni(d-y,-ry,ry)}while(Math.abs(y)>1e-6&&--p>0);b=d*d;const E=ni(_o(o/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),T=_o(d);return new Bi(E,T)}}const Bw=Nn(gs);class eS extends Eu{project(o,l){l=Nn(l),o=Nn(o);const d=Math.cos(l),p=2/Math.PI,y=Math.acos(d*Math.cos(o/2)),b=Math.sin(y)/y,E=.5*(o*p+2*d*Math.sin(o/2)/b)||0,T=.5*(l+Math.sin(l)/b)||0;return{x:.5*(E/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(o,l){let d=o=(2*o-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,y=25;const b=1e-6;let E=0,T=0;do{const D=Math.cos(p),R=Math.sin(p),N=2*R*D,B=R*R,j=D*D,H=Math.cos(d/2),X=Math.sin(d/2),ie=2*H*X,ce=X*X,be=1-j*H*H,de=be?1/be:0,ve=be?Math.acos(D*H)*Math.sqrt(1/be):0,xe=.5*(2*ve*D*X+2*d/Math.PI)-o,Ce=.5*(ve*R+p)-l,Xe=.5*de*(j*ce+ve*D*H*B)+1/Math.PI,Ge=de*(ie*N/4-ve*R*X),st=.125*de*(N*X-ve*R*j*ie),Mt=.5*de*(B*H+ve*ce*D)+.5,Je=Ge*st-Mt*Xe;E=(Ce*Ge-xe*Mt)/Je,T=(xe*st-Ce*Xe)/Je,d=ni(d-E,-Math.PI,Math.PI),p=ni(p-T,-Bw,Bw)}while((Math.abs(E)>b||Math.abs(T)>b)&&--y>0);return new Bi(_o(d),_o(p))}}class eb extends Eu{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Nn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:d,cosPhi:p}=this;return{x:Nn(o)*p*d+.5,y:-Math.sin(Nn(l))/p*d+.5,z:0}}unproject(o,l){const{scale:d,cosPhi:p}=this,y=-(l-.5)/d,b=ni(_o((o-.5)/d)/p,-180,180),E=Math.asin(ni(y*p,-1,1)),T=ni(_o(E),-gs,gs);return new Bi(b,T)}}class Uw extends iy{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,d){const p=po(o,l,d);return eo(p,p,qm(fd(d))),{x:p[0],y:p[1],z:p[2]}}locationPoint(o,l){const d=Gm(l.lat,l.lng),p=ts([],d),y=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;sf(d,d,p,Nc(1,0)*Tn*y);const b=Ja(new Float64Array(16));return ud(b,o.pixelMatrix,o.globeMatrix),eo(d,d,b),new Gt(d[0],d[1])}pixelsPerMeter(o,l){return Nc(1,0)*l}pixelSpaceConversion(o,l,d){const p=Nc(1,o)*l,y=ai(Nc(1,45)*l,p,d);return this.pixelsPerMeter(o,l)/y}createTileMatrix(o,l,d){const p=tl(fd(d.canonical));return ud(new Float64Array(16),o.globeMatrix,p)}createInversionMatrix(o,l){const{center:d}=o,p=qm(fd(l));return dd(p,p,Nn(d.lng)),K0(p,p,Nn(d.lat)),oh(p,p,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(o,l,d,p){return af(o,l,d,!0)||new pd(0,0)}pointCoordinate3D(o,l,d){const p=this.pointCoordinate(o,l,d,0);return[p.x,p.y,p.z]}isPointAboveHorizon(o,l){return!af(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(p,y){const b=p.cameraToCenterDistance,E=p._centerAltitude*y,T=p._camera,D=p._camera.forward(),R=sh([],da([],D,-b),[0,0,E]),N=p.worldSize/(2*Math.PI),B=[0,0,-N],j=p.width/p.height,H=Math.tan(p.fovAboveCenter),X=da([],T.up(),H),ie=da([],T.right(),H*j),ce=ts([],sh([],sh([],D,X),ie)),be=[];let de;if(new E_(R,ce).closestPointOnSphere(B,N,be)){const ve=sh([],be,B),xe=Lc([],ve,R);de=Math.cos(p.fovAboveCenter)*Bm(xe)}else{const ve=Lc([],R,B),xe=Lc([],B,R);ts(xe,xe);const Ce=Bm(ve)-N;de=Math.sqrt(Ce*(Ce+2*N));const Xe=Math.acos(de/(N+Ce))-Math.acos(Rc(D,xe));de*=Math.cos(Xe)}return 1.01*de}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),d=cf(o.zoom);if(d>0){const p=QD(o,Nc(1,o.center.lat)*o.worldSize),y=o.worldSize/(2*Math.PI),b=Math.max(o.width,o.height)/o.worldSize*Math.PI;return ai(l,p+y*(1-Math.cos(b)),Math.pow(d,10))}return l}upVector(o,l,d){return po(l,d,o,1)}upVectorScale(o){return{metersToTile:vp(T_(fd(o)))}}}function Vw(a){const o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new iy(a);case"equirectangular":return new Nw(a);case"naturalEarth":return new zw(a);case"equalEarth":return new cg(a);case"winkelTripel":return new eS(a);case"albers":return l?new eb(a):new Jv(a);case"lambertConformalConic":return l?new eb(a):new Lk(a);case"globe":return new Uw(a)}throw new Error(`Invalid projection name: ${a.name}`)}const tS=B_.types,Fk=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function oy(a,o,l,d,p,y,b,E,T,D,R,N,B){const j=E?Math.min(Ra,Math.round(E[0])):0,H=E?Math.min(Ra,Math.round(E[1])):0;a.emplaceBack(o,l,Math.round(32*d),Math.round(32*p),y,b,(j<<1)+(T?1:0),H,16*D,16*R,256*N,256*B)}function Hp(a,o,l,d,p,y,b){a.emplaceBack(o,l,d,p,y,b)}function Gp(a,o,l,d,p){a.emplaceBack(o,l,d,p),a.emplaceBack(o,l,d,p),a.emplaceBack(o,l,d,p),a.emplaceBack(o,l,d,p)}function nS(a){for(const o of a.sections)if(fp(o.text))return!0;return!1}class sy{constructor(o){this.layoutVertexArray=new yt,this.indexArray=new gn,this.programConfigurations=o,this.segments=new fo,this.dynamicLayoutVertexArray=new Et,this.opacityVertexArray=new wn,this.placedSymbolArray=new ho,this.globeExtVertexArray=new It}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,l,d,p){this.isEmpty()||(d&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,zv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,ag.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,Fk,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,LD.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||p)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}an(sy,"SymbolBuffers");class ug{constructor(o,l,d){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new d,this.segments=new fo,this.collisionVertexArray=new ui,this.collisionVertexArrayExt=new li}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,G_.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,Bv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}an(ug,"CollisionBuffers");class Uc{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(b=>b.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ja([]),this.placementViewportMatrix=Ja([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vv(this.zoom,l["text-size"]),this.iconSizeData=Vv(this.zoom,l["icon-size"]);const d=this.layers[0].layout,p=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==y&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===y||"auto"===y&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(b=>Ol[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new sy(new ih(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new sy(new ih(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new vt,this.lineVertexArray=new Ii,this.symbolInstances=new Rr}calculateGlyphDependencies(o,l,d,p,y){for(let b=0;b<o.length;b++)if(l[o.charCodeAt(b)]=!0,p&&y){const E=Vs[o.charAt(b)];E&&(l[E.charCodeAt(0)]=!0)}}populate(o,l,d,p){const y=this.layers[0],b=y.layout,E="globe"===this.projection.name,T=b.get("text-font"),D=b.get("text-field"),R=b.get("icon-image"),N=("constant"!==D.value.kind||D.value.value instanceof Li&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),B="constant"!==R.value.kind||!!R.value.value||Object.keys(R.parameters).length>0,j=b.get("symbol-sort-key");if(this.features=[],!N&&!B)return;const H=l.iconDependencies,X=l.glyphDependencies,ie=l.availableImages,ce=new L(this.zoom);for(const{feature:be,id:de,index:ve,sourceLayerIndex:xe}of o){const Ce=y._featureFilter.needGeometry,Xe=uh(be,Ce);if(!y._featureFilter.filter(ce,Xe,d))continue;if(Ce||(Xe.geometry=nc(be,d,p)),E&&1!==be.type&&d.z<=5){const Je=Xe.geometry,mt=.98078528056,gt=(wt,Pt)=>Rc(po(wt.x,wt.y,d,1),po(Pt.x,Pt.y,d,1))<mt;for(let wt=0;wt<Je.length;wt++)Je[wt]=I_(Je[wt],gt)}let Ge,st;if(N){const Je=y.getValueAndResolveTokens("text-field",Xe,d,ie),mt=Li.factory(Je);nS(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===M()||this.hasRTLText&&k.isParsed())&&(Ge=ND(mt,y,Xe))}if(B){const Je=y.getValueAndResolveTokens("icon-image",Xe,d,ie);st=Je instanceof si?Je:si.fromString(Je)}if(!Ge&&!st)continue;const Mt=this.sortFeaturesByKey?j.evaluate(Xe,{},d):void 0;if(this.features.push({id:de,text:Ge,icon:st,index:ve,sourceLayerIndex:xe,geometry:Xe.geometry,properties:be.properties,type:tS[be.type],sortKey:Mt}),st&&(H[st.name]=!0),Ge){const Je=T.evaluate(Xe,{},d).join(","),mt="map"===b.get("text-rotation-alignment")&&"point"!==b.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ol.vertical)>=0;for(const gt of Ge.sections)if(gt.image)H[gt.image.name]=!0;else{const wt=hp(Ge.toString()),Pt=gt.fontStack||Je,rt=X[Pt]=X[Pt]||{};this.calculateGlyphDependencies(gt.text,rt,mt,this.allowVerticalPlacement,wt)}}}"line"===b.get("symbol-placement")&&(this.features=function(be){const de={},ve={},xe=[];let Ce=0;function Xe(Je){xe.push(be[Je]),Ce++}function Ge(Je,mt,gt){const wt=ve[Je];return delete ve[Je],ve[mt]=wt,xe[wt].geometry[0].pop(),xe[wt].geometry[0]=xe[wt].geometry[0].concat(gt[0]),wt}function st(Je,mt,gt){const wt=de[mt];return delete de[mt],de[Je]=wt,xe[wt].geometry[0].shift(),xe[wt].geometry[0]=gt[0].concat(xe[wt].geometry[0]),wt}function Mt(Je,mt,gt){const wt=gt?mt[0][mt[0].length-1]:mt[0][0];return`${Je}:${wt.x}:${wt.y}`}for(let Je=0;Je<be.length;Je++){const mt=be[Je],gt=mt.geometry,wt=mt.text?mt.text.toString():null;if(!wt){Xe(Je);continue}const Pt=Mt(wt,gt),rt=Mt(wt,gt,!0);if(Pt in ve&&rt in de&&ve[Pt]!==de[rt]){const Xt=st(Pt,rt,gt),un=Ge(Pt,rt,xe[Xt].geometry);delete de[Pt],delete ve[rt],ve[Mt(wt,xe[un].geometry,!0)]=un,xe[Xt].geometry=null}else Pt in ve?Ge(Pt,rt,gt):rt in de?st(Pt,rt,gt):(Xe(Je),de[Pt]=Ce-1,ve[rt]=Ce-1)}return xe.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((be,de)=>be.sortKey-de.sortKey)}update(o,l,d,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,l,this.layers,d,p),this.icon.programConfigurations.updatePaintArrays(o,l,this.layers,d,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Vw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const d=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:p,y}of l)this.lineVertexArray.emplaceBack(p,y);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(o,l,d,p,y,b,E,T,D,R,N,B,j,H){const X=o.indexArray,ie=o.layoutVertexArray,ce=o.globeExtVertexArray,be=o.segments.prepareSegment(4*l.length,ie,X,this.canOverlap?b.sortKey:void 0),de=this.glyphOffsetArray.length,ve=be.vertexLength,xe=this.allowVerticalPlacement&&E===Ol.vertical?Math.PI/2:0,Ce=b.text&&b.text.sections;for(let Ge=0;Ge<l.length;Ge++){const{tl:st,tr:Mt,bl:Je,br:mt,tex:gt,pixelOffsetTL:wt,pixelOffsetBR:Pt,minFontScaleX:rt,minFontScaleY:Xt,glyphOffset:un,isSDF:Jt,sectionIndex:qn}=l[Ge],Ot=be.vertexLength,En=un[1];if(oy(ie,D.x,D.y,st.x,En+st.y,gt.x,gt.y,d,Jt,wt.x,wt.y,rt,Xt),oy(ie,D.x,D.y,Mt.x,En+Mt.y,gt.x+gt.w,gt.y,d,Jt,Pt.x,wt.y,rt,Xt),oy(ie,D.x,D.y,Je.x,En+Je.y,gt.x,gt.y+gt.h,d,Jt,wt.x,Pt.y,rt,Xt),oy(ie,D.x,D.y,mt.x,En+mt.y,gt.x+gt.w,gt.y+gt.h,d,Jt,Pt.x,Pt.y,rt,Xt),T){const{x:Ln,y:Ci,z:Wn}=T.anchor,[On,Dr,Zn]=T.up;Hp(ce,Ln,Ci,Wn,On,Dr,Zn),Hp(ce,Ln,Ci,Wn,On,Dr,Zn),Hp(ce,Ln,Ci,Wn,On,Dr,Zn),Hp(ce,Ln,Ci,Wn,On,Dr,Zn),Gp(o.dynamicLayoutVertexArray,Ln,Ci,Wn,xe)}else Gp(o.dynamicLayoutVertexArray,D.x,D.y,D.z,xe);X.emplaceBack(Ot,Ot+1,Ot+2),X.emplaceBack(Ot+1,Ot+2,Ot+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(un[0]),Ge!==l.length-1&&qn===l[Ge+1].sectionIndex||o.programConfigurations.populatePaintArrays(ie.length,b,b.index,{},j,H,Ce&&Ce[qn])}const Xe=T?T.anchor:D;o.placedSymbolArray.emplaceBack(Xe.x,Xe.y,Xe.z,D.x,D.y,de,this.glyphOffsetArray.length-de,ve,R,N,D.segment,d?d[0]:0,d?d[1]:0,p[0],p[1],E,0,!1,0,B,0)}_commitLayoutVertex(o,l,d,p,y,b,E){o.emplaceBack(l,d,p,y,b,Math.round(E.x),Math.round(E.y))}_addCollisionDebugVertices(o,l,d,p,y,b,E){const T=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),D=T.vertexLength,R=E.tileAnchorX,N=E.tileAnchorY;for(let j=0;j<4;j++)d.collisionVertexArray.emplaceBack(0,0,0,0);d.collisionVertexArrayExt.emplaceBack(l,-o.padding,-o.padding),d.collisionVertexArrayExt.emplaceBack(l,o.padding,-o.padding),d.collisionVertexArrayExt.emplaceBack(l,o.padding,o.padding),d.collisionVertexArrayExt.emplaceBack(l,-o.padding,o.padding),this._commitLayoutVertex(d.layoutVertexArray,p,y,b,R,N,new Gt(o.x1,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,y,b,R,N,new Gt(o.x2,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,y,b,R,N,new Gt(o.x2,o.y2)),this._commitLayoutVertex(d.layoutVertexArray,p,y,b,R,N,new Gt(o.x1,o.y2)),T.vertexLength+=4;const B=d.indexArray;B.emplaceBack(D,D+1),B.emplaceBack(D+1,D+2),B.emplaceBack(D+2,D+3),B.emplaceBack(D+3,D),T.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,d,p,y,b){for(let E=p;E<y;E++){const T=d.get(E),D=this.getSymbolInstanceTextSize(o,b,l,E);this._addCollisionDebugVertices(T,D,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(o,l,d,p,y,b){for(let E=p;E<y;E++){const T=d.get(E),D=this.getSymbolInstanceIconSize(o,l,b.placedIconSymbolIndex);this._addCollisionDebugVertices(T,D,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,b)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ug(ln,Uv.members,Fo),this.iconCollisionBox=new ug(ln,Uv.members,Fo);const d=Op(this.iconSizeData,o),p=Op(this.textSizeData,o);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(p,o,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(p,o,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(d,o,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(d,o,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(o,l,d,p){const y=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),b=q_(this.textSizeData,o,y)/No;return this.tilePixelRatio*b}getSymbolInstanceIconSize(o,l,d){const p=this.icon.placedSymbolArray.get(d),y=q_(this.iconSizeData,o,p);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(o,l,d){o.emplaceBack(l,-d,-d),o.emplaceBack(l,d,-d),o.emplaceBack(l,d,d),o.emplaceBack(l,-d,d)}_updateTextDebugCollisionBoxes(o,l,d,p,y,b){for(let E=p;E<y;E++){const T=d.get(E),D=this.getSymbolInstanceTextSize(o,b,l,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,T.padding)}}_updateIconDebugCollisionBoxes(o,l,d,p,y,b){for(let E=p;E<y;E++){const T=d.get(E),D=this.getSymbolInstanceIconSize(o,l,b);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,T.padding)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=Op(this.iconSizeData,o),p=Op(this.textSizeData,o);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(p,o,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(p,o,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(d,o,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(d,o,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,d,p,y,b,E,T,D){const R={};if(l<d){const{x1:N,y1:B,x2:j,y2:H,padding:X,projectedAnchorX:ie,projectedAnchorY:ce,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve,featureIndex:xe}=o.get(l);R.textBox={x1:N,y1:B,x2:j,y2:H,padding:X,projectedAnchorX:ie,projectedAnchorY:ce,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve},R.textFeatureIndex=xe}if(p<y){const{x1:N,y1:B,x2:j,y2:H,padding:X,projectedAnchorX:ie,projectedAnchorY:ce,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve,featureIndex:xe}=o.get(p);R.verticalTextBox={x1:N,y1:B,x2:j,y2:H,padding:X,projectedAnchorX:ie,projectedAnchorY:ce,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve},R.verticalTextFeatureIndex=xe}if(b<E){const{x1:N,y1:B,x2:j,y2:H,padding:X,projectedAnchorX:ie,projectedAnchorY:ce,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve,featureIndex:xe}=o.get(b);R.iconBox={x1:N,y1:B,x2:j,y2:H,padding:X,projectedAnchorX:ie,projectedAnchorY:ce,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve},R.iconFeatureIndex=xe}if(T<D){const{x1:N,y1:B,x2:j,y2:H,padding:X,projectedAnchorX:ie,projectedAnchorY:ce,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve,featureIndex:xe}=o.get(T);R.verticalIconBox={x1:N,y1:B,x2:j,y2:H,padding:X,projectedAnchorX:ie,projectedAnchorY:ce,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve},R.verticalIconFeatureIndex=xe}return R}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,l){const d=o.placedSymbolArray.get(l),p=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<p;y+=4)o.indexArray.emplaceBack(y,y+1,y+2),o.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),d=Math.cos(o),p=[],y=[],b=[];for(let E=0;E<this.symbolInstances.length;++E){b.push(E);const T=this.symbolInstances.get(E);p.push(0|Math.round(l*T.tileAnchorX+d*T.tileAnchorY)),y.push(T.featureIndex)}return b.sort((E,T)=>p[E]-p[T]||y[T]-y[E]),b}addToSortKeyRanges(o,l){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:E,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:D}=d;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&b!==y&&b!==p&&this.addIndicesForPlacedSymbol(this.text,b),E>=0&&this.addIndicesForPlacedSymbol(this.text,E),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}an(Uc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Uc.MAX_GLYPHS=65535,Uc.addDynamicAttributes=Gp;const iS=new _e({"symbol-placement":new W(nt.layout_symbol["symbol-placement"]),"symbol-spacing":new W(nt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new W(nt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new re(nt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new W(nt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new W(nt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new W(nt.layout_symbol["icon-ignore-placement"]),"icon-optional":new W(nt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new W(nt.layout_symbol["icon-rotation-alignment"]),"icon-size":new re(nt.layout_symbol["icon-size"]),"icon-text-fit":new W(nt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new W(nt.layout_symbol["icon-text-fit-padding"]),"icon-image":new re(nt.layout_symbol["icon-image"]),"icon-rotate":new re(nt.layout_symbol["icon-rotate"]),"icon-padding":new W(nt.layout_symbol["icon-padding"]),"icon-keep-upright":new W(nt.layout_symbol["icon-keep-upright"]),"icon-offset":new re(nt.layout_symbol["icon-offset"]),"icon-anchor":new re(nt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new W(nt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new W(nt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new W(nt.layout_symbol["text-rotation-alignment"]),"text-field":new re(nt.layout_symbol["text-field"]),"text-font":new re(nt.layout_symbol["text-font"]),"text-size":new re(nt.layout_symbol["text-size"]),"text-max-width":new re(nt.layout_symbol["text-max-width"]),"text-line-height":new re(nt.layout_symbol["text-line-height"]),"text-letter-spacing":new re(nt.layout_symbol["text-letter-spacing"]),"text-justify":new re(nt.layout_symbol["text-justify"]),"text-radial-offset":new re(nt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new W(nt.layout_symbol["text-variable-anchor"]),"text-anchor":new re(nt.layout_symbol["text-anchor"]),"text-max-angle":new W(nt.layout_symbol["text-max-angle"]),"text-writing-mode":new W(nt.layout_symbol["text-writing-mode"]),"text-rotate":new re(nt.layout_symbol["text-rotate"]),"text-padding":new W(nt.layout_symbol["text-padding"]),"text-keep-upright":new W(nt.layout_symbol["text-keep-upright"]),"text-transform":new re(nt.layout_symbol["text-transform"]),"text-offset":new re(nt.layout_symbol["text-offset"]),"text-allow-overlap":new W(nt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new W(nt.layout_symbol["text-ignore-placement"]),"text-optional":new W(nt.layout_symbol["text-optional"])});var ay={paint:new _e({"icon-opacity":new re(nt.paint_symbol["icon-opacity"]),"icon-color":new re(nt.paint_symbol["icon-color"]),"icon-halo-color":new re(nt.paint_symbol["icon-halo-color"]),"icon-halo-width":new re(nt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new re(nt.paint_symbol["icon-halo-blur"]),"icon-translate":new W(nt.paint_symbol["icon-translate"]),"icon-translate-anchor":new W(nt.paint_symbol["icon-translate-anchor"]),"text-opacity":new re(nt.paint_symbol["text-opacity"]),"text-color":new re(nt.paint_symbol["text-color"],{runtimeType:Zo,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new re(nt.paint_symbol["text-halo-color"]),"text-halo-width":new re(nt.paint_symbol["text-halo-width"]),"text-halo-blur":new re(nt.paint_symbol["text-halo-blur"]),"text-translate":new W(nt.paint_symbol["text-translate"]),"text-translate-anchor":new W(nt.paint_symbol["text-translate-anchor"])}),layout:iS};class jw{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:or,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}an(jw,"FormatSectionOverride",{omit:["defaultValue"]});class dg extends kc{constructor(o){super(o,ay)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const p=[];for(const y of d)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,l,d,p){const y=this.layout.get(o).evaluate(l,{},d,p),b=this._unevaluatedLayout._values[o];return b.isDataDriven()||mr(b.value)||!y?y:(E=l.properties,y.replace(/{([^{}]+)}/g,(D,R)=>R in E?String(E[R]):""));var E}createBucket(o){return new Uc(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of ay.paint.overridableProperties){if(!dg.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),d=new jw(l),p=new ca(d,l.property.specification);let y=null;y="constant"===l.value.kind||"source"===l.value.kind?new Mc("source",p):new Jn("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new se(l.property,y,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&dg.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const d=o.get("text-field"),p=ay.paint.properties[l];let y=!1;const b=E=>{for(const T of E)if(p.overrides&&p.overrides.hasOverride(T))return void(y=!0)};if("constant"===d.value.kind&&d.value.value instanceof Li)b(d.value.value.sections);else if("source"===d.value.kind){const E=D=>{y||(D instanceof cs&&Qn(D.value)===z?b(D.value.sections):D instanceof yl?b(D.sections):D.eachChild(E))},T=d.value;T._styleExpression&&E(T._styleExpression.expression)}return y}getProgramConfiguration(o){return new ld(this,o)}}var Nk={paint:new _e({"background-color":new W(nt.paint_background["background-color"]),"background-pattern":new W(nt.paint_background["background-pattern"]),"background-opacity":new W(nt.paint_background["background-opacity"])})},rS={paint:new _e({"raster-opacity":new W(nt.paint_raster["raster-opacity"]),"raster-hue-rotate":new W(nt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new W(nt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new W(nt.paint_raster["raster-brightness-max"]),"raster-saturation":new W(nt.paint_raster["raster-saturation"]),"raster-contrast":new W(nt.paint_raster["raster-contrast"]),"raster-resampling":new W(nt.paint_raster["raster-resampling"]),"raster-fade-duration":new W(nt.paint_raster["raster-fade-duration"])})};class qp extends kc{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var oS={paint:new _e({"sky-type":new W(nt.paint_sky["sky-type"]),"sky-atmosphere-sun":new W(nt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new W(nt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new W(nt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new W(nt.paint_sky["sky-gradient-radius"]),"sky-gradient":new fe(nt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new W(nt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new W(nt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new W(nt.paint_sky["sky-opacity"])})};function mh(a,o,l){const d=[0,0,1],p=tv([]);return iv(p,p,l?-Nn(a)+Math.PI:Nn(a)),nv(p,p,-Nn(o)),j1(d,d,p),ts(d,d)}const vs={circle:class extends kc{constructor(a){super(a,fD)}createBucket(a){return new dh(a)}queryRadius(a){const o=a;return df("circle-radius",this,o)+df("circle-stroke-width",this,o)+pv(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,d,p,y,b,E){const T=dD(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return O_(a,d,y,b,E,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,D)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new ld(this,a)}},heatmap:class extends kc{createBucket(a){return new mD(a)}constructor(a){super(a,_v),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=k_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return df("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,d,p,y,b,E){const T=this.paint.get("heatmap-radius").evaluate(o,l);return O_(a,d,y,b,E,!0,!0,new Gt(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new ld(this,a)}},hillshade:class extends kc{constructor(a){super(a,ew)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends kc{constructor(a){super(a,rw)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new ld(this,a)}recalculate(a,o){super.recalculate(a,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new N_(a)}queryRadius(){return pv(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,d,p,y){return!a.queryGeometry.isAboveHorizon&&cD(mv(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}},"fill-extrusion":class extends kc{constructor(a){super(a,rg)}createBucket(a){return new ig(a)}queryRadius(){return pv(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new ld(this,a)}queryIntersectsFeature(a,o,l,d,p,y,b,E,T){const D=dD(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(o,l),N=this.paint.get("fill-extrusion-base").evaluate(o,l),B=[0,0],j=E&&y.elevation,H=y.elevation?y.elevation.exaggeration():1,X=a.tile.getBucket(this);if(j&&X instanceof ig){const ve=X.centroidVertexArray,xe=T+1;xe<ve.length&&(B[0]=ve.geta_centroid_pos0(xe),B[1]=ve.geta_centroid_pos1(xe))}if(0===B[0]&&1===B[1])return!1;"globe"===y.projection.name&&(d=Rv([d],[new Gt(0,0),new Gt(Tn,Tn)],a.tileID.canonical).map(ve=>ve.polygon).flat());const ie=j?E:null,[ce,be]=(xe=d,Ce=N,Xe=R,Ge=D,st=b,Mt=ie,Je=B,mt=H,gt=y.center.lat,"globe"===(ve=y).projection.name?function(Pt,rt,Xt,un,Jt,qn,Ot,En,Ln,Ci,Wn){const On=[],Dr=[],Zn=Pt.projection.upVectorScale(Wn,Pt.center.lat,Pt.worldSize).metersToTile,Xn=[0,0,0,1],Yi=[0,0,0,1],ur=(dr,Fr,Zr,oo)=>{dr[0]=Fr,dr[1]=Zr,dr[2]=oo,dr[3]=1},Sr=j_();Xt>0&&(Xt+=Sr),un+=Sr;for(const dr of rt){const Fr=[],Zr=[];for(const oo of dr){const ir=oo.x+Jt.x,Ir=oo.y+Jt.y,mo=Pt.projection.projectTilePoint(ir,Ir,Wn),Xr=Pt.projection.upVector(Wn,oo.x,oo.y);let Ai=Xt,go=un;if(Ot){const xr=fw(ir,Ir,Xt,un,Ot,En,Ln,Ci);Ai+=xr.base,go+=xr.top}0!==Xt?ur(Xn,mo.x+Xr[0]*Zn*Ai,mo.y+Xr[1]*Zn*Ai,mo.z+Xr[2]*Zn*Ai):ur(Xn,mo.x,mo.y,mo.z),ur(Yi,mo.x+Xr[0]*Zn*go,mo.y+Xr[1]*Zn*go,mo.z+Xr[2]*Zn*go),eo(Xn,Xn,qn),eo(Yi,Yi,qn),Fr.push(new yu(Xn[0],Xn[1],Xn[2])),Zr.push(new yu(Yi[0],Yi[1],Yi[2]))}On.push(Fr),Dr.push(Zr)}return[On,Dr]}(ve,xe,Ce,Xe,Ge,st,Mt,Je,mt,gt,a.tileID.canonical):Mt?function(Pt,rt,Xt,un,Jt,qn,Ot,En,Ln){const Ci=[],Wn=[],On=[0,0,0,1];for(const Dr of Pt){const Zn=[],Xn=[];for(const Yi of Dr){const ur=Yi.x+un.x,Sr=Yi.y+un.y,dr=fw(ur,Sr,rt,Xt,qn,Ot,En,Ln);On[0]=ur,On[1]=Sr,On[2]=dr.base,On[3]=1,hd(On,On,Jt),On[3]=Math.max(On[3],1e-5);const Fr=new yu(On[0]/On[3],On[1]/On[3],On[2]/On[3]);On[0]=ur,On[1]=Sr,On[2]=dr.top,On[3]=1,hd(On,On,Jt),On[3]=Math.max(On[3],1e-5);const Zr=new yu(On[0]/On[3],On[1]/On[3],On[2]/On[3]);Zn.push(Fr),Xn.push(Zr)}Ci.push(Zn),Wn.push(Xn)}return[Ci,Wn]}(xe,Ce,Xe,Ge,st,Mt,Je,mt,gt):function(Pt,rt,Xt,un,Jt){const qn=[],Ot=[],En=Jt[8]*rt,Ln=Jt[9]*rt,Ci=Jt[10]*rt,Wn=Jt[11]*rt,On=Jt[8]*Xt,Dr=Jt[9]*Xt,Zn=Jt[10]*Xt,Xn=Jt[11]*Xt;for(const Yi of Pt){const ur=[],Sr=[];for(const dr of Yi){const Fr=dr.x+un.x,Zr=dr.y+un.y,oo=Jt[0]*Fr+Jt[4]*Zr+Jt[12],ir=Jt[1]*Fr+Jt[5]*Zr+Jt[13],Ir=Jt[2]*Fr+Jt[6]*Zr+Jt[14],mo=Jt[3]*Fr+Jt[7]*Zr+Jt[15],Xr=oo+En,Ai=ir+Ln,go=Ir+Ci,xr=Math.max(mo+Wn,1e-5),pa=oo+On,xo=ir+Dr,zo=Ir+Zn,Bo=Math.max(mo+Xn,1e-5);ur.push(new yu(Xr/xr,Ai/xr,go/xr)),Sr.push(new yu(pa/Bo,xo/Bo,zo/Bo))}qn.push(ur),Ot.push(Sr)}return[qn,Ot]}(xe,Ce,Xe,Ge,st)),de=a.queryGeometry;var ve,xe,Ce,Xe,Ge,st,Mt,Je,mt,gt;return function(ve,xe,Ce){let Xe=1/0;cD(Ce,xe)&&(Xe=Fv(Ce,xe[0]));for(let Ge=0;Ge<xe.length;Ge++){const st=xe[Ge],Mt=ve[Ge];for(let Je=0;Je<st.length-1;Je++){const mt=st[Je],gt=[mt,st[Je+1],Mt[Je+1],Mt[Je],mt];Ep(Ce,gt)&&(Xe=Math.min(Xe,Fv(Ce,gt)))}}return Xe!==1/0&&Xe}(ce,be,de.isPointQuery()?de.screenBounds:de.screenGeometry)}},line:class extends kc{constructor(a){super(a,gw),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof ra,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=RD.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new _d(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new ld(this,a)}queryRadius(a){const o=a,l=_w(df("line-width",this,o),df("line-gap-width",this,o)),d=df("line-offset",this,o);return l/2+Math.abs(d)+pv(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,d,p,y){if(a.queryGeometry.isAboveHorizon)return!1;const b=mv(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),E=a.pixelToTileUnitsFactor/2*_w(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),T=this.paint.get("line-offset").evaluate(o,l);return T&&(d=function(D,R){const N=[],B=new Gt(0,0);for(let j=0;j<D.length;j++){const H=D[j],X=[];for(let ie=0;ie<H.length;ie++){const ce=H[ie],be=H[ie+1],de=0===ie?B:ce.sub(H[ie-1])._unit()._perp(),ve=ie===H.length-1?B:be.sub(ce)._unit()._perp(),xe=de._add(ve)._unit();xe._mult(1/(xe.x*ve.x+xe.y*ve.y)),X.push(xe._mult(R)._add(ce))}N.push(X)}return N}(d,T*a.pixelToTileUnitsFactor)),function(D,R,N){for(let B=0;B<R.length;B++){const j=R[B];if(D.length>=3)for(let H=0;H<j.length;H++)if(gu(D,j[H]))return!0;if(Y1(D,j,N))return!0}return!1}(b,d,E)}isTileClipped(){return!0}},symbol:dg,background:class extends kc{constructor(a){super(a,Nk)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends kc{constructor(a){super(a,rS)}getProgramIds(){return["raster"]}},sky:class extends kc{constructor(a){super(a,oS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=k_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const d=this.paint.get("sky-atmosphere-sun"),p=!d,y=a.style.light,b=y.properties.get("position");return p&&"viewport"===y.properties.get("anchor")&&_r("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?mh(b.azimuthal,90-b.polar,o):mh(d[0],90-d[1],o)}const l=this.paint.get("sky-gradient-center");return mh(l[0],90-l[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class hg{constructor(o,l,d,p){this.context=o,this.format=d,this.texture=o.gl.createTexture(),this.update(l,p)}update(o,l,d){const{width:p,height:y}=o,{context:b}=this,{gl:E}=b,{HTMLImageElement:T,HTMLCanvasElement:D,HTMLVideoElement:R,ImageData:N,ImageBitmap:B}=pt;if(E.bindTexture(E.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!l||!1!==l.premultiply)),d||this.size&&this.size[0]===p&&this.size[1]===y){const{x:j,y:H}=d||{x:0,y:0};o instanceof T||o instanceof D||o instanceof R||o instanceof N||B&&o instanceof B?E.texSubImage2D(E.TEXTURE_2D,0,j,H,E.RGBA,E.UNSIGNED_BYTE,o):E.texSubImage2D(E.TEXTURE_2D,0,j,H,p,y,E.RGBA,E.UNSIGNED_BYTE,o.data)}else this.size=[p,y],o instanceof T||o instanceof D||o instanceof R||o instanceof N||B&&o instanceof B?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,o):E.texImage2D(E.TEXTURE_2D,0,this.format,p,y,0,this.format,E.UNSIGNED_BYTE,o.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&E.generateMipmap(E.TEXTURE_2D)}bind(o,l){const{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),o!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?o===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:o),this.filter=o),l!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class fg{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ly{constructor(){this.tasks={},this.taskQueue=[],hi(["process"],this),this.invoker=new fg(this.process),this.nextId=0}add(o,l){const d=this.nextId++,p=function({type:y,isSymbolTile:b,zoom:E}){return E=E||0,"message"===y?0:"maybePrepare"!==y||b?"parseTile"!==y||b?"parseTile"===y&&b?300-E:"maybePrepare"===y&&b?400-E:500:200-E:100-E}(l);if(0===p){pl();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[d]={fn:o,metadata:l,priority:p,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){pl();try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const y=this.tasks[this.taskQueue[p]];y.priority<l&&(l=y.priority,o=p)}if(null===o)return null;const d=this.taskQueue[o];return this.taskQueue.splice(o,1),d}remove(){this.invoker.remove()}}class $w{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const d=o[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const sS=["tile","layer","source","sourceLayer","state"];class Ef{constructor(o,l,d,p,y){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=d,this._y=p,this.properties=o.properties,this.id=y}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const l of sS)void 0!==this[l]&&(o[l]=this[l]);return o}}const ac=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,d=0,p=0,y=0,b=0,E=0;for(1&o?p=y=b=32:l=d=E=32;(o>>=1)>1;){const D=l+p>>1,R=d+y>>1;1&o?(p=l,y=d,l=b,d=E):(l=p,d=y,p=b,y=E),b=D,E=R}const T=4*a;ac[T+0]=l,ac[T+1]=d,ac[T+2]=p,ac[T+3]=y}const Vc=new Uint16Array(2178),Cf=new Uint8Array(1089),Wp=new Uint16Array(1089);function gh(a){return 0===a?-.03125:32===a?.03125:0}var pg=Fe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const tb={type:2,extent:Tn,loadGeometry:()=>[[new Gt(0,0),new Gt(Tn+1,0),new Gt(Tn+1,Tn+1),new Gt(0,Tn+1),new Gt(0,0)]]};class cy{constructor(o,l,d,p,y){this.tileID=o,this.uid=Yn(),this.uses=0,this.tileSize=l,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(o){const l=o+this.timeAdded;l<ta.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=wu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,d){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(p,y){const b={};if(!y)return b;for(const E of p){const T=E.layerIds.map(D=>y.getLayer(D)).filter(Boolean);if(0!==T.length){E.layers=T,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(D=>T.filter(R=>R.id===D)[0]));for(const D of T)b[D.id]=E}}return b}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof Uc){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof Uc&&y.hasRTLText){this.hasRTLText=!0,k.isLoading()||k.isLoaded()||"deferred"!==M()||I();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(y))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new gr}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const d in this.buckets){const p=this.buckets[d];p.uploadPending()&&p.upload(o)}const l=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new hg(o,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new hg(o,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new hg(o,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,l,d,p,y,b,E,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:E,transform:b,params:y,tileTransform:this.tileTransform},o,l,d):{}}querySourceFeatures(o,l){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const p=d.loadVTLayers(),y=l?l.sourceLayer:"",b=p._geojsonTileLayer||p[y];if(!b)return;const E=td(l&&l.filter),{z:T,x:D,y:R}=this.tileID.canonical,N={z:T,x:D,y:R};for(let B=0;B<b.length;B++){const j=b.feature(B);if(E.needGeometry){const ie=uh(j,!0);if(!E.filter(new L(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!E.filter(new L(this.tileID.overscaledZ),j))continue;const H=d.getId(j,y),X=new Ef(j,T,D,R,H);X.tile=N,o.push(X)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const l=this.expirationTime;if(o.cacheControl){const d=Ks(o.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const d=Date.now();let p=!1;if(this.expirationTime>d)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const y=this.expirationTime-l;y?this.expirationTime=d+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!l)return;const d=this.latestFeatureIndex.loadVTLayers(),p=l.style.listImages();for(const y in this.buckets){if(!l.style.hasLayer(y))continue;const b=this.buckets[y],E=b.layers[0].sourceLayer||"_geojsonTileLayer",T=d[E],D=o[E];if(!T||!D||0===Object.keys(D).length)continue;if(b.update(D,T,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),b instanceof _d||b instanceof N_){const N=l.style._getSourceCache(b.layers[0].source);l._terrain&&l._terrain.enabled&&N&&b.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(N.id,this.tileID)}const R=l&&l.style&&l.style.getLayer(y);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(b)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ta.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=ta.now()+o}setTexture(o,l){const d=l.context,p=d.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new hg(d,o,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(o,l){const d={};for(const p of l)d[p]=!0;this.dependencies[o]=d}hasDependency(o,l){for(const d of o){const p=this.dependencies[d];if(p)for(const y of l)if(p[y])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const d=nc(tb,this.tileID.canonical,this.tileTransform)[0],p=new ht,y=new Qa;for(let b=0;b<d.length;b++){const{x:E,y:T}=d[b];p.emplaceBack(E,T),y.emplaceBack(b)}y.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(y),this._tileDebugBuffer=o.createVertexBuffer(p,jm.members),this._tileDebugSegments=fo.simpleSegment(0,0,p.length,y.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const d=nc(tb,this.tileID.canonical,this.tileTransform)[0];let p,y;if(this.isRaster){const b=function(E,T){const D=wu(E,T),R=Math.pow(2,E.z);for(let ie=0;ie<33;ie++)for(let ce=0;ce<33;ce++){const be=Pl((E.x+(ce+gh(ce))/32)/R),de=ms((E.y+(ie+gh(ie))/32)/R),ve=T.project(be,de),xe=33*ie+ce;Vc[2*xe+0]=Math.round((ve.x*D.scale-D.x)*Tn),Vc[2*xe+1]=Math.round((ve.y*D.scale-D.y)*Tn)}Cf.fill(0),Wp.fill(0);for(let ie=2045;ie>=0;ie--){const ce=4*ie,be=ac[ce+0],de=ac[ce+1],ve=ac[ce+2],xe=ac[ce+3],Ce=be+ve>>1,Xe=de+xe>>1,Ge=Ce+Xe-de,st=Xe+be-Ce,Mt=33*de+be,Je=33*xe+ve,mt=33*Xe+Ce,gt=Math.hypot((Vc[2*Mt+0]+Vc[2*Je+0])/2-Vc[2*mt+0],(Vc[2*Mt+1]+Vc[2*Je+1])/2-Vc[2*mt+1])>=16;Cf[mt]=Cf[mt]||(gt?1:0),ie<1022&&(Cf[mt]=Cf[mt]||Cf[33*(de+st>>1)+(be+Ge>>1)]||Cf[33*(xe+st>>1)+(ve+Ge>>1)])}const N=new dt,B=new gn;let j=0;function H(ie,ce){const be=33*ce+ie;return 0===Wp[be]&&(N.emplaceBack(Vc[2*be+0],Vc[2*be+1],ie*Tn/32,ce*Tn/32),Wp[be]=++j),Wp[be]-1}function X(ie,ce,be,de,ve,xe){const Ce=ie+be>>1,Xe=ce+de>>1;if(Math.abs(ie-ve)+Math.abs(ce-xe)>1&&Cf[33*Xe+Ce])X(ve,xe,ie,ce,Ce,Xe),X(be,de,ve,xe,Ce,Xe);else{const Ge=H(ie,ce),st=H(be,de),Mt=H(ve,xe);B.emplaceBack(Ge,st,Mt)}}return X(0,0,32,32,32,0),X(32,32,0,0,0,32),{vertices:N,indices:B}}(this.tileID.canonical,l);p=b.vertices,y=b.indices}else{p=new dt,y=new gn;for(const{x:E,y:T}of d)p.emplaceBack(E,T,0,0);const b=F_(p.int16,void 0,4);for(let E=0;E<b.length;E+=3)y.emplaceBack(b[E],b[E+1],b[E+2])}this._tileBoundsBuffer=o.createVertexBuffer(p,pg.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(y),this._tileBoundsSegments=fo.simpleSegment(0,0,p.length,y.length)}_makeGlobeTileDebugBuffers(o,l){const d=l.projection;if(!d||"globe"!==d.name||l.freezeTileCoverage)return;const p=this.tileID.canonical,y=qm(oD(p,l)),b=cf(l.zoom);let E;b>0&&(E=mp(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,p,l,y,E,b),this._makeGlobeTileDebugTextBuffer(o,p,l,y,E,b)}_globePoint(o,l,d,p,y,b,E){let T=po(o,l,d);if(b){const D=1<<d.z,R=Fc(p.center.lng),N=mu(p.center.lat),B=(d.x+.5)/D-R;let j=0;B>.5?j=-1:B<-.5&&(j=1);let H=(o/Tn+d.x)/D+j,X=(l/Tn+d.y)/D;H=(H-R)*p._pixelsPerMercatorPixel+R,X=(X-N)*p._pixelsPerMercatorPixel+N;const ie=[H*p.worldSize,X*p.worldSize,0];eo(ie,ie,b),T=bp(T,ie,E)}return eo(T,T,y)}_makeGlobeTileDebugBorderBuffer(o,l,d,p,y,b){const E=new ht,T=new Qa,D=new je,R=(B,j,H,X,ie)=>{const ce=(H-B)/(ie-1),be=(X-j)/(ie-1),de=E.length;for(let ve=0;ve<ie;ve++){const xe=B+ve*ce,Ce=j+ve*be;E.emplaceBack(xe,Ce);const Xe=this._globePoint(xe,Ce,l,d,p,y,b);D.emplaceBack(Xe[0],Xe[1],Xe[2]),T.emplaceBack(de+ve)}},N=Tn;R(0,0,N,0,16),R(N,0,N,N,16),R(N,N,0,N,16),R(0,N,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(T),this._tileDebugBuffer=o.createVertexBuffer(E,jm.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(D,lh.members),this._tileDebugSegments=fo.simpleSegment(0,0,E.length,T.length)}_makeGlobeTileDebugTextBuffer(o,l,d,p,y,b){const E=Tn/4,T=new ht,D=new gn,R=new je,N=25;D.reserve(32),T.reserve(N),R.reserve(N);const B=(j,H)=>N*j+H;for(let j=0;j<N;j++){const H=j*E;for(let X=0;X<N;X++){const ie=X*E;T.emplaceBack(ie,H);const ce=this._globePoint(ie,H,l,d,p,y,b);R.emplaceBack(ce[0],ce[1],ce[2])}}for(let j=0;j<4;j++)for(let H=0;H<4;H++){const X=B(j,H),ie=B(j,H+1),ce=B(j+1,H),be=B(j+1,H+1);D.emplaceBack(X,ie,ce),D.emplaceBack(ce,ie,be)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(D),this._tileDebugTextBuffer=o.createVertexBuffer(T,jm.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(R,lh.members),this._tileDebugTextSegments=fo.simpleSegment(0,0,N,32)}}class aS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,d){const p=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][p]=this.stateChanges[o][p]||{},Ti(this.stateChanges[o][p],d),null===this.deletedStates[o]){this.deletedStates[o]={};for(const y in this.state[o])y!==p&&(this.deletedStates[o][y]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][p]){this.deletedStates[o][p]={};for(const y in this.state[o][p])d[y]||(this.deletedStates[o][p][y]=null)}else for(const y in d)this.deletedStates[o]&&this.deletedStates[o][p]&&null===this.deletedStates[o][p][y]&&delete this.deletedStates[o][p][y]}removeFeatureState(o,l,d){if(null===this.deletedStates[o])return;const p=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},d&&void 0!==l)null!==this.deletedStates[o][p]&&(this.deletedStates[o][p]=this.deletedStates[o][p]||{},this.deletedStates[o][p][d]=null);else if(void 0!==l)if(this.stateChanges[o]&&this.stateChanges[o][p])for(d in this.deletedStates[o][p]={},this.stateChanges[o][p])this.deletedStates[o][p][d]=null;else this.deletedStates[o][p]=null;else this.deletedStates[o]=null}getState(o,l){const d=String(l),p=Ti({},(this.state[o]||{})[d],(this.stateChanges[o]||{})[d]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const y=this.deletedStates[o][l];if(null===y)return{};for(const b in y)delete p[b]}return p}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){const d={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),Ti(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];d[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(null===this.deletedStates[p])for(const b in this.state[p])y[b]={},this.state[p][b]={};else for(const b in this.deletedStates[p]){if(null===this.deletedStates[p][b])this.state[p][b]={};else if(this.state[p][b])for(const E of Object.keys(this.deletedStates[p][b]))delete this.state[p][b][E];y[b]=this.state[p][b]}d[p]=d[p]||{},Ti(d[p],y)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length)for(const p in o)o[p].setFeatureState(d,l)}}class Hw{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const d=this.toIdx(o,l);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function Gw(a,o,l,d){let p=0,y=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(d[b])<1e-15){if(l[b]<a[b]||l[b]>o[b])return null}else{const E=1/d[b];let T=(a[b]-l[b])*E,D=(o[b]-l[b])*E;if(T>D){const R=T;T=D,D=R}if(T>p&&(p=T),D<y&&(y=D),p>y)return null}return p}function qw(a,o,l,d,p,y,b,E,T,D,R){const N=d-a,B=p-o,j=y-l,H=b-a,X=E-o,ie=T-l,ce=R[1]*ie-R[2]*X,be=R[2]*H-R[0]*ie,de=R[0]*X-R[1]*H,ve=N*ce+B*be+j*de;if(Math.abs(ve)<1e-15)return null;const xe=1/ve,Ce=D[0]-a,Xe=D[1]-o,Ge=D[2]-l,st=(Ce*ce+Xe*be+Ge*de)*xe;if(st<0||st>1)return null;const Mt=Xe*j-Ge*B,Je=Ge*N-Ce*j,mt=Ce*B-Xe*N,gt=(R[0]*Mt+R[1]*Je+R[2]*mt)*xe;return gt<0||st+gt>1?null:(H*Mt+X*Je+ie*mt)*xe}function Ww(a,o,l){return(a-o)/(l-o)}function Zw(a,o,l,d,p,y,b,E,T){const D=1<<l,R=y-d,N=b-p,B=(a+1)/D*R+d,j=(o+0)/D*N+p,H=(o+1)/D*N+p;E[0]=(a+0)/D*R+d,E[1]=j,T[0]=B,T[1]=H}class nb{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(y){const b=Math.ceil(Math.log2(y.dim/8)),E=[];let T=Math.ceil(Math.pow(2,b));const D=1/T,R=(j,H,X,ie,ce)=>{const be=ie?1:0,de=(j+1)*X-be,ve=H*X,xe=(H+1)*X-be;ce[0]=j*X,ce[1]=ve,ce[2]=de,ce[3]=xe};let N=new Hw(T);const B=[];for(let j=0;j<T*T;j++){R(j%T,Math.floor(j/T),D,!1,B);const H=fa(B[0],B[1],y),X=fa(B[2],B[1],y),ie=fa(B[2],B[3],y),ce=fa(B[0],B[3],y);N.minimums.push(Math.min(H,X,ie,ce)),N.maximums.push(Math.max(H,X,ie,ce)),N.leaves.push(1)}for(E.push(N),T/=2;T>=1;T/=2){const j=E[E.length-1];N=new Hw(T);for(let H=0;H<T*T;H++){R(H%T,Math.floor(H/T),2,!0,B);const X=j.getElevation(B[0],B[1]),ie=j.getElevation(B[2],B[1]),ce=j.getElevation(B[2],B[3]),be=j.getElevation(B[0],B[3]),de=j.isLeaf(B[0],B[1]),ve=j.isLeaf(B[2],B[1]),xe=j.isLeaf(B[2],B[3]),Ce=j.isLeaf(B[0],B[3]),Xe=Math.min(X.min,ie.min,ce.min,be.min),Ge=Math.max(X.max,ie.max,ce.max,be.max),st=de&&ve&&xe&&Ce;N.maximums.push(Ge),N.minimums.push(Xe),N.leaves.push(Ge-Xe<=5&&st?1:0)}E.push(N)}return E}(this.dem),d=l.length-1,p=l[d];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,d,0)}raycastRoot(o,l,d,p,y,b,E=1){return Gw([o,l,-100],[d,p,this.maximums[0]*E],y,b)}raycast(o,l,d,p,y,b,E=1){if(!this.nodeCount)return null;const T=this.raycastRoot(o,l,d,p,y,b,E);if(null==T)return null;const D=[],R=[],N=[],B=[],j=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;j.length>0;){const{idx:H,t:X,nodex:ie,nodey:ce,depth:be}=j.pop();if(this.leaves[H]){Zw(ie,ce,be,o,l,d,p,N,B);const ve=1<<be,xe=(ie+0)/ve,Ce=(ie+1)/ve,Xe=(ce+0)/ve,Ge=(ce+1)/ve,st=fa(xe,Xe,this.dem)*E,Mt=fa(Ce,Xe,this.dem)*E,Je=fa(Ce,Ge,this.dem)*E,mt=fa(xe,Ge,this.dem)*E,gt=qw(N[0],N[1],st,B[0],N[1],Mt,B[0],B[1],Je,y,b),wt=qw(B[0],B[1],Je,N[0],B[1],mt,N[0],N[1],st,y,b),Pt=Math.min(null!==gt?gt:Number.MAX_VALUE,null!==wt?wt:Number.MAX_VALUE);if(Pt!==Number.MAX_VALUE)return Pt;{const rt=sf([],y,b,X);if(Mf(st,Mt,mt,Je,Ww(rt[0],N[0],B[0]),Ww(rt[1],N[1],B[1]))>=rt[2])return X}continue}let de=0;for(let ve=0;ve<this._siblingOffset.length;ve++){Zw((ie<<1)+this._siblingOffset[ve][0],(ce<<1)+this._siblingOffset[ve][1],be+1,o,l,d,p,N,B),N[2]=-100,B[2]=this.maximums[this.childOffsets[H]+ve]*E;const xe=Gw(N,B,y,b);if(null!=xe){const Ce=xe;D[ve]=Ce;let Xe=!1;for(let Ge=0;Ge<de&&!Xe;Ge++)Ce>=D[R[Ge]]&&(R.splice(Ge,0,ve),Xe=!0);Xe||(R[de]=ve),de++}}for(let ve=0;ve<de;ve++){const xe=R[ve];j.push({idx:this.childOffsets[H]+xe,t:D[xe],nodex:(ie<<1)+this._siblingOffset[xe][0],nodey:(ce<<1)+this._siblingOffset[xe][1],depth:be+1})}}return null}_addNode(o,l,d){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,d,p,y){if(1===o[p].isLeaf(l,d))return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const b=p-1,E=o[b];let T=0,D=0;for(let R=0;R<this._siblingOffset.length;R++){const N=2*l+this._siblingOffset[R][0],B=2*d+this._siblingOffset[R][1],j=E.getElevation(N,B),H=E.isLeaf(N,B),X=this._addNode(j.min,j.max,H);H&&(T|=1<<R),D||(D=X)}for(let R=0;R<this._siblingOffset.length;R++)T&1<<R||this._construct(o,2*l+this._siblingOffset[R][0],2*d+this._siblingOffset[R][1],b,D+R)}}function Mf(a,o,l,d,p,y){return ai(ai(a,l,y),ai(o,d,y),p)}function fa(a,o,l){const d=l.dim,p=ni(a*d-.5,0,d-1),y=ni(o*d-.5,0,d-1),b=Math.floor(p),E=Math.floor(y),T=Math.min(b+1,d-1),D=Math.min(E+1,d-1);return Mf(l.get(b,E),l.get(T,E),l.get(b,D),l.get(T,D),p-b,y-E)}const ib={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function zk(a,o,l){return(256*a*256+256*o+l)/10-1e4}function lS(a,o,l){return 256*a+o+l/256-32768}class rb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,d,p=!1,y=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&"mapbox"!==d&&"terrarium"!==d)return _r(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const b=this.dim=l.height-2,E=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=d||"mapbox",this.borderReady=p,!p){for(let T=0;T<b;T++)E[this._idx(-1,T)]=E[this._idx(0,T)],E[this._idx(b,T)]=E[this._idx(b-1,T)],E[this._idx(T,-1)]=E[this._idx(T,0)],E[this._idx(T,b)]=E[this._idx(T,b-1)];E[this._idx(-1,-1)]=E[this._idx(0,0)],E[this._idx(b,-1)]=E[this._idx(b-1,0)],E[this._idx(-1,b)]=E[this._idx(0,b-1)],E[this._idx(b,b)]=E[this._idx(b-1,b-1)],y&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new nb(this)}get(o,l,d=!1){d&&(o=ni(o,-1,this.dim),l=ni(l,-1,this.dim));const p=4*this._idx(o,l);return("terrarium"===this.encoding?lS:zk)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(o){return ib[o]}get unpackVector(){return ib[this.encoding]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const d=[0,0,0,0],p=rb.getUnpackVector(l);let y=Math.floor((o+p[3])/p[2]);return d[2]=y%256,y=Math.floor(y/256),d[1]=y%256,y=Math.floor(y/256),d[0]=y,d}getPixels(){return new zs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,d){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,y=l*this.dim+this.dim,b=d*this.dim,E=d*this.dim+this.dim;switch(l){case-1:p=y-1;break;case 1:y=p+1}switch(d){case-1:b=E-1;break;case 1:E=b+1}const T=-l*this.dim,D=-d*this.dim;for(let R=b;R<E;R++)for(let N=p;N<y;N++){const B=4*this._idx(N,R),j=4*this._idx(N+T,R+D);this.pixels[B+0]=o.pixels[j+0],this.pixels[B+1]=o.pixels[j+1],this.pixels[B+2]=o.pixels[j+2],this.pixels[B+3]=o.pixels[j+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}an(rb,"DEMData"),an(nb,"DemMinMaxQuadTree",{omit:["dem"]});class Bk{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(const o in this.data)for(const l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,d){const p=o.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const y={value:l,timeout:void 0};if(void 0!==d&&(y.timeout=setTimeout(()=>{this.remove(o,y)},d)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){const l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;const d=o.wrapped().key,p=void 0===l?0:this.data[d].indexOf(l),y=this.data[d][p];return this.data[d].splice(p,1),y.timeout&&clearTimeout(y.timeout),0===this.data[d].length&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){const l=[];for(const d in this.data)for(const p of this.data[d])o(p.value)||l.push(p);for(const d of l)this.remove(d.value.tileID,d)}}class Tf{constructor(o,l,d){this.func=o,this.mask=l,this.range=d}}Tf.ReadOnly=!1,Tf.ReadWrite=!0,Tf.disabled=new Tf(519,Tf.ReadOnly,[0,1]);class Xw{constructor(o,l,d,p,y,b){this.test=o,this.ref=l,this.mask=d,this.fail=p,this.depthFail=y,this.pass=b}}Xw.disabled=new Xw({func:519,mask:0},0,0,7680,7680,7680);class jc{constructor(o,l,d){this.blendFunction=o,this.blendColor=l,this.mask=d}}jc.Replace=[1,0],jc.disabled=new jc(jc.Replace,lt.transparent,[!1,!1,!1,!1]),jc.unblended=new jc(jc.Replace,lt.transparent,[!0,!0,!0,!0]),jc.alphaBlended=new jc([1,771],lt.transparent,[!0,!0,!0,!0]);class lc{constructor(o,l,d){this.enable=o,this.mode=l,this.frontFace=d}}lc.disabled=new lc(!1,1029,2305),lc.backCCW=new lc(!0,1029,2305),lc.backCW=new lc(!0,1029,2304),lc.frontCW=new lc(!0,1028,2304),lc.frontCCW=new lc(!0,1028,2305);class _h extends qo{constructor(o,l,d){super(),this.id=o,this._onlySymbols=d,l.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Bk(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new aS,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const l=this._tiles[o];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const d=this._tiles[l];d.upload(o),d.prepare(this.map.style.imageManager)}}getIds(){return Ba(this._tiles).map(o=>o.tileID).sort(mi).map(o=>o.key)}getRenderableIds(o){const l=[];for(const d in this._tiles)this._isIdRenderable(+d,o)&&l.push(this._tiles[d]);return o?l.sort((d,p)=>{const y=d.tileID,b=p.tileID,E=new Gt(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),T=new Gt(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-b.overscaledZ||T.y-E.y||T.x-E.x}).map(d=>d.tileID.key):l.map(d=>d.tileID).sort(mi).map(d=>d.key)}hasRenderableParent(o){const l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){const d=this._tiles[o];d&&("loading"!==d.state&&(d.state=l),this._loadTile(d,this._tileLoaded.bind(this,d,o,l)))}_tileLoaded(o,l,d,p){if(p)if(o.state="errored",404!==p.status)this._source.fire(new Oo(p,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=ta.now(),"expired"===d&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new na("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const y=l[p];if(o.neighboringTiles&&o.neighboringTiles[y]){const b=this.getTileByID(y);d(o,b),d(b,o)}}function d(p,y){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let b=y.tileID.canonical.x-p.tileID.canonical.x;const E=y.tileID.canonical.y-p.tileID.canonical.y,T=Math.pow(2,p.tileID.canonical.z),D=y.tileID.key;0===b&&0===E||Math.abs(E)>1||(Math.abs(b)>1&&(1===Math.abs(b+T)?b+=T:1===Math.abs(b-T)&&(b-=T)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,b,E),p.neighboringTiles&&p.neighboringTiles[D]&&(p.neighboringTiles[D].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,d,p){for(const y in this._tiles){let b=this._tiles[y];if(p[y]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>d)continue;let E=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){const D=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[D.key],b&&b.hasData()&&(E=D)}let T=E;for(;T.overscaledZ>l;)if(T=T.scaledTo(T.overscaledZ-1),o[T.key]){p[E.key]=E;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){const d=this._loadedParentTiles[o.key];return d&&d.tileID.overscaledZ>=l?d:null}for(let d=o.overscaledZ-1;d>=l;d--){const p=o.scaledTo(d),y=this._getLoadedTile(p);if(y)return y}}_getLoadedTile(o){const l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;const d=Math.ceil(o.width/l)+1,p=Math.ceil(o.height/l)+1,y=Math.floor(d*p*5),b="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,y):y,E="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(E)}handleWrapJump(o){const l=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,l){const d={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+l),d[y.tileID.key]=y}this._tiles=d;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(o,l,d){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;let p;this.updateCacheSize(o,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new Bs(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y)):(p=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(E=>this._source.hasTile(E)))):p=[];const y=this._updateRetainedTiles(p);if(xt(this._source.type)&&0!==p.length){const E={},T={},D=Object.keys(y);for(const N of D){const B=y[N],j=this._tiles[N];if(!j||j.fadeEndTime&&j.fadeEndTime<=ta.now())continue;const H=this.findLoadedParent(B,Math.max(B.overscaledZ-_h.maxOverzooming,this._source.minzoom));H&&(this._addTile(H.tileID),E[H.tileID.key]=H.tileID),T[N]=B}const R=p[p.length-1].overscaledZ;for(const N in this._tiles){const B=this._tiles[N];if(y[N]||!B.hasData())continue;let j=B.tileID;for(;j.overscaledZ>R;){j=j.scaledTo(j.overscaledZ-1);const H=this._tiles[j.key];if(H&&H.hasData()&&T[j.key]){y[N]=B.tileID;break}}}for(const N in E)y[N]||(this._coveredTiles[N]=!0,y[N]=E[N])}for(const E in y)this._tiles[E].clearFadeHold();const b=function(E,T){const D=[];for(const R in E)R in T||D.push(R);return D}(this._tiles,y);for(const E of b){const T=this._tiles[E];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+E)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const l={};if(0===o.length)return l;const d={},p=o.reduce((D,R)=>Math.min(D,R.overscaledZ),1/0),y=o[0].overscaledZ,b=Math.max(y-_h.maxOverzooming,this._source.minzoom),E=Math.max(y+_h.maxUnderzooming,this._source.minzoom),T={};for(const D of o){const R=this._addTile(D);l[D.key]=D,R.hasData()||p<this._source.maxzoom&&(T[D.key]=D)}this._retainLoadedChildren(T,p,E,l);for(const D of o){let R=this._tiles[D.key];if(R.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const B=D.children(this._source.maxzoom)[0],j=this.getTile(B);if(j&&j.hasData()){l[B.key]=B;continue}}else{const B=D.children(this._source.maxzoom);if(l[B[0].key]&&l[B[1].key]&&l[B[2].key]&&l[B[3].key])continue}let N=R.wasRequested();for(let B=D.overscaledZ-1;B>=b;--B){const j=D.scaledTo(B);if(d[j.key]||(d[j.key]=!0,R=this.getTile(j),!R&&N&&(R=this._addTile(j)),R&&(l[j.key]=j,N=R.wasRequested(),R.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const l=[];let d,p=this._tiles[o].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){d=this._loadedParentTiles[p.key];break}l.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;p=y}for(const y of l)this._loadedParentTiles[y]=d}}_addTile(o){let l=this._tiles[o.key];if(l)return l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));const d=!!l;if(!d){const p=this.map?this.map.painter:null;l=new cy(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,d||this._source.fire(new na("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const d=l.getExpiryTimeout();d&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},d))}_removeTile(o){const l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,d){const p=[],y=this.transform;if(!y)return p;const b="globe"===y.projection.name,E=Fc(y.center.lng);for(const T in this._tiles){const D=this._tiles[T];if(d&&D.clearQueryDebugViz(),D.holdingForFade())continue;let R;if(b){const N=D.tileID.canonical;if(0===N.z){const B=[Math.abs(ni(E,...Xp(N,-1))-E),Math.abs(ni(E,...Xp(N,1))-E)];R=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(ni(E,...Xp(N,-1))-E),Math.abs(ni(E,...Xp(N,0))-E),Math.abs(ni(E,...Xp(N,1))-E)];R=[B.indexOf(Math.min(...B))-1]}}else R=[0];for(const N of R){const B=o.containsTile(D,y,l,N);B&&p.push(B)}}return p}getVisibleCoordinates(o){const l=this.getRenderableIds(o).map(d=>this._tiles[d].tileID);for(const d of l)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(xt(this._source.type))for(const o in this._tiles){const l=this._tiles[o];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=ta.now())return!0}return!1}setFeatureState(o,l,d){this._state.updateState(o=o||"_geojsonTileLayer",l,d)}removeFeatureState(o,l,d){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,d)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,d){const p=this._tiles[o];p&&p.setDependencies(l,d)}reloadTilesForDependencies(o,l){for(const d in this._tiles)this._tiles[d].hasDependency(o,l)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(o,l))}_preloadTiles(o,l){if(!this._sourceLoaded){const E=()=>{this._sourceLoaded&&(this._source.off("data",E),this._preloadTiles(o,l))};return void this._source.on("data",E)}const d=new Map,p=Array.isArray(o)?o:[o],y=this.map.painter.terrain,b=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const E of p){const T=E.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of T)d.set(D.key,D);this.usedForTerrain&&E.updateElevation(!1)}Yr(Array.from(d.values()),(E,T)=>{const D=new cy(E,this._source.tileSize*E.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,R=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),T(R,D)})},l)}}function mi(a,o){const l=Math.abs(2*a.wrap)-+(a.wrap<0),d=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||d-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function xt(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function Xp(a,o){const l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}_h.maxOverzooming=10,_h.maxUnderzooming=3;class ob{constructor(o,l,d){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=d}static create(o,l,d){const p=d||o.findDEMTileFor(l);if(!p||!p.dem)return;const y=p.dem,b=p.tileID,E=1<<l.canonical.z-b.canonical.z;return new ob(p,p.tileSize/Tn/E,[(l.canonical.x/E-b.canonical.x)*y.dim,(l.canonical.y/E-b.canonical.y)*y.dim])}tileCoordToPixel(o,l){const d=l*this._scale+this._offset[1],p=Math.floor(o*this._scale+this._offset[0]),y=Math.floor(d);return new Gt(p,y)}getElevationAt(o,l,d,p){const y=o*this._scale+this._offset[0],b=l*this._scale+this._offset[1],E=Math.floor(y),T=Math.floor(b),D=this._dem;return p=!!p,d?ai(ai(D.get(E,T,p),D.get(E,T+1,p),b-T),ai(D.get(E+1,T,p),D.get(E+1,T+1,p),b-T),y-E):D.get(E,T,p)}getElevationAtPixel(o,l,d){return this._dem.get(o,l,!!d)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Nc(1,o)*this._dem.stride}}class Yw{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new cu(Tn,16,0),this.featureIndexArray=new Pa,this.promoteId=l}insert(o,l,d,p,y,b=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,p,y,b);const T=this.grid;for(let D=0;D<l.length;D++){const R=l[D],N=[1/0,1/0,-1/0,-1/0];for(let B=0;B<R.length;B++){const j=R[B];N[0]=Math.min(N[0],j.x),N[1]=Math.min(N[1],j.y),N[2]=Math.max(N[2],j.x),N[3]=Math.max(N[3],j.y)}N[0]<Tn&&N[1]<Tn&&N[2]>=0&&N[3]>=0&&T.insert(E,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ng(new Hv(this.rawTileData)).layers,this.sourceLayerCoder=new $w(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,d,p){this.loadVTLayers();const y=o.params||{},b=td(y.filter),E=o.tileResult,T=o.transform,D=E.bufferedTilespaceBounds,R=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(H,X,ie,ce)=>fv(E.bufferedTilespaceGeometry,H,X,ie,ce));R.sort(cS);let N=null;T.elevation&&R.length>0&&(N=ob.create(T.elevation,this.tileID));const B={};let j;for(let H=0;H<R.length;H++){const X=R[H];if(X===j)continue;j=X;const ie=this.featureIndexArray.get(X);let ce=null;this.loadMatchingFeature(B,ie,b,y.layers,y.availableImages,l,d,p,(be,de,ve,xe=0)=>(ce||(ce=nc(be,this.tileID.canonical,o.tileTransform)),de.queryIntersectsFeature(E,be,ve,ce,this.z,o.transform,o.pixelPosMatrix,N,xe)))}return B}loadMatchingFeature(o,l,d,p,y,b,E,T,D){const{featureIndex:R,bucketIndex:N,sourceLayerIndex:B,layoutVertexArrayOffset:j}=l,H=this.bucketLayerIDs[N];if(p&&!function(be,de){for(let ve=0;ve<be.length;ve++)if(de.indexOf(be[ve])>=0)return!0;return!1}(p,H))return;const X=this.sourceLayerCoder.decode(B),ie=this.vtLayers[X].feature(R);if(d.needGeometry){const be=uh(ie,!0);if(!d.filter(new L(this.tileID.overscaledZ),be,this.tileID.canonical))return}else if(!d.filter(new L(this.tileID.overscaledZ),ie))return;const ce=this.getId(ie,X);for(let be=0;be<H.length;be++){const de=H[be];if(p&&p.indexOf(de)<0)continue;const ve=b[de];if(!ve)continue;let xe={};void 0!==ce&&T&&(xe=T.getState(ve.sourceLayer||"_geojsonTileLayer",ce));const Ce=Ti({},E[de]);Ce.paint=sb(Ce.paint,ve.paint,ie,xe,y),Ce.layout=sb(Ce.layout,ve.layout,ie,xe,y);const Xe=!D||D(ie,ve,xe,j);if(!Xe)continue;const Ge=new Ef(ie,this.z,this.x,this.y,ce);Ge.layer=Ce;let st=o[de];void 0===st&&(st=o[de]=[]),st.push({featureIndex:R,feature:Ge,intersectionZ:Xe})}}lookupSymbolFeatures(o,l,d,p,y,b,E,T){const D={};this.loadVTLayers();const R=td(y);for(const N of o)this.loadMatchingFeature(D,{bucketIndex:d,sourceLayerIndex:p,featureIndex:N,layoutVertexArrayOffset:0},R,b,E,T,l);return D}loadFeature(o){const{featureIndex:l,sourceLayerIndex:d}=o;this.loadVTLayers();const p=this.sourceLayerCoder.decode(d),y=this.vtFeatures[p];if(y[l])return y[l];const b=this.vtLayers[p].feature(l);return y[l]=b,b}hasLayer(o){for(const l of this.bucketLayerIDs)for(const d of l)if(o===d)return!0;return!1}getId(o,l){let d=o.id;if(this.promoteId){const p="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=p&&(d=o.properties[p]),"boolean"==typeof d&&(d=Number(d))}return d}}function sb(a,o,l,d,p){return fi(a,(y,b)=>{const E=o instanceof le?o.get(b):null;return E&&E.evaluate?E.evaluate(l,d,p):E})}function cS(a,o){return o-a}an(Yw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Kw{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new md({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const d=this.getKey(o,l);return this.positions[d]}trim(){const o=this.width,l=this.height=Kr(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,d){const p=[];let y=o.length%2==1?-o[o.length-1]*d:0,b=o[0]*d,E=!0;p.push({left:y,right:b,isDash:E,zeroLength:0===o[0]});let T=o[0];for(let D=1;D<o.length;D++){E=!E;const R=o[D];y=T*d,T+=R,b=T*d,p.push({left:y,right:b,isDash:E,zeroLength:0===R})}return p}addRoundDash(o,l,d){const p=l/2;for(let y=-d;y<=d;y++){const b=this.width*(this.nextRow+d+y);let E=0,T=o[E];for(let D=0;D<this.width;D++){D/T.right>1&&(T=o[++E]);const R=Math.abs(D-T.left),N=Math.abs(D-T.right),B=Math.min(R,N);let j;const H=y/d*(p+1);if(T.isDash){const X=p-Math.abs(H);j=Math.sqrt(B*B+X*X)}else j=p-Math.sqrt(B*B+H*H);this.image.data[b+D]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(o,l){for(let T=o.length-1;T>=0;--T){const D=o[T],R=o[T+1];D.zeroLength?o.splice(T,1):R&&R.isDash===D.isDash&&(R.left=D.left,o.splice(T,1))}const d=o[0],p=o[o.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const y=this.width*this.nextRow;let b=0,E=o[b];for(let T=0;T<this.width;T++){T/E.right>1&&(E=o[++b]);const D=Math.abs(T-E.left),R=Math.abs(T-E.right),N=Math.min(D,R);this.image.data[y+T]=Math.max(0,Math.min(255,(E.isDash?N:-N)+l+128))}}addDash(o,l){const d=this.getKey(o,l);if(this.positions[d])return this.positions[d];const p="round"===l,y=p?7:0,b=2*y+1;if(this.nextRow+b>this.height)return _r("LineAtlas out of space"),null;0===o.length&&o.push(1);let E=0;for(let R=0;R<o.length;R++)o[R]<0&&(_r("Negative value is found in line dasharray, replacing values with 0"),o[R]=0),E+=o[R];if(0!==E){const R=this.width/E,N=this.getDashRanges(o,this.width,R);p?this.addRoundDash(N,R,y):this.addRegularDash(N,"square"===l?.5*R:0)}const T=this.nextRow+y;this.nextRow+=b;const D={tl:[T,y],br:[E,0]};return this.positions[d]=D,D}}an(Kw,"LineAtlas");const ab=1*ic;class Qw{constructor(o){const l={},d=[];for(const E in o){const T=o[E],D=l[E]={};for(const R in T.glyphs){const N=T.glyphs[+R];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const B=N.metrics.localGlyph?ab:1,j={x:0,y:0,w:N.bitmap.width+2*B,h:N.bitmap.height+2*B};d.push(j),D[R]=j}}const{w:p,h:y}=X_(d),b=new md({width:p||1,height:y||1});for(const E in o){const T=o[E];for(const D in T.glyphs){const R=T.glyphs[+D];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const N=l[E][D],B=R.metrics.localGlyph?ab:1;md.copy(R.bitmap,b,{x:0,y:0},{x:N.x+B,y:N.y+B},R.bitmap)}}this.image=b,this.positions=l}}an(Qw,"GlyphAtlas");class Jw{constructor(o){this.tileID=new Bs(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=wu(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,l,d,p,y){this.status="parsing",this.data=o,this.collisionBoxArray=new gr;const b=new $w(Object.keys(o.layers).sort()),E=new Yw(this.tileID,this.promoteId);E.bucketLayerIDs=[];const T={},D=new Kw(256,256),R={featureIndex:E,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:d},N=l.familiesBySource[this.source];for(const xe in N){const Ce=o.layers[xe];if(!Ce)continue;let Xe=!1,Ge=!1;for(const Je of N[xe])"symbol"===Je[0].type?Xe=!0:Ge=!0;if(!0===this.isSymbolTile&&!Xe||!1===this.isSymbolTile&&!Ge)continue;1===Ce.version&&_r(`Vector tile source "${this.source}" layer "${xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const st=b.encode(xe),Mt=[];for(let Je=0;Je<Ce.length;Je++){const mt=Ce.feature(Je),gt=E.getId(mt,xe);Mt.push({feature:mt,id:gt,index:Je,sourceLayerIndex:st})}for(const Je of N[xe]){const mt=Je[0];void 0!==this.isSymbolTile&&"symbol"===mt.type!==this.isSymbolTile||mt.minzoom&&this.zoom<Math.floor(mt.minzoom)||mt.maxzoom&&this.zoom>=mt.maxzoom||"none"!==mt.visibility&&(lb(Je,this.zoom,d),(T[mt.id]=mt.createBucket({index:E.bucketLayerIDs.length,layers:Je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:st,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:d})).populate(Mt,R,this.tileID.canonical,this.tileTransform),E.bucketLayerIDs.push(Je.map(gt=>gt.id)))}}let B,j,H,X;D.trim();const ie={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ce=()=>{if(B)return y(B);if(j&&H&&X){const xe=new Qw(j),Ce=new K_(H,X);for(const Xe in T){const Ge=T[Xe];Ge instanceof Uc?(lb(Ge.layers,this.zoom,d),Kv(Ge,j,xe.positions,H,Ce.iconPositions,this.showCollisionBoxes,d,this.tileID.canonical,this.tileZoom,this.projection)):Ge.hasPattern&&(Ge instanceof _d||Ge instanceof N_||Ge instanceof ig)&&(lb(Ge.layers,this.zoom,d),Ge.addFeatures(R,this.tileID.canonical,Ce.patternPositions,d,this.tileTransform))}this.status="done",y(null,{buckets:Ba(T).filter(Xe=>!Xe.isEmpty()),featureIndex:E,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xe.image,lineAtlas:D,imageAtlas:Ce,glyphMap:this.returnDependencies?j:null,iconMap:this.returnDependencies?H:null,glyphPositions:this.returnDependencies?xe.positions:null})}},be=fi(R.glyphDependencies,xe=>Object.keys(xe).map(Number));Object.keys(be).length?p.send("getGlyphs",{uid:this.uid,stacks:be},(xe,Ce)=>{B||(B=xe,j=Ce,ce())},void 0,!1,ie):j={};const de=Object.keys(R.iconDependencies);de.length?p.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"icons"},(xe,Ce)=>{B||(B=xe,H=Ce,ce())},void 0,!1,ie):H={};const ve=Object.keys(R.patternDependencies);ve.length?p.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"patterns"},(xe,Ce)=>{B||(B=xe,X=Ce,ce())},void 0,!1,ie):X={},ce()}}function lb(a,o,l){const d=new L(o);for(const p of a)p.recalculate(d,l)}class eE{constructor(o){this.entries={},this.scheduler=o}request(o,l,d,p){const y=this.entries[o]=this.entries[o]||{callbacks:[]};if(y.result){const[b,E]=y.result;return this.scheduler?this.scheduler.add(()=>{p(b,E)},l):p(b,E),()=>{}}return y.callbacks.push(p),y.cancel||(y.cancel=d((b,E)=>{y.result=[b,E];for(const T of y.callbacks)this.scheduler?this.scheduler.add(()=>{T(b,E)},l):T(b,E);setTimeout(()=>delete this.entries[o],3e3)})),()=>{y.result||(y.callbacks=y.callbacks.filter(b=>b!==p),y.callbacks.length||(y.cancel(),delete this.entries[o]))}}}function uS(a,o,l){const d=JSON.stringify(a.request);return a.data&&(this.deduped.entries[d]={result:[null,a.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},p=>{const y=eu(a.request,(b,E,T,D)=>{b?p(b):E&&p(null,{vectorTile:l?void 0:new ng(new Hv(E)),rawData:E,cacheControl:T,expires:D})});return()=>{y.cancel(),p()}},o)}const cb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hy{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,d]=new Uint8Array(o,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const p=d>>4;if(1!==p)throw new Error(`Got v${p} data when expected v1.`);const y=cb[15&d];if(!y)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(o,2,1),[E]=new Uint32Array(o,4,1);return new hy(E,b,y,o)}constructor(o,l=64,d=Float64Array,p){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=d,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const y=cb.indexOf(this.ArrayType),b=2*o*this.ArrayType.BYTES_PER_ELEMENT,E=o*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-E%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${d}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+E+T,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+b+E+T),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+E+T,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=o,this.coords[this._pos++]=l,d}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return bs(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,d,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:b,nodeSize:E}=this,T=[0,y.length-1,0],D=[];for(;T.length;){const R=T.pop()||0,N=T.pop()||0,B=T.pop()||0;if(N-B<=E){for(let ie=B;ie<=N;ie++){const ce=b[2*ie],be=b[2*ie+1];ce>=o&&ce<=d&&be>=l&&be<=p&&D.push(y[ie])}continue}const j=B+N>>1,H=b[2*j],X=b[2*j+1];H>=o&&H<=d&&X>=l&&X<=p&&D.push(y[j]),(0===R?o<=H:l<=X)&&(T.push(B),T.push(j-1),T.push(1-R)),(0===R?d>=H:p>=X)&&(T.push(j+1),T.push(N),T.push(1-R))}return D}within(o,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:b}=this,E=[0,p.length-1,0],T=[],D=d*d;for(;E.length;){const R=E.pop()||0,N=E.pop()||0,B=E.pop()||0;if(N-B<=b){for(let ie=B;ie<=N;ie++)mg(y[2*ie],y[2*ie+1],o,l)<=D&&T.push(p[ie]);continue}const j=B+N>>1,H=y[2*j],X=y[2*j+1];mg(H,X,o,l)<=D&&T.push(p[j]),(0===R?o-d<=H:l-d<=X)&&(E.push(B),E.push(j-1),E.push(1-R)),(0===R?o+d>=H:l+d>=X)&&(E.push(j+1),E.push(N),E.push(1-R))}return T}}function bs(a,o,l,d,p,y){if(p-d<=l)return;const b=d+p>>1;Nt(a,o,b,d,p,y),bs(a,o,l,d,b-1,1-y),bs(a,o,l,b+1,p,1-y)}function Nt(a,o,l,d,p,y){for(;p>d;){if(p-d>600){const D=p-d+1,R=l-d+1,N=Math.log(D),B=.5*Math.exp(2*N/3),j=.5*Math.sqrt(N*B*(D-B)/D)*(R-D/2<0?-1:1);Nt(a,o,l,Math.max(d,Math.floor(l-R*B/D+j)),Math.min(p,Math.floor(l+(D-R)*B/D+j)),y)}const b=o[2*l+y];let E=d,T=p;for(yh(a,o,d,l),o[2*p+y]>b&&yh(a,o,d,p);E<T;){for(yh(a,o,E,T),E++,T--;o[2*E+y]<b;)E++;for(;o[2*T+y]>b;)T--}o[2*d+y]===b?yh(a,o,d,T):(T++,yh(a,o,T,p)),T<=l&&(d=T+1),l<=T&&(p=T-1)}}function yh(a,o,l,d){ub(a,l,d),ub(o,2*l,2*d),ub(o,2*l+1,2*d+1)}function ub(a,o,l){const d=a[o];a[o]=a[l],a[l]=d}function mg(a,o,l,d){const p=a-l,y=o-d;return p*p+y*y}m.ARRAY_TYPE=Ao,m.AUTH_ERR_MSG=Me,m.Aabb=ha,m.Actor=class{constructor(a,o,l){this.target=a,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},hi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=pl()?a:pt,this.scheduler=new ly}send(a,o,l,d,p=!1,y){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=y,this.callbacks[b]=l);const E=ju(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:a,hasCallback:!!l,targetMapId:d,mustQueue:p,sourceMapId:this.mapId,data:rd(o,E)},E),{cancel:()=>{l&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(a){const o=a.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d.cancel()}else if(o.mustQueue||pl()){const d=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,o),d&&d.metadata||{type:"message"})}else this.processTask(l,o)}processTask(a,o){if("<response>"===o.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(o.error?l(th(o.error)):l(null,th(o.data)))}else{const l=ju(this.globalScope)?void 0:[],d=o.hasCallback?(y,b)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:y?rd(y):null,data:rd(b,l)},l)}:y=>{},p=th(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,p,d);else if(this.parent.getWorkerSource){const y=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,y[0],p.source)[y[1]](p,d)}else d(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},m.CanonicalTileID=Pp,m.Color=lt,m.ColorMode=jc,m.CullFaceMode=lc,m.DEMData=rb,m.DataConstantProperty=W,m.DedupedRequest=eE,m.DepthMode=Tf,m.EXTENT=Tn,m.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const l=o.getSource().maxzoom,d=1<<l,p=Math.floor(a.x),y=Math.floor((a.x-p)*d),b=Math.floor(a.y*d),E=this.findDEMTileFor(new Bs(l,p,l,y,b));return!(!E||!E.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const d=this._source();if(!d||a.y<0||a.y>1)return o;const p=d.getSource().maxzoom,y=1<<p,b=Math.floor(a.x),E=a.x-b,T=new Bs(p,b,p,Math.floor(E*y),Math.floor(a.y*y)),D=this.findDEMTileFor(T);if(!D||!D.dem)return o;const R=D.dem,N=1<<D.tileID.canonical.z,B=(E*N-D.tileID.canonical.x)*R.dim,j=(a.y*N-D.tileID.canonical.y)*R.dim,H=Math.floor(B),X=Math.floor(j);return(l?this.exaggeration():1)*ai(ai(R.get(H,X),R.get(H,X+1),j-X),ai(R.get(H+1,X),R.get(H+1,X+1),j-X),B-H)}getAtTileOffset(a,o,l){const d=1<<a.canonical.z;return this.getAtPointOrZero(new pd(a.wrap+(a.canonical.x+o/Tn)/d,(a.canonical.y+l/Tn)/d))}getAtTileOffsetFunc(a,o,l,d){return p=>{const y=this.getAtTileOffset(a,p.x,p.y),b=d.upVector(a.canonical,p.x,p.y);return da(b,b,y*d.upVectorScale(a.canonical,o,l).metersToTile),b}}getForTilePoints(a,o,l,d){if(this.isUsingMockSource())return!1;const p=ob.create(this,a,d);return!!p&&(o.forEach(y=>{y[2]=this.exaggeration()*p.getElevationAt(y[0],y[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const l=o.dem.tree,d=o.tileID,p=1<<a.canonical.z-d.canonical.z;let y=a.canonical.x/p-d.canonical.x,b=a.canonical.y/p-d.canonical.y,E=0;for(let T=0;T<a.canonical.z-d.canonical.z&&!l.leaves[E];T++){y*=2,b*=2;const D=2*Math.floor(b)+Math.floor(y);E=l.childOffsets[E]+D,y%=1,b%=1}return{min:this.exaggeration()*l.minimums[E],max:this.exaggeration()*l.maximums[E]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},m.ErrorEvent=Oo,m.EvaluationParameters=L,m.Event=na,m.Evented=qo,m.FillExtrusionBucket=ig,m.Frustum=ch,m.FrustumCorners=C_,m.GLOBE_RADIUS=du,m.GLOBE_SCALE_MATCH_LATITUDE=45,m.GLOBE_ZOOM_THRESHOLD_MAX=M_,m.GLOBE_ZOOM_THRESHOLD_MIN=$m,m.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,o){const l=new ht,d=new gn,p=[],y=a+1+2,b=o[0]+1,E=o[0]+1+(1+o.length),T=(D,R,N)=>{let B=D===y-1?D-2:0===D?D:D-1;return B+=N?24575:0,[B,R]};for(let D=0;D<y;++D)l.emplaceBack(...T(D,0,!0));for(let D=0;D<b;++D)for(let R=0;R<y;++R)l.emplaceBack(...T(R,D,(0===R||R===y-1)&&!0));for(let D=0;D<o.length;++D){const R=o[D];for(let N=0;N<y;++N)l.emplaceBack(...T(N,R,!0))}for(let D=0;D<o.length;++D){const R=d.length,N=o[D]+1+2,B=new gn;for(let X=0;X<N-1;X++){const ie=X===N-2,ce=ie?y*(E-o.length+D-X):y;for(let be=0;be<y-1;be++){const de=X*y+be;0===X||ie||0===be||be===y-2?(B.emplaceBack(de+1,de,de+ce),B.emplaceBack(de+ce,de+ce+1,de+1)):(d.emplaceBack(de+1,de,de+ce),d.emplaceBack(de+ce,de+ce+1,de+1))}}const j=fo.simpleSegment(0,R,l.length,d.length-R);for(let X=0;X<B.uint16.length;X+=3)d.emplaceBack(B.uint16[X],B.uint16[X+1],B.uint16[X+2]);const H=fo.simpleSegment(0,R,l.length,d.length-R);p.push({withoutSkirts:j,withSkirts:H})}return{vertices:l,indices:d,segments:p}}_createGrid(a){const o=this._fillGridMeshWithLods(64,fu);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,jm.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){const o=new gn;for(let p=0;p<=64;p++)o.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const l=new vr,d=new vr;this._poleSegments=[];for(let p=0,y=0;p<$m;p++){const b=360/(1<<p);l.emplaceBack(0,-du,0,.5,0),d.emplaceBack(0,-du,0,.5,1);for(let E=0;E<=64;E++){const T=E/64,D=ai(0,b,T),[R,N,B]=Hm(Dk,aD,D,du);l.emplaceBack(R,N,B,T,0),d.emplaceBack(R,N,B,T,1)}this._poleSegments.push(fo.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,Vm,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(d,Vm,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const l=new Fo,d=64,p=d+1+2,y=1;this._wireframeSegments=[];for(let b=0,E=0;b<fu.length;b++){const T=fu[b];for(let R=y;R<T+y;R++)for(let N=y;N<d+y;N++){const B=R*p+N;l.emplaceBack(B,B+1),l.emplaceBack(B,B+p),l.emplaceBack(B,B+p+1)}const D=T*d*3;this._wireframeSegments.push(fo.simpleSegment(0,E,(T+1)*p,D)),E+=D}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},m.GlyphManager=rc,m.ImagePosition=Y_,m.KDBush=hy,m.LivePerformanceUtils=Im,m.LngLat=Bi,m.LngLatBounds=cd,m.LocalGlyphMode=ty,m.MAX_MERCATOR_LATITUDE=gs,m.MercatorCoordinate=pd,m.ONE_EM=No,m.OverscaledTileID=Bs,m.PerformanceMarkers=nu,m.Point=Gt,m.Properties=_e,m.RGBAImage=zs,m.Ray=E_,m.RequestManager=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ul,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!Pe(a))return a;const l=Vt(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!Pe(a))return a;const l=Vt(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,d){if(!Pe(a))return a;const p=Vt(a);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),l&&p.params.push(`language=${l}`),d&&p.params.push(`worldview=${d}`),this._makeAPIURL(p,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,d){const p=Vt(a);return Pe(a)?(p.path=`/styles/v1${p.path}/sprite${o}${l}`,this._makeAPIURL(p,this._customAccessToken||d)):(p.path+=`${o}${l}`,Tt(p))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Pe(a))return a;const d=Vt(a);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&"raster"!==d.authority&&512===l?"@2x":""}${Pn.supported?".webp":"$1"}`),"raster"===d.authority?d.path=`/${An.RASTER_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${An.TILE_URL_VERSION}${d.path}`);const p=this._customAccessToken||function(y){for(const b of y){const E=b.match(/^access_token=(.*)$/);if(E)return E[1]}return null}(d.params)||An.ACCESS_TOKEN;return An.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,p)}canonicalizeTileURL(a,o){const l=Vt(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let d="mapbox://";l.path.match(/^\/raster\/v1\//)?d+=`raster/${l.path.replace(`/${An.RASTER_URL_PREFIX}/`,"")}`:d+=`tiles/${l.path.replace(`/${An.TILE_URL_VERSION}/`,"")}`;let p=l.params;return o&&(p=p.filter(y=>!y.match(/^access_token=/))),p.length&&(d+=`?${p.join("&")}`),d}canonicalizeTileset(a,o){const l=!!o&&Pe(o),d=[];for(const p of a.tiles||[])Ve(p)?d.push(this.canonicalizeTileURL(p,l)):d.push(p);return d}_makeAPIURL(a,o){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",d=Vt(An.API_URL);if(a.protocol=d.protocol,a.authority=d.authority,"http"===a.protocol){const p=a.params.indexOf("secure");p>=0&&a.params.splice(p,1)}if("/"!==d.path&&(a.path=`${d.path}${a.path}`),!An.REQUIRE_ACCESS_TOKEN)return Tt(a);if(o=o||An.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(p=>-1===p.indexOf("access_token")),a.params.push(`access_token=${o||""}`),Tt(a)}},m.ResourceType=Co,m.SegmentVector=fo,m.SourceCache=_h,m.StencilMode=Xw,m.StructArrayLayout1ui2=Qa,m.StructArrayLayout2f1f2i16=Sn,m.StructArrayLayout2i4=ht,m.StructArrayLayout2ui4=Fo,m.StructArrayLayout3f12=li,m.StructArrayLayout3ui6=gn,m.StructArrayLayout4i8=dt,m.StructArrayLayout5f20=vr,m.Texture=hg,m.Tile=cy,m.Transitionable=q,m.Uniform1f=Rm,m.Uniform1i=class extends sd{constructor(a){super(a),this.current=0}set(a,o,l){this.fetchUniformLocation(a,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},m.Uniform2f=class extends sd{constructor(a){super(a),this.current=[0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},m.Uniform3f=class extends sd{constructor(a){super(a),this.current=[0,0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},m.Uniform4f=F1,m.UniformColor=N1,m.UniformMatrix2f=class extends sd{constructor(a){super(a),this.current=z1}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let d=0;d<4;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},m.UniformMatrix3f=class extends sd{constructor(a){super(a),this.current=X0}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let d=0;d<9;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},m.UniformMatrix4f=class extends sd{constructor(a){super(a),this.current=Z0}set(a,o,l){if(this.fetchUniformLocation(a,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let d=1;d<16;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},m.UnwrappedTileID=og,m.ValidationError=Ft,m.VectorTileFeature=B_,m.VectorTileWorkerSource=class extends qo{constructor(a,o,l,d,p){super(),this.actor=a,this.layerIndex=o,this.availableImages=l,this.loadVectorData=p||uS,this.loading={},this.loaded={},this.deduped=new eE(a.scheduler),this.isSpriteLoaded=d,this.scheduler=a.scheduler}loadTile(a,o){const l=a.uid,d=a&&a.request,p=d&&d.collectResourceTiming,y=this.loading[l]=new Jw(a);y.abort=this.loadVectorData(a,(b,E)=>{const T=!this.loading[l];if(delete this.loading[l],T||b||!E)return y.status="done",T||(this.loaded[l]=y),o(b);const D=E.rawData,R={};E.expires&&(R.expires=E.expires),E.cacheControl&&(R.cacheControl=E.cacheControl),y.vectorTile=E.vectorTile||new ng(new Hv(D));const N=()=>{y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,(B,j)=>{if(B||!j)return o(B);const H={};if(p){const X=zr(d);X.length>0&&(H.resourceTiming=JSON.parse(JSON.stringify(X)))}o(null,Ti({rawTileData:D.slice(0)},j,R,H))})};this.isSpriteLoaded?N():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(N,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):N()}),this.loaded=this.loaded||{},this.loaded[l]=y})}reloadTile(a,o){const l=this.loaded,d=a.uid,p=this;if(l&&l[d]){const y=l[d];y.showCollisionBoxes=a.showCollisionBoxes,y.enableTerrain=!!a.enableTerrain,y.projection=a.projection,y.tileTransform=wu(a.tileID.canonical,a.projection);const b=(E,T)=>{const D=y.reloadCallback;D&&(delete y.reloadCallback,y.parse(y.vectorTile,p.layerIndex,this.availableImages,p.actor,D)),o(E,T)};"parsing"===y.status?y.reloadCallback=b:"done"===y.status&&(y.vectorTile?y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,b):b())}}abortTile(a,o){const l=a.uid,d=this.loading[l];d&&(d.abort&&d.abort(),delete this.loading[l]),o()}removeTile(a,o){const l=this.loaded,d=a.uid;l&&l[d]&&delete l[d],o()}},m.WritingMode=Ol,m.ZoomDependentExpression=Jn,m.add=sh,m.addDynamicAttributes=Gp,m.adjoint=function(a,o){var l=o[0],d=o[1],p=o[2],y=o[3],b=o[4],E=o[5],T=o[6],D=o[7],R=o[8];return a[0]=b*R-E*D,a[1]=p*D-d*R,a[2]=d*E-p*b,a[3]=E*T-y*R,a[4]=l*R-p*T,a[5]=p*y-l*E,a[6]=y*D-b*T,a[7]=d*T-l*D,a[8]=l*b-d*y,a},m.asyncAll=Yr,m.bezier=za,m.bindAll=hi,m.boundsAttributes=pg,m.bufferConvexPolygon=function(a,o){const l=[];for(let d=0;d<a.length;d++){const p=ii(d-1,-1,a.length-1),y=ii(d+1,-1,a.length-1),b=a[d],E=a[y],T=a[p].sub(b).unit(),D=E.sub(b).unit(),R=D.angleWithSep(T.x,T.y),N=T.add(D).unit().mult(-1*o/Math.sin(R/2));l.push(b.add(N))}return l},m.cacheEntryPossiblyAdded=function(a){Hl++,Hl>Qs&&(a.getActor().send("enforceCacheSizeLimit",$u),Hl=0)},m.calculateGlobeLabelMatrix=function(a,o){const{x:l,y:d}=a.point,p=wp(l,d,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ud(p,p,tl(fd(o)))},m.calculateGlobeMatrix=function(a){const{x:o,y:l}=a.point,{lng:d,lat:p}=a._center;return wp(o,l,a.worldSize,d,p)},m.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,l=o/Nc(1,a.center.lat),d=Ja(new Float64Array(16));return gp(d,d,[a.point.x,a.point.y,0]),oh(d,d,[l,l,o]),Float32Array.from(d)},m.circumferenceAtLatitude=Z1,m.clamp=ni,m.clearTileCache=function(a){if(!$l())return;const o=pt.caches.delete(Va);a&&o.catch(a).then(()=>a())},m.clipLine=qD,m.clone=function(a){var o=new Ao(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},m.clone$1=Go,m.collisionCircleLayout=yw,m.config=An,m.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},m.create=function(){var a=new Ao(16);return Ao!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},m.create$1=B1,m.createExpression=Ml,m.createLayout=Fe,m.createStyleLayer=function(a){return"custom"===a.type?new qp(a):new vs[a.type](a)},m.cross=b_,m.degToRad=Nn,m.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},m.div=function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a},m.dot=Rc,m.earthRadius=D_,m.ease=Ts,m.easeCubicInOut=Vu,m.ecefToLatLng=function([a,o,l]){const d=Math.hypot(a,o,l),p=Math.atan2(a,l),y=.5*Math.PI-Math.acos(-o/d);return new Bi(_o(p),_o(y))},m.emitValidationErrors=H0,m.endsWith=yn,m.enforceCacheSizeLimit=function(a){Ca(),ls&&ls.then(o=>{o.keys().then(l=>{for(let d=0;d<l.length-a;d++)o.delete(l[d])})})},m.evaluateSizeForFeature=q_,m.evaluateSizeForZoom=Op,m.evaluateVariableOffset=Fw,m.evented=w,m.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},m.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},m.exported=ta,m.exported$1=Pn,m.extend=Ti,m.extend$1=Wo,m.fillExtrusionHeightLift=j_,m.filterObject=pi,m.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},m.fromQuat=function(a,o){var l=o[0],d=o[1],p=o[2],y=o[3],b=l+l,E=d+d,T=p+p,D=l*b,R=d*b,N=d*E,B=p*b,j=p*E,H=p*T,X=y*b,ie=y*E,ce=y*T;return a[0]=1-N-H,a[1]=R+ce,a[2]=B-ie,a[3]=0,a[4]=R-ce,a[5]=1-D-H,a[6]=j+X,a[7]=0,a[8]=B+ie,a[9]=j-X,a[10]=1-D-N,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},m.fromRotation=function(a,o){var l=Math.sin(o),d=Math.cos(o);return a[0]=d,a[1]=l,a[2]=0,a[3]=-l,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},m.fromScaling=_p,m.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return Na[o]},m.getAABBPointSquareDist=function(a,o,l){let d=0;for(let p=0;p<2;++p){const y=l?l[p]:0;a[p]>y&&(d+=(a[p]-y)*(a[p]-y)),o[p]<y&&(d+=(y-o[p])*(y-o[p]))}return d},m.getAnchorAlignment=Aw,m.getAnchorJustification=yf,m.getBounds=function(a){let o=1/0,l=1/0,d=-1/0,p=-1/0;for(const y of a)o=Math.min(o,y.x),l=Math.min(l,y.y),d=Math.max(d,y.x),p=Math.max(p,y.y);return{min:new Gt(o,l),max:new Gt(d,p)}},m.getColumn=ml,m.getDefaultExportFromCjs=fr,m.getGridMatrix=function(a,o,l,d){const p=o.getNorth(),y=o.getSouth(),b=o.getWest(),E=o.getEast(),T=1<<a.z,D=E-b,R=p-y,N=D/64,B=-R/fu[l],j=[0,N,0,B,0,0,p,b,0];if(a.z>0){const H=180/d;Nm(j,j,[H/D+1,0,0,0,H/R+1,0,-.5*H/N,.5*H/B,1])}return j[2]=T,j[5]=a.x,j[8]=a.y,j},m.getImage=me,m.getJSON=function(a,o){return Ss(Ti(a,{type:"json"}),o)},m.getLatitudinalLod=function(a){const o=gs-5;a=ni(a,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(Nn(a))),3);return Math.round(l*(fu.length-1))},m.getMapSessionAPI=yo,m.getPerformanceMeasurement=zr,m.getProjection=Vw,m.getRTLTextPluginStatus=M,m.getReferrer=_c,m.getTilePoint=function(a,{x:o,y:l},d=0){return new Gt(((o-d)*a.scale-a.x)*Tn,(l*a.scale-a.y)*Tn)},m.getTileVec3=function(a,o,l=0){return yp(((o.x-l)*a.scale-a.x)*Tn,(o.y*a.scale-a.y)*Tn,X1(o.z,o.y))},m.getVideo=function(a,o){const l=pt.document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let d=0;d<a.length;d++){const p=pt.document.createElement("source");tu(a[d])||(l.crossOrigin="Anonymous"),p.src=a[d],l.appendChild(p)}return{cancel:()=>{}}},m.globeCenterToScreenPoint=function(a){const o=[0,0,0],l=Ja(new Float64Array(16));return ud(l,a.pixelMatrix,a.globeMatrix),eo(o,o,l),new Gt(o[0],o[1])},m.globeDenormalizeECEF=tl,m.globeECEFOrigin=function(a,o){const l=[0,0,0];return eo(l,l,qm(fd(o.canonical))),eo(l,l,a),l},m.globeMetersToEcef=vp,m.globeNormalizeECEF=qm,m.globePixelsToTileUnits=function(a,o){return Tn/(512*Math.pow(2,a))*T_(fd(o))},m.globePoleMatrixForTile=function(a,o,l){const d=Ja(new Float64Array(16)),p=(o/(1<<a)-.5)*Math.PI*2;return dd(d,l.globeMatrix,p),Float32Array.from(d)},m.globeTileBounds=fd,m.globeTiltAtLngLat=Wm,m.globeToMercatorTransition=cf,m.globeUseCustomAntiAliasing=function(a,o,l){const d=cf(l.zoom),p=a.style.map._antialias,y=!!o.extStandardDerivatives,b=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===d&&!p&&!b&&y},m.identity=Ja,m.identity$1=tv,m.invert=mp,m.isFullscreen=function(){return!!pt.document.fullscreenElement||!!pt.document.webkitFullscreenElement},m.isLngLatBehindGlobe=uf,m.isMapAuthenticated=function(a){return er.has(a)},m.isMapboxURL=Pe,m.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!ju(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},m.latFromMercatorY=ms,m.latLngToECEF=Gm,m.len=J0,m.length=Bm,m.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},m.lngFromMercatorX=Pl,m.loadVectorTile=uS,m.makeRequest=Ss,m.mapValue=function(a,o,l,d,p){return ni((a-o)/(l-o)*(p-d)+d,d,p)},m.mercatorScale=S_,m.mercatorXfromLng=Fc,m.mercatorYfromLat=mu,m.mercatorZfromAltitude=Nc,m.mul=Ck,m.mul$1=x_,m.multiply=ud,m.multiply$1=Nm,m.multiply$2=Q0,m.nextPowerOfTwo=Kr,m.normalize=ts,m.normalize$1=H1,m.normalize$2=w_,m.number=ai,m.ortho=function(a,o,l,d,p,y,b){var E=1/(o-l),T=1/(d-p),D=1/(y-b);return a[0]=-2*E,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*D,a[11]=0,a[12]=(o+l)*E,a[13]=(p+d)*T,a[14]=(b+y)*D,a[15]=1,a},m.pbf=vw,m.perspective=function(a,o,l,d,p){var y,b=1/Math.tan(o/2);return a[0]=b/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=p&&p!==1/0?(a[10]=(p+d)*(y=1/(d-p)),a[14]=2*p*d*y):(a[10]=-1,a[14]=-2*d),a},m.pick=function(a,o){const l={};for(let d=0;d<o.length;d++){const p=o[d];p in a&&(l[p]=a[p])}return l},m.plugin=k,m.pointGeometry=dl,m.polesInViewport=function(a){const o=Ja(new Float64Array(16));ud(o,a.pixelMatrix,a.globeMatrix);const l=[0,Fs,0],d=[0,Ns,0];return eo(l,l,o),eo(d,d,o),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!uf(a,new Bi(a.center.lat,90)),d[0]>0&&d[0]<=a.width&&d[1]>0&&d[1]<=a.height&&!uf(a,new Bi(a.center.lat,-90))]},m.polygonContainsPoint=gu,m.polygonIntersectsBox=fv,m.polygonIntersectsPolygon=Ep,m.polygonizeBounds=function(a,o,l=0,d=!0){const p=new Gt(l,l),y=a.sub(p),b=o.add(p),E=[y,new Gt(b.x,y.y),b,new Gt(y.x,b.y)];return d&&E.push(y.clone()),E},m.posAttributes=jm,m.postMapLoadEvent=bi,m.postPerformanceEvent=Nr,m.postTurnstileEvent=ri,m.potpack=X_,m.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},m.radToDeg=_o,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.registerForPluginStateChange=function(a){return a({pluginStatus:_,pluginURL:c}),w.on("pluginStateChange",a),a},m.removeAuthState=function(a){er.delete(a)},m.renderColorRamp=k_,m.resample=Zm,m.rotateX=K0,m.rotateX$1=nv,m.rotateY=dd,m.rotateY$1=iv,m.rotateZ=function(a,o,l){var d=Math.sin(l),p=Math.cos(l),y=o[0],b=o[1],E=o[2],T=o[3],D=o[4],R=o[5],N=o[6],B=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=y*p+D*d,a[1]=b*p+R*d,a[2]=E*p+N*d,a[3]=T*p+B*d,a[4]=D*p-y*d,a[5]=R*p-b*d,a[6]=N*p-E*d,a[7]=B*p-T*d,a},m.rotateZ$1=function(a,o,l){l*=.5;var d=o[0],p=o[1],y=o[2],b=o[3],E=Math.sin(l),T=Math.cos(l);return a[0]=d*T+p*E,a[1]=p*T-d*E,a[2]=y*T+b*E,a[3]=b*T-y*E,a},m.scale=oh,m.scale$1=ev,m.scale$2=da,m.scaleAndAdd=sf,m.set=function(a,o,l,d){return a[0]=o,a[1]=l,a[2]=d,a},m.setCacheLimits=function(a,o){$u=a,Qs=o},m.setColumn=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},m.setRTLTextPlugin=function(a,o,l=!1){if(_===bo||_===pp||_===v_)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=ta.resolveURL(a),_=bo,uu=o,v(),l||I()},m.smoothstep=hl,m.spec=nt,m.squaredLength=function(a){var o=a[0],l=a[1],d=a[2];return o*o+l*l+d*d},m.storeAuthState=function(a,o){o?er.add(a):er.delete(a)},m.sub=Lc,m.subtract=V1,m.symbolSize=FD,m.tileAABB=function(a,o,l,d,p,y,b,E,T){if("globe"===T.name)return function Tk(a,o,l){const d=o/a.worldSize,p=a.globeMatrix;if(l.z<=1){const Ge=fd(l).getCorners();return sD(Ge,p,d),ha.fromPoints(Ge)}const y=ov(l),b=lf(y);sD(b,p,d);const E=Number.MAX_VALUE,T=[-E,-E,-E],D=[E,E,E];if(y.contains(a.center)){for(const Mt of b)ah(D,D,Mt),Um(T,T,Mt);T[2]=0;const Ge=a.point,st=[Ge.x*d,Ge.y*d,0];return ah(D,D,st),Um(T,T,st),new ha(D,T)}const R=[p[12]*d,p[13]*d,p[14]*d],N=y.getCenter(),B=ni(a.center.lat,-gs,gs),j=ni(N.lat,-gs,gs),H=Fc(a.center.lng),X=mu(B);let ie=H-Fc(N.lng);const ce=X-mu(j);ie>.5?ie-=1:ie<-.5&&(ie+=1);let be=0;Math.abs(ie)>Math.abs(ce)?be=ie>=0?1:3:(be=ce>=0?0:2,sf(R,R,[p[4]*d,p[5]*d,p[6]*d],-Math.sin(Nn(ce>=0?y.getSouth():y.getNorth()))*du));const de=b[be],ve=b[(be+1)%4],xe=new Mk(de,ve,R),Ce=[rv(xe,0)||de[0],rv(xe,1)||de[1],rv(xe,2)||de[2]],Xe=cf(a.zoom);if(Xe>0){const Ge=function({x:Mt,y:Je,z:mt},gt,wt,Pt,rt){const Xt=1/(1<<mt);let un=Mt*Xt,Jt=un+Xt,qn=Je*Xt,Ot=qn+Xt,En=0;const Ln=(un+Jt)/2-Pt;return Ln>.5?En=-1:Ln<-.5&&(En=1),un=((un+En)*gt-(Pt*=gt))*wt+Pt,Jt=((Jt+En)*gt-Pt)*wt+Pt,qn=(qn*gt-(rt*=gt))*wt+rt,Ot=(Ot*gt-rt)*wt+rt,[[un,Ot,0],[Jt,Ot,0],[Jt,qn,0],[un,qn,0]]}(l,o,a._pixelsPerMercatorPixel,H,X);for(let Mt=0;Mt<b.length;Mt++)bp(b[Mt],Ge[Mt],Xe);const st=sh([],Ge[be],Ge[(be+1)%4]);da(st,st,.5),bp(Ce,st,Xe)}for(const Ge of b)ah(D,D,Ge),Um(T,T,Ge);return D[2]=Math.min(de[2],ve[2]),ah(D,D,Ce),Um(T,T,Ce),new ha(D,T)}(a,o,new Pp(l,d,p));const D=wu({z:l,x:d,y:p},T);return new ha([(y+D.x/D.scale)*o,o*(D.y/D.scale),b],[(y+D.x2/D.scale)*o,o*(D.y2/D.scale),E])},m.tileCornersToBounds=ov,m.tileTransform=wu,m.transformMat3=function(a,o,l){var d=o[0],p=o[1],y=o[2];return a[0]=d*l[0]+p*l[3]+y*l[6],a[1]=d*l[1]+p*l[4]+y*l[7],a[2]=d*l[2]+p*l[5]+y*l[8],a},m.transformMat4=eo,m.transformMat4$1=hd,m.transformQuat=j1,m.transitionTileAABBinECEF=oD,m.translate=gp,m.transpose=function(a,o){if(a===o){var l=o[1],d=o[2],p=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=d,a[7]=p}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},m.triggerPluginCompletionEvent=f,m.uniqueId=Yn,m.updateGlobeVertexNormal=function(a,o,l,d,p){const y=5*o+2;a.float32[y+0]=l,a.float32[y+1]=d,a.float32[y+2]=p},m.validateCustomStyleLayer=function(a){const o=[],l=a.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},m.validateFilter=a=>Dl(Lo(a)),m.validateFog=a=>Dl(V0(a)),m.validateLayer=a=>Dl(dp(a)),m.validateLight=a=>Dl(p_(a)),m.validateSource=a=>Dl(B0(a)),m.validateStyle=$0,m.validateTerrain=a=>Dl(m_(a)),m.values=Ba,m.vectorTile=eg,m.version=Xs,m.warnOnce=_r,m.window=pt,m.wrap=ii}),Uu(0,function(m){function pt(ye){if("number"==typeof ye||"boolean"==typeof ye||"string"==typeof ye||null==ye)return JSON.stringify(ye);if(Array.isArray(ye)){let ee="[";for(const me of ye)ee+=`${pt(me)},`;return`${ee}]`}let K="{";for(const ee of Object.keys(ye).sort())K+=`${ee}:${pt(ye[ee])},`;return`${K}}`}function Xs(ye){let K="";for(const ee of m.refProperties)K+=`/${pt(ye[ee])}`;return K}class ss{constructor(K){this.keyCache={},K&&this.replace(K)}replace(K){this._layerConfigs={},this._layers={},this.update(K,[])}update(K,ee){for(const Me of K)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=m.createStyleLayer(Me)).compileFilter(),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(const Me of ee)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const me=function(Me,Pe){const Ve={};for(let Oe=0;Oe<Me.length;Oe++){const Ke=Pe&&Pe[Me[Oe].id]||Xs(Me[Oe]);Pe&&(Pe[Me[Oe].id]=Ke);let St=Ve[Ke];St||(St=Ve[Ke]=[]),St.push(Me[Oe])}const Ue=[];for(const Oe in Ve)Ue.push(Ve[Oe]);return Ue}(m.values(this._layerConfigs),this.keyCache);for(const Me of me){const Pe=Me.map(Vt=>this._layers[Vt.id]),Ve=Pe[0];if("none"===Ve.visibility)continue;const Ue=Ve.source||"";let Oe=this.familiesBySource[Ue];Oe||(Oe=this.familiesBySource[Ue]={});const Ke=Ve.sourceLayer||"_geojsonTileLayer";let St=Oe[Ke];St||(St=Oe[Ke]=[]),St.push(Pe)}}}class An{loadTile(K,ee){const{uid:me,encoding:Me,rawImageData:Pe,padding:Ve,buildQuadTree:Ue}=K,Oe=m.window.ImageBitmap&&Pe instanceof m.window.ImageBitmap?this.getImageData(Pe,Ve):Pe;ee(null,new m.DEMData(me,Oe,Me,Ve<1,Ue))}getImageData(K,ee){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(K.width,K.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=K.width,this.offscreenCanvas.height=K.height,this.offscreenCanvasContext.drawImage(K,0,0,K.width,K.height);const me=this.offscreenCanvasContext.getImageData(-ee,-ee,K.width+2*ee,K.height+2*ee);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}function Pn(ye,K){if(0!==ye.length){di(ye[0],K);for(var ee=1;ee<ye.length;ee++)di(ye[ee],!K)}}function di(ye,K){for(var ee=0,me=0,Me=0,Pe=ye.length,Ve=Pe-1;Me<Pe;Ve=Me++){var Ue=(ye[Me][0]-ye[Ve][0])*(ye[Ve][1]+ye[Me][1]),Oe=ee+Ue;me+=Math.abs(ee)>=Math.abs(Ue)?ee-Oe+Ue:Ue-Oe+ee,ee=Oe}ee+me>=0!=!!K&&ye.reverse()}var hr=m.getDefaultExportFromCjs(function ye(K,ee){var me,Me=K&&K.type;if("FeatureCollection"===Me)for(me=0;me<K.features.length;me++)ye(K.features[me],ee);else if("GeometryCollection"===Me)for(me=0;me<K.geometries.length;me++)ye(K.geometries[me],ee);else if("Feature"===Me)ye(K.geometry,ee);else if("Polygon"===Me)Pn(K.coordinates,ee);else if("MultiPolygon"===Me)for(me=0;me<K.coordinates.length;me++)Pn(K.coordinates[me],ee);return K});const _n=m.VectorTileFeature.prototype.toGeoJSON;var ti={exports:{}},Eo=m.pointGeometry,Ul=m.vectorTile.VectorTileFeature,fr=rr;function rr(ye,K){this.options=K||{},this.features=ye,this.length=ye.length}function Ho(ye,K){this.id="number"==typeof ye.id?ye.id:void 0,this.type=ye.type,this.rawGeometry=1===ye.type?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=K||4096}rr.prototype.feature=function(ye){return new Ho(this.features[ye],this.options.extent)},Ho.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var K=0;K<ye.length;K++){for(var ee=ye[K],me=[],Me=0;Me<ee.length;Me++)me.push(new Eo(ee[Me][0],ee[Me][1]));this.geometry.push(me)}return this.geometry},Ho.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,K=1/0,ee=-1/0,me=1/0,Me=-1/0,Pe=0;Pe<ye.length;Pe++)for(var Ve=ye[Pe],Ue=0;Ue<Ve.length;Ue++){var Oe=Ve[Ue];K=Math.min(K,Oe.x),ee=Math.max(ee,Oe.x),me=Math.min(me,Oe.y),Me=Math.max(Me,Oe.y)}return[K,me,ee,Me]},Ho.prototype.toGeoJSON=Ul.prototype.toGeoJSON;var ul=m.pbf,dl=fr;function Ys(ye){var K=new ul;return function(ee,me){for(var Me in ee.layers)me.writeMessage(3,Gt,ee.layers[Me])}(ye,K),K.finish()}function Gt(ye,K){var ee;K.writeVarintField(15,ye.version||1),K.writeStringField(1,ye.name||""),K.writeVarintField(5,ye.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(ee=0;ee<ye.length;ee++)me.feature=ye.feature(ee),K.writeMessage(2,Hd,me);var Me=me.keys;for(ee=0;ee<Me.length;ee++)K.writeStringField(3,Me[ee]);var Pe=me.values;for(ee=0;ee<Pe.length;ee++)K.writeMessage(4,Vu,Pe[ee])}function Hd(ye,K){var ee=ye.feature;void 0!==ee.id&&K.writeVarintField(1,ee.id),K.writeMessage(2,Vl,ye),K.writeVarintField(3,ee.type),K.writeMessage(4,Na,ee)}function Vl(ye,K){var ee=ye.feature,me=ye.keys,Me=ye.values,Pe=ye.keycache,Ve=ye.valuecache;for(var Ue in ee.properties){var Oe=ee.properties[Ue],Ke=Pe[Ue];if(null!==Oe){void 0===Ke&&(me.push(Ue),Pe[Ue]=Ke=me.length-1),K.writeVarint(Ke);var St=typeof Oe;"string"!==St&&"boolean"!==St&&"number"!==St&&(Oe=JSON.stringify(Oe));var Vt=St+":"+Oe,Tt=Ve[Vt];void 0===Tt&&(Me.push(Oe),Ve[Vt]=Tt=Me.length-1),K.writeVarint(Tt)}}}function Nn(ye,K){return(K<<3)+(7&ye)}function _o(ye){return ye<<1^ye>>31}function Na(ye,K){for(var ee=ye.loadGeometry(),me=ye.type,Me=0,Pe=0,Ve=ee.length,Ue=0;Ue<Ve;Ue++){var Oe=ee[Ue],Ke=1;1===me&&(Ke=Oe.length),K.writeVarint(Nn(1,Ke));for(var St=3===me?Oe.length-1:Oe.length,Vt=0;Vt<St;Vt++){1===Vt&&1!==me&&K.writeVarint(Nn(2,St-1));var Tt=Oe[Vt].x-Me,$n=Oe[Vt].y-Pe;K.writeVarint(_o(Tt)),K.writeVarint(_o($n)),Me+=Tt,Pe+=$n}3===me&&K.writeVarint(Nn(7,1))}}function Vu(ye,K){var ee=typeof ye;"string"===ee?K.writeStringField(1,ye):"boolean"===ee?K.writeBooleanField(7,ye):"number"===ee&&(ye%1!=0?K.writeDoubleField(3,ye):ye<0?K.writeSVarintField(6,ye):K.writeVarintField(5,ye))}ti.exports=Ys,ti.exports.fromVectorTileJs=Ys,ti.exports.fromGeojsonVt=function(ye,K){K=K||{};var ee={};for(var me in ye)ee[me]=new dl(ye[me].features,K),ee[me].name=me,ee[me].version=K.version,ee[me].extent=K.extent;return Ys({layers:ee})},ti.exports.GeoJSONWrapper=dl;var za=m.getDefaultExportFromCjs(ti.exports);const Ts={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},ni=Math.fround||(hl=new Float32Array(1),ye=>(hl[0]=+ye,hl[0]));var hl;const ii=3,Yr=5,Ba=6;class Ti{constructor(K){this.options=Object.assign(Object.create(Ts),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:ee,minZoom:me,maxZoom:Me}=this.options;ee&&console.time("total time");const Pe=`prepare ${K.length} points`;ee&&console.time(Pe),this.points=K;const Ve=[];for(let Oe=0;Oe<K.length;Oe++){const Ke=K[Oe];if(!Ke.geometry)continue;const[St,Vt]=Ke.geometry.coordinates,Tt=ni(io(St)),$n=ni(Kr(Vt));Ve.push(Tt,$n,1/0,Oe,-1,1),this.options.reduce&&Ve.push(0)}let Ue=this.trees[Me+1]=this._createTree(Ve);ee&&console.timeEnd(Pe);for(let Oe=Me;Oe>=me;Oe--){const Ke=+Date.now();Ue=this.trees[Oe]=this._createTree(this._cluster(Ue,Oe)),ee&&console.log("z%d: %d clusters in %dms",Oe,Ue.numItems,+Date.now()-Ke)}return ee&&console.timeEnd("total time"),this}getClusters(K,ee){let me=((K[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,K[1]));let Pe=180===K[2]?180:((K[2]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)me=-180,Pe=180;else if(me>Pe){const Vt=this.getClusters([me,Me,180,Ve],ee),Tt=this.getClusters([-180,Me,Pe,Ve],ee);return Vt.concat(Tt)}const Ue=this.trees[this._limitZoom(ee)],Oe=Ue.range(io(me),Kr(Ve),io(Pe),Kr(Me)),Ke=Ue.data,St=[];for(const Vt of Oe){const Tt=this.stride*Vt;St.push(Ke[Tt+Yr]>1?as(Ke,Tt,this.clusterProps):this.points[Ke[Tt+ii]])}return St}getChildren(K){const ee=this._getOriginId(K),me=this._getOriginZoom(K),Me="No cluster with the specified id.",Pe=this.trees[me];if(!Pe)throw new Error(Me);const Ve=Pe.data;if(ee*this.stride>=Ve.length)throw new Error(Me);const Ue=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Oe=Pe.within(Ve[ee*this.stride],Ve[ee*this.stride+1],Ue),Ke=[];for(const St of Oe){const Vt=St*this.stride;Ve[Vt+4]===K&&Ke.push(Ve[Vt+Yr]>1?as(Ve,Vt,this.clusterProps):this.points[Ve[Vt+ii]])}if(0===Ke.length)throw new Error(Me);return Ke}getLeaves(K,ee,me){const Me=[];return this._appendLeaves(Me,K,ee=ee||10,me=me||0,0),Me}getTile(K,ee,me){const Me=this.trees[this._limitZoom(K)],Pe=Math.pow(2,K),{extent:Ve,radius:Ue}=this.options,Oe=Ue/Ve,Ke=(me-Oe)/Pe,St=(me+1+Oe)/Pe,Vt={features:[]};return this._addTileFeatures(Me.range((ee-Oe)/Pe,Ke,(ee+1+Oe)/Pe,St),Me.data,ee,me,Pe,Vt),0===ee&&this._addTileFeatures(Me.range(1-Oe/Pe,Ke,1,St),Me.data,Pe,me,Pe,Vt),ee===Pe-1&&this._addTileFeatures(Me.range(0,Ke,Oe/Pe,St),Me.data,-1,me,Pe,Vt),Vt.features.length?Vt:null}getClusterExpansionZoom(K){let ee=this._getOriginZoom(K)-1;for(;ee<=this.options.maxZoom;){const me=this.getChildren(K);if(ee++,1!==me.length)break;K=me[0].properties.cluster_id}return ee}_appendLeaves(K,ee,me,Me,Pe){const Ve=this.getChildren(ee);for(const Ue of Ve){const Oe=Ue.properties;if(Oe&&Oe.cluster?Pe+Oe.point_count<=Me?Pe+=Oe.point_count:Pe=this._appendLeaves(K,Oe.cluster_id,me,Me,Pe):Pe<Me?Pe++:K.push(Ue),K.length===me)break}return Pe}_createTree(K){const ee=new m.KDBush(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<K.length;me+=this.stride)ee.add(K[me],K[me+1]);return ee.finish(),ee.data=K,ee}_addTileFeatures(K,ee,me,Me,Pe,Ve){for(const Ue of K){const Oe=Ue*this.stride,Ke=ee[Oe+Yr]>1;let St,Vt,Tt;if(Ke)St=Yn(ee,Oe,this.clusterProps),Vt=ee[Oe],Tt=ee[Oe+1];else{const Un=this.points[ee[Oe+ii]];St=Un.properties;const[Kn,ri]=Un.geometry.coordinates;Vt=io(Kn),Tt=Kr(ri)}const $n={type:1,geometry:[[Math.round(this.options.extent*(Vt*Pe-me)),Math.round(this.options.extent*(Tt*Pe-Me))]],tags:St};let Fn;Fn=Ke||this.options.generateId?ee[Oe+ii]:this.points[ee[Oe+ii]].id,void 0!==Fn&&($n.id=Fn),Ve.features.push($n)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,ee){const{radius:me,extent:Me,reduce:Pe,minPoints:Ve}=this.options,Ue=me/(Me*Math.pow(2,ee)),Oe=K.data,Ke=[],St=this.stride;for(let Vt=0;Vt<Oe.length;Vt+=St){if(Oe[Vt+2]<=ee)continue;Oe[Vt+2]=ee;const Tt=Oe[Vt],$n=Oe[Vt+1],Fn=K.within(Oe[Vt],Oe[Vt+1],Ue),Un=Oe[Vt+Yr];let Kn=Un;for(const ri of Fn){const Wi=ri*St;Oe[Wi+2]>ee&&(Kn+=Oe[Wi+Yr])}if(Kn>Un&&Kn>=Ve){let ri,Wi=Tt*Un,bi=$n*Un,co=-1;const Nr=((Vt/St|0)<<5)+(ee+1)+this.points.length;for(const ja of Fn){const yo=ja*St;if(Oe[yo+2]<=ee)continue;Oe[yo+2]=ee;const er=Oe[yo+Yr];Wi+=Oe[yo]*er,bi+=Oe[yo+1]*er,Oe[yo+4]=Nr,Pe&&(ri||(ri=this._map(Oe,Vt,!0),co=this.clusterProps.length,this.clusterProps.push(ri)),Pe(ri,this._map(Oe,yo)))}Oe[Vt+4]=Nr,Ke.push(Wi/Kn,bi/Kn,1/0,Nr,-1,Kn),Pe&&Ke.push(co)}else{for(let ri=0;ri<St;ri++)Ke.push(Oe[Vt+ri]);if(Kn>1)for(const ri of Fn){const Wi=ri*St;if(!(Oe[Wi+2]<=ee)){Oe[Wi+2]=ee;for(let bi=0;bi<St;bi++)Ke.push(Oe[Wi+bi])}}}}return Ke}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,ee,me){if(K[ee+Yr]>1){const Ve=this.clusterProps[K[ee+Ba]];return me?Object.assign({},Ve):Ve}const Me=this.points[K[ee+ii]].properties,Pe=this.options.map(Me);return me&&Pe===Me?Object.assign({},Pe):Pe}}function as(ye,K,ee){return{type:"Feature",id:ye[K+ii],properties:Yn(ye,K,ee),geometry:{type:"Point",coordinates:[(me=ye[K],360*(me-.5)),jl(ye[K+1])]}};var me}function Yn(ye,K,ee){const me=ye[K+Yr],Me=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Pe=ye[K+Ba],Ve=-1===Pe?{}:Object.assign({},ee[Pe]);return Object.assign(Ve,{cluster:!0,cluster_id:ye[K+ii],point_count:me,point_count_abbreviated:Me})}function io(ye){return ye/360+.5}function Kr(ye){const K=Math.sin(ye*Math.PI/180),ee=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return ee<0?0:ee>1?1:ee}function jl(ye){const K=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function hi(ye,K,ee,me){for(var Me,Pe=me,Ve=ee-K>>1,Ue=ee-K,Oe=ye[K],Ke=ye[K+1],St=ye[ee],Vt=ye[ee+1],Tt=K+3;Tt<ee;Tt+=3){var $n=yn(ye[Tt],ye[Tt+1],Oe,Ke,St,Vt);if($n>Pe)Me=Tt,Pe=$n;else if($n===Pe){var Fn=Math.abs(Tt-Ve);Fn<Ue&&(Me=Tt,Ue=Fn)}}Pe>me&&(Me-K>3&&hi(ye,K,Me,me),ye[Me+2]=Pe,ee-Me>3&&hi(ye,Me,ee,me))}function yn(ye,K,ee,me,Me,Pe){var Ve=Me-ee,Ue=Pe-me;if(0!==Ve||0!==Ue){var Oe=((ye-ee)*Ve+(K-me)*Ue)/(Ve*Ve+Ue*Ue);Oe>1?(ee=Me,me=Pe):Oe>0&&(ee+=Ve*Oe,me+=Ue*Oe)}return(Ve=ye-ee)*Ve+(Ue=K-me)*Ue}function fi(ye,K,ee,me){var Me={id:void 0===ye?null:ye,type:K,geometry:ee,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pe){var Ve=Pe.geometry,Ue=Pe.type;if("Point"===Ue||"MultiPoint"===Ue||"LineString"===Ue)pi(Pe,Ve);else if("Polygon"===Ue||"MultiLineString"===Ue)for(var Oe=0;Oe<Ve.length;Oe++)pi(Pe,Ve[Oe]);else if("MultiPolygon"===Ue)for(Oe=0;Oe<Ve.length;Oe++)for(var Ke=0;Ke<Ve[Oe].length;Ke++)pi(Pe,Ve[Oe][Ke])}(Me),Me}function pi(ye,K){for(var ee=0;ee<K.length;ee+=3)ye.minX=Math.min(ye.minX,K[ee]),ye.minY=Math.min(ye.minY,K[ee+1]),ye.maxX=Math.max(ye.maxX,K[ee]),ye.maxY=Math.max(ye.maxY,K[ee+1])}function Go(ye,K,ee,me){if(K.geometry){var Me=K.geometry.coordinates,Pe=K.geometry.type,Ve=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2),Ue=[],Oe=K.id;if(ee.promoteId?Oe=K.properties[ee.promoteId]:ee.generateId&&(Oe=me||0),"Point"===Pe)fl(Me,Ue);else if("MultiPoint"===Pe)for(var Ke=0;Ke<Me.length;Ke++)fl(Me[Ke],Ue);else if("LineString"===Pe)_r(Me,Ue,Ve,!1);else if("MultiLineString"===Pe){if(ee.lineMetrics){for(Ke=0;Ke<Me.length;Ke++)_r(Me[Ke],Ue=[],Ve,!1),ye.push(fi(Oe,"LineString",Ue,K.properties));return}wi(Me,Ue,Ve,!1)}else if("Polygon"===Pe)wi(Me,Ue,Ve,!0);else{if("MultiPolygon"!==Pe){if("GeometryCollection"===Pe){for(Ke=0;Ke<K.geometry.geometries.length;Ke++)Go(ye,{id:Oe,geometry:K.geometry.geometries[Ke],properties:K.properties},ee,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ke=0;Ke<Me.length;Ke++){var St=[];wi(Me[Ke],St,Ve,!0),Ue.push(St)}}ye.push(fi(Oe,Pe,Ue,K.properties))}}function fl(ye,K){K.push(Ua(ye[0])),K.push(pl(ye[1])),K.push(0)}function _r(ye,K,ee,me){for(var Me,Pe,Ve=0,Ue=0;Ue<ye.length;Ue++){var Oe=Ua(ye[Ue][0]),Ke=pl(ye[Ue][1]);K.push(Oe),K.push(Ke),K.push(0),Ue>0&&(Ve+=me?(Me*Ke-Oe*Pe)/2:Math.sqrt(Math.pow(Oe-Me,2)+Math.pow(Ke-Pe,2))),Me=Oe,Pe=Ke}var St=K.length-3;K[2]=1,hi(K,0,St,ee),K[St+2]=1,K.size=Math.abs(Ve),K.start=0,K.end=K.size}function wi(ye,K,ee,me){for(var Me=0;Me<ye.length;Me++){var Pe=[];_r(ye[Me],Pe,ee,me),K.push(Pe)}}function Ua(ye){return ye/360+.5}function pl(ye){var K=Math.sin(ye*Math.PI/180),ee=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return ee<0?0:ee>1?1:ee}function Ks(ye,K,ee,me,Me,Pe,Ve,Ue){if(me/=K,Pe>=(ee/=K)&&Ve<me)return ye;if(Ve<ee||Pe>=me)return null;for(var Oe=[],Ke=0;Ke<ye.length;Ke++){var St=ye[Ke],Vt=St.geometry,Tt=St.type,$n=0===Me?St.minX:St.minY,Fn=0===Me?St.maxX:St.maxY;if($n>=ee&&Fn<me)Oe.push(St);else if(!(Fn<ee||$n>=me)){var Un=[];if("Point"===Tt||"MultiPoint"===Tt)Ea(Vt,Un,ee,me,Me);else if("LineString"===Tt)ju(Vt,Un,ee,me,Me,!1,Ue.lineMetrics);else if("MultiLineString"===Tt)ml(Vt,Un,ee,me,Me,!1);else if("Polygon"===Tt)ml(Vt,Un,ee,me,Me,!0);else if("MultiPolygon"===Tt)for(var Kn=0;Kn<Vt.length;Kn++){var ri=[];ml(Vt[Kn],ri,ee,me,Me,!0),ri.length&&Un.push(ri)}if(Un.length){if(Ue.lineMetrics&&"LineString"===Tt){for(Kn=0;Kn<Un.length;Kn++)Oe.push(fi(St.id,Tt,Un[Kn],St.tags));continue}"LineString"!==Tt&&"MultiLineString"!==Tt||(1===Un.length?(Tt="LineString",Un=Un[0]):Tt="MultiLineString"),"Point"!==Tt&&"MultiPoint"!==Tt||(Tt=3===Un.length?"Point":"MultiPoint"),Oe.push(fi(St.id,Tt,Un,St.tags))}}}return Oe.length?Oe:null}function Ea(ye,K,ee,me,Me){for(var Pe=0;Pe<ye.length;Pe+=3){var Ve=ye[Pe+Me];Ve>=ee&&Ve<=me&&(K.push(ye[Pe]),K.push(ye[Pe+1]),K.push(ye[Pe+2]))}}function ju(ye,K,ee,me,Me,Pe,Ve){for(var Ue,Oe,Ke=Gd(ye),St=0===Me?$u:Qs,Vt=ye.start,Tt=0;Tt<ye.length-3;Tt+=3){var $n=ye[Tt],Fn=ye[Tt+1],Un=ye[Tt+2],Kn=ye[Tt+3],ri=ye[Tt+4],Wi=0===Me?$n:Fn,bi=0===Me?Kn:ri,co=!1;Ve&&(Ue=Math.sqrt(Math.pow($n-Kn,2)+Math.pow(Fn-ri,2))),Wi<ee?bi>ee&&(Oe=St(Ke,$n,Fn,Kn,ri,ee),Ve&&(Ke.start=Vt+Ue*Oe)):Wi>me?bi<me&&(Oe=St(Ke,$n,Fn,Kn,ri,me),Ve&&(Ke.start=Vt+Ue*Oe)):Va(Ke,$n,Fn,Un),bi<ee&&Wi>=ee&&(Oe=St(Ke,$n,Fn,Kn,ri,ee),co=!0),bi>me&&Wi<=me&&(Oe=St(Ke,$n,Fn,Kn,ri,me),co=!0),!Pe&&co&&(Ve&&(Ke.end=Vt+Ue*Oe),K.push(Ke),Ke=Gd(ye)),Ve&&(Vt+=Ue)}var Nr=ye.length-3;$n=ye[Nr],Fn=ye[Nr+1],Un=ye[Nr+2],(Wi=0===Me?$n:Fn)>=ee&&Wi<=me&&Va(Ke,$n,Fn,Un),Nr=Ke.length-3,Pe&&Nr>=3&&(Ke[Nr]!==Ke[0]||Ke[Nr+1]!==Ke[1])&&Va(Ke,Ke[0],Ke[1],Ke[2]),Ke.length&&K.push(Ke)}function Gd(ye){var K=[];return K.size=ye.size,K.start=ye.start,K.end=ye.end,K}function ml(ye,K,ee,me,Me,Pe){for(var Ve=0;Ve<ye.length;Ve++)ju(ye[Ve],K,ee,me,Me,Pe,!1)}function Va(ye,K,ee,me){ye.push(K),ye.push(ee),ye.push(me)}function $u(ye,K,ee,me,Me,Pe){var Ve=(Pe-K)/(me-K);return ye.push(Pe),ye.push(ee+(Me-ee)*Ve),ye.push(1),Ve}function Qs(ye,K,ee,me,Me,Pe){var Ve=(Pe-ee)/(Me-ee);return ye.push(K+(me-K)*Ve),ye.push(Pe),ye.push(1),Ve}function ls(ye,K){for(var ee=[],me=0;me<ye.length;me++){var Me,Pe=ye[me],Ve=Pe.type;if("Point"===Ve||"MultiPoint"===Ve||"LineString"===Ve)Me=Ds(Pe.geometry,K);else if("MultiLineString"===Ve||"Polygon"===Ve){Me=[];for(var Ue=0;Ue<Pe.geometry.length;Ue++)Me.push(Ds(Pe.geometry[Ue],K))}else if("MultiPolygon"===Ve)for(Me=[],Ue=0;Ue<Pe.geometry.length;Ue++){for(var Oe=[],Ke=0;Ke<Pe.geometry[Ue].length;Ke++)Oe.push(Ds(Pe.geometry[Ue][Ke],K));Me.push(Oe)}ee.push(fi(Pe.id,Ve,Me,Pe.tags))}return ee}function Ds(ye,K){var ee=[];ee.size=ye.size,void 0!==ye.start&&(ee.start=ye.start,ee.end=ye.end);for(var me=0;me<ye.length;me+=3)ee.push(ye[me]+K,ye[me+1],ye[me+2]);return ee}function $l(ye,K){if(ye.transformed)return ye;var ee,me,Me,Pe=1<<ye.z,Ve=ye.x,Ue=ye.y;for(ee=0;ee<ye.features.length;ee++){var Oe=ye.features[ee],Ke=Oe.geometry,St=Oe.type;if(Oe.geometry=[],1===St)for(me=0;me<Ke.length;me+=2)Oe.geometry.push(Ca(Ke[me],Ke[me+1],K,Pe,Ve,Ue));else for(me=0;me<Ke.length;me++){var Vt=[];for(Me=0;Me<Ke[me].length;Me+=2)Vt.push(Ca(Ke[me][Me],Ke[me][Me+1],K,Pe,Ve,Ue));Oe.geometry.push(Vt)}}return ye.transformed=!0,ye}function Ca(ye,K,ee,me,Me,Pe){return[Math.round(ee*(ye*me-Me)),Math.round(ee*(K*me-Pe))]}function gl(ye,K,ee,me,Me){for(var Pe=K===Me.maxZoom?0:Me.tolerance/((1<<K)*Me.extent),Ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ee,y:me,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ue=0;Ue<ye.length;Ue++){Ve.numFeatures++,Hl(Ve,ye[Ue],Pe,Me);var Oe=ye[Ue].minX,Ke=ye[Ue].minY,St=ye[Ue].maxX,Vt=ye[Ue].maxY;Oe<Ve.minX&&(Ve.minX=Oe),Ke<Ve.minY&&(Ve.minY=Ke),St>Ve.maxX&&(Ve.maxX=St),Vt>Ve.maxY&&(Ve.maxY=Vt)}return Ve}function Hl(ye,K,ee,me){var Me=K.geometry,Pe=K.type,Ve=[];if("Point"===Pe||"MultiPoint"===Pe)for(var Ue=0;Ue<Me.length;Ue+=3)Ve.push(Me[Ue]),Ve.push(Me[Ue+1]),ye.numPoints++,ye.numSimplified++;else if("LineString"===Pe)Co(Ve,Me,ye,ee,!1,!1);else if("MultiLineString"===Pe||"Polygon"===Pe)for(Ue=0;Ue<Me.length;Ue++)Co(Ve,Me[Ue],ye,ee,"Polygon"===Pe,0===Ue);else if("MultiPolygon"===Pe)for(var Oe=0;Oe<Me.length;Oe++){var Ke=Me[Oe];for(Ue=0;Ue<Ke.length;Ue++)Co(Ve,Ke[Ue],ye,ee,!0,0===Ue)}if(Ve.length){var St=K.tags||null;if("LineString"===Pe&&me.lineMetrics){for(var Vt in St={},K.tags)St[Vt]=K.tags[Vt];St.mapbox_clip_start=Me.start/Me.size,St.mapbox_clip_end=Me.end/Me.size}var Tt={geometry:Ve,type:"Polygon"===Pe||"MultiPolygon"===Pe?3:"LineString"===Pe||"MultiLineString"===Pe?2:1,tags:St};null!==K.id&&(Tt.id=K.id),ye.features.push(Tt)}}function Co(ye,K,ee,me,Me,Pe){var Ve=me*me;if(me>0&&K.size<(Me?Ve:me))ee.numPoints+=K.length/3;else{for(var Ue=[],Oe=0;Oe<K.length;Oe+=3)(0===me||K[Oe+2]>Ve)&&(ee.numSimplified++,Ue.push(K[Oe]),Ue.push(K[Oe+1])),ee.numPoints++;Me&&function(Ke,St){for(var Vt=0,Tt=0,$n=Ke.length,Fn=$n-2;Tt<$n;Fn=Tt,Tt+=2)Vt+=(Ke[Tt]-Ke[Fn])*(Ke[Tt+1]+Ke[Fn+1]);if(Vt>0===St)for(Tt=0,$n=Ke.length;Tt<$n/2;Tt+=2){var Un=Ke[Tt],Kn=Ke[Tt+1];Ke[Tt]=Ke[$n-2-Tt],Ke[Tt+1]=Ke[$n-1-Tt],Ke[$n-2-Tt]=Un,Ke[$n-1-Tt]=Kn}}(Ue,Pe),ye.push(Ue)}}function _l(ye,K){var ee=(K=this.options=function(Me,Pe){for(var Ve in Pe)Me[Ve]=Pe[Ve];return Me}(Object.create(this.options),K)).debug;if(ee&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");var Me,Pe,Ve,Ue,Oe,Ke,me=function(Me,Pe){var Ve=[];if("FeatureCollection"===Me.type)for(var Ue=0;Ue<Me.features.length;Ue++)Go(Ve,Me.features[Ue],Pe,Ue);else Go(Ve,"Feature"===Me.type?Me:{geometry:Me},Pe);return Ve}(ye,K);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ue=Me=me,Oe=Ks(Me,1,-1-(Ve=(Pe=K).buffer/Pe.extent),Ve,0,-1,2,Pe),Ke=Ks(Me,1,1-Ve,2+Ve,0,-1,2,Pe),(Oe||Ke)&&(Ue=Ks(Me,1,-Ve,1+Ve,0,-1,2,Pe)||[],Oe&&(Ue=ls(Oe,1).concat(Ue)),Ke&&(Ue=Ue.concat(ls(Ke,-1)))),(me=Ue).length&&this.splitTile(me,0,0,0),ee&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _c(ye,K,ee){return 32*((1<<ye)*ee+K)+ye}function Ss(ye,K){const ee=ye.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);const me=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!me)return K(null,null);const Me=new class{constructor(Ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=Ve.length,this._features=Ve}feature(Ve){return new class{constructor(Ue){this._feature=Ue,this.extent=m.EXTENT,this.type=Ue.type,this.properties=Ue.tags,"id"in Ue&&!isNaN(Ue.id)&&(this.id=parseInt(Ue.id,10))}loadGeometry(){if(1===this._feature.type){const Ue=[];for(const Oe of this._feature.geometry)Ue.push([new m.Point(Oe[0],Oe[1])]);return Ue}{const Ue=[];for(const Oe of this._feature.geometry){const Ke=[];for(const St of Oe)Ke.push(new m.Point(St[0],St[1]));Ue.push(Ke)}return Ue}}toGeoJSON(Ue,Oe,Ke){return _n.call(this,Ue,Oe,Ke)}}(this._features[Ve])}}(me.features);let Pe=za(Me);0===Pe.byteOffset&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),K(null,{vectorTile:Me,rawData:Pe.buffer})}_l.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_l.prototype.splitTile=function(ye,K,ee,me,Me,Pe,Ve){for(var Ue=[ye,K,ee,me],Oe=this.options,Ke=Oe.debug;Ue.length;){me=Ue.pop(),ee=Ue.pop(),K=Ue.pop(),ye=Ue.pop();var St=1<<K,Vt=_c(K,ee,me),Tt=this.tiles[Vt];if(!Tt&&(Ke>1&&console.time("creation"),Tt=this.tiles[Vt]=gl(ye,K,ee,me,Oe),this.tileCoords.push({z:K,x:ee,y:me}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ee,me,Tt.numFeatures,Tt.numPoints,Tt.numSimplified),console.timeEnd("creation"));var $n="z"+K;this.stats[$n]=(this.stats[$n]||0)+1,this.total++}if(Tt.source=ye,Me){if(K===Oe.maxZoom||K===Me)continue;var Fn=1<<Me-K;if(ee!==Math.floor(Pe/Fn)||me!==Math.floor(Ve/Fn))continue}else if(K===Oe.indexMaxZoom||Tt.numPoints<=Oe.indexMaxPoints)continue;if(Tt.source=null,0!==ye.length){Ke>1&&console.time("clipping");var Un,Kn,ri,Wi,bi,co,Nr=.5*Oe.buffer/Oe.extent,ja=.5-Nr,yo=.5+Nr,er=1+Nr;Un=Kn=ri=Wi=null,bi=Ks(ye,St,ee-Nr,ee+yo,0,Tt.minX,Tt.maxX,Oe),co=Ks(ye,St,ee+ja,ee+er,0,Tt.minX,Tt.maxX,Oe),ye=null,bi&&(Un=Ks(bi,St,me-Nr,me+yo,1,Tt.minY,Tt.maxY,Oe),Kn=Ks(bi,St,me+ja,me+er,1,Tt.minY,Tt.maxY,Oe),bi=null),co&&(ri=Ks(co,St,me-Nr,me+yo,1,Tt.minY,Tt.maxY,Oe),Wi=Ks(co,St,me+ja,me+er,1,Tt.minY,Tt.maxY,Oe),co=null),Ke>1&&console.timeEnd("clipping"),Ue.push(Un||[],K+1,2*ee,2*me),Ue.push(Kn||[],K+1,2*ee,2*me+1),Ue.push(ri||[],K+1,2*ee+1,2*me),Ue.push(Wi||[],K+1,2*ee+1,2*me+1)}}},_l.prototype.getTile=function(ye,K,ee){var me=this.options,Me=me.extent,Pe=me.debug;if(ye<0||ye>24)return null;var Ve=1<<ye,Ue=_c(ye,K=(K%Ve+Ve)%Ve,ee);if(this.tiles[Ue])return $l(this.tiles[Ue],Me);Pe>1&&console.log("drilling down to z%d-%d-%d",ye,K,ee);for(var Oe,Ke=ye,St=K,Vt=ee;!Oe&&Ke>0;)Ke--,St=Math.floor(St/2),Vt=Math.floor(Vt/2),Oe=this.tiles[_c(Ke,St,Vt)];return Oe&&Oe.source?(Pe>1&&console.log("found parent tile z%d-%d-%d",Ke,St,Vt),Pe>1&&console.time("drilling down"),this.splitTile(Oe.source,Ke,St,Vt,ye,K,ee),Pe>1&&console.timeEnd("drilling down"),this.tiles[Ue]?$l(this.tiles[Ue],Me):null):null};class eu extends m.VectorTileWorkerSource{constructor(K,ee,me,Me,Pe){super(K,ee,me,Me,Ss),Pe&&(this.loadGeoJSON=Pe)}loadData(K,ee){const me=K&&K.request,Me=me&&me.collectResourceTiming;this.loadGeoJSON(K,(Pe,Ve)=>{if(Pe||!Ve)return ee(Pe);if("object"!=typeof Ve)return ee(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));{hr(Ve,!0);try{if(K.filter){const Oe=m.createExpression(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Oe.result)throw new Error(Oe.value.map(St=>`${St.key}: ${St.message}`).join(", "));Ve={type:"FeatureCollection",features:Ve.features.filter(St=>Oe.value.evaluate({zoom:0},St))}}this._geoJSONIndex=K.cluster?new Ti(function({superclusterOptions:Oe,clusterProperties:Ke}){if(!Ke||!Oe)return Oe;const St={},Vt={},Tt={accumulated:null,zoom:0},$n={properties:null},Fn=Object.keys(Ke);for(const Un of Fn){const[Kn,ri]=Ke[Un],Wi=m.createExpression(ri),bi=m.createExpression("string"==typeof Kn?[Kn,["accumulated"],["get",Un]]:Kn);St[Un]=Wi.value,Vt[Un]=bi.value}return Oe.map=Un=>{$n.properties=Un;const Kn={};for(const ri of Fn)Kn[ri]=St[ri].evaluate(Tt,$n);return Kn},Oe.reduce=(Un,Kn)=>{$n.properties=Kn;for(const ri of Fn)Tt.accumulated=Un[ri],Un[ri]=Vt[ri].evaluate(Tt,$n)},Oe}(K)).load(Ve.features):new _l(Oe=Ve,K.geojsonVtOptions)}catch(Oe){return ee(Oe)}this.loaded={};const Ue={};if(Me){const Oe=m.getPerformanceMeasurement(me);Oe&&(Ue.resourceTiming={},Ue.resourceTiming[K.source]=JSON.parse(JSON.stringify(Oe)))}ee(null,Ue)}var Oe})}reloadTile(K,ee){const me=this.loaded;return me&&me[K.uid]?super.reloadTile(K,ee):this.loadTile(K,ee)}loadGeoJSON(K,ee){if(K.request)m.getJSON(K.request,ee);else{if("string"!=typeof K.data)return ee(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));try{return ee(null,JSON.parse(K.data))}catch{return ee(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(K,ee){try{ee(null,this._geoJSONIndex.getClusterExpansionZoom(K.clusterId))}catch(me){ee(me)}}getClusterChildren(K,ee){try{ee(null,this._geoJSONIndex.getChildren(K.clusterId))}catch(me){ee(me)}}getClusterLeaves(K,ee){try{ee(null,this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset))}catch(me){ee(me)}}}class tu{constructor(K){this.self=K,this.actor=new m.Actor(K,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=m.getProjection({name:"mercator"}),this.workerSourceTypes={vector:m.VectorTileWorkerSource,geojson:eu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ee,me)=>{if(this.workerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.workerSourceTypes[ee]=me},this.self.registerRTLTextPlugin=ee=>{if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=ee.applyArabicShaping,m.plugin.processBidirectionalText=ee.processBidirectionalText,m.plugin.processStyledBidirectionalText=ee.processStyledBidirectionalText}}clearCaches(K,ee,me){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K],me()}checkIfReady(K,ee,me){me()}setReferrer(K,ee){this.referrer=ee}spriteLoaded(K,ee){this.isSpriteLoaded[K]=ee;for(const me in this.workerSources[K]){const Me=this.workerSources[K][me];for(const Pe in Me)Me[Pe]instanceof m.VectorTileWorkerSource&&(Me[Pe].isSpriteLoaded=ee,Me[Pe].fire(new m.Event("isSpriteLoaded")))}}setImages(K,ee,me){this.availableImages[K]=ee;for(const Me in this.workerSources[K]){const Pe=this.workerSources[K][Me];for(const Ve in Pe)Pe[Ve].availableImages=ee}me()}enableTerrain(K,ee,me){this.terrain=ee,me()}setProjection(K,ee){this.projections[K]=m.getProjection(ee)}setLayers(K,ee,me){this.getLayerIndex(K).replace(ee),me()}updateLayers(K,ee,me){this.getLayerIndex(K).update(ee.layers,ee.removedIds),me()}loadTile(K,ee,me){const Me=this.enableTerrain?m.extend({enableTerrain:this.terrain},ee):ee;Me.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,ee.type,ee.source).loadTile(Me,me)}loadDEMTile(K,ee,me){const Me=this.enableTerrain?m.extend({buildQuadTree:this.terrain},ee):ee;this.getDEMWorkerSource(K,ee.source).loadTile(Me,me)}reloadTile(K,ee,me){const Me=this.enableTerrain?m.extend({enableTerrain:this.terrain},ee):ee;Me.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,ee.type,ee.source).reloadTile(Me,me)}abortTile(K,ee,me){this.getWorkerSource(K,ee.type,ee.source).abortTile(ee,me)}removeTile(K,ee,me){this.getWorkerSource(K,ee.type,ee.source).removeTile(ee,me)}removeSource(K,ee,me){if(!this.workerSources[K]||!this.workerSources[K][ee.type]||!this.workerSources[K][ee.type][ee.source])return;const Me=this.workerSources[K][ee.type][ee.source];delete this.workerSources[K][ee.type][ee.source],void 0!==Me.removeSource?Me.removeSource(ee,me):me()}loadWorkerSource(K,ee,me){try{this.self.importScripts(ee.url),me()}catch(Me){me(Me.toString())}}syncRTLPluginState(K,ee,me){try{m.plugin.setState(ee);const Me=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&null!=Me){this.self.importScripts(Me);const Pe=m.plugin.isParsed();me(Pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Me}`),Pe)}}catch(Me){me(Me.toString())}}getAvailableImages(K){let ee=this.availableImages[K];return ee||(ee=[]),ee}getLayerIndex(K){let ee=this.layerIndexes[K];return ee||(ee=this.layerIndexes[K]=new ss),ee}getWorkerSource(K,ee,me){return this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][ee]||(this.workerSources[K][ee]={}),this.workerSources[K][ee][me]||(this.workerSources[K][ee][me]=new this.workerSourceTypes[ee]({send:(Pe,Ve,Ue,Oe,Ke,St)=>{this.actor.send(Pe,Ve,Ue,K,Ke,St)},scheduler:this.actor.scheduler},this.getLayerIndex(K),this.getAvailableImages(K),this.isSpriteLoaded[K])),this.workerSources[K][ee][me]}getDEMWorkerSource(K,ee){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][ee]||(this.demWorkerSources[K][ee]=new An),this.demWorkerSources[K][ee]}enforceCacheSizeLimit(K,ee){m.enforceCacheSizeLimit(ee)}getWorkerPerformanceMetrics(K,ee,me){me(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new tu(self)),tu}),Uu(0,function(m){function pt(_,c){if(Array.isArray(_)){if(!Array.isArray(c)||_.length!==c.length)return!1;for(let f=0;f<_.length;f++)if(!pt(_[f],c[f]))return!1;return!0}if("object"==typeof _&&null!==_&&null!==c){if("object"!=typeof c||Object.keys(_).length!==Object.keys(c).length)return!1;for(const f in _)if(!pt(_[f],c[f]))return!1;return!0}return _===c}var Xs=ss;function ss(_){return c=_,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,M=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(M);try{w=new Worker(I),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(I),v}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var M=w.getImageData(0,0,1,1);return M&&M.width===v.width}()||(void 0===An[f=c&&c.failIfMajorPerformanceCaveat]&&(An[f]=function(v){var w,I,k,L,M=(I=v,k=document.createElement("canvas"),(L=Object.create(ss.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,k.getContext("webgl",L)||k.getContext("experimental-webgl",L));if(!M)return!1;try{w=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!w||M.isContextLost())&&(M.shaderSource(w,"void main() {}"),M.compileShader(w),!0===M.getShaderParameter(w,M.COMPILE_STATUS))}(f)),!An[f]||document.documentMode));var c,f}var An={};function Pn(_,c,f){const v=m.window.document.createElement(_);return void 0!==c&&(v.className=c),f&&f.appendChild(v),v}function di(_,c,f){const v=m.window.document.createElementNS("http://www.w3.org/2000/svg",_);for(const w of Object.keys(c))v.setAttributeNS(null,w,c[w]);return f&&f.appendChild(v),v}ss.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const hr=m.window.document&&m.window.document.documentElement.style,_n=hr&&void 0!==hr.userSelect?"userSelect":"WebkitUserSelect";let ti;function Eo(){hr&&_n&&(ti=hr[_n],hr[_n]="none")}function Ul(){hr&&_n&&(hr[_n]=ti)}function fr(_){_.preventDefault(),_.stopPropagation(),m.window.removeEventListener("click",fr,!0)}function rr(){m.window.addEventListener("click",fr,!0),m.window.setTimeout(()=>{m.window.removeEventListener("click",fr,!0)},0)}function Ho(_,c){const f=_.getBoundingClientRect();return Ys(_,f,c)}function ul(_,c){const f=_.getBoundingClientRect(),v=[];for(let w=0;w<c.length;w++)v.push(Ys(_,f,c[w]));return v}function dl(_){return void 0!==m.window.InstallTrigger&&2===_.button&&_.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function Ys(_,c,f){const v=_.offsetWidth===c.width?1:_.offsetWidth/c.width;return new m.Point((f.clientX-c.left)*v,(f.clientY-c.top)*v)}function Gt(_,c){var f=c[0],v=c[1],w=c[2],M=c[3],I=f*M-w*v;return I?(_[0]=M*(I=1/I),_[1]=-v*I,_[2]=-w*I,_[3]=f*I,_):null}function Hd(_){const{userImage:c}=_;return!!(c&&c.render&&c.render())&&(_.data.replace(new Uint8Array(c.data.buffer)),!0)}class Vl extends m.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:f,callback:v}of this.requestors)this._notify(f,v);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,f){this._validate(c,f)&&(this.images[c]=f)}_validate(c,f){let v=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new m.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new m.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new m.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),v=!1),v}_validateStretch(c,f){if(!c)return!0;let v=0;for(const w of c){if(w[0]<v||w[1]<w[0]||f<w[1])return!1;v=w[1]}return!0}_validateContent(c,f){return!(c&&(4!==c.length||c[0]<0||f.data.width<c[0]||c[1]<0||f.data.height<c[1]||c[2]<0||f.data.width<c[2]||c[3]<0||f.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,f){f.version=this.images[c].version+1,this.images[c]=f,this.updatedImages[c]=!0}removeImage(c){const f=this.images[c];delete this.images[c],delete this.patterns[c],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,f){let v=!0;if(!this.isLoaded())for(const w of c)this.images[w]||(v=!1);this.isLoaded()||v?this._notify(c,f):this.requestors.push({ids:c,callback:f})}_notify(c,f){const v={};for(const w of c){this.images[w]||this.fire(new m.Event("styleimagemissing",{id:w}));const M=this.images[w];M?v[w]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!(!M.userImage||!M.userImage.render)}:m.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,v)}getPixelSize(){const{width:c,height:f}=this.atlasImage;return{width:c,height:f}}getPattern(c){const f=this.patterns[c],v=this.getImage(c);if(!v)return null;if(f&&f.position.version===v.version)return f.position;if(f)f.position.version=v.version;else{const w={w:v.data.width+2,h:v.data.height+2,x:0,y:0},M=new m.ImagePosition(w,v);this.patterns[c]={bin:w,position:M}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const f=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,f.RGBA),this.atlasTexture&&this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const M in this.patterns)c.push(this.patterns[M].bin);const{w:f,h:v}=m.potpack(c),w=this.atlasImage;w.resize({width:f||1,height:v||1});for(const M in this.patterns){const{bin:I}=this.patterns[M],k=I.x+1,L=I.y+1,V=this.images[M].data,U=V.width,q=V.height;m.RGBAImage.copy(V,w,{x:0,y:0},{x:k,y:L},{width:U,height:q}),m.RGBAImage.copy(V,w,{x:0,y:q-1},{x:k,y:L-1},{width:U,height:1}),m.RGBAImage.copy(V,w,{x:0,y:0},{x:k,y:L+q},{width:U,height:1}),m.RGBAImage.copy(V,w,{x:U-1,y:0},{x:k-1,y:L},{width:1,height:q}),m.RGBAImage.copy(V,w,{x:0,y:0},{x:k+U,y:L},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const f of c){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const v=this.images[f];Hd(v)&&this.updateImage(f,v)}}}const Nn=new m.Properties({anchor:new m.DataConstantProperty(m.spec.light.anchor),position:new class{constructor(){this.specification=m.spec.light.position}possiblyEvaluate(_,c){return function([f,v,w]){const M=m.degToRad(v+90),I=m.degToRad(w);return{x:f*Math.cos(M)*Math.sin(I),y:f*Math.sin(M)*Math.sin(I),z:f*Math.cos(I),azimuthal:v,polar:w}}(_.expression.evaluate(c))}interpolate(_,c,f){return{x:m.number(_.x,c.x,f),y:m.number(_.y,c.y,f),z:m.number(_.z,c.z,f),azimuthal:m.number(_.azimuthal,c.azimuthal,f),polar:m.number(_.polar,c.polar,f)}}},color:new m.DataConstantProperty(m.spec.light.color),intensity:new m.DataConstantProperty(m.spec.light.intensity)});class _o extends m.Evented{constructor(c){super(),this._transitionable=new m.Transitionable(Nn),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,f={}){if(!this._validate(m.validateLight,c,f))for(const v in c){const w=c[v];m.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),w):this._transitionable.setValue(v,w)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,f,v){return(!v||!1!==v.validate)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:m.spec})))}}const Na=new m.Properties({source:new m.DataConstantProperty(m.spec.terrain.source),exaggeration:new m.DataConstantProperty(m.spec.terrain.exaggeration)});let Vu=class extends m.Evented{constructor(_,c){super(),this._transitionable=new m.Transitionable(Na),this.set(_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(_){for(const c in _){const f=_[c];m.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),f):this._transitionable.setValue(c,f)}}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}};function za(_,c,f,v){const w=m.smoothstep(45,65,f),[M,I]=Ts(_,v),k=m.length(c);let L=1-Math.min(1,Math.exp((k-M)/(I-M)*-6));return L*=L*L,L=Math.min(1,1.00747*L),L*w*_.alpha}function Ts(_,c){const f=.5/Math.tan(.5*c);return[_.range[0]+f,_.range[1]+f]}const ni=new m.Properties({range:new m.DataConstantProperty(m.spec.fog.range),color:new m.DataConstantProperty(m.spec.fog.color),"high-color":new m.DataConstantProperty(m.spec.fog["high-color"]),"space-color":new m.DataConstantProperty(m.spec.fog["space-color"]),"horizon-blend":new m.DataConstantProperty(m.spec.fog["horizon-blend"]),"star-intensity":new m.DataConstantProperty(m.spec.fog["star-intensity"])});class hl extends m.Evented{constructor(c,f){super(),this._transitionable=new m.Transitionable(ni),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const c=this._transform,f="globe"===c.projection.name,v=m.globeToMercatorTransition(c.zoom),w=this.properties.get("range"),M=[.5,3];return{range:f?[m.number(M[0],w[0],v),m.number(M[1],w[1],v)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,f={}){if(!this._validate(m.validateFog,c,f)){for(const v of Object.keys(m.spec.fog))c&&void 0===c[v]&&(c[v]=m.spec.fog[v].default);for(const v in c){const w=c[v];m.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),w):this._transitionable.setValue(v,w)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:m.smoothstep(45,65,c))*f.a}getOpacityAtLatLng(c,f){return this._transform.projection.supportsFog?function(v,w,M){const I=m.MercatorCoordinate.fromLngLat(w),k=M.elevation?M.elevation.getAtPointOrZero(I):0,L=[I.x,I.y,k];return m.transformMat4(L,L,M.mercatorFogMatrix),za(v,L,M.pitch,M._fov)}(this.state,c,f):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Ts(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,f,v){return(!v||!1!==v.validate)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:m.spec})))}}class ii{constructor(c,f){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=m.uniqueId();const v=this.workerPool.acquire(this.id);for(let w=0;w<v.length;w++){const M=new ii.Actor(v[w],f,this.id);M.name=`Worker ${w}`,this.actors.push(M)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,f,v){m.asyncAll(this.actors,(w,M)=>{w.send(c,f,M)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Yr(_,c,f){return c*(m.EXTENT/(_.tileSize*Math.pow(2,f-_.tileID.overscaledZ)))}ii.Actor=m.Actor;class Ba{constructor(c,f,v,w){this.screenBounds=c,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(c,f){let v,w;if(c instanceof m.Point||"number"==typeof c[0]){const M=m.Point.convert(c);v=[M],w=f.isPointAboveHorizon(M)}else{const M=m.Point.convert(c[0]),I=m.Point.convert(c[1]);v=[M,I],w=m.polygonizeBounds(M,I).every(k=>f.isPointAboveHorizon(k))}return new Ba(v,f.getCameraPoint(),w,f)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return m.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const f=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new m.Point(1,1)):this.screenBounds[1],w=m.polygonizeBounds(f,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<v.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?w[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(w[3]=this.cameraPoint)),m.bufferConvexPolygon(w,c)}bufferedCameraGeometryGlobe(c){const f=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new m.Point(1,1)):this.screenBounds[1],w=m.polygonizeBounds(f,v,c),M=this.cameraPoint.clone();switch(3*((M.y>f.y)+(M.y>v.y))+((M.x>f.x)+(M.x>v.x))){case 0:w[0]=M,w[4]=M.clone();break;case 1:w.splice(1,0,M);break;case 2:w[1]=M;break;case 3:w.splice(4,0,M);break;case 5:w.splice(2,0,M);break;case 6:w[3]=M;break;case 7:w.splice(3,0,M);break;case 8:w[2]=M}return w}containsTile(c,f,v,w=0){const M=c.queryPadding/f._pixelsPerMercatorPixel+1,I=v?this._bufferedCameraMercator(M,f):this._bufferedScreenMercator(M,f);let k=c.tileID.wrap+(I.unwrapped?w:0);const L=I.polygon.map(le=>m.getTilePoint(c.tileTransform,le,k));if(!m.polygonIntersectsBox(L,0,0,m.EXTENT,m.EXTENT))return;k=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const V=this.screenGeometryMercator.polygon.map(le=>m.getTileVec3(c.tileTransform,le,k)),U=V.map(le=>new m.Point(le[0],le[1])),q=f.getFreeCameraOptions().position||new m.MercatorCoordinate(0,0,0),ne=m.getTileVec3(c.tileTransform,q,k),oe=V.map(le=>{const W=m.sub(le,le,ne);return m.normalize(W,W),new m.Ray(ne,W)}),ae=Yr(c,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:U,tilespaceRays:oe,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(se=m.getBounds(L),se.min.x=m.clamp(se.min.x,0,m.EXTENT),se.min.y=m.clamp(se.min.y,0,m.EXTENT),se.max.x=m.clamp(se.max.x,0,m.EXTENT),se.max.y=m.clamp(se.max.y,0,m.EXTENT),se),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:ae};var se}_bufferedScreenMercator(c,f){const v=Yn(c);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let w;return w="globe"===f.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),f):{polygon:this.bufferedScreenGeometry(c).map(M=>f.pointCoordinate3D(M)),unwrapped:!0},this._screenRaycastCache[v]=w,w}}_bufferedCameraMercator(c,f){const v=Yn(c);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let w;return w="globe"===f.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),f):{polygon:this.bufferedCameraGeometry(c).map(M=>f.pointCoordinate3D(M)),unwrapped:!0},this._cameraRaycastCache[v]=w,w}}_projectAndResample(c,f){const v=function(M,I){const k=m.multiply([],I.pixelMatrix,I.globeMatrix),L=[0,-m.GLOBE_RADIUS,0,1],V=[0,m.GLOBE_RADIUS,0,1],U=[0,0,0,1];m.transformMat4$1(L,L,k),m.transformMat4$1(V,V,k),m.transformMat4$1(U,U,k);const q=new m.Point(L[0]/L[3],L[1]/L[3]),ne=new m.Point(V[0]/V[3],V[1]/V[3]),oe=m.polygonContainsPoint(M,q)&&L[3]<U[3],ae=m.polygonContainsPoint(M,ne)&&V[3]<U[3];if(!oe&&!ae)return null;const se=function(Se,Le,Fe){for(let Ze=1;Ze<Se.length;Ze++){const ht=as(Le.pointCoordinate3D(Se[Ze-1]).x),je=as(Le.pointCoordinate3D(Se[Ze]).x);if(Fe<0){if(ht<je)return{idx:Ze,t:-ht/(je-1-ht)}}else if(je<ht)return{idx:Ze,t:(1-ht)/(je+1-ht)}}return null}(M,I,oe?-1:1);if(!se)return null;const{idx:le,t:W}=se;let re=le>1?Ti(M.slice(0,le),I):[],fe=le<M.length?Ti(M.slice(le),I):[];re=re.map(Se=>new m.Point(as(Se.x),Se.y)),fe=fe.map(Se=>new m.Point(as(Se.x),Se.y));const _e=[...re];0===_e.length&&_e.push(fe[fe.length-1]);const Te=m.number(_e[_e.length-1].y,(0===fe.length?re[0]:fe[0]).y,W);let De;return De=oe?[new m.Point(0,Te),new m.Point(0,0),new m.Point(1,0),new m.Point(1,Te)]:[new m.Point(1,Te),new m.Point(1,1),new m.Point(0,1),new m.Point(0,Te)],_e.push(...De),0===fe.length?_e.push(re[0]):_e.push(...fe),{polygon:_e.map(Se=>new m.MercatorCoordinate(Se.x,Se.y)),unwrapped:!1}}(c,f);if(v)return v;const w=function(M,I){let k=!1,L=-1/0,V=0;for(let q=0;q<M.length-1;q++)M[q].x>L&&(L=M[q].x,V=q);for(let q=0;q<M.length-1;q++){const ne=(V+q)%(M.length-1),oe=M[ne],ae=M[ne+1];Math.abs(oe.x-ae.x)>.5&&(oe.x<ae.x?(oe.x+=1,0===ne&&(M[M.length-1].x+=1)):(ae.x+=1,ne+1===M.length-1&&(M[0].x+=1)),k=!0)}const U=m.mercatorXfromLng(I.center.lng);return k&&U<Math.abs(U-1)&&M.forEach(q=>{q.x-=1}),{polygon:M,unwrapped:k}}(Ti(c,f).map(M=>new m.Point(as(M.x),M.y)),f);return{polygon:w.polygon.map(M=>new m.MercatorCoordinate(M.x,M.y)),unwrapped:w.unwrapped}}}function Ti(_,c){return m.resample(_,f=>{const v=c.pointCoordinate3D(f);f.x=v.x,f.y=v.y},1/256)}function as(_){return _<0?1+_%1:_%1}function Yn(_){return 100*_|0}function io(_,c,f,v,w){const M=function(I,k){if(I)return w(I);if(k){_.url&&k.tiles&&_.tiles&&delete _.tiles;const L=m.pick(m.extend(k,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(L.vectorLayers=k.vector_layers,L.vectorLayerIds=L.vectorLayers.map(V=>V.id)),L.tiles=c.canonicalizeTileset(L,_.url),w(null,L)}};return _.url?m.getJSON(c.transformRequest(c.normalizeSourceURL(_.url,null,f,v),m.ResourceType.Source),M):m.exported.frame(()=>M(null,_))}class Kr{constructor(c,f,v){this.bounds=m.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const f=Math.pow(2,c.z),v=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),w=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),M=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),I=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return c.x>=v&&c.x<M&&c.y>=w&&c.y<I}}class jl{constructor(c,f,v){this.context=c;const w=c.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yn{constructor(c,f,v,w){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=w,this.context=c;const M=c.gl;this.buffer=M.createBuffer(),c.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,f){for(let v=0;v<this.attributes.length;v++){const w=f.attributes[this.attributes[v].name];void 0!==w&&c.enableVertexAttribArray(w)}}setVertexAttribPointers(c,f,v){for(let w=0;w<this.attributes.length;w++){const M=this.attributes[w],I=f.attributes[M.name];void 0!==I&&c.vertexAttribPointer(I,M.components,c[hi[M.type]],!1,this.itemSize,M.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class fi{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pi extends fi{getDefault(){return m.Color.transparent}set(c){const f=this.current;(c.r!==f.r||c.g!==f.g||c.b!==f.b||c.a!==f.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Go extends fi{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class fl extends fi{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class _r extends fi{getDefault(){return[!0,!0,!0,!0]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class wi extends fi{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Ua extends fi{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class pl extends fi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const f=this.current;(c.func!==f.func||c.ref!==f.ref||c.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Ks extends fi{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Ea extends fi{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=c,this.dirty=!1}}class ju extends fi{getDefault(){return[0,1]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class Gd extends fi{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=c,this.dirty=!1}}class ml extends fi{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Va extends fi{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.BLEND):f.disable(f.BLEND),this.current=c,this.dirty=!1}}class $u extends fi{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class Qs extends fi{getDefault(){return m.Color.transparent}set(c){const f=this.current;(c.r!==f.r||c.g!==f.g||c.b!==f.b||c.a!==f.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class ls extends fi{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class Ds extends fi{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=c,this.dirty=!1}}class $l extends fi{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class Ca extends fi{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let gl,Hl=class extends fi{getDefault(){return null}set(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)}};class Co extends fi{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class _l extends fi{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class _c extends fi{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class Ss extends fi{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class eu extends fi{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class tu extends fi{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class ye extends fi{getDefault(){return null}set(c){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class K extends fi{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class ee extends fi{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class me extends fi{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class Me extends fi{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Pe extends fi{constructor(c,f){super(c),this.context=c,this.parent=f}getDefault(){return null}}class Ve extends Pe{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Ue extends Pe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Oe extends Ue{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ke{constructor(c,f,v,w){this.context=c,this.width=f,this.height=v;const M=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Ve(c,M),w&&(this.depthAttachment=new Ue(c,M))}destroy(){const c=this.context.gl,f=this.colorAttachment.get();if(f&&c.deleteTexture(f),this.depthAttachment){const v=this.depthAttachment.get();v&&c.deleteRenderbuffer(v)}c.deleteFramebuffer(this.framebuffer)}}class St{constructor(c,f=!1){if(this.gl=c,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const v=c;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(c),deleteVertexArrayOES:v.deleteVertexArray.bind(c),bindVertexArrayOES:v.bindVertexArray.bind(c)}}this.clearColor=new pi(this),this.clearDepth=new Go(this),this.clearStencil=new fl(this),this.colorMask=new _r(this),this.depthMask=new wi(this),this.stencilMask=new Ua(this),this.stencilFunc=new pl(this),this.stencilOp=new Ks(this),this.stencilTest=new Ea(this),this.depthRange=new ju(this),this.depthTest=new Gd(this),this.depthFunc=new ml(this),this.blend=new Va(this),this.blendFunc=new $u(this),this.blendColor=new Qs(this),this.blendEquation=new ls(this),this.cullFace=new Ds(this),this.cullFaceSide=new $l(this),this.frontFace=new Ca(this),this.program=new Hl(this),this.activeTexture=new Co(this),this.viewport=new _l(this),this.bindFramebuffer=new _c(this),this.bindRenderbuffer=new Ss(this),this.bindTexture=new eu(this),this.bindVertexBuffer=new tu(this),this.bindElementBuffer=new ye(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new K(this),this.pixelStoreUnpack=new ee(this),this.pixelStoreUnpackPremultiplyAlpha=new me(this),this.pixelStoreUnpackFlipY=new Me(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,f){return new jl(this,c,f)}createVertexBuffer(c,f,v){return new yn(this,c,f,v)}createRenderbuffer(c,f,v){const w=this.gl,M=w.createRenderbuffer();return this.bindRenderbuffer.set(M),w.renderbufferStorage(w.RENDERBUFFER,c,f,v),this.bindRenderbuffer.set(null),M}createFramebuffer(c,f,v){return new Ke(this,c,f,v)}clear({color:c,depth:f,stencil:v}){const w=this.gl;let M=0;c&&(M|=w.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==f&&(M|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),void 0!==v&&(M|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),w.clear(M)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){pt(c.blendFunction,m.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Vt extends m.Evented{constructor(c,f,v,w){if(super(),this.id=c,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(f,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new m.DedupedRequest}load(c){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=io(this._options,this.map._requestManager,f,v,(w,M)=>{this._tileJSONRequest=null,this._loaded=!0,w?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),v&&2!==v.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new m.ErrorEvent(w))):M&&(m.extend(this,M),M.bounds&&(this.tileBounds=new Kr(M.bounds,this.minzoom,this.maxzoom)),m.postTurnstileEvent(M.tiles,this.map._requestManager._customAccessToken),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(w)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return m.extend({},this._options)}loadTile(c,f){const v=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(v,m.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=f:c.request=c.actor.send("reloadTile",w,M.bind(this));else if(c.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",w,M.bind(this),void 0,!0);else{const I=m.loadVectorTile.call({deduped:this._deduped},w,(k,L)=>{k||!L?M.call(this,k):(w.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},c.actor&&c.actor.send("loadTile",w,M.bind(this),void 0,!0))},!0);c.request={cancel:I}}function M(I,k){return delete c.request,c.aborted?f(null):I&&404!==I.status?f(I):(k&&k.resourceTiming&&(c.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&c.setExpiryData(k),c.loadVectorData(k,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Tt extends m.Evented{constructor(c,f,v,w){super(),this.id=c,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},f),m.extend(this,m.pick(f,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=io(this._options,this.map._requestManager,null,null,(f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new m.ErrorEvent(f)):v&&(m.extend(this,v),v.bounds&&(this.tileBounds=new Kr(v.bounds,this.minzoom,this.maxzoom)),m.postTurnstileEvent(v.tiles),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(f)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return m.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,f){const v=m.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),(M,I,k,L)=>(delete c.request,c.aborted?(c.state="unloaded",f(null)):M?(c.state="errored",f(M)):I?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:k,expires:L}),c.setTexture(I,this.map.painter),c.state="loaded",m.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null)))}static loadTileData(c,f,v){c.setTexture(f,v)}static unloadTileData(c,f){c.texture&&f.saveTileTexture(c.texture)}abortTile(c,f){c.request&&(c.request.cancel(),delete c.request),f()}unloadTile(c,f){c.texture&&this.map.painter.saveTileTexture(c.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function $n(_,c,f,v,w,M,I,k){const L=[_,f,w,c,v,M,1,1,1],V=[I,k,1],U=m.adjoint([],L),[q,ne,oe]=m.transformMat3(V,V,m.transpose(U,U));return m.multiply$1(L,[q,0,0,0,ne,0,0,0,oe],L)}class Fn extends m.Evented{constructor(c,f,v,w){super(),this.id=c,this.dispatcher=v,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=f,this._dirty=!1}load(c,f){this._loaded=f||!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),(v,w)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new m.ErrorEvent(v));else if(w){const{HTMLImageElement:M}=m.window;this.image=w instanceof M?m.exported.getImageData(w):w,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const f=c.map(m.MercatorCoordinate.fromLngLat);return this.tileID=function(v){let w=1/0,M=1/0,I=-1/0,k=-1/0;for(const q of v)w=Math.min(w,q.x),M=Math.min(M,q.y),I=Math.max(I,q.x),k=Math.max(k,q.y);const L=Math.max(I-w,k-M),V=Math.max(0,Math.floor(-Math.log(L)/Math.LN2)),U=Math.pow(2,V);return new m.CanonicalTileID(V,Math.floor((w+I)/2*U),Math.floor((M+k)/2*U))}(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const L in this.tiles){const V=this.tiles[L];"loaded"!==V.state&&(V.state="loaded",V.texture=this.texture)}if(this._boundsArray)return;const f=m.tileTransform(this.tileID,this.map.transform.projection),[v,w,M,I]=this.coordinates.map(L=>{const V=f.projection.project(L[0],L[1]);return m.getTilePoint(f,V)._round()});this.perspectiveTransform=function(L,V,U,q,ne,oe,ae,se,le,W){const re=$n(0,0,L,0,0,V,L,V),fe=$n(U,q,ne,oe,ae,se,le,W);return m.multiply$1(fe,m.adjoint(re,re),fe),[fe[6]/fe[8]*L/m.EXTENT,fe[7]/fe[8]*V/m.EXTENT]}(this.width,this.height,v.x,v.y,w.x,w.y,I.x,I.y,M.x,M.y);const k=this._boundsArray=new m.StructArrayLayout4i8;k.emplaceBack(v.x,v.y,0,0),k.emplaceBack(w.x,w.y,m.EXTENT,0),k.emplaceBack(I.x,I.y,0,m.EXTENT),k.emplaceBack(M.x,M.y,m.EXTENT,m.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(k,m.boundsAttributes.members),this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,f=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new m.Texture(c,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,f){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},f(null)):(c.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Un={vector:Vt,raster:Tt,"raster-dem":class extends Tt{constructor(_,c,f,v){super(_,c,f,v),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(_,c){const f=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(w,M){w&&(_.state="errored",c(w)),M&&(_.dem=M,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",c(null))}_.request=m.getImage(this.map._requestManager.transformRequest(f,m.ResourceType.Tile),function(w,M,I,k){if(delete _.request,_.aborted)_.state="unloaded",c(null);else if(w)_.state="errored",c(w);else if(M){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:I,expires:k});const L=m.window.ImageBitmap&&M instanceof m.window.ImageBitmap&&(null==gl&&(gl=m.window.OffscreenCanvas&&new m.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof m.window.createImageBitmap),gl),V=1-(M.width-m.prevPowerOfTwo(M.width))/2;V<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const U=L?M:m.exported.getImageData(M,V),q={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:U,encoding:this.encoding,padding:V};_.actor&&"expired"!==_.state||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",q,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const c=_.canonical,f=Math.pow(2,c.z),v=(c.x-1+f)%f,w=0===c.x?_.wrap-1:_.wrap,M=(c.x+1+f)%f,I=c.x+1===f?_.wrap+1:_.wrap,k={};return k[new m.OverscaledTileID(_.overscaledZ,w,c.z,v,c.y).key]={backfilled:!1},k[new m.OverscaledTileID(_.overscaledZ,I,c.z,M,c.y).key]={backfilled:!1},c.y>0&&(k[new m.OverscaledTileID(_.overscaledZ,w,c.z,v,c.y-1).key]={backfilled:!1},k[new m.OverscaledTileID(_.overscaledZ,_.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},k[new m.OverscaledTileID(_.overscaledZ,I,c.z,M,c.y-1).key]={backfilled:!1}),c.y+1<f&&(k[new m.OverscaledTileID(_.overscaledZ,w,c.z,v,c.y+1).key]={backfilled:!1},k[new m.OverscaledTileID(_.overscaledZ,_.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},k[new m.OverscaledTileID(_.overscaledZ,I,c.z,M,c.y+1).key]={backfilled:!1}),k}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends m.Evented{constructor(_,c,f,v){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(v),this._data=c.data,this._options=m.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const w=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*w,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*w,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:m.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*w,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},c),this}getClusterChildren(_,c){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},c),this}getClusterLeaves(_,c,f,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:c,offset:f},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new m.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=m.extend({},this.workerOptions),c=this._data;"string"==typeof c?(_.request=this.map._requestManager.transformRequest(m.exported.resolveURL(c),m.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new m.ErrorEvent(f));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),this.fire(new m.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,c){const f=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(f,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(v,w)=>(delete _.request,_.unloadVectorData(),_.aborted?c(null):v?c(v):(_.loadVectorData(w,this.map.painter,"reloadTile"===f),c(null))),void 0,"loadTile"===f)}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return m.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Fn{constructor(_,c,f,v){super(_,c,f,v),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const c of _.urls)this.urls.push(this.map._requestManager.transformRequest(c,m.ResourceType.Source).url);m.getVideo(this.urls,(c,f)=>{this._loaded=!0,c?this.fire(new m.ErrorEvent(c)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const c=this.video.seekable;_<c.start(0)||_>c.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const _=this.map.painter.context,c=_.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(_,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Fn,canvas:class extends Fn{constructor(_,c,f,v){super(_,c,f,v),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(M=>"number"!=typeof M))||this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends m.Evented{constructor(_,c,f,v){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=c,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new m.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new m.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Kr(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),m.extend(this,m.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return m.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this._map=_,this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:c,y:f,z:v}=_.canonical;return this._implementation.hasTile({x:c,y:f,z:v})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,c){const{x:f,y:v,z:w}=_.tileID.canonical,M=new m.window.AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:f,y:v,z:w},{signal:M.signal})).then(function(I){return delete _.request,_.aborted?(_.state="unloaded",c(null)):void 0===I?(_.state="errored",c(null)):null===I?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",c(null)):(k=I)instanceof m.window.ImageData||k instanceof m.window.HTMLCanvasElement||k instanceof m.window.ImageBitmap||k instanceof m.window.HTMLImageElement?(this.loadTileData(_,I),_.state="loaded",void c(null)):(_.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var k}.bind(this)).catch(I=>{20!==I.code&&(_.state="errored",c(I))}),_.request.cancel=()=>M.abort()}loadTileData(_,c){Tt.loadTileData(_,c,this._map.painter)}unloadTileData(_){Tt.unloadTileData(_,this._map.painter)}unloadTile(_,c){if(this.unloadTileData(_),this._implementation.unloadTile){const{x:f,y:v,z:w}=_.tileID.canonical;this._implementation.unloadTile({x:f,y:v,z:w})}c()}abortTile(_,c){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Kn=function(_,c,f,v){const w=new Un[c.type](_,c,f,v);if(w.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${w.id}`);return m.bindAll(["load","abort","unload","serialize","prepare"],w),w};function ri(_,c){const f=m.identity([]);return m.scale(f,f,[.5*_.width,.5*-_.height,1]),m.translate(f,f,[1,-1,0]),m.multiply(f,f,_.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(f)}function Wi(_,c,f,v,w,M,I,k=!1){const L=_.tilesIn(v,I,k);L.sort(co);const V=[];for(const q of L)V.push({wrappedTileID:q.tile.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(c,f,_._state,q,w,M,ri(_.transform,q.tile.tileID),k)});const U=function(q){const ne={},oe={};for(const ae of q){const se=ae.queryResults,le=ae.wrappedTileID,W=oe[le]=oe[le]||{};for(const re in se){const fe=se[re],_e=W[re]=W[re]||{},Te=ne[re]=ne[re]||[];for(const De of fe)_e[De.featureIndex]||(_e[De.featureIndex]=!0,Te.push(De))}}return ne}(V);for(const q in U)U[q].forEach(ne=>{const oe=ne.feature,ae=oe.layer;ae&&"background"!==ae.type&&"sky"!==ae.type&&(oe.source=ae.source,ae["source-layer"]&&(oe.sourceLayer=ae["source-layer"]),oe.state=void 0!==oe.id?_.getFeatureState(ae["source-layer"],oe.id):{})});return U}function bi(_,c){const f=_.getRenderableIds().map(M=>_.getTileByID(M)),v=[],w={};for(let M=0;M<f.length;M++){const I=f[M],k=I.tileID.canonical.key;w[k]||(w[k]=!0,I.querySourceFeatures(v,c))}return v}function co(_,c){const f=_.tileID,v=c.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}function Nr(){return null!=uu.workerClass?new uu.workerClass:new m.window.Worker(uu.workerUrl)}const ja="mapboxgl_preloaded_worker_pool";class yo{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<yo.workerCount;)this.workers.push(new Nr);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ja]}numActive(){return Object.keys(this.active).length}}let er;function nu(){return er||(er=new yo),er}function Im(_,c){const f={};for(const v in _)"ref"!==v&&(f[v]=_[v]);return m.refProperties.forEach(v=>{v in c&&(f[v]=c[v])}),f}function $a(_){_=_.slice();const c=Object.create(null);for(let f=0;f<_.length;f++)c[_[f].id]=_[f];for(let f=0;f<_.length;f++)"ref"in _[f]&&(_[f]=Im(_[f],c[_[f].ref]));return _}yo.workerCount=2;const Di={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function zr(_,c,f){f.push({command:Di.addSource,args:[_,c[_]]})}function Js(_,c,f){c.push({command:Di.removeSource,args:[_]}),f[_]=!0}function Is(_,c,f,v){Js(_,f,v),zr(_,c,f)}function iu(_,c,f){let v;for(v in _[f])if(_[f].hasOwnProperty(v)&&"data"!==v&&!pt(_[f][v],c[f][v]))return!1;for(v in c[f])if(c[f].hasOwnProperty(v)&&"data"!==v&&!pt(_[f][v],c[f][v]))return!1;return!0}function ea(_,c,f,v,w,M){let I;for(I in c=c||{},_=_||{})_.hasOwnProperty(I)&&(pt(_[I],c[I])||f.push({command:M,args:[v,I,c[I],w]}));for(I in c)c.hasOwnProperty(I)&&!_.hasOwnProperty(I)&&(pt(_[I],c[I])||f.push({command:M,args:[v,I,c[I],w]}))}function ta(_){return _.id}function Br(_,c){return _[c.id]=c,_}class Hu{constructor(c,f){this.reset(c,f)}reset(c,f){this.points=c||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=m.clamp(c,0,1);let f=1,v=this._distances[f];const w=c*this.paddedLength+this.padding;for(;v<w&&f<this._distances.length;)v=this._distances[++f];const M=f-1,I=this._distances[M],k=v-I,L=k>0?(w-I)/k:0;return this.points[M].mult(1-L).add(this.points[f].mult(L))}}class na{constructor(c,f,v){const w=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(c/v),this.yCellCount=Math.ceil(f/v);for(let I=0;I<this.xCellCount*this.yCellCount;I++)w.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=f,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,f,v,w,M){this._forEachCell(f,v,w,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(M)}insertCircle(c,f,v,w){this._forEachCell(f-w,v-w,f+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(f),this.circles.push(v),this.circles.push(w)}_insertBoxCell(c,f,v,w,M,I){this.boxCells[M].push(I)}_insertCircleCell(c,f,v,w,M,I){this.circleCells[M].push(I)}_query(c,f,v,w,M,I){if(v<0||c>this.width||w<0||f>this.height)return!M&&[];const k=[];if(c<=0&&f<=0&&this.width<=v&&this.height<=w){if(M)return!0;for(let L=0;L<this.boxKeys.length;L++)k.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const V=this.circles[3*L],U=this.circles[3*L+1],q=this.circles[3*L+2];k.push({key:this.circleKeys[L],x1:V-q,y1:U-q,x2:V+q,y2:U+q})}return I?k.filter(I):k}return this._forEachCell(c,f,v,w,this._queryCell,k,{hitTest:M,seenUids:{box:{},circle:{}}},I),M?k.length>0:k}_queryCircle(c,f,v,w,M){const I=c-v,k=c+v,L=f-v,V=f+v;if(k<0||I>this.width||V<0||L>this.height)return!w&&[];const U=[];return this._forEachCell(I,L,k,V,this._queryCellCircle,U,{hitTest:w,circle:{x:c,y:f,radius:v},seenUids:{box:{},circle:{}}},M),w?U.length>0:U}query(c,f,v,w,M){return this._query(c,f,v,w,!1,M)}hitTest(c,f,v,w,M){return this._query(c,f,v,w,!0,M)}hitTestCircle(c,f,v,w){return this._queryCircle(c,f,v,!0,w)}_queryCell(c,f,v,w,M,I,k,L){const V=k.seenUids,U=this.boxCells[M];if(null!==U){const ne=this.bboxes;for(const oe of U)if(!V.box[oe]){V.box[oe]=!0;const ae=4*oe;if(c<=ne[ae+2]&&f<=ne[ae+3]&&v>=ne[ae+0]&&w>=ne[ae+1]&&(!L||L(this.boxKeys[oe]))){if(k.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[oe],x1:ne[ae],y1:ne[ae+1],x2:ne[ae+2],y2:ne[ae+3]})}}}const q=this.circleCells[M];if(null!==q){const ne=this.circles;for(const oe of q)if(!V.circle[oe]){V.circle[oe]=!0;const ae=3*oe;if(this._circleAndRectCollide(ne[ae],ne[ae+1],ne[ae+2],c,f,v,w)&&(!L||L(this.circleKeys[oe]))){if(k.hitTest)return I.push(!0),!0;{const se=ne[ae],le=ne[ae+1],W=ne[ae+2];I.push({key:this.circleKeys[oe],x1:se-W,y1:le-W,x2:se+W,y2:le+W})}}}}}_queryCellCircle(c,f,v,w,M,I,k,L){const V=k.circle,U=k.seenUids,q=this.boxCells[M];if(null!==q){const oe=this.bboxes;for(const ae of q)if(!U.box[ae]){U.box[ae]=!0;const se=4*ae;if(this._circleAndRectCollide(V.x,V.y,V.radius,oe[se+0],oe[se+1],oe[se+2],oe[se+3])&&(!L||L(this.boxKeys[ae])))return I.push(!0),!0}}const ne=this.circleCells[M];if(null!==ne){const oe=this.circles;for(const ae of ne)if(!U.circle[ae]){U.circle[ae]=!0;const se=3*ae;if(this._circlesCollide(oe[se],oe[se+1],oe[se+2],V.x,V.y,V.radius)&&(!L||L(this.circleKeys[ae])))return I.push(!0),!0}}}_forEachCell(c,f,v,w,M,I,k,L){const V=this._convertToXCellCoord(c),U=this._convertToYCellCoord(f),q=this._convertToXCellCoord(v),ne=this._convertToYCellCoord(w);for(let oe=V;oe<=q;oe++)for(let ae=U;ae<=ne;ae++)if(M.call(this,c,f,v,w,this.xCellCount*ae+oe,I,k,L))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,f,v,w,M,I){const k=w-c,L=M-f,V=v+I;return V*V>k*k+L*L}_circleAndRectCollide(c,f,v,w,M,I,k){const L=(I-w)/2,V=Math.abs(c-(w+L));if(V>L+v)return!1;const U=(k-M)/2,q=Math.abs(f-(M+U));if(q>U+v)return!1;if(V<=L||q<=U)return!0;const ne=V-L,oe=q-U;return ne*ne+oe*oe<=v*v}}const Oo={unknown:0,flipRequired:1,flipNotRequired:2},qo=Math.tan(85*Math.PI/180);function nt(_,c,f,v,w,M,I){const k=m.create();if(f)if("globe"===M.name){const L=m.calculateGlobeLabelMatrix(w,c);m.multiply(k,k,L)}else{const L=Gt([],I);k[0]=L[0],k[1]=L[1],k[4]=L[2],k[5]=L[3],v||m.rotateZ(k,k,w.angle)}else m.multiply(k,w.labelPlaneMatrix,_);return k}function Wo(_,c,f,v,w,M,I){const k=nt(_,c,f,v,w,M,I);return"globe"===M.name&&f||(k[2]=k[6]=k[10]=k[14]=0),k}function yr(_,c,f,v,w,M,I){if(f){if("globe"===M.name){const k=nt(_,c,f,v,w,M,I);return m.invert(k,k),m.multiply(k,_,k),k}{const k=m.clone(_),L=m.identity([]);return L[0]=I[0],L[1]=I[1],L[4]=I[2],L[5]=I[3],m.multiply(k,k,L),v||m.rotateZ(k,k,-w.angle),k}}return w.glCoordMatrix}function uo(_,c,f,v){const w=[_,c,f,1];f?m.transformMat4$1(w,w,v):Vn(w,w,v);const M=w[3];return w[0]/=M,w[1]/=M,w[2]/=M,w}function op(_,c){return Math.min(.5+_/c*.5,1.5)}function Ma(_,c){const f=_[0]/_[3],v=_[1]/_[3];return f>=-c[0]&&f<=c[0]&&v>=-c[1]&&v<=c[1]}function jh(_,c,f,v,w,M,I,k,L,V){const U=f.transform,q=v?_.textSizeData:_.iconSizeData,ne=m.evaluateSizeForZoom(q,f.transform.zoom),oe="globe"===U.projection.name,ae=[256/f.width*2+1,256/f.height*2+1],se=v?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;se.clear();let le=null;oe&&(le=v?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const W=_.lineVertexArray,re=v?_.text.placedSymbolArray:_.icon.placedSymbolArray,fe=f.transform.width/f.transform.height;let _e,Te=!1;for(let De=0;De<re.length;De++){const Se=re.get(De),{numGlyphs:Le,writingMode:Fe}=Se;if(Fe!==m.WritingMode.vertical||Te||_e===m.WritingMode.horizontal||(Te=!0),_e=Fe,(Se.hidden||Fe===m.WritingMode.vertical)&&!Te){qr(Le,se);continue}Te=!1;const Ze=new m.Point(Se.tileAnchorX,Se.tileAnchorY);let{x:ht,y:je,z:dt}=U.projection.projectTilePoint(Ze.x,Ze.y,V.canonical);if(L){const[kn,ln,Sn]=L(Ze);ht+=kn,je+=ln,dt+=Sn}const He=[ht,je,dt,1];if(m.transformMat4$1(He,He,c),!Ma(He,ae)){qr(Le,se);continue}const Et=op(f.transform.cameraToCenterDistance,He[3]),qe=m.evaluateSizeForFeature(q,ne,Se),ct=I?qe/Et:qe*Et,_t=uo(ht,je,dt,w);if(_t[3]<=0){qr(Le,se);continue}let yt={};const It=I?null:L,wn=Kt(Se,ct,!1,k,c,w,M,_.glyphOffsetArray,W,se,le,_t,Ze,yt,fe,It,U.projection,V,I);Te=wn.useVertical,It&&wn.needsFlipping&&(yt={}),(wn.notEnoughRoom||Te||wn.needsFlipping&&Kt(Se,ct,!0,k,c,w,M,_.glyphOffsetArray,W,se,le,_t,Ze,yt,fe,It,U.projection,V,I).notEnoughRoom)&&qr(Le,se)}v?(_.text.dynamicLayoutVertexBuffer.updateData(se),le&&_.text.globeExtVertexBuffer.updateData(le)):(_.icon.dynamicLayoutVertexBuffer.updateData(se),le&&_.icon.globeExtVertexBuffer.updateData(le))}function $h(_,c,f,v,w,M,I,k,L,V,U,q,ne,oe,ae,se){const{lineStartIndex:le,glyphStartIndex:W,segment:re}=k,fe=W+k.numGlyphs,_e=le+k.lineLength,Te=c.getoffsetX(W),De=c.getoffsetX(fe-1),Se=Zo(_*Te,f,v,w,M,I,re,le,_e,L,V,U,q,ne,!0,oe,ae,se);if(!Se)return null;const Le=Zo(_*De,f,v,w,M,I,re,le,_e,L,V,U,q,ne,!0,oe,ae,se);return Le?{first:Se,last:Le}:null}function or(_,c,f,v){return _===m.WritingMode.horizontal&&Math.abs(v)>Math.abs(f)?{useVertical:!0}:_===m.WritingMode.vertical?v>0?{needsFlipping:!0}:null:c!==Oo.unknown&&(0===(w=f)||Math.abs(v/w)>qo)?c===Oo.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null;var w}function Kt(_,c,f,v,w,M,I,k,L,V,U,q,ne,oe,ae,se,le,W,re){const fe=c/24,_e=_.lineOffsetX*fe,Te=_.lineOffsetY*fe,{lineStartIndex:De,glyphStartIndex:Se,numGlyphs:Le,segment:Fe,writingMode:Ze,flipState:ht}=_,je=De+_.lineLength,dt=He=>{if(U){const[_t,yt,It]=He.up,wn=V.length;m.updateGlobeVertexNormal(U,wn+0,_t,yt,It),m.updateGlobeVertexNormal(U,wn+1,_t,yt,It),m.updateGlobeVertexNormal(U,wn+2,_t,yt,It),m.updateGlobeVertexNormal(U,wn+3,_t,yt,It)}const[Et,qe,ct]=He.point;m.addDynamicAttributes(V,Et,qe,ct,He.angle)};if(Le>1){const He=$h(fe,k,_e,Te,f,q,ne,_,L,M,oe,se,!1,le,W,re);if(!He)return{notEnoughRoom:!0};if(v&&!f){let[Et,qe,ct]=He.first.point,[_t,yt,It]=He.last.point;[Et,qe]=uo(Et,qe,ct,I),[_t,yt]=uo(_t,yt,It,I);const wn=or(Ze,ht,(_t-Et)*ae,yt-qe);if(_.flipState=wn&&wn.needsFlipping?Oo.flipRequired:Oo.flipNotRequired,wn)return wn}dt(He.first);for(let Et=Se+1;Et<Se+Le-1;Et++){const qe=Zo(fe*k.getoffsetX(Et),_e,Te,f,q,ne,Fe,De,je,L,M,oe,se,!1,!1,le,W,re);if(!qe)return V.length-=4*(Et-Se),{notEnoughRoom:!0};dt(qe)}dt(He.last)}else{if(v&&!f){const Et=uo(ne.x,ne.y,0,w),qe=De+Fe+1,ct=new m.Point(L.getx(qe),L.gety(qe)),_t=uo(ct.x,ct.y,0,w),yt=_t[3]>0?_t:oi(ne,ct,Et,1,w,void 0,le,W.canonical),It=or(Ze,ht,(yt[0]-Et[0])*ae,yt[1]-Et[1]);if(_.flipState=It&&It.needsFlipping?Oo.flipRequired:Oo.flipNotRequired,It)return It}const He=Zo(fe*k.getoffsetX(Se),_e,Te,f,q,ne,Fe,De,je,L,M,oe,se,!1,!1,le,W,re);if(!He)return{notEnoughRoom:!0};dt(He)}return{}}function qt(_,c,f,v,w){const{x:M,y:I,z:k}=v.projectTilePoint(_.x,_.y,c);if(!w)return uo(M,I,k,f);const[L,V,U]=w(_);return uo(M+L,I+V,k+U,f)}function oi(_,c,f,v,w,M,I,k){const L=qt(_.sub(c)._unit()._add(_),k,w,I,M);return m.sub(L,f,L),m.normalize(L,L),m.scaleAndAdd(L,f,L,v)}function Zo(_,c,f,v,w,M,I,k,L,V,U,q,ne,oe,ae,se,le,W){const re=v?_-c:_+c;let fe=re>0?1:-1,_e=0;v&&(fe*=-1,_e=Math.PI),fe<0&&(_e+=Math.PI);let Te=k+I+(fe>0?0:1)|0,De=w,Se=w,Le=0,Fe=0;const Ze=Math.abs(re),ht=[],je=[];let dt=M,He=dt;const Et=()=>oi(He,dt,Se,Ze-Le+1,U,ne,se,le.canonical);for(;Le+Fe<=Ze;){if(Te+=fe,Te<k||Te>=L)return null;if(Se=De,He=dt,ht.push(Se),oe&&je.push(He),dt=new m.Point(V.getx(Te),V.gety(Te)),De=q[Te],!De){const Sn=qt(dt,le.canonical,U,se,ne);De=Sn[3]>0?q[Te]=Sn:Et()}Le+=Fe,Fe=m.distance(Se,De)}ae&&ne&&(q[Te]&&(De=Et(),Fe=m.distance(Se,De)),q[Te]=De);const qe=(Ze-Le)/Fe,ct=dt.sub(He)._mult(qe)._add(He),_t=m.sub([],De,Se),yt=m.scaleAndAdd([],Se,_t,qe);let It=[0,0,1],wn=_t[0],kn=_t[1];if(W&&(It=se.upVector(le.canonical,ct.x,ct.y),0!==It[0]||0!==It[1]||1!==It[2])){const Sn=[It[2],0,-It[0]],ui=m.cross([],It,Sn);m.normalize(Sn,Sn),m.normalize(ui,ui),wn=m.dot(_t,Sn),kn=m.dot(_t,ui)}if(f){const Sn=m.cross([],It,_t);m.normalize(Sn,Sn),m.scaleAndAdd(yt,yt,Sn,f*fe)}const ln=_e+Math.atan2(kn,wn);return ht.push(yt),oe&&je.push(ct),{point:yt,angle:ln,path:ht,tilePath:je,up:It}}function qr(_,c){const f=c.length,v=f+4*_;c.resize(v),c.float32.fill(-1/0,4*f,4*v)}function Vn(_,c,f){const v=c[0],w=c[1];return _[0]=f[0]*v+f[4]*w+f[12],_[1]=f[1]*v+f[5]*w+f[13],_[3]=f[3]*v+f[7]*w+f[15],_}const P=100;class z{constructor(c,f,v=new na(c.width+200,c.height+200,25),w=new na(c.width+200,c.height+200,25)){this.transform=c,this.grid=v,this.ignoredGrid=w,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+P,this.screenBottomBoundary=c.height+P,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=f}placeCollisionBox(c,f,v,w,M,I,k,L){let V=v.projectedAnchorX,U=v.projectedAnchorY,q=v.projectedAnchorZ;const ne=v.elevation,oe=v.tileID,ae=c.getProjection();if(ne&&oe){const[De,Se,Le]=ae.upVector(oe.canonical,v.tileAnchorX,v.tileAnchorY),Fe=ae.upVectorScale(oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=De*ne*Fe,U+=Se*ne*Fe,q+=Le*ne*Fe}const se=this.projectAndGetPerspectiveRatio(k,V,U,q,v.tileID,"globe"===ae.name||!!ne||this.transform.pitch>0,ae),le=I*se.perspectiveRatio,W=(v.x1*f+w.x-v.padding)*le+se.point.x,re=(v.y1*f+w.y-v.padding)*le+se.point.y,fe=(v.x2*f+w.x+v.padding)*le+se.point.x,_e=(v.y2*f+w.y+v.padding)*le+se.point.y,Te=se.perspectiveRatio<=.55||se.occluded;return!this.isInsideGrid(W,re,fe,_e)||!M&&this.grid.hitTest(W,re,fe,_e,L)||Te?{box:[],offscreen:!1,occluded:se.occluded}:{box:[W,re,fe,_e],offscreen:this.isOffscreen(W,re,fe,_e),occluded:!1}}placeCollisionCircles(c,f,v,w,M,I,k,L,V,U,q,ne,oe,ae,se){const le=[],W=this.transform.elevation,re=c.getProjection(),fe=W?W.getAtTileOffsetFunc(se,this.transform.center.lat,this.transform.worldSize,re):null,_e=new m.Point(v.tileAnchorX,v.tileAnchorY);let{x:Te,y:De,z:Se}=re.projectTilePoint(_e.x,_e.y,se.canonical);if(fe){const[ct,_t,yt]=fe(_e);Te+=ct,De+=_t,Se+=yt}const Le="globe"===re.name,Fe=this.projectAndGetPerspectiveRatio(k,Te,De,Se,se,Le||!!W||this.transform.pitch>0,re),{perspectiveRatio:Ze}=Fe,ht=(q?I/Ze:I*Ze)/m.ONE_EM,je=uo(Te,De,Se,L),dt=Fe.signedDistanceFromCamera>0?$h(ht,M,v.lineOffsetX*ht,v.lineOffsetY*ht,!1,je,_e,v,w,L,{},W&&!q?fe:null,q&&!!W,re,se,q):null;let He=!1,Et=!1,qe=!0;if(dt&&!Fe.occluded){const ct=.5*oe*Ze+ae,_t=new m.Point(-100,-100),yt=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),It=new Hu,{first:wn,last:kn}=dt,ln=wn.path.length;let Sn=[];for(let gn=ln-1;gn>=1;gn--)Sn.push(wn.path[gn]);for(let gn=1;gn<kn.path.length;gn++)Sn.push(kn.path[gn]);const ui=2.5*ct;V&&(Sn=Sn.map(([gn,Xi,cn],lr)=>(fe&&!Le&&(cn=fe(lr<ln-1?wn.tilePath[ln-1-lr]:kn.tilePath[lr-ln+2])[2]),uo(gn,Xi,cn,V))),Sn.some(gn=>gn[3]<=0)&&(Sn=[]));let li=[];if(Sn.length>0){let gn=1/0,Xi=-1/0,cn=1/0,lr=-1/0;for(const vr of Sn)gn=Math.min(gn,vr[0]),cn=Math.min(cn,vr[1]),Xi=Math.max(Xi,vr[0]),lr=Math.max(lr,vr[1]);Xi>=_t.x&&gn<=yt.x&&lr>=_t.y&&cn<=yt.y&&(li=[Sn.map(vr=>new m.Point(vr[0],vr[1]))],(gn<_t.x||Xi>yt.x||cn<_t.y||lr>yt.y)&&(li=m.clipLine(li,_t.x,_t.y,yt.x,yt.y)))}for(const gn of li){It.reset(gn,.25*ct);let Xi=0;Xi=It.length<=.5*ct?1:Math.ceil(It.paddedLength/ui)+1;for(let cn=0;cn<Xi;cn++){const lr=cn/Math.max(Xi-1,1),vr=It.lerp(lr),ps=vr.x+P,Fo=vr.y+P;le.push(ps,Fo,ct,0);const Qa=ps-ct,Il=Fo-ct,cr=ps+ct,gr=Fo+ct;if(qe=qe&&this.isOffscreen(Qa,Il,cr,gr),Et=Et||this.isInsideGrid(Qa,Il,cr,gr),!f&&this.grid.hitTestCircle(ps,Fo,ct,ne)&&(He=!0,!U))return{circles:[],offscreen:!1,collisionDetected:He,occluded:!1}}}}return{circles:!U&&He||!Et?[]:le,offscreen:qe,collisionDetected:He,occluded:Fe.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const f=[];let v=1/0,w=1/0,M=-1/0,I=-1/0;for(const U of c){const q=new m.Point(U.x+P,U.y+P);v=Math.min(v,q.x),w=Math.min(w,q.y),M=Math.max(M,q.x),I=Math.max(I,q.y),f.push(q)}const k=this.grid.query(v,w,M,I).concat(this.ignoredGrid.query(v,w,M,I)),L={},V={};for(const U of k){const q=U.key;if(void 0===L[q.bucketInstanceId]&&(L[q.bucketInstanceId]={}),L[q.bucketInstanceId][q.featureIndex])continue;const ne=[new m.Point(U.x1,U.y1),new m.Point(U.x2,U.y1),new m.Point(U.x2,U.y2),new m.Point(U.x1,U.y2)];m.polygonIntersectsPolygon(f,ne)&&(L[q.bucketInstanceId][q.featureIndex]=!0,void 0===V[q.bucketInstanceId]&&(V[q.bucketInstanceId]=[]),V[q.bucketInstanceId].push(q.featureIndex))}return V}insertCollisionBox(c,f,v,w,M){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:M},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,f,v,w,M){const I=f?this.ignoredGrid:this.grid,k={bucketInstanceId:v,featureIndex:w,collisionGroupID:M};for(let L=0;L<c.length;L+=4)I.insertCircle(k,c[L],c[L+1],c[L+2])}projectAndGetPerspectiveRatio(c,f,v,w,M,I,k){const L=[f,v,w,1];let V=!1;w||this.transform.pitch>0?(m.transformMat4$1(L,L,c),this.fogState&&M&&"globe"!==k.name&&(V=function(ne,oe,ae,se,le,W){const re=W.calculateFogTileMatrix(le),fe=[oe,ae,se];return m.transformMat4(fe,fe,re),za(ne,fe,W.pitch,W._fov)}(this.fogState,f,v,w,M.toUnwrapped(),this.transform)>.9)):Vn(L,L,c);const U=L[3];return{point:new m.Point((L[0]/U+1)/2*this.transform.width+P,(-L[1]/U+1)/2*this.transform.height+P),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/U*.5,1.5),signedDistanceFromCamera:U,occluded:I&&L[2]>U||V}}isOffscreen(c,f,v,w){return v<P||c>=this.screenRightBoundary||w<P||f>this.screenBottomBoundary}isInsideGrid(c,f,v,w){return v>=0&&c<this.gridRightBoundary&&w>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const c=m.identity([]);return m.translate(c,c,[-100,-100,0]),c}}function te(_,c,f){const v=c.createTileMatrix(_,_.worldSize,f.toUnwrapped());return m.multiply(new Float32Array(16),_.projMatrix,v)}function pe(_,c,f){if(c.projection.name===f.projection.name)return _.projMatrix;const v=f.clone();return v.setProjection(c.projection),te(v,c.getProjection(),_)}function Ee(_,c,f){return c.name===f.projection.name?_.projMatrix:te(f,c,_)}class ke{constructor(c,f,v,w){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?f:-f))):w&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class ze{constructor(c,f,v,w,M,I=!1){this.text=new ke(c?c.text:null,f,v,M),this.icon=new ke(c?c.icon:null,f,w,M),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tt{constructor(c,f,v,w=!1){this.text=c,this.icon=f,this.skipFade=v,this.clipped=w}}class zt{constructor(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]}}class rn{constructor(c,f,v,w,M){this.bucketInstanceId=c,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=M}}class on{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const f=++this.maxGroupID;this.collisionGroups[c]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[c]}}function Wt(_,c,f,v,w){const{horizontalAlign:M,verticalAlign:I}=m.getAnchorAlignment(_),k=-(M-.5)*c,L=-(I-.5)*f,V=m.evaluateVariableOffset(_,v);return new m.Point(k+V[0]*w,L+V[1]*w)}function $e(_,c,f,v,w){const M=new m.Point(_,c);return f&&M._rotate(v?w:-w),M}class sr{constructor(c,f,v,w,M){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new z(this.transform,M),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new on(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,f,v,w){const M=v.getBucket(f),I=v.latestFeatureIndex;if(!M||!I||f.id!==M.layerIds[0])return;const k=M.layers[0].layout,L=v.collisionBoxArray,V=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),U=v.tileSize/m.EXTENT,q=v.tileID.toUnwrapped();this.transform.setProjection(M.projection);const ne=(oe=v.tileID,ae=M.getProjection(),se=this.transform,ae.name===this.projection?se.calculateProjMatrix(oe.toUnwrapped()):te(se,ae,oe));var oe,ae,se;const le="map"===k.get("text-pitch-alignment"),W="map"===k.get("text-rotation-alignment");f.compileFilter();const re=f.dynamicFilter(),fe=f.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(v),Te=Wo(ne,v.tileID.canonical,le,W,this.transform,M.getProjection(),_e);let De=null;if(le){const Fe=yr(ne,v.tileID.canonical,le,W,this.transform,M.getProjection(),_e);De=m.multiply([],this.transform.labelPlaneMatrix,Fe)}let Se=null;re&&v.latestFeatureIndex&&(Se={unwrappedTileID:q,dynamicFilter:re,dynamicFilterNeedsFeature:fe,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[M.bucketInstanceId]=new rn(M.bucketInstanceId,I,M.sourceLayerIndex,M.index,v.tileID);const Le={bucket:M,layout:k,posMatrix:ne,textLabelPlaneMatrix:Te,labelToScreenMatrix:De,clippingData:Se,scale:V,textPixelRatio:U,holdingForFade:v.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(M.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:m.evaluateSizeForZoom(M.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(M.sourceID)};if(w)for(const Fe of M.sortKeyRanges){const{sortKey:Ze,symbolInstanceStart:ht,symbolInstanceEnd:je}=Fe;c.push({sortKey:Ze,symbolInstanceStart:ht,symbolInstanceEnd:je,parameters:Le})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:M.symbolInstances.length,parameters:Le})}attemptAnchorPlacement(c,f,v,w,M,I,k,L,V,U,q,ne,oe,ae,se,le,W,re){const{textOffset0:fe,textOffset1:_e,crossTileID:Te}=ne,De=[fe,_e],Se=Wt(c,v,w,De,M),Le=this.collisionIndex.placeCollisionBox(ae,M,f,$e(Se.x,Se.y,I,k,this.transform.angle),q,L,V,U.predicate);if(le){const Fe=ae.getSymbolInstanceIconSize(re,this.transform.zoom,ne.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ae,Fe,le,$e(Se.x,Se.y,I,k,this.transform.angle),q,L,V,U.predicate).box.length)return}if(Le.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Te]&&this.prevPlacement.placements[Te]&&this.prevPlacement.placements[Te].text&&(Fe=this.prevPlacement.variableOffsets[Te].anchor),this.variableOffsets[Te]={textOffset:De,width:v,height:w,anchor:c,textScale:M,prevAnchor:Fe},this.markUsedJustification(ae,c,ne,se),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,se,ne),this.placedOrientations[Te]=se),{shift:Se,placedGlyphBoxes:Le}}}placeLayerBucketPart(c,f,v,w){const{bucket:M,layout:I,posMatrix:k,textLabelPlaneMatrix:L,labelToScreenMatrix:V,clippingData:U,textPixelRatio:q,holdingForFade:ne,collisionBoxArray:oe,partiallyEvaluatedTextSize:ae,partiallyEvaluatedIconSize:se,collisionGroup:le}=c.parameters,W=I.get("text-optional"),re=I.get("icon-optional"),fe=I.get("text-allow-overlap"),_e=I.get("icon-allow-overlap"),Te="map"===I.get("text-rotation-alignment"),De="map"===I.get("text-pitch-alignment"),Se="none"!==I.get("icon-text-fit"),Le="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(M.projection);let Fe=fe&&(_e||!M.hasIconData()||re),Ze=_e&&(fe||!M.hasTextData()||W);!M.collisionArrays&&oe&&M.deserializeCollisionBoxes(oe),v&&w&&M.updateCollisionDebugBuffers(this.transform.zoom,oe);const ht=(je,dt,He)=>{const{crossTileID:Et,numVerticalGlyphVertices:qe}=je;if(U){const cr={zoom:this.transform.zoom,pitch:this.transform.pitch};let gr=null;if(U.dynamicFilterNeedsFeature){const zi=this.retainedQueryData[M.bucketInstanceId];gr=U.featureIndex.loadFeature({featureIndex:je.featureIndex,bucketIndex:zi.bucketIndex,sourceLayerIndex:zi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,U.dynamicFilter)(cr,gr,this.retainedQueryData[M.bucketInstanceId].tileID.canonical,new m.Point(je.tileAnchorX,je.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[Et]=new tt(!1,!1,!1,!0),void f.add(Et)}if(f.has(Et))return;if(ne)return void(this.placements[Et]=new tt(!1,!1,!1));let ct=!1,_t=!1,yt=!0,It=!1,wn=!1,kn=null,ln={box:null,offscreen:null,occluded:null},Sn={box:null,offscreen:null,occluded:null},ui=null,li=null,gn=null,Xi=0,cn=0,lr=0;He.textFeatureIndex?Xi=He.textFeatureIndex:je.useRuntimeCollisionCircles&&(Xi=je.featureIndex),He.verticalTextFeatureIndex&&(cn=He.verticalTextFeatureIndex);const vr=cr=>{cr.tileID=this.retainedQueryData[M.bucketInstanceId].tileID;const gr=this.transform.elevation;(gr||cr.elevation)&&(cr.elevation=gr?gr.getAtTileOffset(cr.tileID,cr.tileAnchorX,cr.tileAnchorY):0)},ps=He.textBox;if(ps){vr(ps);const cr=zi=>{let ho=m.WritingMode.horizontal;if(M.allowVerticalPlacement&&!zi&&this.prevPlacement){const ks=this.prevPlacement.placedOrientations[Et];ks&&(this.placedOrientations[Et]=ks,ho=ks,this.markUsedOrientation(M,ho,je))}return ho},gr=(zi,ho)=>{if(M.allowVerticalPlacement&&qe>0&&He.verticalTextBox){for(const ks of M.writingModes)if(ks===m.WritingMode.vertical?(ln=ho(),Sn=ln):ln=zi(),ln&&ln.box&&ln.box.length)break}else ln=zi()};if(I.get("text-variable-anchor")){let zi=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Et]){const Rr=this.prevPlacement.variableOffsets[Et];zi.indexOf(Rr.anchor)>0&&(zi=zi.filter(vt=>vt!==Rr.anchor),zi.unshift(Rr.anchor))}const ho=(Rr,vt,Ii)=>{const Rs=M.getSymbolInstanceTextSize(ae,je,this.transform.zoom,dt),Pa=(Rr.x2-Rr.x1)*Rs+2*Rr.padding,Vr=(Rr.y2-Rr.y1)*Rs+2*Rr.padding,Pc=Se&&!_e?vt:null;Pc&&vr(Pc);let Al={box:[],offscreen:!1,occluded:!1};const Oa=fe?2*zi.length:zi.length;for(let od=0;od<Oa;++od){const tf=this.attemptAnchorPlacement(zi[od%zi.length],Rr,Pa,Vr,Rs,Te,De,q,k,le,od>=zi.length,je,dt,M,Ii,Pc,ae,se);if(tf&&(Al=tf.placedGlyphBoxes,Al&&Al.box&&Al.box.length)){ct=!0,kn=tf.shift;break}}return Al};gr(()=>ho(ps,He.iconBox,m.WritingMode.horizontal),()=>{const Rr=He.verticalTextBox;return Rr&&vr(Rr),M.allowVerticalPlacement&&!(ln&&ln.box&&ln.box.length)&&qe>0&&Rr?ho(Rr,He.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ln&&(ct=ln.box,yt=ln.offscreen,It=ln.occluded);const ks=cr(!(!ln||!ln.box));if(!ct&&this.prevPlacement){const Rr=this.prevPlacement.variableOffsets[Et];Rr&&(this.variableOffsets[Et]=Rr,this.markUsedJustification(M,Rr.anchor,je,ks))}}else{const zi=(ho,ks)=>{const Rr=M.getSymbolInstanceTextSize(ae,je,this.transform.zoom,dt),vt=this.collisionIndex.placeCollisionBox(M,Rr,ho,new m.Point(0,0),fe,q,k,le.predicate);return vt&&vt.box&&vt.box.length&&(this.markUsedOrientation(M,ks,je),this.placedOrientations[Et]=ks),vt};gr(()=>zi(ps,m.WritingMode.horizontal),()=>{const ho=He.verticalTextBox;return M.allowVerticalPlacement&&qe>0&&ho?(vr(ho),zi(ho,m.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),cr(!!(ln&&ln.box&&ln.box.length))}}if(ui=ln,ct=ui&&ui.box&&ui.box.length>0,yt=ui&&ui.offscreen,It=ui&&ui.occluded,je.useRuntimeCollisionCircles){const cr=M.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex>=0?je.centerJustifiedTextSymbolIndex:je.verticalPlacedTextSymbolIndex),gr=m.evaluateSizeForFeature(M.textSizeData,ae,cr),zi=I.get("text-padding");li=this.collisionIndex.placeCollisionCircles(M,fe,cr,M.lineVertexArray,M.glyphOffsetArray,gr,k,L,V,v,De,le.predicate,je.collisionCircleDiameter*gr/m.ONE_EM,zi,this.retainedQueryData[M.bucketInstanceId].tileID),ct=fe||li.circles.length>0&&!li.collisionDetected,yt=yt&&li.offscreen,It=li.occluded}if(He.iconFeatureIndex&&(lr=He.iconFeatureIndex),He.iconBox){const cr=gr=>{vr(gr);const zi=Se&&kn?$e(kn.x,kn.y,Te,De,this.transform.angle):new m.Point(0,0),ho=M.getSymbolInstanceIconSize(se,this.transform.zoom,je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(M,ho,gr,zi,_e,q,k,le.predicate)};Sn&&Sn.box&&Sn.box.length&&He.verticalIconBox?(gn=cr(He.verticalIconBox),_t=gn.box.length>0):(gn=cr(He.iconBox),_t=gn.box.length>0),yt=yt&&gn.offscreen,wn=gn.occluded}const Fo=W||0===je.numHorizontalGlyphVertices&&0===qe,Qa=re||0===je.numIconVertices;if(Fo||Qa?Qa?Fo||(_t=_t&&ct):ct=_t&&ct:_t=ct=_t&&ct,ct&&ui&&ui.box&&this.collisionIndex.insertCollisionBox(ui.box,I.get("text-ignore-placement"),M.bucketInstanceId,Sn&&Sn.box&&cn?cn:Xi,le.ID),_t&&gn&&this.collisionIndex.insertCollisionBox(gn.box,I.get("icon-ignore-placement"),M.bucketInstanceId,lr,le.ID),li&&(ct&&this.collisionIndex.insertCollisionCircles(li.circles,I.get("text-ignore-placement"),M.bucketInstanceId,Xi,le.ID),v)){const cr=M.bucketInstanceId;let gr=this.collisionCircleArrays[cr];void 0===gr&&(gr=this.collisionCircleArrays[cr]=new zt);for(let zi=0;zi<li.circles.length;zi+=4)gr.circles.push(li.circles[zi+0]),gr.circles.push(li.circles[zi+1]),gr.circles.push(li.circles[zi+2]),gr.circles.push(li.collisionDetected?1:0)}const Il="globe"!==M.projection.name;Fe=Fe&&(Il||!It),Ze=Ze&&(Il||!wn),this.placements[Et]=new tt(ct||Fe,_t||Ze,yt||M.justReloaded),f.add(Et)};if(Le){const je=M.getSortedSymbolIndexes(this.transform.angle);for(let dt=je.length-1;dt>=0;--dt){const He=je[dt];ht(M.symbolInstances.get(He),He,M.collisionArrays[He])}}else for(let je=c.symbolInstanceStart;je<c.symbolInstanceEnd;je++)ht(M.symbolInstances.get(je),je,M.collisionArrays[je]);if(v&&M.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[M.bucketInstanceId];m.invert(je.invProjMatrix,k),je.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1}markUsedJustification(c,f,v,w){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:L,crossTileID:V}=v,U=m.getAnchorJustification(f),q=w===m.WritingMode.vertical?L:"left"===U?M:"center"===U?I:"right"===U?k:-1;M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=q>=0&&M!==q?0:V),I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=q>=0&&I!==q?0:V),k>=0&&(c.text.placedSymbolArray.get(k).crossTileID=q>=0&&k!==q?0:V),L>=0&&(c.text.placedSymbolArray.get(L).crossTileID=q>=0&&L!==q?0:V)}markUsedOrientation(c,f,v){const w=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,M=f===m.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:V}=v,U=c.text.placedSymbolArray;I>=0&&(U.get(I).placedOrientation=w),k>=0&&(U.get(k).placedOrientation=w),L>=0&&(U.get(L).placedOrientation=w),V>=0&&(U.get(V).placedOrientation=M)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const w=f?f.symbolFadeChange(c):1,M=f?f.opacities:{},I=f?f.variableOffsets:{},k=f?f.placedOrientations:{};for(const L in this.placements){const V=this.placements[L],U=M[L];U?(this.opacities[L]=new ze(U,w,V.text,V.icon,null,V.clipped),v=v||V.text!==U.text.placed||V.icon!==U.icon.placed):(this.opacities[L]=new ze(null,w,V.text,V.icon,V.skipFade,V.clipped),v=v||V.text||V.icon)}for(const L in M){const V=M[L];if(!this.opacities[L]){const U=new ze(V,w,!1,!1);U.isHidden()||(this.opacities[L]=U,v=v||V.text.placed||V.icon.placed)}}for(const L in I)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=I[L]);for(const L in k)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=k[L]);v?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:c)}updateLayerOpacities(c,f){const v=new Set;for(const w of f){const M=w.getBucket(c);M&&w.latestFeatureIndex&&c.id===M.layerIds[0]&&this.updateBucketOpacities(M,v,w.collisionBoxArray)}}updateBucketOpacities(c,f,v){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const w=c.layers[0].layout,M=!!c.layers[0].dynamicFilter(),I=new ze(null,0,!1,!1,!0),k=w.get("text-allow-overlap"),L=w.get("icon-allow-overlap"),V=w.get("text-variable-anchor"),U="map"===w.get("text-rotation-alignment"),q="map"===w.get("text-pitch-alignment"),ne="none"!==w.get("icon-text-fit"),oe=new ze(null,0,k&&(L||!c.hasIconData()||w.get("icon-optional")),L&&(k||!c.hasTextData()||w.get("text-optional")),!0);!c.collisionArrays&&v&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(v);const ae=(le,W,re)=>{for(let fe=0;fe<W/4;fe++)le.opacityVertexArray.emplaceBack(re)};let se=0;for(let le=0;le<c.symbolInstances.length;le++){const W=c.symbolInstances.get(le),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:fe,crossTileID:_e,numIconVertices:Te}=W,De=f.has(_e);let Se=this.opacities[_e];De?Se=I:Se||(Se=oe,this.opacities[_e]=Se),f.add(_e);const Le=re>0||fe>0,Fe=Te>0,Ze=this.placedOrientations[_e],ht=Ze===m.WritingMode.vertical,je=Ze===m.WritingMode.horizontal||Ze===m.WritingMode.horizontalOnly;if(!Le&&!Fe||Se.isHidden()||se++,Le){const dt=Gu(Se.text);ae(c.text,re,ht?Qn:dt),ae(c.text,fe,je?Qn:dt);const He=Se.text.isHidden(),{leftJustifiedTextSymbolIndex:Et,centerJustifiedTextSymbolIndex:qe,rightJustifiedTextSymbolIndex:ct,verticalPlacedTextSymbolIndex:_t}=W,yt=c.text.placedSymbolArray,It=He||ht?1:0;Et>=0&&(yt.get(Et).hidden=It),qe>=0&&(yt.get(qe).hidden=It),ct>=0&&(yt.get(ct).hidden=It),_t>=0&&(yt.get(_t).hidden=He||je?1:0);const wn=this.variableOffsets[_e];wn&&this.markUsedJustification(c,wn.anchor,W,Ze);const kn=this.placedOrientations[_e];kn&&(this.markUsedJustification(c,"left",W,kn),this.markUsedOrientation(c,kn,W))}if(Fe){const dt=Gu(Se.icon),{placedIconSymbolIndex:He,verticalPlacedIconSymbolIndex:Et}=W,qe=c.icon.placedSymbolArray,ct=Se.icon.isHidden()?1:0;He>=0&&(ae(c.icon,Te,ht?Qn:dt),qe.get(He).hidden=ct),Et>=0&&(ae(c.icon,W.numVerticalIconVertices,je?Qn:dt),qe.get(Et).hidden=ct)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const dt=c.collisionArrays[le];if(dt){let He=new m.Point(0,0),Et=!0;if(dt.textBox||dt.verticalTextBox){if(V){const ct=this.variableOffsets[_e];ct?(He=Wt(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textScale),U&&He._rotate(q?this.transform.angle:-this.transform.angle)):Et=!1}M&&(Et=!Se.clipped),dt.textBox&&$t(c.textCollisionBox.collisionVertexArray,Se.text.placed,!Et||ht,He.x,He.y),dt.verticalTextBox&&$t(c.textCollisionBox.collisionVertexArray,Se.text.placed,!Et||je,He.x,He.y)}const qe=Et&&!(je||!dt.verticalIconBox);dt.iconBox&&$t(c.iconCollisionBox.collisionVertexArray,Se.icon.placed,qe,ne?He.x:0,ne?He.y:0),dt.verticalIconBox&&$t(c.iconCollisionBox.collisionVertexArray,Se.icon.placed,!qe,ne?He.x:0,ne?He.y:0)}}}if(c.fullyClipped=0===se,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=le.invProjMatrix,c.placementViewportMatrix=le.viewportMatrix,c.collisionCircleArray=le.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>c}setStale(){this.stale=!0}}function $t(_,c,f,v,w){_.emplaceBack(c?1:0,f?1:0,v||0,w||0),_.emplaceBack(c?1:0,f?1:0,v||0,w||0),_.emplaceBack(c?1:0,f?1:0,v||0,w||0),_.emplaceBack(c?1:0,f?1:0,v||0,w||0)}const Cn=Math.pow(2,25),lt=Math.pow(2,24),xn=Math.pow(2,17),Zi=Math.pow(2,16),Li=Math.pow(2,9),si=Math.pow(2,8),Hh=Math.pow(2,1);function Gu(_){if(0===_.opacity&&!_.placed)return 0;if(1===_.opacity&&_.placed)return 4294967295;const c=_.placed?1:0,f=Math.floor(127*_.opacity);return f*Cn+c*lt+f*xn+c*Zi+f*Li+c*si+f*Hh+c}const Qn=0;class As{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,f,v,w,M){const I=this._bucketParts;for(;this._currentTileIndex<c.length;)if(f.getBucketParts(I,w,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((k,L)=>k.sortKey-L.sortKey));this._currentPartIndex<I.length;){const k=I[this._currentPartIndex];if(f.placeLayerBucketPart(k,this._seenCrossTileIDs,v,0===k.symbolInstanceStart),this._currentPartIndex++,M())return!0}return!1}}class sp{constructor(c,f,v,w,M,I,k,L){this.placement=new sr(c,M,I,k,L),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(c,f,v){const w=m.exported.now(),M=()=>{const I=m.exported.now()-w;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=f[c[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=k)&&(!I.maxzoom||I.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new As(I)),this._inProgressLayer.continuePlacement(v[I.source],this.placement,this._showCollisionBoxes,I,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const cs=512/m.EXTENT/2;class Mo{constructor(c,f,v){this.tileID=c,this.bucketInstanceId=v,this.index=new m.KDBush(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=c.canonical.x*m.EXTENT,M=c.canonical.y*m.EXTENT;for(let I=0;I<f.length;I++){const{key:k,crossTileID:L,tileAnchorX:V,tileAnchorY:U}=f.get(I),q=Math.floor((w+V)*cs),ne=Math.floor((M+U)*cs);this.index.add(q,ne),this.keys.push(k),this.crossTileIDs.push(L)}this.index.finish()}findMatches(c,f,v){const w=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),M=cs/Math.pow(2,f.canonical.z-this.tileID.canonical.z),I=f.canonical.x*m.EXTENT,k=f.canonical.y*m.EXTENT;for(let L=0;L<c.length;L++){const V=c.get(L);if(V.crossTileID)continue;const{key:U,tileAnchorX:q,tileAnchorY:ne}=V,oe=Math.floor((I+q)*M),ae=Math.floor((k+ne)*M),se=this.index.range(oe-w,ae-w,oe+w,ae+w);for(const le of se){const W=this.crossTileIDs[le];if(this.keys[le]===U&&!v.has(W)){v.add(W),V.crossTileID=W;break}}}}}class Gh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const f=Math.round((c-this.lng)/360);if(0!==f)for(const v in this.indexes){const w=this.indexes[v],M={};for(const I in w){const k=w[I];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+f),M[k.tileID.key]=k}this.indexes[v]=M}this.lng=c}addBucket(c,f,v){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let M=0;M<f.symbolInstances.length;M++)f.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const w=this.usedCrossTileIDs[c.overscaledZ];for(const M in this.indexes){const I=this.indexes[M];if(Number(M)>c.overscaledZ)for(const k in I){const L=I[k];L.tileID.isChildOf(c)&&L.findMatches(f.symbolInstances,c,w)}else{const k=I[c.scaledTo(Number(M)).key];k&&k.findMatches(f.symbolInstances,c,w)}}for(let M=0;M<f.symbolInstances.length;M++){const I=f.symbolInstances.get(M);I.crossTileID||(I.crossTileID=v.generate(),w.add(I.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Mo(c,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(c,f){for(const v of f.crossTileIDs)this.usedCrossTileIDs[c].delete(v)}removeStaleBuckets(c){let f=!1;for(const v in this.indexes){const w=this.indexes[v];for(const M in w)c[w[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[M]),delete w[M],f=!0)}return f}}class Ha{constructor(){this.layerIndexes={},this.crossTileIDs=new Gh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,f,v,w){let M=this.layerIndexes[c.id];void 0===M&&(M=this.layerIndexes[c.id]=new qd);let I=!1;const k={};"globe"!==w.name&&M.handleWrapJump(v);for(const L of f){const V=L.getBucket(c);V&&c.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(L.tileID,V,this.crossTileIDs)&&(I=!0),k[V.bucketInstanceId]=!0)}return M.removeStaleBuckets(k)&&(I=!0),I}pruneUnusedLayers(c){const f={};c.forEach(v=>{f[v]=!0});for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}const yl=(_,c)=>m.emitValidationErrors(_,c&&c.filter(f=>"source.canvas"!==f.identifier)),Wd=m.pick(Di,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ia=m.pick(Di,["setCenter","setZoom","setBearing","setPitch"]),$i={version:8,layers:[],sources:{}},qu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ga extends m.Evented{constructor(c,f={}){super(),this.map=c,this.dispatcher=new ii(nu(),this),this.imageManager=new Vl,this.imageManager.setEventedParent(this),this.glyphManager=new m.GlyphManager(c._requestManager,f.localFontFamily?m.LocalGlyphMode.all:f.localIdeographFontFamily?m.LocalGlyphMode.ideographs:m.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new Ha,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());const v=this;this._rtlTextPluginCallback=Ga.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(M,I)=>{if(m.triggerPluginCompletionEvent(M),I&&I.every(k=>k))for(const k in v._sourceCaches){const L=v._sourceCaches[k],V=L.getSource().type;"vector"!==V&&"geojson"!==V||L.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const M=this.getSource(w.sourceId);if(M&&M.vectorLayerIds)for(const I in this._layers){const k=this._layers[I];k.source===M.id&&this._validateLayer(k)}})}loadURL(c,f={}){this.fire(new m.Event("dataloading",{dataType:"style"}));const v="boolean"==typeof f.validate?f.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,f.accessToken);const w=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(w,(M,I)=>{this._request=null,M?this.fire(new m.ErrorEvent(M)):I&&this._load(I,v)})}loadJSON(c,f={}){this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.exported.frame(()=>{this._request=null,this._load(c,!1!==f.validate)})}loadEmpty(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load($i,!1)}_updateLayerCount(c,f){const v=f?1:-1;c.is3D()&&(this._num3DLayers+=v),"circle"===c.type&&(this._numCircleLayers+=v),"symbol"===c.type&&(this._numSymbolLayers+=v)}_load(c,f){if(f&&yl(this,m.validateStyle(c)))return;this._loaded=!0,this.stylesheet=m.clone$1(c),this._updateMapProjection();for(const w in c.sources)this.addSource(w,c.sources[w],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const v=$a(this.stylesheet.layers);this._order=v.map(w=>w.id),this._layers={},this._serializedLayers={};for(const w of v){const M=m.createStyleLayer(w);M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M,this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _o(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(f,v,w){let M,I,k;const L=m.exported.devicePixelRatio>1?"@2x":"";let V=m.getJSON(v.transformRequest(v.normalizeSpriteURL(f,L,".json"),m.ResourceType.SpriteJSON),(ne,oe)=>{V=null,k||(k=ne,M=oe,q())}),U=m.getImage(v.transformRequest(v.normalizeSpriteURL(f,L,".png"),m.ResourceType.SpriteImage),(ne,oe)=>{U=null,k||(k=ne,I=oe,q())});function q(){if(k)w(k);else if(M&&I){const ne=m.exported.getImageData(I),oe={};for(const ae in M){const{width:se,height:le,x:W,y:re,sdf:fe,pixelRatio:_e,stretchX:Te,stretchY:De,content:Se}=M[ae],Le=new m.RGBAImage({width:se,height:le});m.RGBAImage.copy(ne,Le,{x:W,y:re},{x:0,y:0},{width:se,height:le}),oe[ae]={data:Le,pixelRatio:_e,sdf:fe,stretchX:Te,stretchY:De,content:Se}}w(null,oe)}}return{cancel(){V&&(V.cancel(),V=null),U&&(U.cancel(),U=null)}}}(c,this.map._requestManager,(f,v)=>{if(this._spriteRequest=null,f)this.fire(new m.ErrorEvent(f));else if(v)for(const w in v)this.imageManager.addImage(w,v[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new m.Event("data",{dataType:"style"}))})}_validateLayer(c){const f=this.getSource(c.source);if(!f)return;const v=c.sourceLayer;v&&("geojson"===f.type||f.vectorLayerIds&&-1===f.vectorLayerIds.indexOf(v))&&this.fire(new m.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${f.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const f=[];for(const v of c){const w=this._layers[v];"custom"!==w.type&&f.push(w.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():qu[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const f=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);(w.length||M.length)&&this._updateWorkerLayers(w,M);for(const I in this._updatedSources){const k=this._updatedSources[I];"reload"===k?this._reloadSource(I):"clear"===k&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const v={};for(const w in this._sourceCaches){const M=this._sourceCaches[w];v[w]=M.used,M.used=!1}for(const w of this._order){const M=this._layers[w];if(M.recalculate(c,this._availableImages),!M.isHidden(c.zoom)){const k=this._getLayerSourceCache(M);k&&(k.used=!0)}const I=this.map.painter;if(I){const k=M.getProgramIds();if(!k)continue;const L=M.getProgramConfiguration(c.zoom);for(const V of k)I.useProgram(V,L)}}for(const w in v){const M=this._sourceCaches[w];v[w]!==M.used&&M.getSource().fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new m.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),yl(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=$a(c.layers);const f=function(w,M){if(!w)return[{command:Di.setStyle,args:[M]}];let I=[];try{if(!pt(w.version,M.version))return[{command:Di.setStyle,args:[M]}];pt(w.center,M.center)||I.push({command:Di.setCenter,args:[M.center]}),pt(w.zoom,M.zoom)||I.push({command:Di.setZoom,args:[M.zoom]}),pt(w.bearing,M.bearing)||I.push({command:Di.setBearing,args:[M.bearing]}),pt(w.pitch,M.pitch)||I.push({command:Di.setPitch,args:[M.pitch]}),pt(w.sprite,M.sprite)||I.push({command:Di.setSprite,args:[M.sprite]}),pt(w.glyphs,M.glyphs)||I.push({command:Di.setGlyphs,args:[M.glyphs]}),pt(w.transition,M.transition)||I.push({command:Di.setTransition,args:[M.transition]}),pt(w.light,M.light)||I.push({command:Di.setLight,args:[M.light]}),pt(w.fog,M.fog)||I.push({command:Di.setFog,args:[M.fog]}),pt(w.projection,M.projection)||I.push({command:Di.setProjection,args:[M.projection]});const k={},L=[];!function(q,ne,oe,ae){let se;for(se in ne=ne||{},q=q||{})q.hasOwnProperty(se)&&(ne.hasOwnProperty(se)||Js(se,oe,ae));for(se in ne){if(!ne.hasOwnProperty(se))continue;const le=ne[se];q.hasOwnProperty(se)?pt(q[se],le)||("geojson"===q[se].type&&"geojson"===le.type&&iu(q,ne,se)?oe.push({command:Di.setGeoJSONSourceData,args:[se,le.data]}):Is(se,ne,oe,ae)):zr(se,ne,oe)}}(w.sources,M.sources,L,k);const V=[];w.layers&&w.layers.forEach(q=>{q.source&&k[q.source]?I.push({command:Di.removeLayer,args:[q.id]}):V.push(q)});let U=w.terrain;U&&k[U.source]&&(I.push({command:Di.setTerrain,args:[void 0]}),U=void 0),I=I.concat(L),pt(U,M.terrain)||I.push({command:Di.setTerrain,args:[M.terrain]}),function(q,ne,oe){ne=ne||[];const ae=(q=q||[]).map(ta),se=ne.map(ta),le=q.reduce(Br,{}),W=ne.reduce(Br,{}),re=ae.slice(),fe=Object.create(null);let _e,Te,De,Se,Le,Fe,Ze;for(_e=0,Te=0;_e<ae.length;_e++)De=ae[_e],W.hasOwnProperty(De)?Te++:(oe.push({command:Di.removeLayer,args:[De]}),re.splice(re.indexOf(De,Te),1));for(_e=0,Te=0;_e<se.length;_e++)De=se[se.length-1-_e],re[re.length-1-_e]!==De&&(le.hasOwnProperty(De)?(oe.push({command:Di.removeLayer,args:[De]}),re.splice(re.lastIndexOf(De,re.length-Te),1)):Te++,Fe=re[re.length-_e],oe.push({command:Di.addLayer,args:[W[De],Fe]}),re.splice(re.length-_e,0,De),fe[De]=!0);for(_e=0;_e<se.length;_e++)if(De=se[_e],Se=le[De],Le=W[De],!fe[De]&&!pt(Se,Le))if(pt(Se.source,Le.source)&&pt(Se["source-layer"],Le["source-layer"])&&pt(Se.type,Le.type)){for(Ze in ea(Se.layout,Le.layout,oe,De,null,Di.setLayoutProperty),ea(Se.paint,Le.paint,oe,De,null,Di.setPaintProperty),pt(Se.filter,Le.filter)||oe.push({command:Di.setFilter,args:[De,Le.filter]}),pt(Se.minzoom,Le.minzoom)&&pt(Se.maxzoom,Le.maxzoom)||oe.push({command:Di.setLayerZoomRange,args:[De,Le.minzoom,Le.maxzoom]}),Se)Se.hasOwnProperty(Ze)&&"layout"!==Ze&&"paint"!==Ze&&"filter"!==Ze&&"metadata"!==Ze&&"minzoom"!==Ze&&"maxzoom"!==Ze&&(0===Ze.indexOf("paint.")?ea(Se[Ze],Le[Ze],oe,De,Ze.slice(6),Di.setPaintProperty):pt(Se[Ze],Le[Ze])||oe.push({command:Di.setLayerProperty,args:[De,Ze,Le[Ze]]}));for(Ze in Le)Le.hasOwnProperty(Ze)&&!Se.hasOwnProperty(Ze)&&"layout"!==Ze&&"paint"!==Ze&&"filter"!==Ze&&"metadata"!==Ze&&"minzoom"!==Ze&&"maxzoom"!==Ze&&(0===Ze.indexOf("paint.")?ea(Se[Ze],Le[Ze],oe,De,Ze.slice(6),Di.setPaintProperty):pt(Se[Ze],Le[Ze])||oe.push({command:Di.setLayerProperty,args:[De,Ze,Le[Ze]]}))}else oe.push({command:Di.removeLayer,args:[De]}),Fe=re[re.lastIndexOf(De)+1],oe.push({command:Di.addLayer,args:[Le,Fe]})}(V,M.layers,I)}catch(k){console.warn("Unable to compute style diff:",k),I=[{command:Di.setStyle,args:[M]}]}return I}(this.serialize(),c).filter(w=>!(w.command in ia));if(0===f.length)return!1;const v=f.filter(w=>!(w.command in Wd));if(v.length>0)throw new Error(`Unimplemented: ${v.map(w=>w.command).join(", ")}.`);return f.forEach(w=>{"setTransition"!==w.command&&"setProjection"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,f){return this.getImage(c)?this.fire(new m.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,f),this._afterImageUpdated(c),this)}updateImage(c,f){this.imageManager.updateImage(c,f)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new m.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,f,v={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(m.validateSource,`sources.${c}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const w=Kn(c,f,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:w.serialize(),sourceId:c}));const M=I=>{const k=(I?"symbol:":"other:")+c,L=this._sourceCaches[k]=new m.SourceCache(k,w,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[c]=L,L.style=this,L.onAdd(this.map)};M(!1),"vector"!==f.type&&"geojson"!==f.type||M(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const f=this.getSource(c);if(!f)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===c)return this.fire(new m.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new m.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(c);for(const w of v)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,f){this._checkLoaded(),this.getSource(c).setData(f),this._changed=!0}getSource(c){const f=this._getSourceCache(c);return f&&f.getSource()}_getSources(){const c=[];for(const f in this._otherSourceCaches){const v=this._getSourceCache(f);v&&c.push(v.getSource())}return c}addLayer(c,f,v={}){this._checkLoaded();const w=c.id;if(this.getLayer(w))return void this.fire(new m.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let M;if("custom"===c.type){if(yl(this,m.validateCustomStyleLayer(c)))return;M=m.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateLayer,`layers.${w}`,c,{arrayIndex:-1},v))return;M=m.createStyleLayer(c),this._validateLayer(M),M.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0)}const I=f?this._order.indexOf(f):this._order.length;if(f&&-1===I)return void this.fire(new m.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(I,0,w),this._layerOrderChanged=!0,this._layers[w]=M;const k=this._getLayerSourceCache(M);if(this._removedLayers[w]&&M.source&&k&&"custom"!==M.type){const L=this._removedLayers[w];delete this._removedLayers[w],L.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",k.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,f){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===f)return;const v=this._order.indexOf(c);this._order.splice(v,1);const w=f?this._order.indexOf(f):this._order.length;f&&-1===w?this.fire(new m.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(w,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const f=this._layers[c];if(!f)return void this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const v=this._order.indexOf(c);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=f,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const f in this._layers)if(this._layers[f].type===c)return!0;return!1}setLayerZoomRange(c,f,v){this._checkLoaded();const w=this.getLayer(c);w?w.minzoom===f&&w.maxzoom===v||(null!=f&&(w.minzoom=f),null!=v&&(w.maxzoom=v),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,f,v={}){this._checkLoaded();const w=this.getLayer(c);if(w){if(!pt(w.filter,f))return null==f?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateFilter,`layers.${w.id}.filter`,f,{layerType:w.type},v)||(w.filter=m.clone$1(f),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const f=this.getLayer(c);return f&&m.clone$1(f.filter)}setLayoutProperty(c,f,v,w={}){this._checkLoaded();const M=this.getLayer(c);M?pt(M.getLayoutProperty(f),v)||(M.setLayoutProperty(f,v,w),this._updateLayer(M)):this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,f){const v=this.getLayer(c);if(v)return v.getLayoutProperty(f);this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,f,v,w={}){this._checkLoaded();const M=this.getLayer(c);M?pt(M.getPaintProperty(f),v)||(M.setPaintProperty(f,v,w)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,f){const v=this.getLayer(c);return v&&v.getPaintProperty(f)}setFeatureState(c,f){this._checkLoaded();const v=c.source,w=c.sourceLayer,M=this.getSource(v);if(!M)return void this.fire(new m.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const I=M.type;if("geojson"===I&&w)return void this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!w)return void this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided.")));const k=this._getSourceCaches(v);for(const L of k)L.setFeatureState(w,c.id,f)}removeFeatureState(c,f){this._checkLoaded();const v=c.source,w=this.getSource(v);if(!w)return void this.fire(new m.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const M=w.type,I="vector"===M?c.sourceLayer:void 0;if("vector"===M&&!I)return void this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const k=this._getSourceCaches(v);for(const L of k)L.removeFeatureState(I,c.id,f)}getFeatureState(c){this._checkLoaded();const f=c.source,v=c.sourceLayer,w=this.getSource(f);if(w){if("vector"!==w.type||v)return void 0===c.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(v,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const f in this._sourceCaches){const v=this._sourceCaches[f].getSource();c[v.id]||(c[v.id]=v.serialize())}return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},f=>void 0!==f)}_updateLayer(c){this._updatedLayers[c.id]=!0;const f=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&f&&"raster"!==f.getSource().type&&(this._updatedSources[c.source]="reload",f.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const f=I=>"fill-extrusion"===this._layers[I].type,v={},w=[];for(let I=this._order.length-1;I>=0;I--){const k=this._order[I];if(f(k)){v[k]=I;for(const L of c){const V=L[k];if(V)for(const U of V)w.push(U)}}}w.sort((I,k)=>k.intersectionZ-I.intersectionZ);const M=[];for(let I=this._order.length-1;I>=0;I--){const k=this._order[I];if(f(k))for(let L=w.length-1;L>=0;L--){const V=w[L].feature;if(v[V.layer.id]<I)break;M.push(V),w.pop()}else for(const L of c){const V=L[k];if(V)for(const U of V)M.push(U.feature)}}return M}queryRenderedFeatures(c,f,v){f&&f.filter&&this._validate(m.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const w={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const L of f.layers){const V=this._layers[L];if(!V)return this.fire(new m.ErrorEvent(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];w[V.source]=!0}}const M=[];f.availableImages=this._availableImages;const I=f&&f.layers?f.layers.some(L=>{const V=this.getLayer(L);return V&&V.is3D()}):this.has3DLayers(),k=Ba.createFromScreenPoints(c,v);for(const L in this._sourceCaches){const V=this._sourceCaches[L].getSource().id;f.layers&&!w[V]||M.push(Wi(this._sourceCaches[L],this._layers,this._serializedLayers,k,f,v,I,!!this.map._showQueryGeometry))}return this.placement&&M.push(function(L,V,U,q,ne,oe,ae){const se={},le=oe.queryRenderedSymbols(q),W=[];for(const re of Object.keys(le).map(Number))W.push(ae[re]);W.sort(co);for(const re of W){const fe=re.featureIndex.lookupSymbolFeatures(le[re.bucketInstanceId],V,re.bucketIndex,re.sourceLayerIndex,ne.filter,ne.layers,ne.availableImages,L);for(const _e in fe){const Te=se[_e]=se[_e]||[],De=fe[_e];De.sort((Se,Le)=>{const Fe=re.featureSortOrder;if(Fe){const Ze=Fe.indexOf(Se.featureIndex);return Fe.indexOf(Le.featureIndex)-Ze}return Le.featureIndex-Se.featureIndex});for(const Se of De)Te.push(Se)}}for(const re in se)se[re].forEach(fe=>{const _e=fe.feature,Te=U(L[re]);if(!Te)return;const De=Te.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=De});return se}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),k.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(M)}querySourceFeatures(c,f){f&&f.filter&&this._validate(m.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const v=this._getSourceCaches(c);let w=[];for(const M of v)w=w.concat(bi(M,f));return w}addSourceType(c,f,v){return Ga.getSourceType(c)?v(new Error(`A source type called "${c}" already exists.`)):(Ga.setSourceType(c,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:f.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(c,f={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const I in c)if(!pt(c[I],v[I])){w=!0;break}if(!w)return;const M=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,f),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,f=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=c;if(1===f){if("object"==typeof v.source){const w="terrain-dem-src";this.addSource(w,v.source),v=m.clone$1(v),v=m.extend(v,{source:w})}if(this._validate(m.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,f)}else{const w=this.terrain,M=w.get();for(const I of Object.keys(m.spec.terrain))!v.hasOwnProperty(I)&&m.spec.terrain[I].default&&(v[I]=m.spec.terrain[I].default);for(const I in v)if(!pt(v[I],M[I])){w.set(v),this.stylesheet.terrain=v;const k=this._setTransitionParameters({duration:0});w.updateTransitions(k);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const f=this.fog=new hl(c,this.map.transform);this.stylesheet.fog=c;const v=this._setTransitionParameters({duration:0});f.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,v=f.get();0===Object.keys(c).length&&f.set(c);for(const w in c)if(!pt(c[w],v[w])){f.set(c),this.stylesheet.fog=c;const M=this._setTransitionParameters({duration:0});f.updateTransitions(M);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:m.exported.now(),transition:m.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(v=>this.isLayerDraped(this._layers[v])),f=this._order.filter(v=>!this.isLayerDraped(this._layers[v]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...f)}_createTerrain(c,f){const v=this.terrain=new Vu(c,f);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w=this._setTransitionParameters({duration:0});v.updateTransitions(w)}_force3DLayerUpdate(){for(const c in this._layers){const f=this._layers[c];"fill-extrusion"===f.type&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const f=this._layers[c];"symbol"===f.type&&this._updateLayer(f)}}_validate(c,f,v,w,M={}){return(!M||!1!==M.validate)&&yl(this,c.call(m.validateStyle,m.extend({key:f,style:this.serialize(),value:v,styleSpec:m.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const f=this._getSourceCaches(c);for(const v of f)v.clearTiles()}_reloadSource(c){const f=this._getSourceCaches(c);for(const v of f)v.resume(),v.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const f in this._sourceCaches)this._sourceCaches[f].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const f=this._sourceCaches[c];f.resume(),f.reload()}}_updatePlacement(c,f,v,w,M=!1){let I=!1,k=!1;const L={};for(const V of this._order){const U=this._layers[V];if("symbol"!==U.type)continue;if(!L[U.source]){const ne=this._getLayerSourceCache(U);if(!ne)continue;L[U.source]=ne.getRenderableIds(!0).map(oe=>ne.getTileByID(oe)).sort((oe,ae)=>ae.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(ae.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(U,L[U.source],c.center.lng,c.projection);I=I||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),M=M||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new m.Event("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.exported.now(),c.zoom))&&(this.pauseablePlacement=new sp(c,this._order,M,f,v,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.exported.now()),k=!0),I&&this.pauseablePlacement.placement.setStale()),k||I)for(const V of this._order){const U=this._layers[V];"symbol"===U.type&&this.placement.updateLayerOpacities(U,L[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,f,v){this.imageManager.getImages(f.icons,v),this._updateTilesForChangedImages();const w=M=>{M&&M.setDependencies(f.tileID.key,f.type,f.icons)};w(this._otherSourceCaches[f.source]),w(this._symbolSourceCaches[f.source])}getGlyphs(c,f,v){this.glyphManager.getGlyphs(f.stacks,v)}getResource(c,f,v){return m.makeRequest(f,v)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const f=[];return this._otherSourceCaches[c]&&f.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&f.push(this._symbolSourceCaches[c]),f}_isSourceCacheLoaded(c){const f=this._getSourceCaches(c);return 0===f.length?(this.fire(new m.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):f.every(v=>v.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ga.getSourceType=function(_){return Un[_]},Ga.setSourceType=function(_,c){Un[_]=c},Ga.registerForPluginStateChange=m.registerForPluginStateChange;var qh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Zt="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Gl="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Er="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Xo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ru={},ql={};const us=[];vl(qh,us),vl(Gl,us),vl(Er,us),vl(Xo,us),ru=en("",Gl),ql=en(Xo,Er);const Zd=en("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Wl=qh,Wu="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Zu={background:en("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:en("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:en("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:en("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:en("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:en("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:en("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:en("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:en("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:en("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:en("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:en("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:en("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:en("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:en("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:en("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:en("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:en("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:en("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:en("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:en("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:en("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:en("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:en("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:en("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:en("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Zt),skyboxGradient:en("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Zt),skyboxCapture:en("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:en("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:en("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function vl(_,c){const f=_.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let v of f)if(v=v.trim(),"#"===v[0]&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=v.split(" ");for(const M of w)c.includes(M)||c.push(M)}}function en(_,c){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w={},M=[...us];return vl(_,M),vl(c,M),{fragmentSource:_=_.replace(f,(I,k,L,V,U)=>(w[U]=!0,"define"===k?`\n#ifndef HAS_UNIFORM_u_${U}\nvarying ${L} ${V} ${U};\n#else\nuniform ${L} ${V} u_${U};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${U}\n    ${L} ${V} ${U} = u_${U};\n#endif\n`)),vertexSource:c=c.replace(f,(I,k,L,V,U)=>{const q="float"===V?"vec2":"vec4",ne=U.match(/color/)?"color":q;return w[U]?"define"===k?`\n#ifndef HAS_UNIFORM_u_${U}\nuniform lowp float u_${U}_t;\nattribute ${L} ${q} a_${U};\nvarying ${L} ${V} ${U};\n#else\nuniform ${L} ${V} u_${U};\n#endif\n`:"vec4"===ne?`\n#ifndef HAS_UNIFORM_u_${U}\n    ${U} = a_${U};\n#else\n    ${L} ${V} ${U} = u_${U};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${U}\n    ${U} = unpack_mix_${ne}(a_${U}, u_${U}_t);\n#else\n    ${L} ${V} ${U} = u_${U};\n#endif\n`:"define"===k?`\n#ifndef HAS_UNIFORM_u_${U}\nuniform lowp float u_${U}_t;\nattribute ${L} ${q} a_${U};\n#else\nuniform ${L} ${V} u_${U};\n#endif\n`:"vec4"===ne?`\n#ifndef HAS_UNIFORM_u_${U}\n    ${L} ${V} ${U} = a_${U};\n#else\n    ${L} ${V} ${U} = u_${U};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${U}\n    ${L} ${V} ${U} = unpack_mix_${ne}(a_${U}, u_${U}_t);\n#else\n    ${L} ${V} ${U} = u_${U};\n#endif\n`}),staticAttributes:v,usedDefines:M}}class Xd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,f,v,w,M,I,k){this.context=c;let L=this.boundPaintVertexBuffers.length!==w.length;for(let U=0;!L&&U<w.length;U++)this.boundPaintVertexBuffers[U]!==w[U]&&(L=!0);let V=this.boundDynamicVertexBuffers.length!==k.length;for(let U=0;!V&&U<k.length;U++)this.boundDynamicVertexBuffers[U]!==k[U]&&(V=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||L||V||this.boundIndexBuffer!==M||this.boundVertexOffset!==I)this.freshBind(f,v,w,M,I,k);else{c.bindVertexArrayOES.set(this.vao);for(const U of k)U&&U.bind();M&&M.dynamicDraw&&M.bind()}}freshBind(c,f,v,w,M,I){let k;const L=c.numAttributes,V=this.context,U=V.gl;if(V.extVertexArrayObject)this.vao&&this.destroy(),this.vao=V.extVertexArrayObject.createVertexArrayOES(),V.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=c,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=I;else{k=V.currentNumAttributes||0;for(let q=L;q<k;q++)U.disableVertexAttribArray(q)}f.enableAttributes(U,c),f.bind(),f.setVertexAttribPointers(U,c,M);for(const q of v)q.enableAttributes(U,c),q.bind(),q.setVertexAttribPointers(U,c,M);for(const q of I)q&&(q.enableAttributes(U,c),q.bind(),q.setVertexAttribPointers(U,c,M));w&&w.bind(),V.currentNumAttributes=L}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Yd(_,c){const f=Math.pow(2,c.canonical.z),v=c.canonical.y;return[new m.MercatorCoordinate(0,v/f).toLngLat().lat,new m.MercatorCoordinate(0,(v+1)/f).toLngLat().lat]}function Qr(_,c,f,v,w,M,I){const k=_.context,L=k.gl,V=f.fbo;if(!V)return;_.prepareDrawTile();const U=_.useProgram("hillshade");k.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,V.colorAttachment.get());const q=((se,le,W,re)=>{const fe=W.paint.get("hillshade-shadow-color"),_e=W.paint.get("hillshade-highlight-color"),Te=W.paint.get("hillshade-accent-color");let De=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===W.paint.get("hillshade-illumination-anchor")&&(De-=se.transform.angle);const Se=!se.options.moving;return{u_matrix:re||se.transform.calculateProjMatrix(le.tileID.toUnwrapped(),Se),u_image:0,u_latrange:Yd(0,le.tileID),u_light:[W.paint.get("hillshade-exaggeration"),De],u_shadow:fe,u_highlight:_e,u_accent:Te}})(_,f,v,_.terrain?c.projMatrix:null);_.prepareDrawProgram(k,U,c.toUnwrapped());const{tileBoundsBuffer:ne,tileBoundsIndexBuffer:oe,tileBoundsSegments:ae}=_.getTileBoundsBuffers(f);U.draw(k,L.TRIANGLES,w,M,I,m.CullFaceMode.disabled,q,v.id,ne,oe,ae)}function Xu(_,c,f){if(!c.needsDEMTextureUpload)return;const v=_.context,w=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||_.getTileTexture(f.stride);const M=f.getPixels();c.demTexture?c.demTexture.update(M,{premultiply:!1}):c.demTexture=new m.Texture(v,M,w.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function Am(_,c,f,v,w,M){const I=_.context,k=I.gl;if(!c.dem)return;const L=c.dem;if(I.activeTexture.set(k.TEXTURE1),Xu(_,c,L),!c.demTexture)return;c.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);const V=L.dim;I.activeTexture.set(k.TEXTURE0);let U=c.fbo;if(!U){const ae=new m.Texture(I,{width:V,height:V,data:null},k.RGBA);ae.bind(k.LINEAR,k.CLAMP_TO_EDGE),U=c.fbo=I.createFramebuffer(V,V,!0),U.colorAttachment.set(ae.texture)}I.bindFramebuffer.set(U.framebuffer),I.viewport.set([0,0,V,V]);const{tileBoundsBuffer:q,tileBoundsIndexBuffer:ne,tileBoundsSegments:oe}=_.getMercatorTileBoundsBuffers();_.useProgram("hillshadePrepare").draw(I,k.TRIANGLES,v,w,M,m.CullFaceMode.disabled,((ae,se)=>{const le=se.stride,W=m.create();return m.ortho(W,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(W,W,[0,-m.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[le,le],u_zoom:ae.overscaledZ,u_unpack:se.unpackVector}})(c.tileID,L),f.id,q,ne,oe),c.needsHillshadePrepare=!1}const ar=_=>({u_matrix:new m.UniformMatrix4f(_),u_image0:new m.Uniform1i(_),u_skirt_height:new m.Uniform1f(_)}),yc=(_,c)=>({u_matrix:_,u_image0:0,u_skirt_height:c}),vc=(_,c,f,v,w,M,I,k,L,V,U,q,ne,oe,ae)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:f,u_zoom_transition:w,u_merc_center:M,u_image0:0,u_frustum_tl:I,u_frustum_tr:k,u_frustum_br:L,u_frustum_bl:V,u_globe_pos:U,u_globe_radius:q,u_viewport:ne,u_grid_matrix:ae?Float32Array.from(ae):new Float32Array(9),u_skirt_height:oe});function bc(_,c){return null!=_&&null!=c&&!(!_.hasData()||!c.hasData())&&null!=_.demTexture&&null!=c.demTexture&&_.tileID.key!==c.tileID.key}const Yo=new class{constructor(){this.operations={}}newMorphing(_,c,f,v,w){if(_ in this.operations){const M=this.operations[_];M.to.tileID.key!==f.tileID.key&&(M.queued=f)}else this.operations[_]={startTime:v,phase:0,duration:w,from:c,to:f,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const c=this.operations[_];return{from:c.from,to:c.to,phase:c.phase}}update(_){for(const c in this.operations){const f=this.operations[c];for(f.phase=(_-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,_)){delete this.operations[c];break}}}_nextOp(_,c){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=c,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},Ta={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Da(_){return 6*Math.pow(1.5,22-_)}function ap(_,c){const f=1<<_.z;return!c&&(0===_.x||_.x===f-1)||0===_.y||_.y===f-1}const Yu=_=>({u_matrix:_});function Wh(_,c,f,v,w){if(w>0){const M=m.exported.now(),I=(M-_.timeAdded)/w,k=c?(M-c.timeAdded)/w:-1,L=f.getSource(),V=v.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),U=!c||Math.abs(c.tileID.overscaledZ-V)>Math.abs(_.tileID.overscaledZ-V),q=U&&_.refreshedUponExpiration?1:m.clamp(U?I:1-k,0,1);return _.refreshedUponExpiration&&I>=1&&(_.refreshedUponExpiration=!1),c?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}class Kd extends m.SourceCache{constructor(c){const f={type:"raster-dem",maxzoom:c.transform.maxZoom},v=new ii(nu(),null),w=Kn("mock-dem",f,v,c.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,f){c.state="loaded",f(null)}}class bl extends m.SourceCache{constructor(c){const f=Kn("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new ii(nu(),null),c.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,f,v){if(c.freezeTileCoverage)return;this.transform=c;const w=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((M,I)=>{if(M[I.key]="",!this._tiles[I.key]){const k=new m.Tile(I,this._source.tileSize*I.overscaleFactor(),c.tileZoom);k.state="loaded",this._tiles[I.key]=k}return M},{});for(const M in this._tiles)M in w||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(c){const f=this.proxyCachedFBO[c];if(void 0!==f){const v=Object.values(f);this.renderCachePool.push(...v),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ku extends m.OverscaledTileID{constructor(c,f,v){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=f,this.projMatrix=v}}class ra extends m.Elevation{constructor(c,f){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,w,M]=function(L){const V=new m.StructArrayLayout2i4,U=new m.StructArrayLayout3ui6,q=131;V.reserve(17161),U.reserve(33800);const ne=m.EXTENT/128,oe=m.EXTENT+ne/2,ae=oe+ne;for(let le=-ne;le<ae;le+=ne)for(let W=-ne;W<ae;W+=ne){const re=W<0||W>oe||le<0||le>oe?24575:0,fe=m.clamp(Math.round(W),0,m.EXTENT),_e=m.clamp(Math.round(le),0,m.EXTENT);V.emplaceBack(fe+re,_e)}const se=(le,W)=>{const re=W*q+le;U.emplaceBack(re+1,re,re+q),U.emplaceBack(re+q,re+q+1,re+1)};for(let le=1;le<129;le++)for(let W=1;W<129;W++)se(W,le);return[0,129].forEach(le=>{for(let W=0;W<130;W++)se(W,le),se(le,W)}),[V,U,32768]}(),I=c.context;this.gridBuffer=I.createVertexBuffer(v,m.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(w),this.gridSegments=m.SegmentVector.simpleSegment(0,0,v.length,w.length),this.gridNoSkirtSegments=m.SegmentVector.simpleSegment(0,0,v.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new bl(f.map),this.orthoMatrix=m.create(),m.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,m.EXTENT,0,m.EXTENT,0,1);const k=I.gl;this._overlapStencilMode=new m.StencilMode({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Kd(f.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,f,v){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const w=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const M=()=>{this.sourceCache.used&&m.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(f,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,M(),this._initializing=!0),M(),f.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&m.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(m.MercatorCoordinate.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=f.getIds().map(L=>{const V=f.getTileByID(L).tileID;return V.projMatrix=v.calculateProjMatrix(V.toUnwrapped()),V});(function(L,V){const U=V.transform.pointCoordinate(V.transform.getCameraPoint()),q=new m.Point(U.x,U.y);L.sort((ne,oe)=>{if(oe.overscaledZ-ne.overscaledZ)return oe.overscaledZ-ne.overscaledZ;const ae=new m.Point(ne.canonical.x+(1<<ne.canonical.z)*ne.wrap,ne.canonical.y),se=new m.Point(oe.canonical.x+(1<<oe.canonical.z)*oe.wrap,oe.canonical.y),le=q.mult(1<<ne.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(ae)-le.distSqr(se)})})(w,this.painter),this._previousZoom=v.zoom;const M=this.proxyToSource||{};this.proxyToSource={},w.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const L in I){const V=I[L];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,c[L],M),V.usedForTerrain))continue;const U=c[L];V.getSource().reparseOverscaled&&this._assignTerrainTiles(U)}this.proxiedCoords[f.id]=w.map(L=>new Ku(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1,this._updateTimestamp=m.exported.now();const k={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const V=this.terrainTileForTile[L.key];if(!V)continue;const U=V.tileID.key;U in k||(this._visibleDemTiles.push(V),k[U]=U)}}_assignTerrainTiles(c){this._initializing||c.forEach(f=>{if(this.terrainTileForTile[f.key])return;const v=this._findTileCoveringTileID(f,this.sourceCache);v&&(this.terrainTileForTile[f.key]=v)})}_prepareDEMTextures(){const c=this.painter.context,f=c.gl;for(const v in this.terrainTileForTile){const w=this.terrainTileForTile[v],M=w.dem;!M||w.demTexture&&!w.needsDEMTextureUpload||(c.activeTexture.set(f.TEXTURE1),Xu(this.painter,w,M))}}_prepareDemTileUniforms(c,f,v,w){if(!f||null==f.demTexture)return!1;const M=c.tileID.canonical,I=Math.pow(2,f.tileID.canonical.z-M.z),k=w||"";return v[`u_dem_tl${k}`]=[M.x*I%1,M.y*I%1],v[`u_dem_scale${k}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,f=c.gl;if(!this._emptyDepthBufferTexture){const v=new m.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new m.Texture(c,v,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const f=this._visibleDemTiles.reduce((v,w)=>{if(!w.dem)return v;const M=w.dem.tree.minimums[0];return M>0&&c++,v+M},0);return c?f/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,f=c.gl;c.activeTexture.set(f.TEXTURE2);const v=this._getLoadedAreaMinimum(),w=new m.RGBAImage({width:1,height:1},new Uint8Array(m.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(w,{premultiply:!1}):M=this._emptyDEMTexture=new m.Texture(c,w,f.RGBA,{premultiply:!1}),M}setupElevationDraw(c,f,v){const w=this.painter.context,M=w.gl,I=(k=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:m.DEMData.getUnpackVector(k),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var k;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let L=null,V=null,U=1;if(v&&v.morphing&&this._useVertexMorphing){const q=v.morphing.srcDemTile,ne=v.morphing.dstDemTile;U=v.morphing.phase,q&&ne&&(this._prepareDemTileUniforms(c,q,I,"_prev")&&(V=q),this._prepareDemTileUniforms(c,ne,I)&&(L=ne))}if(V&&L?(w.activeTexture.set(M.TEXTURE2),L.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE,M.NEAREST),w.activeTexture.set(M.TEXTURE4),V.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE,M.NEAREST),I.u_dem_lerp=U):(L=this.terrainTileForTile[c.tileID.key],w.activeTexture.set(M.TEXTURE2),(this._prepareDemTileUniforms(c,L,I)?L.demTexture:this.emptyDEMTexture).bind(M.NEAREST,M.CLAMP_TO_EDGE)),w.activeTexture.set(M.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&L){const q=(1<<L.tileID.canonical.z)*m.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=q}if(v&&v.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),f.setTerrainUniformValues(w,I),"globe"===this.painter.transform.projection.name){const q=this.globeUniformValues(this.painter.transform,c.tileID.canonical,v&&v.useDenormalizedUpVectorScale);f.setGlobeUniformValues(w,q)}}globeUniformValues(c,f,v){const w=c.projection;return{u_tile_tl_up:w.upVector(f,0,0),u_tile_tr_up:w.upVector(f,m.EXTENT,0),u_tile_br_up:w.upVector(f,m.EXTENT,m.EXTENT),u_tile_bl_up:w.upVector(f,0,m.EXTENT),u_tile_up_scale:v?m.globeMetersToEcef(1):w.upVectorScale(f,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const f=this.painter,v=this.painter.context;0!==c.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,M,I,k,L){if("globe"===w.transform.projection.name)!function(V,U,q,ne,oe){const ae=V.context,se=ae.gl;let le,W;const re=V.options.showTerrainWireframe?2:0,fe=V.transform,_e=m.globeUseCustomAntiAliasing(V,ae,fe),Te=(Et,qe)=>{if(W===Et)return;const ct=[Ta[Et],"PROJECTION_GLOBE_VIEW"];_e&&ct.push("CUSTOM_ANTIALIASING"),qe&&ct.push(Ta[re]),le=V.useProgram("globeRaster",null,ct),W=Et},De=V.colorModeForRenderPass(),Se=new m.DepthMode(se.LEQUAL,m.DepthMode.ReadWrite,V.depthRangeFor3D);Yo.update(oe);const Le=m.calculateGlobeMercatorMatrix(fe),Fe=[m.mercatorXfromLng(fe.center.lng),m.mercatorYfromLat(fe.center.lat)],Ze=re?[!1,!0]:[!1],ht=V.globeSharedBuffers,je=[fe.width*m.exported.devicePixelRatio,fe.height*m.exported.devicePixelRatio],dt=Float32Array.from(fe.globeMatrix),He={useDenormalizedUpVectorScale:!0};if(Ze.forEach(Et=>{const qe=V.transform,ct=Da(qe.zoom)*U.exaggeration();W=-1;const _t=Et?se.LINES:se.TRIANGLES;for(const yt of ne){const It=q.getTile(yt),wn=m.StencilMode.disabled,kn=U.prevTerrainTileForTile[yt.key],ln=U.terrainTileForTile[yt.key];bc(kn,ln)&&Yo.newMorphing(yt.key,kn,ln,oe,250),ae.activeTexture.set(se.TEXTURE0),It.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const Sn=Yo.getMorphValuesForProxy(yt.key),ui=Sn?1:0;Sn&&m.extend$1(He,{morphing:{srcDemTile:Sn.from,dstDemTile:Sn.to,phase:m.easeCubicInOut(Sn.phase)}});const li=m.tileCornersToBounds(yt.canonical),gn=m.getLatitudinalLod(li.getCenter().lat),Xi=m.getGridMatrix(yt.canonical,li,gn,qe.worldSize/qe._pixelsPerMercatorPixel),cn=m.globeNormalizeECEF(m.globeTileBounds(yt.canonical)),lr=vc(qe.projMatrix,dt,Le,cn,m.globeToMercatorTransition(qe.zoom),Fe,qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.globeCenterInViewSpace,qe.globeRadius,je,ct,Xi);if(Te(ui,Et),U.setupElevationDraw(It,le,He),V.prepareDrawProgram(ae,le,yt.toUnwrapped()),ht){const[vr,ps,Fo]=Et?ht.getWirefameBuffers(V.context,gn):ht.getGridBuffers(gn,0!==ct);le.draw(ae,_t,Se,wn,De,m.CullFaceMode.backCCW,lr,"globe_raster",vr,ps,Fo)}}}),ht){const Et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_e&&Et.push("CUSTOM_ANTIALIASING"),le=V.useProgram("globeRaster",null,Et);for(const qe of ne){const{x:ct,y:_t,z:yt}=qe.canonical,It=0===_t,wn=_t===(1<<yt)-1,[kn,ln,Sn,ui]=ht.getPoleBuffers(yt);if(ui&&(It||wn)){const li=q.getTile(qe);ae.activeTexture.set(se.TEXTURE0),li.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);let gn=m.globePoleMatrixForTile(yt,ct,fe);const Xi=m.globeNormalizeECEF(m.globeTileBounds(qe.canonical)),cn=(lr,vr)=>lr.draw(ae,se.TRIANGLES,Se,m.StencilMode.disabled,De,m.CullFaceMode.disabled,vc(fe.projMatrix,gn,gn,Xi,0,Fe,fe.frustumCorners.TL,fe.frustumCorners.TR,fe.frustumCorners.BR,fe.frustumCorners.BL,fe.globeCenterInViewSpace,fe.globeRadius,je,0),"globe_pole_raster",vr,Sn,ui);U.setupElevationDraw(li,le,He),V.prepareDrawProgram(ae,le,qe.toUnwrapped()),It&&cn(le,kn),wn&&(gn=m.scale(m.create(),gn,[1,-1,1]),cn(le,ln))}}}}(w,M,I,k,L);else{const V=w.context,U=V.gl;let q,ne;const oe=w.options.showTerrainWireframe?2:0,ae=(fe,_e)=>{if(ne===fe)return;const Te=[Ta[fe]];_e&&Te.push(Ta[oe]),q=w.useProgram("terrainRaster",null,Te),ne=fe},se=w.colorModeForRenderPass(),le=new m.DepthMode(U.LEQUAL,m.DepthMode.ReadWrite,w.depthRangeFor3D);Yo.update(L);const W=w.transform,re=Da(W.zoom)*M.exaggeration();(oe?[!1,!0]:[!1]).forEach(fe=>{ne=-1;const _e=fe?U.LINES:U.TRIANGLES,[Te,De]=fe?M.getWirefameBuffer():[M.gridIndexBuffer,M.gridSegments];for(const Se of k){const Le=I.getTile(Se),Fe=m.StencilMode.disabled,Ze=M.prevTerrainTileForTile[Se.key],ht=M.terrainTileForTile[Se.key];bc(Ze,ht)&&Yo.newMorphing(Se.key,Ze,ht,L,250),V.activeTexture.set(U.TEXTURE0),Le.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST);const je=Yo.getMorphValuesForProxy(Se.key),dt=je?1:0;let He;je&&(He={morphing:{srcDemTile:je.from,dstDemTile:je.to,phase:m.easeCubicInOut(je.phase)}});const Et=yc(Se.projMatrix,ap(Se.canonical,W.renderWorldCopies)?re/10:re);ae(dt,fe),M.setupElevationDraw(Le,q,He),w.prepareDrawProgram(V,q,Se.toUnwrapped()),q.draw(V,_e,le,Fe,se,m.CullFaceMode.backCCW,Et,"terrain_raster",M.gridBuffer,Te,De)}})}}(f,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const f=this.painter,v=this.painter.context,w=this.proxySourceCache,M=this.proxiedCoords[w.id],I=this._drapedRenderBatches.shift(),k=[],L=f.style.order;let V=0;for(const U of M){const q=w.getTileByID(U.proxyTileKey),ne=w.proxyCachedFBO[U.key]?w.proxyCachedFBO[U.key][c]:void 0,oe=void 0!==ne?w.renderCache[ne]:this.pool[V++],ae=void 0!==ne;if(q.texture=oe.tex,ae&&!oe.dirty){k.push(q.tileID);continue}let se;v.bindFramebuffer.set(oe.fb.framebuffer),this.renderedToTile=!1,oe.dirty&&(v.clear({color:m.Color.transparent,stencil:0}),oe.dirty=!1);for(let le=I.start;le<=I.end;++le){const W=f.style._layers[L[le]];if(W.isHidden(f.transform.zoom))continue;const re=f.style._getLayerSourceCache(W),fe=re?this.proxyToSource[U.key][re.id]:[U];if(!fe)continue;const _e=fe;v.viewport.set([0,0,oe.fb.width,oe.fb.height]),se!==(re?re.id:null)&&(this._setupStencil(oe,fe,W,re),se=re?re.id:null),f.renderLayer(f,re,W,_e)}this.renderedToTile?(oe.dirty=!0,k.push(q.tileID)):ae||--V,5===V&&(V=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),I.end+1}postRender(){}renderCacheEfficiency(c){const f=c.order.length;if(0===f)return{efficiency:100};let v,w=0,M=0,I=!1;for(let k=0;k<f;++k){const L=c._layers[c.order[k]];this._style.isLayerDraped(L)?(I&&++w,++M):I||(I=!0,v=L.id)}return 0===M?{efficiency:100}:{efficiency:100*(1-w/M),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{c=Math.min(c,f.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,f,v){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(M=>M.dem).map(M=>{const I=M.tileID,k=1<<I.overscaledZ,{x:L,y:V}=I.canonical,U=L/k,q=(L+1)/k,ne=V/k,oe=(V+1)/k;return{minx:U,miny:ne,maxx:q,maxy:oe,t:M.dem.tree.raycastRoot(U,ne,q,oe,c,f,v),tile:M}});w.sort((M,I)=>(null!==M.t?M.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const M of w){if(null==M.t)return null;const I=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,c,f,v);if(null!=I)return I}return null}_createFBO(){const c=this.painter.context,f=c.gl,v=this.drapeBufferSize;c.activeTexture.set(f.TEXTURE0);const w=new m.Texture(c,{width:v[0],height:v[1],data:null},f.RGBA);w.bind(f.LINEAR,f.CLAMP_TO_EDGE);const M=c.createFramebuffer(v[0],v[1],!1);return M.colorAttachment.set(w.texture),M.depthAttachment=new Oe(c,M.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:M,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const f=this._style._layers[c],v=f.isHidden(this.painter.transform.zoom);return"custom"===f.type?!v&&f.shouldRedrape():!v&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const v of this._style._getSources())if(v instanceof Vt){c=!0;break}if(!c)return;const f={};for(let v=0;v<this._style.order.length;++v){const w=this._style._layers[this._style.order[v]],M=this._style._getLayerSourceCache(w);if(M&&!f[M.id]&&!w.isHidden(this.painter.transform.zoom)&&"line"===w.type&&w.widthExpression()instanceof m.ZoomDependentExpression){f[M.id]=!0;for(const I of this.proxyCoords){const k=this.proxyToSource[I.key][M.id];if(k)for(const L of k)this._clearRenderCacheForTile(M.id,L)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof Tt){c=!0;break}if(!c)return;const f={};for(let v=0;v<this._style.order.length;++v){const w=this._style._layers[this._style.order[v]],M=this._style._getLayerSourceCache(w);if(!M||f[M.id]||w.isHidden(this.painter.transform.zoom)||"raster"!==w.type)continue;const I=w.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const L=this.proxyToSource[k.key][M.id];if(L)for(const V of L){const U=Wh(M.getTile(V),M.findLoadedParent(V,0),M,this.painter.transform,I);(1!==U.opacity||0!==U.mix)&&this._clearRenderCacheForTile(M.id,V)}}}}_setupDrapedRenderBatches(){const c=this._style.order,f=c.length;if(0===f)return;const v=[];let w,M=0,I=this._style._layers[c[M]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++M<f;)I=this._style._layers[c[M]];for(;M<f;++M){const k=this._style._layers[c[M]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?void 0===w&&(w=M):void 0!==w&&(v.push({start:w,end:M-1}),w=void 0))}void 0!==w&&v.push({start:w,end:M-1}),this._drapedRenderBatches=v}_setupRenderCache(c){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const I=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let k=0;k<I.length;++k){const L=Object.values(I[k]);f.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,w=this._tilesDirty;for(let I=v.length-1;I>=0;I--){const k=v[I];if(f.getTileByID(k.key),void 0!==f.proxyCachedFBO[k.key]){const L=c[k.key],V=this.proxyToSource[k.key];let U=0;for(const q in V){const ne=V[q],oe=L[q];if(!oe||oe.length!==ne.length||ne.some((ae,se)=>ae!==oe[se]||w[q]&&w[q].hasOwnProperty(ae.key))){U=-1;break}++U}for(const q in f.proxyCachedFBO[k.key])f.renderCache[f.proxyCachedFBO[k.key][q]].dirty=U<0||U!==Object.values(L).length}}const M=[...this._drapedRenderBatches];M.sort((I,k)=>k.end-k.start-(I.end-I.start));for(const I of M)for(const k of v){if(f.proxyCachedFBO[k.key])continue;let L=f.renderCachePool.pop();void 0===L&&f.renderCache.length<50&&(L=f.renderCache.length,f.renderCache.push(this._createFBO())),void 0!==L&&(f.proxyCachedFBO[k.key]={},f.proxyCachedFBO[k.key][I.start]=L,f.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(c,f,v,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,I=M.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let k;if(v.isTileClipped())k=f.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):m.StencilMode.disabled}_renderTileClippingMasks(c,f){const v=this.painter,w=this.painter.context,M=w.gl;v._tileClippingMaskIDs={},w.setColorMode(m.ColorMode.disabled),w.setDepthMode(m.DepthMode.disabled);const I=v.useProgram("clippingMask");for(const k of c){const L=v._tileClippingMaskIDs[k.key]=--f;I.draw(w,M.TRIANGLES,m.DepthMode.disabled,new m.StencilMode({func:M.ALWAYS,mask:0},L,255,M.KEEP,M.KEEP,M.REPLACE),m.ColorMode.disabled,m.CullFaceMode.disabled,Yu(k.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(c){const f=this.painter.transform;if(c.x<0||c.x>f.width||c.y<0||c.y>f.height)return null;const v=[c.x,c.y,1,1];m.transformMat4$1(v,v,f.pixelMatrixInverse),m.scale$1(v,v,1/v[3]),v[0]/=f.worldSize,v[1]/=f.worldSize;const w=f._camera.position,M=m.mercatorZfromAltitude(1,f.center.lat),I=[w[0],w[1],w[2]/M,0],k=m.subtract([],v.slice(0,3),I);m.normalize(k,k);const L=this.raycast(I,k,this._exaggeration);return null!==L&&L?(m.scaleAndAdd(I,I,k,L),I[3]=I[2],I[2]*=M,I):null}drawDepth(){const c=this.painter,f=c.context,v=this.proxySourceCache,w=Math.ceil(c.width),M=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===M||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=f.gl,k=f.createFramebuffer(w,M,!0);f.activeTexture.set(I.TEXTURE0);const L=new m.Texture(f,{width:w,height:M,data:null},I.RGBA);L.bind(I.NEAREST,I.CLAMP_TO_EDGE),k.colorAttachment.set(L.texture);const V=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,w,M);k.depthAttachment.set(V),this._depthFBO=k,this._depthTexture=L}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,w,M]),function(I,k,L,V){if("globe"===I.transform.projection.name)return;const U=I.context,q=U.gl;U.clear({depth:1});const ne=I.useProgram("terrainDepth"),oe=new m.DepthMode(q.LESS,m.DepthMode.ReadWrite,I.depthRangeFor3D);for(const ae of V){const se=L.getTile(ae),le=yc(ae.projMatrix,0);k.setupElevationDraw(se,ne),ne.draw(U,q.TRIANGLES,oe,m.StencilMode.disabled,m.ColorMode.unblended,m.CullFaceMode.backCCW,le,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(c,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,f,v){if(c.getSource()instanceof Fn)return this._setupProxiedCoordsForImageSource(c,f,v);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const w=this.proxiedCoords[c.id]=[],M=this.proxyCoords;for(let k=0;k<M.length;k++){const L=M[k],V=this._findTileCoveringTileID(L,c);if(V){const U=this._createProxiedId(L,V,v[L.key]&&v[L.key][c.id]);w.push(U),this.proxyToSource[L.key][c.id]=[U]}}let I=!1;for(let k=0;k<f.length;k++){const L=c.getTile(f[k]);if(!L||!L.hasData())continue;const V=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(V&&V.tileID.canonical.z!==L.tileID.canonical.z){const U=this.proxyToSource[V.tileID.key][c.id],q=this._createProxiedId(V.tileID,L,v[V.tileID.key]&&v[V.tileID.key][c.id]);U?U.splice(U.length-1,0,q):this.proxyToSource[V.tileID.key][c.id]=[q],w.push(q),I=!0}}this._sourceTilesOverlap[c.id]=I}_setupProxiedCoordsForImageSource(c,f,v){if(!c.getSource().loaded())return;const w=this.proxiedCoords[c.id]=[],M=this.proxyCoords,I=c.getSource(),k=new m.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),L=I.coordinates.map(m.MercatorCoordinate.fromLngLat).reduce((U,q)=>(U.min.x=Math.min(U.min.x,q.x-k.x),U.min.y=Math.min(U.min.y,q.y-k.y),U.max.x=Math.max(U.max.x,q.x-k.x),U.max.y=Math.max(U.max.y,q.y-k.y),U),{min:new m.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new m.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),V=(U,q)=>{const ne=U.wrap+U.canonical.x/(1<<U.canonical.z),oe=U.canonical.y/(1<<U.canonical.z),ae=m.EXTENT/(1<<U.canonical.z),se=q.wrap+q.canonical.x/(1<<q.canonical.z),le=q.canonical.y/(1<<q.canonical.z);return ne+ae<se+L.min.x||ne>se+L.max.x||oe+ae<le+L.min.y||oe>le+L.max.y};for(let U=0;U<M.length;U++){const q=M[U];for(let ne=0;ne<f.length;ne++){const oe=c.getTile(f[ne]);if(!oe||!oe.hasData()||V(q,oe.tileID))continue;const ae=this._createProxiedId(q,oe,v[q.key]&&v[q.key][c.id]),se=this.proxyToSource[q.key][c.id];se?se.push(ae):this.proxyToSource[q.key][c.id]=[ae],w.push(ae)}}}_createProxiedId(c,f,v){let w=this.orthoMatrix;if(v){const M=v.find(I=>I.key===f.tileID.key);if(M)return M}if(f.tileID.key!==c.key){const M=c.canonical.z-f.tileID.canonical.z;let I,k,L;w=m.create();const V=f.tileID.wrap-c.wrap<<c.overscaledZ;M>0?(I=m.EXTENT>>M,k=I*((f.tileID.canonical.x<<M)-c.canonical.x+V),L=I*((f.tileID.canonical.y<<M)-c.canonical.y)):(I=m.EXTENT<<-M,k=m.EXTENT*(f.tileID.canonical.x-(c.canonical.x+V<<-M)),L=m.EXTENT*(f.tileID.canonical.y-(c.canonical.y<<-M))),m.ortho(w,0,I,0,I,0,1),m.translate(w,w,[k,L,0])}return new Ku(f.tileID,c.key,w)}_findTileCoveringTileID(c,f){let v=f.getTile(c);if(v&&v.hasData())return v;const w=this._findCoveringTileCache[f.id],M=w[c.key];if(v=M?f.getTileByID(M):null,v&&v.hasData()||null===M)return v;let I=v?v.tileID:c,k=I.overscaledZ;const L=f.getSource().minzoom,V=[];if(!M){const q=f.getSource().maxzoom;if(c.canonical.z>=q){const ne=c.canonical.z-q;f.getSource().reparseOverscaled?(k=Math.max(c.canonical.z+2,f.transform.tileZoom),I=new m.OverscaledTileID(k,c.wrap,q,c.canonical.x>>ne,c.canonical.y>>ne)):0!==ne&&(k=q,I=new m.OverscaledTileID(k,c.wrap,q,c.canonical.x>>ne,c.canonical.y>>ne))}I.key!==c.key&&(V.push(I.key),v=f.getTile(I))}const U=q=>{V.forEach(ne=>{w[ne]=q}),V.length=0};for(k-=1;k>=L&&(!v||!v.hasData());k--){v&&U(v.tileID.key);const q=I.calculateScaledKey(k);if(v=f.getTileByID(q),v&&v.hasData())break;const ne=w[q];if(null===ne)break;void 0===ne?V.push(q):v=f.getTileByID(ne)}return U(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,f){let v=this._tilesDirty[c];v||(v=this._tilesDirty[c]={}),v[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(f){let v=0;const w=new m.StructArrayLayout2ui4,M=131;for(let I=1;I<129;I++){for(let k=1;k<129;k++)v=I*M+k,w.emplaceBack(v,v+1),w.emplaceBack(v,v+M),w.emplaceBack(v+1,v+M),128===I&&w.emplaceBack(v+M,v+M+1);w.emplaceBack(v+1,v+1+M)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=m.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ai{static cacheKey(c,f,v,w){let M=`${f}${w?w.cacheKey:""}`;for(const I of v)c.usedDefines.includes(I)&&(M+=`/${I}`);return M}constructor(c,f,v,w,M,I){const k=c.gl;this.program=k.createProgram();const L=function(W){const re=[];for(let fe=0;fe<W.length;fe++){if(null===W[fe])continue;const _e=W[fe].split(" ");re.push(_e.pop())}return re}(v.staticAttributes),V=w?w.getBinderAttributes():[],U=L.concat(V);let q=w?w.defines():[];q=q.concat(I.map(W=>`#define ${W}`));const ne=c.isWebGL2?"#version 300 es\n":"",oe=ne+q.concat(c.extStandardDerivatives&&0===ne.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Wu):Wu,Wu,Wl,Zd.fragmentSource,ql.fragmentSource,v.fragmentSource).join("\n"),ae=ne+q.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Wl,Zd.vertexSource,ql.vertexSource,ru.vertexSource,v.vertexSource).join("\n"),se=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(se,oe),k.compileShader(se),k.attachShader(this.program,se);const le=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(le,ae),k.compileShader(le),k.attachShader(this.program,le),this.attributes={},this.numAttributes=U.length;for(let W=0;W<this.numAttributes;W++)U[W]&&(k.bindAttribLocation(this.program,W,U[W]),this.attributes[U[W]]=W);k.linkProgram(this.program),k.deleteShader(le),k.deleteShader(se),this.fixedUniforms=M(c),this.binderUniforms=w?w.getUniforms(c):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new m.Uniform1i(W=c),u_dem_prev:new m.Uniform1i(W),u_dem_unpack:new m.Uniform4f(W),u_dem_tl:new m.Uniform2f(W),u_dem_scale:new m.Uniform1f(W),u_dem_tl_prev:new m.Uniform2f(W),u_dem_scale_prev:new m.Uniform1f(W),u_dem_size:new m.Uniform1f(W),u_dem_lerp:new m.Uniform1f(W),u_exaggeration:new m.Uniform1f(W),u_depth:new m.Uniform1i(W),u_depth_size_inv:new m.Uniform2f(W),u_meter_to_dem:new m.Uniform1f(W),u_label_plane_matrix_inv:new m.UniformMatrix4f(W)}),I.includes("GLOBE")&&(this.globeUniforms=(W=>({u_tile_tl_up:new m.Uniform3f(W),u_tile_tr_up:new m.Uniform3f(W),u_tile_br_up:new m.Uniform3f(W),u_tile_bl_up:new m.Uniform3f(W),u_tile_up_scale:new m.Uniform1f(W)}))(c)),I.includes("FOG")&&(this.fogUniforms=(W=>({u_fog_matrix:new m.UniformMatrix4f(W),u_fog_range:new m.Uniform2f(W),u_fog_color:new m.Uniform4f(W),u_fog_horizon_blend:new m.Uniform1f(W),u_fog_temporal_offset:new m.Uniform1f(W),u_frustum_tl:new m.Uniform3f(W),u_frustum_tr:new m.Uniform3f(W),u_frustum_br:new m.Uniform3f(W),u_frustum_bl:new m.Uniform3f(W),u_globe_pos:new m.Uniform3f(W),u_globe_radius:new m.Uniform1f(W),u_globe_transition:new m.Uniform1f(W),u_is_globe:new m.Uniform1i(W),u_viewport:new m.Uniform2f(W)}))(c))}var W}setTerrainUniformValues(c,f){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w]&&v[w].set(this.program,w,f[w])}}setGlobeUniformValues(c,f){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w]&&v[w].set(this.program,w,f[w])}}setFogUniformValues(c,f){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w].set(this.program,w,f[w])}}draw(c,f,v,w,M,I,k,L,V,U,q,ne,oe,ae,se){const le=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(v),c.setStencilMode(w),c.setColorMode(M),c.setCullFace(I);for(const re of Object.keys(this.fixedUniforms))this.fixedUniforms[re].set(this.program,re,k[re]);ae&&ae.setUniforms(this.program,c,this.binderUniforms,ne,{zoom:oe});const W={[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[f];for(const re of q.get()){const fe=re.vaos||(re.vaos={});(fe[L]||(fe[L]=new Xd)).bind(c,this,V,ae?ae.getPaintVertexBuffers():[],U,re.vertexOffset,se||[]),le.drawElements(f,re.primitiveLength*W,le.UNSIGNED_SHORT,re.primitiveOffset*W*2)}}}function et(_,c){const f=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,_.transform.tileZoom)/f,w=v*(c.tileID.canonical.x+c.tileID.wrap*f),M=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/Yr(c,1,_.transform.tileZoom),u_pixel_coord_upper:[w>>16,M>>16],u_pixel_coord_lower:[65535&w,65535&M]}}const xl=m.create(),tn=(_,c,f,v,w,M,I,k,L,V,U)=>{const q=c.style.light,ne=q.properties.get("position"),oe=[ne.x,ne.y,ne.z],ae=m.create$1();"viewport"===q.properties.get("anchor")&&(m.fromRotation(ae,-c.transform.angle),m.transformMat3(oe,oe,ae));const se=q.properties.get("color"),le=c.transform,W={u_matrix:_,u_lightpos:oe,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[se.r,se.g,se.b],u_vertical_gradient:+f,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xl,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:M};return"globe"===le.projection.name&&(W.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],W.u_zoom_transition=L,W.u_inv_rot_matrix=U,W.u_merc_center=V,W.u_up_dir=le.projection.upVector(new m.CanonicalTileID(0,0,0),V[0]*m.EXTENT,V[1]*m.EXTENT),W.u_height_lift=k),W},oa=(_,c,f,v,w,M,I,k,L,V,U,q)=>{const ne=tn(_,c,f,v,w,M,I,L,V,U,q),oe={u_height_factor:-Math.pow(2,I.overscaledZ)/k.tileSize/8};return m.extend(ne,et(c,k),oe)},wl=_=>({u_matrix:_}),qa=(_,c,f)=>m.extend(wl(_),et(c,f)),Qu=(_,c)=>({u_matrix:_,u_world:c}),lp=(_,c,f,v)=>m.extend(qa(_,c,f),{u_world:v}),cp=m.create(),Sa=(_,c,f,v,w,M)=>{const I=_.transform,k="globe"===I.projection.name;let L;if("map"===M.paint.get("circle-pitch-alignment"))if(k){const U=m.globePixelsToTileUnits(I.zoom,c.canonical)*I._pixelsPerMercatorPixel;L=Float32Array.from([U,0,0,U])}else L=I.calculatePixelsToTileUnitsMatrix(f);else L=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const V={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:_.translatePosMatrix(c.projMatrix,f,M.paint.get("circle-translate"),M.paint.get("circle-translate-anchor")),u_device_pixel_ratio:m.exported.devicePixelRatio,u_extrude_scale:L,u_inv_rot_matrix:cp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){V.u_inv_rot_matrix=v,V.u_merc_center=w,V.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],V.u_zoom_transition=m.globeToMercatorTransition(I.zoom);const U=w[0]*m.EXTENT,q=w[1]*m.EXTENT;V.u_up_dir=I.projection.upVector(new m.CanonicalTileID(0,0,0),U,q)}return V},sa=_=>{const c=[];return"map"===_.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===_.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},To=(_,c,f,v)=>{const w=m.EXTENT/f.tileSize;return{u_matrix:_,u_camera_to_center_distance:c.getCameraToCenterDistance(v),u_extrude_scale:[c.pixelsToGLUnits[0]/w,c.pixelsToGLUnits[1]/w]}},ds=(_,c,f=1)=>({u_matrix:_,u_color:c,u_overlay:0,u_overlay_scale:f}),Ei=m.create(),Wa=(_,c,f,v,w,M,I)=>{const k=_.transform,L="globe"===k.projection.name,V=L?m.globePixelsToTileUnits(k.zoom,c.canonical)*k._pixelsPerMercatorPixel:Yr(f,1,M),U={u_matrix:c.projMatrix,u_extrude_scale:V,u_intensity:I,u_inv_rot_matrix:Ei,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){U.u_inv_rot_matrix=v,U.u_merc_center=w,U.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],U.u_zoom_transition=m.globeToMercatorTransition(k.zoom);const q=w[0]*m.EXTENT,ne=w[1]*m.EXTENT;U.u_up_dir=k.projection.upVector(new m.CanonicalTileID(0,0,0),q,ne)}return U},Zh=(_,c,f,v,w,M,I)=>{const k=_.transform,L=k.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:Do(_,c,f,v),u_pixels_to_tile_units:L,u_device_pixel_ratio:M,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:Za(f)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:xc(c,_.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},Ko=(_,c,f,v,w)=>{const M=_.transform;return{u_matrix:Do(_,c,f,v),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:w,u_image:0,u_tile_units_to_pixels:xc(c,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function xc(_,c){return 1/Yr(_,1,c.tileZoom)}function Do(_,c,f,v){return _.translatePosMatrix(v||c.tileID.projMatrix,c,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function Za(_){const c=_.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const Qd=(_,c,f,v,w,M)=>{return{u_matrix:_,u_tl_parent:c,u_scale_parent:f,u_fade_t:v.mix,u_opacity:v.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(k=w.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(I=w.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:hs(w.paint.get("raster-hue-rotate")),u_perspective_transform:M};var I,k};function hs(_){_*=Math.PI/180;const c=Math.sin(_),f=Math.cos(_);return[(2*f+1)/3,(-Math.sqrt(3)*c-f+1)/3,(Math.sqrt(3)*c-f+1)/3]}const Zl=m.create(),Ju=(_,c,f,v,w,M,I,k,L,V,U,q,ne,oe,ae,se)=>{const le=w.transform,W={u_is_size_zoom_constant:+("constant"===_||"source"===_),u_is_size_feature_constant:+("constant"===_||"camera"===_),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:le.width/le.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:I,u_coord_matrix:k,u_is_text:+L,u_pitch_with_map:+v,u_texsize:V,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Zl,u_up_vector:[0,-1,0]};return"globe"===se.name&&(W.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],W.u_zoom_transition=q,W.u_inv_rot_matrix=oe,W.u_merc_center=ne,W.u_camera_forward=le._camera.forward(),W.u_ecef_origin=m.globeECEFOrigin(le.globeMatrix,U.toUnwrapped()),W.u_tile_matrix=Float32Array.from(le.globeMatrix),W.u_up_vector=ae),W},ou=(_,c,f,v,w,M,I,k,L,V,U,q,ne,oe,ae,se,le)=>m.extend(Ju(_,c,f,v,w,M,I,k,L,V,q,ne,oe,ae,se,le),{u_gamma_scale:v?w.transform.cameraToCenterDistance*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:m.exported.devicePixelRatio,u_is_halo:+U}),wc=(_,c,f,v,w,M,I,k,L,V,U,q,ne,oe,ae,se)=>m.extend(ou(_,c,f,v,w,M,I,k,!0,L,!0,U,q,ne,oe,ae,se),{u_texsize_icon:V,u_texture_icon:1}),Xl=(_,c,f)=>({u_matrix:_,u_opacity:c,u_color:f}),Xh=(_,c,f,v,w)=>m.extend(function(M,I,k){const L=I.imageManager.getPattern(M.toString()),{width:V,height:U}=I.imageManager.getPixelSize(),q=Math.pow(2,k.tileID.overscaledZ),ne=k.tileSize*Math.pow(2,I.transform.tileZoom)/q,oe=ne*(k.tileID.canonical.x+k.tileID.wrap*q),ae=ne*k.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[V,U],u_pattern_size:L.displaySize,u_tile_units_to_pixels:1/Yr(k,1,I.transform.tileZoom),u_pixel_coord_upper:[oe>>16,ae>>16],u_pixel_coord_lower:[65535&oe,65535&ae]}}(v,f,w),{u_matrix:_,u_opacity:c}),Yh={fillExtrusion:_=>({u_matrix:new m.UniformMatrix4f(_),u_lightpos:new m.Uniform3f(_),u_lightintensity:new m.Uniform1f(_),u_lightcolor:new m.Uniform3f(_),u_vertical_gradient:new m.Uniform1f(_),u_opacity:new m.Uniform1f(_),u_edge_radius:new m.Uniform1f(_),u_ao:new m.Uniform2f(_),u_tile_id:new m.Uniform3f(_),u_zoom_transition:new m.Uniform1f(_),u_inv_rot_matrix:new m.UniformMatrix4f(_),u_merc_center:new m.Uniform2f(_),u_up_dir:new m.Uniform3f(_),u_height_lift:new m.Uniform1f(_)}),fillExtrusionPattern:_=>({u_matrix:new m.UniformMatrix4f(_),u_lightpos:new m.Uniform3f(_),u_lightintensity:new m.Uniform1f(_),u_lightcolor:new m.Uniform3f(_),u_vertical_gradient:new m.Uniform1f(_),u_height_factor:new m.Uniform1f(_),u_edge_radius:new m.Uniform1f(_),u_ao:new m.Uniform2f(_),u_tile_id:new m.Uniform3f(_),u_zoom_transition:new m.Uniform1f(_),u_inv_rot_matrix:new m.UniformMatrix4f(_),u_merc_center:new m.Uniform2f(_),u_up_dir:new m.Uniform3f(_),u_height_lift:new m.Uniform1f(_),u_image:new m.Uniform1i(_),u_texsize:new m.Uniform2f(_),u_pixel_coord_upper:new m.Uniform2f(_),u_pixel_coord_lower:new m.Uniform2f(_),u_tile_units_to_pixels:new m.Uniform1f(_),u_opacity:new m.Uniform1f(_)}),fill:_=>({u_matrix:new m.UniformMatrix4f(_)}),fillPattern:_=>({u_matrix:new m.UniformMatrix4f(_),u_image:new m.Uniform1i(_),u_texsize:new m.Uniform2f(_),u_pixel_coord_upper:new m.Uniform2f(_),u_pixel_coord_lower:new m.Uniform2f(_),u_tile_units_to_pixels:new m.Uniform1f(_)}),fillOutline:_=>({u_matrix:new m.UniformMatrix4f(_),u_world:new m.Uniform2f(_)}),fillOutlinePattern:_=>({u_matrix:new m.UniformMatrix4f(_),u_world:new m.Uniform2f(_),u_image:new m.Uniform1i(_),u_texsize:new m.Uniform2f(_),u_pixel_coord_upper:new m.Uniform2f(_),u_pixel_coord_lower:new m.Uniform2f(_),u_tile_units_to_pixels:new m.Uniform1f(_)}),circle:_=>({u_camera_to_center_distance:new m.Uniform1f(_),u_extrude_scale:new m.UniformMatrix2f(_),u_device_pixel_ratio:new m.Uniform1f(_),u_matrix:new m.UniformMatrix4f(_),u_inv_rot_matrix:new m.UniformMatrix4f(_),u_merc_center:new m.Uniform2f(_),u_tile_id:new m.Uniform3f(_),u_zoom_transition:new m.Uniform1f(_),u_up_dir:new m.Uniform3f(_)}),collisionBox:_=>({u_matrix:new m.UniformMatrix4f(_),u_camera_to_center_distance:new m.Uniform1f(_),u_extrude_scale:new m.Uniform2f(_)}),collisionCircle:_=>({u_matrix:new m.UniformMatrix4f(_),u_inv_matrix:new m.UniformMatrix4f(_),u_camera_to_center_distance:new m.Uniform1f(_),u_viewport_size:new m.Uniform2f(_)}),debug:_=>({u_color:new m.UniformColor(_),u_matrix:new m.UniformMatrix4f(_),u_overlay:new m.Uniform1i(_),u_overlay_scale:new m.Uniform1f(_)}),clippingMask:_=>({u_matrix:new m.UniformMatrix4f(_)}),heatmap:_=>({u_extrude_scale:new m.Uniform1f(_),u_intensity:new m.Uniform1f(_),u_matrix:new m.UniformMatrix4f(_),u_inv_rot_matrix:new m.UniformMatrix4f(_),u_merc_center:new m.Uniform2f(_),u_tile_id:new m.Uniform3f(_),u_zoom_transition:new m.Uniform1f(_),u_up_dir:new m.Uniform3f(_)}),heatmapTexture:_=>({u_image:new m.Uniform1i(_),u_color_ramp:new m.Uniform1i(_),u_opacity:new m.Uniform1f(_)}),hillshade:_=>({u_matrix:new m.UniformMatrix4f(_),u_image:new m.Uniform1i(_),u_latrange:new m.Uniform2f(_),u_light:new m.Uniform2f(_),u_shadow:new m.UniformColor(_),u_highlight:new m.UniformColor(_),u_accent:new m.UniformColor(_)}),hillshadePrepare:_=>({u_matrix:new m.UniformMatrix4f(_),u_image:new m.Uniform1i(_),u_dimension:new m.Uniform2f(_),u_zoom:new m.Uniform1f(_),u_unpack:new m.Uniform4f(_)}),line:_=>({u_matrix:new m.UniformMatrix4f(_),u_pixels_to_tile_units:new m.UniformMatrix2f(_),u_device_pixel_ratio:new m.Uniform1f(_),u_units_to_pixels:new m.Uniform2f(_),u_dash_image:new m.Uniform1i(_),u_gradient_image:new m.Uniform1i(_),u_image_height:new m.Uniform1f(_),u_texsize:new m.Uniform2f(_),u_tile_units_to_pixels:new m.Uniform1f(_),u_alpha_discard_threshold:new m.Uniform1f(_),u_trim_offset:new m.Uniform2f(_)}),linePattern:_=>({u_matrix:new m.UniformMatrix4f(_),u_texsize:new m.Uniform2f(_),u_pixels_to_tile_units:new m.UniformMatrix2f(_),u_device_pixel_ratio:new m.Uniform1f(_),u_image:new m.Uniform1i(_),u_units_to_pixels:new m.Uniform2f(_),u_tile_units_to_pixels:new m.Uniform1f(_),u_alpha_discard_threshold:new m.Uniform1f(_)}),raster:_=>({u_matrix:new m.UniformMatrix4f(_),u_tl_parent:new m.Uniform2f(_),u_scale_parent:new m.Uniform1f(_),u_fade_t:new m.Uniform1f(_),u_opacity:new m.Uniform1f(_),u_image0:new m.Uniform1i(_),u_image1:new m.Uniform1i(_),u_brightness_low:new m.Uniform1f(_),u_brightness_high:new m.Uniform1f(_),u_saturation_factor:new m.Uniform1f(_),u_contrast_factor:new m.Uniform1f(_),u_spin_weights:new m.Uniform3f(_),u_perspective_transform:new m.Uniform2f(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new m.Uniform1i(_),u_is_size_feature_constant:new m.Uniform1i(_),u_size_t:new m.Uniform1f(_),u_size:new m.Uniform1f(_),u_camera_to_center_distance:new m.Uniform1f(_),u_rotate_symbol:new m.Uniform1i(_),u_aspect_ratio:new m.Uniform1f(_),u_fade_change:new m.Uniform1f(_),u_matrix:new m.UniformMatrix4f(_),u_label_plane_matrix:new m.UniformMatrix4f(_),u_coord_matrix:new m.UniformMatrix4f(_),u_is_text:new m.Uniform1i(_),u_pitch_with_map:new m.Uniform1i(_),u_texsize:new m.Uniform2f(_),u_tile_id:new m.Uniform3f(_),u_zoom_transition:new m.Uniform1f(_),u_inv_rot_matrix:new m.UniformMatrix4f(_),u_merc_center:new m.Uniform2f(_),u_camera_forward:new m.Uniform3f(_),u_tile_matrix:new m.UniformMatrix4f(_),u_up_vector:new m.Uniform3f(_),u_ecef_origin:new m.Uniform3f(_),u_texture:new m.Uniform1i(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new m.Uniform1i(_),u_is_size_feature_constant:new m.Uniform1i(_),u_size_t:new m.Uniform1f(_),u_size:new m.Uniform1f(_),u_camera_to_center_distance:new m.Uniform1f(_),u_rotate_symbol:new m.Uniform1i(_),u_aspect_ratio:new m.Uniform1f(_),u_fade_change:new m.Uniform1f(_),u_matrix:new m.UniformMatrix4f(_),u_label_plane_matrix:new m.UniformMatrix4f(_),u_coord_matrix:new m.UniformMatrix4f(_),u_is_text:new m.Uniform1i(_),u_pitch_with_map:new m.Uniform1i(_),u_texsize:new m.Uniform2f(_),u_texture:new m.Uniform1i(_),u_gamma_scale:new m.Uniform1f(_),u_device_pixel_ratio:new m.Uniform1f(_),u_tile_id:new m.Uniform3f(_),u_zoom_transition:new m.Uniform1f(_),u_inv_rot_matrix:new m.UniformMatrix4f(_),u_merc_center:new m.Uniform2f(_),u_camera_forward:new m.Uniform3f(_),u_tile_matrix:new m.UniformMatrix4f(_),u_up_vector:new m.Uniform3f(_),u_ecef_origin:new m.Uniform3f(_),u_is_halo:new m.Uniform1i(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new m.Uniform1i(_),u_is_size_feature_constant:new m.Uniform1i(_),u_size_t:new m.Uniform1f(_),u_size:new m.Uniform1f(_),u_camera_to_center_distance:new m.Uniform1f(_),u_rotate_symbol:new m.Uniform1i(_),u_aspect_ratio:new m.Uniform1f(_),u_fade_change:new m.Uniform1f(_),u_matrix:new m.UniformMatrix4f(_),u_label_plane_matrix:new m.UniformMatrix4f(_),u_coord_matrix:new m.UniformMatrix4f(_),u_is_text:new m.Uniform1i(_),u_pitch_with_map:new m.Uniform1i(_),u_texsize:new m.Uniform2f(_),u_texsize_icon:new m.Uniform2f(_),u_texture:new m.Uniform1i(_),u_texture_icon:new m.Uniform1i(_),u_gamma_scale:new m.Uniform1f(_),u_device_pixel_ratio:new m.Uniform1f(_),u_is_halo:new m.Uniform1i(_)}),background:_=>({u_matrix:new m.UniformMatrix4f(_),u_opacity:new m.Uniform1f(_),u_color:new m.UniformColor(_)}),backgroundPattern:_=>({u_matrix:new m.UniformMatrix4f(_),u_opacity:new m.Uniform1f(_),u_image:new m.Uniform1i(_),u_pattern_tl:new m.Uniform2f(_),u_pattern_br:new m.Uniform2f(_),u_texsize:new m.Uniform2f(_),u_pattern_size:new m.Uniform2f(_),u_pixel_coord_upper:new m.Uniform2f(_),u_pixel_coord_lower:new m.Uniform2f(_),u_tile_units_to_pixels:new m.Uniform1f(_)}),terrainRaster:ar,terrainDepth:ar,skybox:_=>({u_matrix:new m.UniformMatrix4f(_),u_sun_direction:new m.Uniform3f(_),u_cubemap:new m.Uniform1i(_),u_opacity:new m.Uniform1f(_),u_temporal_offset:new m.Uniform1f(_)}),skyboxGradient:_=>({u_matrix:new m.UniformMatrix4f(_),u_color_ramp:new m.Uniform1i(_),u_center_direction:new m.Uniform3f(_),u_radius:new m.Uniform1f(_),u_opacity:new m.Uniform1f(_),u_temporal_offset:new m.Uniform1f(_)}),skyboxCapture:_=>({u_matrix_3f:new m.UniformMatrix3f(_),u_sun_direction:new m.Uniform3f(_),u_sun_intensity:new m.Uniform1f(_),u_color_tint_r:new m.Uniform4f(_),u_color_tint_m:new m.Uniform4f(_),u_luminance:new m.Uniform1f(_)}),globeRaster:_=>({u_proj_matrix:new m.UniformMatrix4f(_),u_globe_matrix:new m.UniformMatrix4f(_),u_normalize_matrix:new m.UniformMatrix4f(_),u_merc_matrix:new m.UniformMatrix4f(_),u_zoom_transition:new m.Uniform1f(_),u_merc_center:new m.Uniform2f(_),u_image0:new m.Uniform1i(_),u_grid_matrix:new m.UniformMatrix3f(_),u_skirt_height:new m.Uniform1f(_),u_frustum_tl:new m.Uniform3f(_),u_frustum_tr:new m.Uniform3f(_),u_frustum_br:new m.Uniform3f(_),u_frustum_bl:new m.Uniform3f(_),u_globe_pos:new m.Uniform3f(_),u_globe_radius:new m.Uniform1f(_),u_viewport:new m.Uniform2f(_)}),globeAtmosphere:_=>({u_frustum_tl:new m.Uniform3f(_),u_frustum_tr:new m.Uniform3f(_),u_frustum_br:new m.Uniform3f(_),u_frustum_bl:new m.Uniform3f(_),u_horizon:new m.Uniform1f(_),u_transition:new m.Uniform1f(_),u_fadeout_range:new m.Uniform1f(_),u_color:new m.Uniform4f(_),u_high_color:new m.Uniform4f(_),u_space_color:new m.Uniform4f(_),u_star_intensity:new m.Uniform1f(_),u_star_density:new m.Uniform1f(_),u_star_size:new m.Uniform1f(_),u_temporal_offset:new m.Uniform1f(_),u_horizon_angle:new m.Uniform1f(_),u_rotation_matrix:new m.UniformMatrix4f(_)})};let Be;function ot(_,c,f,v,w,M,I){const k=_.context,L=k.gl,V=_.transform,U=_.useProgram("collisionBox"),q=[];let ne=0,oe=0;for(let _e=0;_e<v.length;_e++){const Te=v[_e],De=c.getTile(Te),Se=De.getBucket(f);if(!Se)continue;const Le=pe(Te,Se,V);let Fe=Le;0===w[0]&&0===w[1]||(Fe=_.translatePosMatrix(Le,De,w,M));const Ze=I?Se.textCollisionBox:Se.iconCollisionBox,ht=Se.collisionCircleArray;if(ht.length>0){const je=m.create(),dt=Fe;m.mul(je,Se.placementInvProjMatrix,V.glCoordMatrix),m.mul(je,je,Se.placementViewportMatrix),q.push({circleArray:ht,circleOffset:oe,transform:dt,invTransform:je,projection:Se.getProjection()}),ne+=ht.length/4,oe=ne}Ze&&(_.terrain&&_.terrain.setupElevationDraw(De,U),U.draw(k,L.LINES,m.DepthMode.disabled,m.StencilMode.disabled,_.colorModeForRenderPass(),m.CullFaceMode.disabled,To(Fe,V,De,Se.getProjection()),f.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,null,V.zoom,null,[Ze.collisionVertexBuffer,Ze.collisionVertexBufferExt]))}if(!I||!q.length)return;const ae=_.useProgram("collisionCircle"),se=new m.StructArrayLayout2f1f2i16;se.resize(4*ne),se._trim();let le=0;for(const _e of q)for(let Te=0;Te<_e.circleArray.length/4;Te++){const De=4*Te,Se=_e.circleArray[De+0],Le=_e.circleArray[De+1],Fe=_e.circleArray[De+2],Ze=_e.circleArray[De+3];se.emplace(le++,Se,Le,Fe,Ze,0),se.emplace(le++,Se,Le,Fe,Ze,1),se.emplace(le++,Se,Le,Fe,Ze,2),se.emplace(le++,Se,Le,Fe,Ze,3)}(!Be||Be.length<2*ne)&&(Be=function(_e){const Te=2*_e,De=new m.StructArrayLayout3ui6;De.resize(Te),De._trim();for(let Se=0;Se<Te;Se++){const Le=6*Se;De.uint16[Le+0]=4*Se+0,De.uint16[Le+1]=4*Se+1,De.uint16[Le+2]=4*Se+2,De.uint16[Le+3]=4*Se+2,De.uint16[Le+4]=4*Se+3,De.uint16[Le+5]=4*Se+0}return De}(ne));const W=k.createIndexBuffer(Be,!0),re=k.createVertexBuffer(se,m.collisionCircleLayout.members,!0);for(const _e of q){const Te={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(fe=V).getCameraToCenterDistance(_e.projection),u_viewport_size:[fe.width,fe.height]};ae.draw(k,L.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,_.colorModeForRenderPass(),m.CullFaceMode.disabled,Te,f.id,re,W,m.SegmentVector.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,V.zoom)}var fe;re.destroy(),W.destroy()}const nn=m.create();function mn({width:_,height:c,anchor:f,textOffset:v,textScale:w},M){const{horizontalAlign:I,verticalAlign:k}=m.getAnchorAlignment(f),L=-(I-.5)*_,V=-(k-.5)*c,U=m.evaluateVariableOffset(f,v);return new m.Point((L/w+U[0])*M,(V/w+U[1])*M)}function Or(_,c,f,v,w,M,I,k,L,V,U){const q=_.text.placedSymbolArray,ne=_.text.dynamicLayoutVertexArray,oe=_.icon.dynamicLayoutVertexArray,ae={},se=_.getProjection(),le=Ee(k,se,M),W=M.elevation,re=se.upVectorScale(k.canonical,M.center.lat,M.worldSize).metersToTile;ne.clear();for(let fe=0;fe<q.length;fe++){const _e=q.get(fe),{tileAnchorX:Te,tileAnchorY:De,numGlyphs:Se}=_e,Le=_e.hidden||!_e.crossTileID||_.allowVerticalPlacement&&!_e.placedOrientation?null:v[_e.crossTileID];if(Le){let Fe=0,Ze=0,ht=0;if(W){const It=W?W.getAtTileOffset(k,Te,De):0,[wn,kn,ln]=se.upVector(k.canonical,Te,De);Fe=It*wn*re,Ze=It*kn*re,ht=It*ln*re}let[je,dt,He,Et]=uo(_e.projectedAnchorX+Fe,_e.projectedAnchorY+Ze,_e.projectedAnchorZ+ht,f?le:I);const qe=op(M.getCameraToCenterDistance(se),Et);let ct=w.evaluateSizeForFeature(_.textSizeData,V,_e)*qe/m.ONE_EM;f&&(ct*=_.tilePixelRatio/L);const _t=mn(Le,ct);f?(({x:je,y:dt,z:He}=se.projectTilePoint(Te+_t.x,De+_t.y,k.canonical)),[je,dt,He]=uo(je+Fe,dt+Ze,He+ht,I)):(c&&_t._rotate(-M.angle),je+=_t.x,dt+=_t.y,He=0);const yt=_.allowVerticalPlacement&&_e.placedOrientation===m.WritingMode.vertical?Math.PI/2:0;for(let It=0;It<Se;It++)m.addDynamicAttributes(ne,je,dt,He,yt);U&&_e.associatedIconIndex>=0&&(ae[_e.associatedIconIndex]={x:je,y:dt,z:He,angle:yt})}else qr(Se,ne)}if(U){oe.clear();const fe=_.icon.placedSymbolArray;for(let _e=0;_e<fe.length;_e++){const Te=fe.get(_e),{numGlyphs:De}=Te,Se=ae[_e];if(Te.hidden||!Se)qr(De,oe);else{const{x:Le,y:Fe,z:Ze,angle:ht}=Se;for(let je=0;je<De;je++)m.addDynamicAttributes(oe,Le,Fe,Ze,ht)}}_.icon.dynamicLayoutVertexBuffer.updateData(oe)}_.text.dynamicLayoutVertexBuffer.updateData(ne)}function gi(_,c,f){return f.iconsInText&&c?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function Ur(_,c,f,v,w,M,I,k,L,V,U,q){const ne=_.context,oe=ne.gl,ae=_.transform,se="map"===k,le="map"===L,W=se&&"point"!==f.layout.get("symbol-placement"),re=se&&!le&&!W,fe=void 0!==f.layout.get("symbol-sort-key").constantOr(1);let _e=!1;const Te=_.depthModeForSublayer(0,m.DepthMode.ReadOnly),De=[m.mercatorXfromLng(ae.center.lng),m.mercatorYfromLat(ae.center.lat)],Se=f.layout.get("text-variable-anchor"),Le="globe"===ae.projection.name,Fe=[],Ze=[0,-1,0];let ht=Ze;!Le&&!ae.mercatorFromTransition||se||(ht=function(je){const dt=je._camera.getWorldToCamera(je.worldSize,1),He=m.multiply([],dt,je.globeMatrix);m.invert(He,He);const Et=[0,0,0],qe=[0,1,0,0];return m.transformMat4$1(qe,qe,He),Et[0]=qe[0],Et[1]=qe[1],Et[2]=qe[2],m.normalize(Et,Et),Et}(ae));for(const je of v){const dt=c.getTile(je),He=dt.getBucket(f);if(!He||"mercator"===He.projection.name&&Le)continue;const Et=w?He.text:He.icon;if(!Et||He.fullyClipped||!Et.segments.get().length)continue;const qe=Et.programConfigurations.get(f.id),ct=w||He.sdfIcons,_t=w?He.textSizeData:He.iconSizeData,yt=le||0!==ae.pitch,It=m.evaluateSizeForZoom(_t,ae.zoom);let wn,kn,ln,Sn,ui=[0,0],li=null;if(w)kn=dt.glyphAtlasTexture,ln=oe.LINEAR,wn=dt.glyphAtlasTexture.size,He.iconsInText&&(ui=dt.imageAtlasTexture.size,li=dt.imageAtlasTexture,Sn=yt||_.options.rotating||_.options.zooming||"composite"===_t.kind||"camera"===_t.kind?oe.LINEAR:oe.NEAREST);else{const Vr=1!==f.layout.get("icon-size").constantOr(0)||He.iconsNeedLinear;kn=dt.imageAtlasTexture,ln=ct||_.options.rotating||_.options.zooming||Vr||yt?oe.LINEAR:oe.NEAREST,wn=dt.imageAtlasTexture.size}const gn="globe"===He.projection.name,Xi=gn?ht:Ze,cn=gn?m.globeToMercatorTransition(ae.zoom):0,lr=Ee(je,He.getProjection(),ae),vr=ae.calculatePixelsToTileUnitsMatrix(dt),ps=nt(lr,dt.tileID.canonical,le,se,ae,He.getProjection(),vr),Fo=_.terrain&&le&&W?m.invert(m.create(),ps):nn,Qa=yr(lr,dt.tileID.canonical,le,se,ae,He.getProjection(),vr),Il=Se&&He.hasTextData(),cr="none"!==f.layout.get("icon-text-fit")&&Il&&He.hasIconData();if(W){const Vr=ae.elevation,Pc=Vr?Vr.getAtTileOffsetFunc(je,ae.center.lat,ae.worldSize,He.getProjection()):null,Al=Wo(lr,dt.tileID.canonical,le,se,ae,He.getProjection(),vr);jh(He,lr,_,w,Al,Qa,le,V,Pc,je)}const gr=W||w&&Se||cr,zi=_.translatePosMatrix(lr,dt,M,I),ho=gr?nn:ps,ks=_.translatePosMatrix(Qa,dt,M,I,!0),Rr=He.getProjection().createInversionMatrix(ae,je.canonical),vt=[];_.terrainRenderModeElevated()&&le&&vt.push("PITCH_WITH_MAP_TERRAIN"),gn&&vt.push("PROJECTION_GLOBE_VIEW"),gr&&vt.push("PROJECTED_POS_ON_VIEWPORT");const Ii=ct&&0!==f.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1);let Rs;Rs=ct?He.iconsInText?wc(_t.kind,It,re,le,_,zi,ho,ks,wn,ui,je,cn,De,Rr,Xi,He.getProjection()):ou(_t.kind,It,re,le,_,zi,ho,ks,w,wn,!0,je,cn,De,Rr,Xi,He.getProjection()):Ju(_t.kind,It,re,le,_,zi,ho,ks,w,wn,je,cn,De,Rr,Xi,He.getProjection());const Pa={program:_.useProgram(gi(ct,w,He),qe,vt),buffers:Et,uniformValues:Rs,atlasTexture:kn,atlasTextureIcon:li,atlasInterpolation:ln,atlasInterpolationIcon:Sn,isSDF:ct,hasHalo:Ii,tile:dt,labelPlaneMatrixInv:Fo};if(fe&&He.canOverlap){_e=!0;const Vr=Et.segments.get();for(const Pc of Vr)Fe.push({segments:new m.SegmentVector([Pc]),sortKey:Pc.sortKey,state:Pa})}else Fe.push({segments:Et.segments,sortKey:0,state:Pa})}_e&&Fe.sort((je,dt)=>je.sortKey-dt.sortKey);for(const je of Fe){const dt=je.state;if(_.terrain&&_.terrain.setupElevationDraw(dt.tile,dt.program,{useDepthForOcclusion:!Le,labelPlaneMatrixInv:dt.labelPlaneMatrixInv}),ne.activeTexture.set(oe.TEXTURE0),dt.atlasTexture.bind(dt.atlasInterpolation,oe.CLAMP_TO_EDGE),dt.atlasTextureIcon&&(ne.activeTexture.set(oe.TEXTURE1),dt.atlasTextureIcon&&dt.atlasTextureIcon.bind(dt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),dt.isSDF){const He=dt.uniformValues;dt.hasHalo&&(He.u_is_halo=1,Lr(dt.buffers,je.segments,f,_,dt.program,Te,U,q,He)),He.u_is_halo=0}Lr(dt.buffers,je.segments,f,_,dt.program,Te,U,q,dt.uniformValues)}}function Lr(_,c,f,v,w,M,I,k,L){const V=v.context,U=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.globeExtVertexBuffer];w.draw(V,V.gl.TRIANGLES,M,I,k,m.CullFaceMode.disabled,L,f.id,_.layoutVertexBuffer,_.indexBuffer,c,f.paint,v.transform.zoom,_.programConfigurations.get(f.id),U)}function aa(_,c,f,v,w,M,I){const k=_.context.gl,L=f.paint.get("fill-pattern"),V=L&&L.constantOr(1);let U,q,ne,oe,ae;I?(q=V&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=k.LINES):(q=V?"fillPattern":"fill",U=k.TRIANGLES);for(const se of v){const le=c.getTile(se);if(V&&!le.patternsLoaded())continue;const W=le.getBucket(f);if(!W)continue;_.prepareDrawTile();const re=W.programConfigurations.get(f.id),fe=_.useProgram(q,re);V&&(_.context.activeTexture.set(k.TEXTURE0),le.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),re.updatePaintBuffers());const _e=L.constantOr(null);if(_e&&le.imageAtlas){const De=le.imageAtlas.patternPositions[_e.toString()];De&&re.setConstantPatternPositions(De)}const Te=_.translatePosMatrix(se.projMatrix,le,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(I){oe=W.indexBuffer2,ae=W.segments2;const De=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];ne="fillOutlinePattern"===q&&V?lp(Te,_,le,De):Qu(Te,De)}else oe=W.indexBuffer,ae=W.segments,ne=V?qa(Te,_,le):wl(Te);_.prepareDrawProgram(_.context,fe,se.toUnwrapped()),fe.draw(_.context,U,w,_.stencilModeForClipping(se),M,m.CullFaceMode.disabled,ne,f.id,W.layoutVertexBuffer,oe,ae,f.paint,_.transform.zoom,re)}}function Wr(_,c,f,v,w,M,I){const k=_.context,L=k.gl,V=_.transform,U=f.paint.get("fill-extrusion-pattern"),q=U.constantOr(1),ne=f.paint.get("fill-extrusion-opacity"),oe=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],ae=f.layout.get("fill-extrusion-edge-radius"),se=ae>0&&!f.paint.get("fill-extrusion-rounded-roof"),le=se?0:ae,W="globe"===V.projection.name?m.fillExtrusionHeightLift():0,re="globe"===V.projection.name,fe=re?m.globeToMercatorTransition(V.zoom):0,_e=[m.mercatorXfromLng(V.center.lng),m.mercatorYfromLat(V.center.lat)],Te=[];re&&Te.push("PROJECTION_GLOBE_VIEW"),oe[0]>0&&Te.push("FAUX_AO"),se&&Te.push("ZERO_ROOF_RADIUS");for(const De of v){const Se=c.getTile(De),Le=Se.getBucket(f);if(!Le||Le.projection.name!==V.projection.name)continue;const Fe=Le.programConfigurations.get(f.id),Ze=_.useProgram(q?"fillExtrusionPattern":"fillExtrusion",Fe,Te);if(_.terrain){const ct=_.terrain;if(_.style.terrainSetForDrapingOnly())ct.setupElevationDraw(Se,Ze,{useMeterToDem:!0});else{if(!Le.enableTerrain)continue;if(ct.setupElevationDraw(Se,Ze,{useMeterToDem:!0}),Jr(k,c,De,Le,f,ct),!Le.centroidVertexBuffer){const _t=Ze.attributes.a_centroid_pos;void 0!==_t&&L.vertexAttrib2f(_t,0,0)}}}q&&(_.context.activeTexture.set(L.TEXTURE0),Se.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Fe.updatePaintBuffers());const ht=U.constantOr(null);if(ht&&Se.imageAtlas){const ct=Se.imageAtlas.patternPositions[ht.toString()];ct&&Fe.setConstantPatternPositions(ct)}const je=_.translatePosMatrix(De.projMatrix,Se,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),dt=V.projection.createInversionMatrix(V,De.canonical),He=f.paint.get("fill-extrusion-vertical-gradient"),Et=q?oa(je,_,He,ne,oe,le,De,Se,W,fe,_e,dt):tn(je,_,He,ne,oe,le,De,W,fe,_e,dt);_.prepareDrawProgram(k,Ze,De.toUnwrapped());const qe=[];_.terrain&&qe.push(Le.centroidVertexBuffer),re&&qe.push(Le.layoutVertexExtBuffer),Ze.draw(k,k.gl.TRIANGLES,w,M,I,m.CullFaceMode.backCCW,Et,f.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,f.paint,_.transform.zoom,Fe,qe)}}function Jr(_,c,f,v,w,M){const I=[W=>{let re=W.canonical.x-1,fe=W.wrap;return re<0&&(re=(1<<W.canonical.z)-1,fe--),new m.OverscaledTileID(W.overscaledZ,fe,W.canonical.z,re,W.canonical.y)},W=>{let re=W.canonical.x+1,fe=W.wrap;return re===1<<W.canonical.z&&(re=0,fe++),new m.OverscaledTileID(W.overscaledZ,fe,W.canonical.z,re,W.canonical.y)},W=>new m.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(0===W.canonical.y?1<<W.canonical.z:W.canonical.y)-1),W=>new m.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],k=W=>{const re=c.getSource().minzoom,fe=Te=>{const De=c.getTileByID(Te);if(De&&De.hasData())return De.getBucket(w)},_e=[0,-1,1];for(const Te of _e){if(W.overscaledZ+Te<re)continue;const De=fe(W.calculateScaledKey(W.overscaledZ+Te));if(De)return De}},L=[0,0,0],V=(W,re)=>(L[0]=Math.min(W.min.y,re.min.y),L[1]=Math.max(W.max.y,re.max.y),L[2]=m.EXTENT-re.min.x>W.max.x?re.min.x-m.EXTENT:W.max.x,L),U=(W,re)=>(L[0]=Math.min(W.min.x,re.min.x),L[1]=Math.max(W.max.x,re.max.x),L[2]=m.EXTENT-re.min.y>W.max.y?re.min.y-m.EXTENT:W.max.y,L),q=[(W,re)=>V(W,re),(W,re)=>V(re,W),(W,re)=>U(W,re),(W,re)=>U(re,W)],ne=new m.Point(0,0);let oe,ae,se;const le=(W,re,fe,_e,Te)=>{const De=[[_e?fe:W,_e?W:fe,0],[_e?fe:re,_e?re:fe,0]],Se=Te<0?m.EXTENT+Te:Te,Le=[_e?Se:(W+re)/2,_e?(W+re)/2:Se,0];return 0===fe&&Te<0||0!==fe&&Te>0?M.getForTilePoints(se,[Le],!0,ae):De.push(Le),M.getForTilePoints(f,De,!0,oe),Math.max(De[0][2],De[1][2],Le[2])/M.exaggeration()};for(let W=0;W<4;W++){const re=(W<2?1:5)-W,fe=v.borders[W];if(0===fe.length)continue;const _e=se=I[W](f),Te=k(_e);if(!(Te&&Te instanceof m.FillExtrusionBucket&&Te.enableTerrain)||v.borderDoneWithNeighborZ[W]===Te.canonical.z&&Te.borderDoneWithNeighborZ[re]===v.canonical.z||(ae=M.findDEMTileFor(_e),!ae||!ae.dem))continue;if(!oe){const Fe=M.findDEMTileFor(f);if(!Fe||!Fe.dem)return;oe=Fe}const De=Te.borders[re];let Se=0;const Le=Te.borderDoneWithNeighborZ[re]!==v.canonical.z;if(v.canonical.z===Te.canonical.z){for(let Fe=0;Fe<fe.length;Fe++){const Ze=v.featuresOnBorder[fe[Fe]],ht=Ze.borders[W];let je;for(;Se<De.length&&(je=Te.featuresOnBorder[De[Se]],!(je.borders[re][1]>ht[0]+3));)Le&&Te.encodeCentroid(void 0,je,!1),Se++;if(je&&Se<De.length){const dt=Se;let He=0;for(;!(je.borders[re][0]>ht[1]-3)&&(He++,++Se!==De.length);)je=Te.featuresOnBorder[De[Se]];if(je=Te.featuresOnBorder[De[dt]],Ze.intersectsCount()>1||je.intersectsCount()>1||1!==He){1!==He&&(Se=dt),v.encodeCentroid(void 0,Ze,!1),Le&&Te.encodeCentroid(void 0,je,!1);continue}const Et=q[W](Ze,je),qe=W%2?m.EXTENT-1:0;ne.x=le(Et[0],Math.min(m.EXTENT-1,Et[1]),qe,W<2,Et[2]),ne.y=0,v.encodeCentroid(ne,Ze,!1),Le&&Te.encodeCentroid(ne,je,!1)}else v.encodeCentroid(void 0,Ze,!1)}v.borderDoneWithNeighborZ[W]=Te.canonical.z,v.needsCentroidUpdate=!0,Le&&(Te.borderDoneWithNeighborZ[re]=v.canonical.z,Te.needsCentroidUpdate=!0)}else{for(const Fe of fe)v.encodeCentroid(void 0,v.featuresOnBorder[Fe],!1);if(Le){for(const Fe of De)Te.encodeCentroid(void 0,Te.featuresOnBorder[Fe],!1);Te.borderDoneWithNeighborZ[re]=v.canonical.z,Te.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[W]=Te.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(_)}const Qo=new m.Color(1,0,0,1),El=new m.Color(0,1,0,1),Jo=new m.Color(0,0,1,1),Ni=new m.Color(1,0,1,1),su=new m.Color(0,1,1,1);function Jd(_,c,f){const v=_.context,w=_.transform,M=v.gl,I="globe"===w.projection.name,k=I?["PROJECTION_GLOBE_VIEW"]:null;let L=f.projMatrix;if(I&&m.globeToMercatorTransition(w.zoom)>0){const Ze=m.transitionTileAABBinECEF(f.canonical,w),ht=m.globeDenormalizeECEF(Ze);L=m.multiply(new Float32Array(16),w.globeMatrix,ht),m.multiply(L,w.projMatrix,L)}const V=_.useProgram("debug",null,k),U=c.getTileByID(f.key);_.terrain&&_.terrain.setupElevationDraw(U,V);const q=m.DepthMode.disabled,ne=m.StencilMode.disabled,oe=_.colorModeForRenderPass();v.activeTexture.set(M.TEXTURE0),_.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),I?U._makeGlobeTileDebugBuffers(_.context,w):U._makeDebugTileBoundsBuffers(_.context,w.projection);const se=U._tileDebugBuffer||_.debugBuffer,le=U._tileDebugIndexBuffer||_.debugIndexBuffer,W=U._tileDebugSegments||_.debugSegments;V.draw(v,M.LINE_STRIP,q,ne,oe,m.CullFaceMode.disabled,ds(L,m.Color.red),"$debug",se,le,W,null,null,null,[U._globeTileDebugBorderBuffer]);const re=U.latestRawTileData,fe=Math.floor((re&&re.byteLength||0)/1024),_e=c.getTile(f).tileSize,Te=512/Math.min(_e,512)*(f.overscaledZ/w.zoom)*.5;let De=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(De+=` => ${f.overscaledZ}`),De+=` ${fe}kb`,function(Ze,ht){Ze.initDebugOverlayCanvas();const je=Ze.debugOverlayCanvas,dt=Ze.context.gl,He=Ze.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,je.width,je.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText(ht,5,5),He.strokeText(ht,5,5),Ze.debugOverlayTexture.update(je),Ze.debugOverlayTexture.bind(dt.LINEAR,dt.CLAMP_TO_EDGE)}(_,De);const Se=U._tileDebugTextBuffer||_.debugBuffer,Le=U._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,Fe=U._tileDebugTextSegments||_.debugSegments;V.draw(v,M.TRIANGLES,q,ne,m.ColorMode.alphaBlended,m.CullFaceMode.disabled,ds(L,m.Color.transparent,Te),"$debug",Se,Le,Fe,null,null,null,[U._globeTileDebugTextBuffer])}function Ec(_,c,f,v){Cc(_,0,c+f/2,_.transform.width,f,v)}function pr(_,c,f,v){Cc(_,c-f/2,0,f,_.transform.height,v)}function Cc(_,c,f,v,w,M){const I=_.context,k=I.gl;k.enable(k.SCISSOR_TEST),k.scissor(c*m.exported.devicePixelRatio,f*m.exported.devicePixelRatio,v*m.exported.devicePixelRatio,w*m.exported.devicePixelRatio),I.clear({color:M}),k.disable(k.SCISSOR_TEST)}const Kh=m.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Cr}=Kh;function Hn(_,c,f,v){_.emplaceBack(c,f,v)}class Mn{constructor(c){this.vertexArray=new m.StructArrayLayout3f12,this.indices=new m.StructArrayLayout3ui6,Hn(this.vertexArray,-1,-1,1),Hn(this.vertexArray,1,-1,1),Hn(this.vertexArray,-1,1,1),Hn(this.vertexArray,1,1,1),Hn(this.vertexArray,-1,-1,-1),Hn(this.vertexArray,1,-1,-1),Hn(this.vertexArray,-1,1,-1),Hn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Cr),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=m.SegmentVector.simpleSegment(0,0,36,12)}}function tr(_,c,f,v,w,M){const I=_.gl,k=c.paint.get("sky-atmosphere-color"),L=c.paint.get("sky-atmosphere-halo-color"),V=c.paint.get("sky-atmosphere-sun-intensity"),U={u_matrix_3f:m.fromMat4(m.create$1(),v),u_sun_direction:w,u_sun_intensity:V,u_color_tint_r:[(ae=k).r,ae.g,ae.b,ae.a],u_color_tint_m:[(se=L).r,se.g,se.b,se.a],u_luminance:5e-5};var ae,se;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+M,c.skyboxTexture,0),f.draw(_,I.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,m.ColorMode.unblended,m.CullFaceMode.frontCW,U,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const kr=m.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Cl{constructor(c){const f=new m.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const v=new m.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(f,kr.members),this.indexBuffer=c.createIndexBuffer(v),this.segments=m.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const nr={symbol:function(_,c,f,v,w){if("translucent"!==_.renderPass)return;const M=m.StencilMode.disabled,I=_.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(k,L,V,U,q,ne,oe){const ae=L.transform,se="map"===q,le="map"===ne;for(const W of k){const re=U.getTile(W),fe=re.getBucket(V);if(!fe||!fe.text||!fe.text.segments.get().length)continue;const _e=m.evaluateSizeForZoom(fe.textSizeData,ae.zoom),Te=Ee(W,fe.getProjection(),ae),De=ae.calculatePixelsToTileUnitsMatrix(re),Se=nt(Te,re.tileID.canonical,le,se,ae,fe.getProjection(),De),Le="none"!==V.layout.get("icon-text-fit")&&fe.hasIconData();if(_e){const Fe=Math.pow(2,ae.zoom-re.tileID.overscaledZ);Or(fe,se,le,oe,m.symbolSize,ae,Se,W,Fe,_e,Le)}}}(v,_,f,c,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),w),0!==f.paint.get("icon-opacity").constantOr(1)&&Ur(_,c,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),M,I),0!==f.paint.get("text-opacity").constantOr(1)&&Ur(_,c,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),M,I),c.map.showCollisionBoxes&&(ot(_,c,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),ot(_,c,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(_,c,f,v){if("translucent"!==_.renderPass)return;const w=f.paint.get("circle-opacity"),M=f.paint.get("circle-stroke-width"),I=f.paint.get("circle-stroke-opacity"),k=void 0!==f.layout.get("circle-sort-key").constantOr(1);if(0===w.constantOr(1)&&(0===M.constantOr(1)||0===I.constantOr(1)))return;const L=_.context,V=L.gl,U=_.transform,q=_.depthModeForSublayer(0,m.DepthMode.ReadOnly),ne=m.StencilMode.disabled,oe=_.colorModeForRenderPass(),ae="globe"===U.projection.name,se=[m.mercatorXfromLng(U.center.lng),m.mercatorYfromLat(U.center.lat)],le=[];for(let re=0;re<v.length;re++){const fe=v[re],_e=c.getTile(fe),Te=_e.getBucket(f);if(!Te||Te.projection.name!==U.projection.name)continue;const De=Te.programConfigurations.get(f.id),Se=sa(f);ae&&Se.push("PROJECTION_GLOBE_VIEW");const Le=_.useProgram("circle",De,Se),Fe=Te.layoutVertexBuffer,Ze=Te.globeExtVertexBuffer,ht=Te.indexBuffer,je=U.projection.createInversionMatrix(U,fe.canonical),dt={programConfiguration:De,program:Le,layoutVertexBuffer:Fe,globeExtVertexBuffer:Ze,indexBuffer:ht,uniformValues:Sa(_,fe,_e,je,se,f),tile:_e};if(k){const He=Te.segments.get();for(const Et of He)le.push({segments:new m.SegmentVector([Et]),sortKey:Et.sortKey,state:dt})}else le.push({segments:Te.segments,sortKey:0,state:dt})}k&&le.sort((re,fe)=>re.sortKey-fe.sortKey);const W={useDepthForOcclusion:!ae};for(const re of le){const{programConfiguration:fe,program:_e,layoutVertexBuffer:Te,globeExtVertexBuffer:De,indexBuffer:Se,uniformValues:Le,tile:Fe}=re.state,Ze=re.segments;_.terrain&&_.terrain.setupElevationDraw(Fe,_e,W),_.prepareDrawProgram(L,_e,Fe.tileID.toUnwrapped()),_e.draw(L,V.TRIANGLES,q,ne,oe,m.CullFaceMode.disabled,Le,f.id,Te,Se,Ze,f.paint,U.zoom,fe,[De])}},heatmap:function(_,c,f,v){if(0!==f.paint.get("heatmap-opacity"))if("offscreen"===_.renderPass){const w=_.context,M=w.gl,I=m.StencilMode.disabled,k=new m.ColorMode([M.ONE,M.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(oe,ae,se,le){const W=oe.gl,re=ae.width*le,fe=ae.height*le;oe.activeTexture.set(W.TEXTURE1),oe.viewport.set([0,0,re,fe]);let _e=se.heatmapFbo;if(!_e||_e&&(_e.width!==re||_e.height!==fe)){_e&&_e.destroy();const Te=W.createTexture();W.bindTexture(W.TEXTURE_2D,Te),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),_e=se.heatmapFbo=oe.createFramebuffer(re,fe,!1),function(De,Se,Le,Fe,Ze,ht){const je=De.gl;je.texImage2D(je.TEXTURE_2D,0,De.isWebGL2&&De.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Ze,ht,0,je.RGBA,De.extRenderToTextureHalfFloat?De.isWebGL2?je.HALF_FLOAT:De.extTextureHalfFloat.HALF_FLOAT_OES:je.UNSIGNED_BYTE,null),Fe.colorAttachment.set(Le)}(oe,0,Te,_e,re,fe)}else W.bindTexture(W.TEXTURE_2D,_e.colorAttachment.get()),oe.bindFramebuffer.set(_e.framebuffer)})(w,_,f,"globe"===_.transform.projection.name?.5:.25),w.clear({color:m.Color.transparent});const L=_.transform,V="globe"===L.projection.name,U=V?["PROJECTION_GLOBE_VIEW"]:null,q=V?m.CullFaceMode.frontCCW:m.CullFaceMode.disabled,ne=[m.mercatorXfromLng(L.center.lng),m.mercatorYfromLat(L.center.lat)];for(let oe=0;oe<v.length;oe++){const ae=v[oe];if(c.hasRenderableParent(ae))continue;const se=c.getTile(ae),le=se.getBucket(f);if(!le||le.projection.name!==L.projection.name)continue;const W=le.programConfigurations.get(f.id),re=_.useProgram("heatmap",W,U),{zoom:fe}=_.transform;_.terrain&&_.terrain.setupElevationDraw(se,re),_.prepareDrawProgram(w,re,ae.toUnwrapped());const _e=L.projection.createInversionMatrix(L,ae.canonical);re.draw(w,M.TRIANGLES,m.DepthMode.disabled,I,k,q,Wa(_,ae,se,_e,ne,fe,f.paint.get("heatmap-intensity")),f.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,f.paint,_.transform.zoom,W,V?[le.globeExtVertexBuffer]:null)}w.viewport.set([0,0,_.width,_.height])}else"translucent"===_.renderPass&&(_.context.setColorMode(_.colorModeForRenderPass()),function(w,M){const I=w.context,k=I.gl,L=M.heatmapFbo;if(!L)return;I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get()),I.activeTexture.set(k.TEXTURE1);let V=M.colorRampTexture;V||(V=M.colorRampTexture=new m.Texture(I,M.colorRamp,k.RGBA)),V.bind(k.LINEAR,k.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(I,k.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,w.colorModeForRenderPass(),m.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:M.paint.get("heatmap-opacity")},M.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,M.paint,w.transform.zoom)}(_,f))},line:function(_,c,f,v){if("translucent"!==_.renderPass)return;const w=f.paint.get("line-opacity"),M=f.paint.get("line-width");if(0===w.constantOr(1)||0===M.constantOr(1))return;const I=_.depthModeForSublayer(0,m.DepthMode.ReadOnly),k=_.colorModeForRenderPass(),L=_.terrain&&_.terrain.renderingToTexture?1:m.exported.devicePixelRatio,V=f.paint.get("line-dasharray"),U=V.constantOr(1),q=f.layout.get("line-cap"),ne=f.paint.get("line-pattern"),oe=ne.constantOr(1),ae=f.paint.get("line-gradient"),se=oe?"linePattern":"line",le=_.context,W=le.gl,re=(_e=>{const Te=[];Za(_e)&&Te.push("RENDER_LINE_DASH"),_e.paint.get("line-gradient")&&Te.push("RENDER_LINE_GRADIENT");const De=_e.paint.get("line-trim-offset");0===De[0]&&0===De[1]||Te.push("RENDER_LINE_TRIM_OFFSET");const Se=_e.paint.get("line-pattern").constantOr(1),Le=1!==_e.paint.get("line-opacity").constantOr(1);return!Se&&Le&&Te.push("RENDER_LINE_ALPHA_DISCARD"),Te})(f);let fe=re.includes("RENDER_LINE_ALPHA_DISCARD");_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(fe=!1);for(const _e of v){const Te=c.getTile(_e);if(oe&&!Te.patternsLoaded())continue;const De=Te.getBucket(f);if(!De)continue;_.prepareDrawTile();const Se=De.programConfigurations.get(f.id),Le=_.useProgram(se,Se,re),Fe=ne.constantOr(null);if(Fe&&Te.imageAtlas){const ct=Te.imageAtlas.patternPositions[Fe.toString()];ct&&Se.setConstantPatternPositions(ct)}const Ze=V.constantOr(null),ht=q.constantOr(null);if(!oe&&Ze&&ht&&Te.lineAtlas){const ct=Te.lineAtlas.getDash(Ze,ht);ct&&Se.setConstantPatternPositions(ct)}let[je,dt]=f.paint.get("line-trim-offset");("round"===ht||"square"===ht)&&je!==dt&&(0===je&&(je-=1),1===dt&&(dt+=1));const He=_.terrain?_e.projMatrix:null,Et=oe?Ko(_,Te,f,He,L):Zh(_,Te,f,He,De.lineClipsArray.length,L,[je,dt]);if(ae){const ct=De.gradients[f.id];let _t=ct.texture;if(f.gradientVersion!==ct.version){let yt=256;if(f.stepInterpolant){const It=c.getSource().maxzoom,wn=_e.canonical.z===It?Math.ceil(1<<_.transform.maxZoom-_e.canonical.z):1;yt=m.clamp(m.nextPowerOfTwo(De.maxLineLength/m.EXTENT*1024*wn),256,le.maxTextureSize)}ct.gradient=m.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:yt,image:ct.gradient||void 0,clips:De.lineClipsArray}),ct.texture?ct.texture.update(ct.gradient):ct.texture=new m.Texture(le,ct.gradient,W.RGBA),ct.version=f.gradientVersion,_t=ct.texture}le.activeTexture.set(W.TEXTURE1),_t.bind(f.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}U&&(le.activeTexture.set(W.TEXTURE0),Te.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),Se.updatePaintBuffers()),oe&&(le.activeTexture.set(W.TEXTURE0),Te.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Se.updatePaintBuffers()),_.prepareDrawProgram(le,Le,_e.toUnwrapped());const qe=ct=>{Le.draw(le,W.TRIANGLES,I,ct,k,m.CullFaceMode.disabled,Et,f.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,f.paint,_.transform.zoom,Se,[De.layoutVertexBuffer2])};if(fe){const ct=_.stencilModeForClipping(_e).ref;0===ct&&_.terrain&&le.clear({stencil:0});const _t={func:W.EQUAL,mask:255};Et.u_alpha_discard_threshold=.8,qe(new m.StencilMode(_t,ct,255,W.KEEP,W.KEEP,W.INVERT)),Et.u_alpha_discard_threshold=0,qe(new m.StencilMode(_t,ct,255,W.KEEP,W.KEEP,W.KEEP))}else qe(_.stencilModeForClipping(_e))}fe&&(_.resetStencilClippingMasks(),_.terrain&&le.clear({stencil:0}))},fill:function(_,c,f,v){const w=f.paint.get("fill-color"),M=f.paint.get("fill-opacity");if(0===M.constantOr(1))return;const I=_.colorModeForRenderPass(),k=f.paint.get("fill-pattern"),L=_.opaquePassEnabledForLayer()&&!k.constantOr(1)&&1===w.constantOr(m.Color.transparent).a&&1===M.constantOr(0)?"opaque":"translucent";if(_.renderPass===L){const V=_.depthModeForSublayer(1,"opaque"===_.renderPass?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly);aa(_,c,f,v,V,I,!1)}if("translucent"===_.renderPass&&f.paint.get("fill-antialias")){const V=_.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,m.DepthMode.ReadOnly);aa(_,c,f,v,V,I,!0)}},"fill-extrusion":function(_,c,f,v){const w=f.paint.get("fill-extrusion-opacity");if(0!==w&&"translucent"===_.renderPass){const M=new m.DepthMode(_.context.gl.LEQUAL,m.DepthMode.ReadWrite,_.depthRangeFor3D);if(1!==w||f.paint.get("fill-extrusion-pattern").constantOr(1))Wr(_,c,f,v,M,m.StencilMode.disabled,m.ColorMode.disabled),Wr(_,c,f,v,M,_.stencilModeFor3D(),_.colorModeForRenderPass()),_.resetStencilClippingMasks();else{const I=_.colorModeForRenderPass();Wr(_,c,f,v,M,m.StencilMode.disabled,I)}}},hillshade:function(_,c,f,v){if("offscreen"!==_.renderPass&&"translucent"!==_.renderPass)return;const w=_.context,M=_.depthModeForSublayer(0,m.DepthMode.ReadOnly),I=_.colorModeForRenderPass(),k=_.terrain&&_.terrain.renderingToTexture,[L,V]="translucent"!==_.renderPass||k?[{},v]:_.stencilConfigForOverlap(v);for(const U of V){const q=c.getTile(U);if(q.needsHillshadePrepare&&"offscreen"===_.renderPass)Am(_,q,f,M,m.StencilMode.disabled,I);else if("translucent"===_.renderPass){const ne=k&&_.terrain?_.terrain.stencilModeForRTTOverlap(U):L[U.overscaledZ];Qr(_,U,q,f,M,ne,I)}}w.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,c,f,v,w,M){if("translucent"!==_.renderPass||0===f.paint.get("raster-opacity")||!v.length)return;const I=_.context,k=I.gl,L=c.getSource(),V=_.useProgram("raster"),U=_.colorModeForRenderPass(),q=_.terrain&&_.terrain.renderingToTexture,[ne,oe]=L instanceof Fn||q?[{},v]:_.stencilConfigForOverlap(v),ae=oe[oe.length-1].overscaledZ,se=!_.options.moving;for(const le of oe){const W=q?m.DepthMode.disabled:_.depthModeForSublayer(le.overscaledZ-ae,1===f.paint.get("raster-opacity")?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly,k.LESS),re=le.toUnwrapped(),fe=c.getTile(le);if(q&&(!fe||!fe.hasData()))continue;const _e=q?le.projMatrix:_.transform.calculateProjMatrix(re,se),Te=_.terrain&&q?_.terrain.stencilModeForRTTOverlap(le):ne[le.overscaledZ],De=M?0:f.paint.get("raster-fade-duration");fe.registerFadeDuration(De);const Se=c.findLoadedParent(le,0),Le=Wh(fe,Se,c,_.transform,De);let Fe,Ze;_.terrain&&_.terrain.prepareDrawTile();const ht="nearest"===f.paint.get("raster-resampling")?k.NEAREST:k.LINEAR;I.activeTexture.set(k.TEXTURE0),fe.texture.bind(ht,k.CLAMP_TO_EDGE),I.activeTexture.set(k.TEXTURE1),Se?(Se.texture.bind(ht,k.CLAMP_TO_EDGE),Fe=Math.pow(2,Se.tileID.overscaledZ-fe.tileID.overscaledZ),Ze=[fe.tileID.canonical.x*Fe%1,fe.tileID.canonical.y*Fe%1]):fe.texture.bind(ht,k.CLAMP_TO_EDGE),fe.texture.useMipmap&&I.extTextureFilterAnisotropic&&_.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const je=Qd(_e,Ze||[0,0],Fe||1,Le,f,L instanceof Fn?L.perspectiveTransform:[0,0]);if(_.prepareDrawProgram(I,V,re),L instanceof Fn)L.boundsBuffer&&L.boundsSegments&&V.draw(I,k.TRIANGLES,W,m.StencilMode.disabled,U,m.CullFaceMode.disabled,je,f.id,L.boundsBuffer,_.quadTriangleIndexBuffer,L.boundsSegments);else{const{tileBoundsBuffer:dt,tileBoundsIndexBuffer:He,tileBoundsSegments:Et}=_.getTileBoundsBuffers(fe);V.draw(I,k.TRIANGLES,W,Te,U,m.CullFaceMode.disabled,je,f.id,dt,He,Et)}}_.resetStencilClippingMasks()},background:function(_,c,f,v){const w=f.paint.get("background-color"),M=f.paint.get("background-opacity");if(0===M)return;const I=_.context,k=I.gl,L=_.transform,V=L.tileSize,U=f.paint.get("background-pattern");if(_.isPatternMissing(U))return;const q=!U&&1===w.a&&1===M&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==q)return;const ne=m.StencilMode.disabled,oe=_.depthModeForSublayer(0,"opaque"===q?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly),ae=_.colorModeForRenderPass(),se=_.useProgram(U?"backgroundPattern":"background");let le,W=v;W||(le=_.getBackgroundTiles(),W=Object.values(le).map(re=>re.tileID)),U&&(I.activeTexture.set(k.TEXTURE0),_.imageManager.bind(_.context));for(const re of W){const fe=re.toUnwrapped(),_e=v?re.projMatrix:_.transform.calculateProjMatrix(fe);_.prepareDrawTile();const Te=c?c.getTile(re):le?le[re.key]:new m.Tile(re,V,L.zoom,_),De=U?Xh(_e,M,_,U,{tileID:re,tileSize:V}):Xl(_e,M,w);_.prepareDrawProgram(I,se,fe);const{tileBoundsBuffer:Se,tileBoundsIndexBuffer:Le,tileBoundsSegments:Fe}=_.getTileBoundsBuffers(Te);se.draw(I,k.TRIANGLES,oe,ne,ae,m.CullFaceMode.disabled,De,f.id,Se,Le,Fe)}},sky:function(_,c,f){const v=_.transform,w="mercator"===v.projection.name||"globe"===v.projection.name?1:m.smoothstep(7,8,v.zoom),M=f.paint.get("sky-opacity")*w;if(0===M)return;const I=_.context,k=f.paint.get("sky-type"),L=new m.DepthMode(I.gl.LEQUAL,m.DepthMode.ReadOnly,[0,1]),V=_.frameCounter/1e3%1;"atmosphere"===k?"offscreen"===_.renderPass?f.needsSkyboxCapture(_)&&(function(U,q,ne,oe){const ae=U.context,se=ae.gl;let le=q.skyboxFbo;if(!le){le=q.skyboxFbo=ae.createFramebuffer(32,32,!1),q.skyboxGeometry=new Mn(ae),q.skyboxTexture=ae.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,q.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let _e=0;_e<6;++_e)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}ae.bindFramebuffer.set(le.framebuffer),ae.viewport.set([0,0,32,32]);const W=q.getCenter(U,!0),re=U.useProgram("skyboxCapture"),fe=new Float64Array(16);m.identity(fe),m.rotateY(fe,fe,.5*-Math.PI),tr(ae,q,re,fe,W,0),m.identity(fe),m.rotateY(fe,fe,.5*Math.PI),tr(ae,q,re,fe,W,1),m.identity(fe),m.rotateX(fe,fe,.5*-Math.PI),tr(ae,q,re,fe,W,2),m.identity(fe),m.rotateX(fe,fe,.5*Math.PI),tr(ae,q,re,fe,W,3),m.identity(fe),tr(ae,q,re,fe,W,4),m.identity(fe),m.rotateY(fe,fe,Math.PI),tr(ae,q,re,fe,W,5),ae.viewport.set([0,0,U.width,U.height])}(_,f),f.markSkyboxValid(_)):"sky"===_.renderPass&&function(U,q,ne,oe,ae){const se=U.context,le=se.gl,W=U.transform,re=U.useProgram("skybox");se.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_CUBE_MAP,q.skyboxTexture);const fe={u_matrix:W.skyboxMatrix,u_sun_direction:q.getCenter(U,!1),u_cubemap:0,u_opacity:oe,u_temporal_offset:ae};U.prepareDrawProgram(se,re),re.draw(se,le.TRIANGLES,ne,m.StencilMode.disabled,U.colorModeForRenderPass(),m.CullFaceMode.backCW,fe,"skybox",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(_,f,L,M,V):"gradient"===k&&"sky"===_.renderPass&&function(U,q,ne,oe,ae){const se=U.context,le=se.gl,W=U.transform,re=U.useProgram("skyboxGradient");q.skyboxGeometry||(q.skyboxGeometry=new Mn(se)),se.activeTexture.set(le.TEXTURE0);let fe=q.colorRampTexture;fe||(fe=q.colorRampTexture=new m.Texture(se,q.colorRamp,le.RGBA)),fe.bind(le.LINEAR,le.CLAMP_TO_EDGE);const _e=(Te=W.skyboxMatrix,De=q.getCenter(U,!1),Se=q.paint.get("sky-gradient-radius"),Le=oe,Fe=ae,{u_matrix:Te,u_color_ramp:0,u_center_direction:De,u_radius:m.degToRad(Se),u_opacity:Le,u_temporal_offset:Fe});var Te,De,Se,Le,Fe;U.prepareDrawProgram(se,re),re.draw(se,le.TRIANGLES,ne,m.StencilMode.disabled,U.colorModeForRenderPass(),m.CullFaceMode.backCW,_e,"skyboxGradient",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(_,f,L,M,V)},debug:function(_,c,f){for(let v=0;v<f.length;v++)Jd(_,c,f[v])},custom:function(_,c,f,v){const w=_.context,M=f.implementation;if(!_.transform.projection.unsupportedLayers||!_.transform.projection.unsupportedLayers.includes("custom")||_.terrain&&(_.terrain.renderingToTexture||"offscreen"===_.renderPass)&&f.isLayerDraped()){if("offscreen"===_.renderPass){const I=M.prerender;if(I){if(_.setCustomLayerDefaults(),w.setColorMode(_.colorModeForRenderPass()),"globe"===_.transform.projection.name){const k=_.transform.pointMerc;I.call(M,w.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),m.globeToMercatorTransition(_.transform.zoom),[k.x,k.y],_.transform.pixelsPerMeterRatio)}else I.call(M,w.gl,_.transform.customLayerMatrix());w.setDirty(),_.setBaseState()}}else if("translucent"===_.renderPass){if(_.terrain&&_.terrain.renderingToTexture){const k=M.renderToTile;if(k){const L=v[0].canonical,V=new m.MercatorCoordinate(L.x+v[0].wrap*(1<<L.z),L.y,L.z);w.setDepthMode(m.DepthMode.disabled),w.setStencilMode(m.StencilMode.disabled),w.setColorMode(_.colorModeForRenderPass()),_.setCustomLayerDefaults(),k.call(M,w.gl,V),w.setDirty(),_.setBaseState()}return}_.setCustomLayerDefaults(),w.setColorMode(_.colorModeForRenderPass()),w.setStencilMode(m.StencilMode.disabled);const I="3d"===M.renderingMode?new m.DepthMode(_.context.gl.LEQUAL,m.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,m.DepthMode.ReadOnly);if(w.setDepthMode(I),"globe"===_.transform.projection.name){const k=_.transform.pointMerc;M.render(w.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),m.globeToMercatorTransition(_.transform.zoom),[k.x,k.y],_.transform.pixelsPerMeterRatio)}else M.render(w.gl,_.transform.customLayerMatrix());w.setDirty(),_.setBaseState(),w.bindFramebuffer.set(null)}}else m.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class es{constructor(c,f,v=!1){this.context=new St(c,v),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=m.SourceCache.maxUnderzooming+m.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,f){const v=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ra(this,c));const w=this._terrain;this.transform.elevation=v?w:null,w.update(c,this.transform,f)}_updateFog(c){const f=c.fog;if(!f||"globe"===this.transform.projection.name||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,w]=f.getFovAdjustedRange(this.transform._fov);if(v>w)return void(this.transform.fogCullDistSq=null);const M=v+.78*(w-v);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,f){if(this.width=c*m.exported.devicePixelRatio,this.height=f*m.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const c=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(f,m.posAttributes.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);const v=new m.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(m.EXTENT,0),v.emplaceBack(0,m.EXTENT),v.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=c.createVertexBuffer(v,m.posAttributes.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);const w=new m.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(w,m.posAttributes.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);const M=new m.StructArrayLayout4i8;M.emplaceBack(0,0,0,0),M.emplaceBack(m.EXTENT,0,m.EXTENT,0),M.emplaceBack(0,m.EXTENT,0,m.EXTENT),M.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(M,m.boundsAttributes.members),this.mercatorBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);const I=new m.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(I);const k=new m.StructArrayLayout1ui2;for(const V of[0,1,3,2,0])k.emplaceBack(V);this.debugIndexBuffer=c.createIndexBuffer(k),this.emptyTexture=new m.Texture(c,new m.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=m.create();const L=this.context.gl;this.stencilClearMode=new m.StencilMode({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(m.window.performance.now()),this.atmosphereBuffer=new Cl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,f=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,f.TRIANGLES,m.DepthMode.disabled,this.stencilClearMode,m.ColorMode.disabled,m.CullFaceMode.disabled,Yu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,f,v){if(!f||this.currentStencilSource===f.id||!c.isTileClipped()||!v||0===v.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const L of v)if(void 0===this._tileClippingMaskIDs[L.key]){k=!0;break}if(!k)return}this.currentStencilSource=f.id;const w=this.context,M=w.gl;this.nextStencilID+v.length>256&&this.clearStencil(),w.setColorMode(m.ColorMode.disabled),w.setDepthMode(m.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of v){const L=f.getTile(k),V=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:U,tileBoundsIndexBuffer:q,tileBoundsSegments:ne}=this.getTileBoundsBuffers(L);I.draw(w,M.TRIANGLES,m.DepthMode.disabled,new m.StencilMode({func:M.ALWAYS,mask:0},V,255,M.KEEP,M.KEEP,M.REPLACE),m.ColorMode.disabled,m.CullFaceMode.disabled,Yu(k.projMatrix),"$clipping",U,q,ne)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,f=this.context.gl;return new m.StencilMode({func:f.NOTEQUAL,mask:255},c,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const f=this.context.gl;return new m.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(c){const f=this.context.gl,v=c.sort((I,k)=>k.overscaledZ-I.overscaledZ),w=v[v.length-1].overscaledZ,M=v[0].overscaledZ-w+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const I={};for(let k=0;k<M;k++)I[k+w]=new m.StencilMode({func:f.GEQUAL,mask:255},k+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=M,[I,v]}return[{[w]:m.StencilMode.disabled},v]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new m.ColorMode([c.CONSTANT_COLOR,c.ONE],new m.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?m.ColorMode.unblended:m.ColorMode.alphaBlended}depthModeForSublayer(c,f,v){if(!this.opaquePassEnabledForLayer())return m.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new m.DepthMode(v||this.context.gl.LEQUAL,f,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,f){this.style=c,this.options=f,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(m.exported.now()),this.imageManager.beginFrame();const v=this.style.order,w=this.style._sourceCaches;for(const V in w){const U=w[V];U.used&&U.prepare(this.context)}const M={},I={},k={};for(const V in w){const U=w[V];M[V]=U.getVisibleCoordinates(),I[V]=M[V].slice().reverse(),k[V]=U.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let V=0;V<v.length;V++)if(this.style._layers[v[V]].is3D()){this.opaquePassCutoff=V;break}if(this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new m.GlobeSharedBuffers(this.context)),!m.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const V of v){const U=this.style._layers[V],q=c._getLayerSourceCache(U);if(!U.hasOffscreenPass()||U.isHidden(this.transform.zoom))continue;const ne=q?I[q.id]:void 0;("custom"===U.type||U.isSky()||ne&&ne.length)&&this.renderLayer(this,q,U,ne)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const L=this.terrain;if(L&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&L.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const V=this.style._layers[v[this.currentLayer]],U=c._getLayerSourceCache(V);if(V.isSky())continue;const q=U?I[U.id]:void 0;this._renderTileClippingMasks(V,U,q),this.renderLayer(this,U,V,q)}if(this.style.fog&&this.transform.projection.supportsFog&&function(V,U){const q=V.context,ne=q.gl,oe=V.transform,ae=new m.DepthMode(ne.LEQUAL,m.DepthMode.ReadOnly,[0,1]),se=V.useProgram("globeAtmosphere",null,"globe"===oe.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),le=m.globeToMercatorTransition(oe.zoom),W=U.properties.get("color").toArray01(),re=U.properties.get("high-color").toArray01(),fe=U.properties.get("space-color").toArray01PremultipliedAlpha(),_e=m.identity$1([]);m.rotateY$1(_e,_e,-m.degToRad(oe._center.lng)),m.rotateX$1(_e,_e,m.degToRad(oe._center.lat)),m.rotateZ$1(_e,_e,oe.angle),m.rotateX$1(_e,_e,-oe._pitch);const Te=m.fromQuat(new Float32Array(16),_e),De=m.mapValue(U.properties.get("star-intensity"),0,1,0,.25),Le=m.mapValue(U.properties.get("horizon-blend"),0,1,5e-4,.25),Fe=m.globeUseCustomAntiAliasing(V,q,oe)&&5e-4===Le?oe.worldSize/(2*Math.PI*1.025)-1:oe.globeRadius,Ze=V.frameCounter/1e3%1,ht=m.length(oe.globeCenterInViewSpace),je=Math.sqrt(Math.pow(ht,2)-Math.pow(Fe,2)),dt=Math.acos(je/ht),He={u_frustum_tl:oe.frustumCorners.TL,u_frustum_tr:oe.frustumCorners.TR,u_frustum_br:oe.frustumCorners.BR,u_frustum_bl:oe.frustumCorners.BL,u_horizon:oe.frustumCorners.horizon,u_transition:le,u_fadeout_range:Le,u_color:W,u_high_color:re,u_space_color:fe,u_star_intensity:De,u_star_size:5*m.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ze,u_horizon_angle:dt,u_rotation_matrix:Te};V.prepareDrawProgram(q,se);const Et=V.atmosphereBuffer;Et&&se.draw(q,ne.TRIANGLES,ae,m.StencilMode.disabled,m.ColorMode.alphaBlended,m.CullFaceMode.backCW,He,"skybox",Et.vertexBuffer,Et.indexBuffer,Et.segments)}(this,this.style.fog),this.renderPass="sky",(m.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const V=this.style._layers[v[this.currentLayer]],U=c._getLayerSourceCache(V);V.isSky()&&this.renderLayer(this,U,V,U?I[U.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const V=this.style._layers[v[this.currentLayer]],U=c._getLayerSourceCache(V);if(V.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(V)){if(V.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const q=U?("symbol"===V.type?k:I)[U.id]:void 0;this._renderTileClippingMasks(V,U,U?M[U.id]:void 0),this.renderLayer(this,U,V,q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let V=null;m.values(this.style._layers).forEach(U=>{const q=c._getLayerSourceCache(U);q&&!U.isHidden(this.transform.zoom)&&(!V||V.getSource().maxzoom<q.getSource().maxzoom)&&(V=q)}),V&&this.options.showTileBoundaries&&nr.debug(this,V,V.getVisibleCoordinates())}this.options.showPadding&&function(V){const U=V.transform.padding;Ec(V,V.transform.height-(U.top||0),3,Qo),Ec(V,U.bottom||0,3,El),pr(V,U.left||0,3,Jo),pr(V,V.transform.width-(U.right||0),3,Ni);const q=V.transform.centerPoint;var ne,oe,ae,se;Cc(ne=V,(oe=q.x)-1,(ae=V.transform.height-q.y)-10,2,20,se=su),Cc(ne,oe-10,ae-1,20,2,se)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(m.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,f,v,w){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||w&&w.length)&&(this.id=v.id,this.gpuTimingStart(v),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(v.type)||c.terrain&&"custom"===v.type)&&nr[v.type](c,f,v,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let v=this.gpuTimers[c.id];v||(v=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),v.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,f=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),c.beginQueryEXT(c.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const f={};for(const v in c){const w=c[v],M=this.context.extTimerQuery,I=M.getQueryObjectEXT(w.query,M.QUERY_RESULT_EXT)/1e6;M.deleteQueryEXT(w.query),f[v]=I}return f}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let v=0;for(const w of c)v+=f.getQueryObjectEXT(w,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(w);return v}translatePosMatrix(c,f,v,w,M){if(!v[0]&&!v[1])return c;const I=M?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(I){const V=Math.sin(I),U=Math.cos(I);v=[v[0]*U-v[1]*V,v[0]*V+v[1]*U]}const k=[M?v[0]:Yr(f,v[0],this.transform.zoom),M?v[1]:Yr(f,v[1],this.transform.zoom),0],L=new Float32Array(16);return m.translate(L,c,k),L}saveTileTexture(c){const f=this._tileTextures[c.size[0]];f?f.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const f=this._tileTextures[c];return f&&f.length>0?f.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&0===this.terrain.exaggeration(),v=this.style&&this.style.fog,w=[];return this.terrainRenderModeElevated()&&w.push("TERRAIN"),"globe"===this.transform.projection.name&&w.push("GLOBE"),f&&w.push("ZERO_EXAGGERATION"),v&&!c&&0!==v.getOpacity(this.transform.pitch)&&w.push("FOG"),c&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}useProgram(c,f,v){this.cache=this.cache||{};const w=v||[],M=this.currentGlobalDefines().concat(w),I=ai.cacheKey(Zu[c],c,M,f);return this.cache[I]||(this.cache[I]=new ai(this.context,c,Zu[c],f,Yh[c],M)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,f,v){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const M=w.getOpacity(this.transform.pitch),I=((k,L,V,U,q,ne,oe,ae,se,le,W)=>{const re=k.transform,fe=L.properties.get("color").toArray01();fe[3]=U;const _e=k.frameCounter/1e3%1;return{u_fog_matrix:V?re.calculateFogTileMatrix(V):k.identityMat,u_fog_range:L.getFovAdjustedRange(re._fov),u_fog_color:fe,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_temporal_offset:_e,u_frustum_tl:q,u_frustum_tr:ne,u_frustum_br:oe,u_frustum_bl:ae,u_globe_pos:se,u_globe_radius:le,u_viewport:W,u_globe_transition:m.globeToMercatorTransition(re.zoom),u_is_globe:+("globe"===re.projection.name)}})(this,w,v,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*m.exported.devicePixelRatio,this.transform.height*m.exported.devicePixelRatio]);f.setFogUniformValues(c,I)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,f=c.createTexture();return c.bindTexture(c.TEXTURE_2D,f),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,f=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const w of v)f[w.key]=c[w.key]||new m.Tile(w,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class la{constructor(c=0,f=0,v=0,w=0){if(isNaN(c)||c<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=f,this.left=v,this.right=w}interpolate(c,f,v){return null!=f.top&&null!=c.top&&(this.top=m.number(c.top,f.top,v)),null!=f.bottom&&null!=c.bottom&&(this.bottom=m.number(c.bottom,f.bottom,v)),null!=f.left&&null!=c.left&&(this.left=m.number(c.left,f.left,v)),null!=f.right&&null!=c.right&&(this.right=m.number(c.right,f.right,v)),this}getCenter(c,f){const v=m.clamp((this.left+c-this.right)/2,0,c),w=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(v,w)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new la(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ia(_,c){const f=m.getColumn(_,3);m.fromQuat(_,c),m.setColumn(_,3,f)}function _i(_,c){const f=m.identity$1([]);return m.rotateZ$1(f,f,-c),m.rotateX$1(f,f,-_),f}function Xa(_,c){const f=[_[0],_[1],0],v=[c[0],c[1],0];if(m.length(f)>=1e-15){const I=m.normalize([],f);m.scale$2(v,I,m.dot(v,I)),c[0]=v[0],c[1]=v[1]}const w=m.cross([],c,_);if(m.len(w)<1e-15)return null;const M=Math.atan2(-w[1],w[0]);return _i(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),M)}class Mr{constructor(c,f){this.position=c,this.orientation=f}get position(){return this._position}set position(c){if(c){const f=c instanceof m.MercatorCoordinate?c:new m.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(f.x=m.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(c,f){if(this.orientation=null,!this.position)return;const v=this.position,w=this._elevation?this._elevation.getAtPointOrZero(m.MercatorCoordinate.fromLngLat(c)):0,M=m.MercatorCoordinate.fromLngLat(c,w),I=[M.x-v.x,M.y-v.y,M.z-v.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Xa(I,f)}setPitchBearing(c,f){this.orientation=_i(m.degToRad(c),m.degToRad(-f))}}class dn{constructor(c,f){this._transform=m.identity([]),this.orientation=f,this.position=c}get mercatorPosition(){const c=this.position;return new m.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=m.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var f;c&&m.setColumn(this._transform,3,[(f=c)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||m.identity$1([]),c&&Ia(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,f){this._orientation=_i(c,f),Ia(this._transform,this._orientation)}forward(){const c=m.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=m.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=m.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,f){const v=new Float64Array(16);return m.invert(v,this.getWorldToCamera(c,f)),v}getWorldToCameraPosition(c,f,v){const w=this.position;m.scale$2(w,w,-c);const M=new Float64Array(16);return m.fromScaling(M,[v,v,v]),m.translate(M,M,w),M[10]*=f,M}getWorldToCamera(c,f){const v=new Float64Array(16),w=new Float64Array(4),M=this.position;return m.conjugate(w,this._orientation),m.scale$2(M,M,-c),m.fromQuat(v,w),m.translate(v,v,M),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=f,v[9]*=f,v[10]*=f,v[11]*=f,v}getCameraToClipPerspective(c,f,v,w){const M=new Float64Array(16);return m.perspective(M,c,f,v,w),M}getDistanceToElevation(c,f=!1){const v=0===c?0:m.mercatorZfromAltitude(c,f?m.latFromMercatorY(this.position[1]):this.position[1]),w=this.forward();return(v-this.position[2])/w[2]}clone(){return new dn([...this.position],[...this.orientation])}}function Bn(_,c){const f=So(_.projection,_.zoom,_.width,_.height),v=function(M,I,k,L,V){const U=new m.LngLat(k.lng-180*ko,k.lat),q=new m.LngLat(k.lng+180*ko,k.lat),ne=M.project(U.lng,U.lat),oe=M.project(q.lng,q.lat),ae=-Math.atan2(oe.y-ne.y,oe.x-ne.x),se=m.MercatorCoordinate.fromLngLat(k);se.y=m.clamp(se.y,-1+ko,1-ko);const le=se.toLngLat(),W=M.project(le.lng,le.lat),re=m.MercatorCoordinate.fromLngLat(le);re.x+=ko;const fe=re.toLngLat(),_e=M.project(fe.lng,fe.lat),Te=ca(_e.x-W.x,_e.y-W.y,ae),De=m.MercatorCoordinate.fromLngLat(le);De.y+=ko;const Se=De.toLngLat(),Le=M.project(Se.lng,Se.lat),Fe=ca(Le.x-W.x,Le.y-W.y,ae),Ze=Math.abs(Te.x)/Math.abs(Fe.y),ht=m.identity([]);m.rotateZ(ht,ht,-ae*(1-(V?0:L)));const je=m.identity([]);return m.scale(je,je,[1,1-(1-Ze)*L,1]),je[4]=-Fe.x/Fe.y*L,m.rotateZ(je,je,ae),m.multiply(je,ht,je),je}(_.projection,0,_.center,f,c),w=Tr(_);return m.scale(v,v,[w,w,1]),v}function Tr(_){const c=_.projection,f=So(_.projection,_.zoom,_.width,_.height),v=vo(c,_.center),w=vo(c,m.LngLat.convert(c.center));return Math.pow(2,v*f+(1-f)*w)}function So(_,c,f,v,w=1/0){const M=_.range;if(!M)return 0;const I=Math.min(w,Math.max(f,v)),k=Math.log(I/1024)/Math.LN2;return m.smoothstep(M[0]+k,M[1]+k,c)}const ko=1/4e4;function vo(_,c){const f=m.clamp(c.lat,-m.MAX_MERCATOR_LATITUDE,m.MAX_MERCATOR_LATITUDE),v=new m.LngLat(c.lng-180*ko,f),w=new m.LngLat(c.lng+180*ko,f),M=_.project(v.lng,f),I=_.project(w.lng,f),k=m.MercatorCoordinate.fromLngLat(v),L=m.MercatorCoordinate.fromLngLat(w),V=I.x-M.x,U=I.y-M.y,q=L.x-k.x,ne=L.y-k.y,oe=Math.sqrt((q*q+ne*ne)/(V*V+U*U));return Math.log(oe)/Math.LN2}function ca(_,c,f){const v=Math.cos(f),w=Math.sin(f);return{x:_*v-c*w,y:_*w+c*v}}class mr{constructor(c,f,v,w,M,I,k){this.tileSize=512,this._renderWorldCopies=void 0===M||M,this._minZoom=c||0,this._maxZoom=f||22,this._minPitch=v??0,this._maxPitch=w??60,this.setProjection(I),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new la,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new dn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new mr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,f=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||v)&&this._updateCameraOnTerrain(),(c||v)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return m.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=m.getProjection(this.projectionOptions);const v=!pt(f,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=m.getProjection({name:"mercator"});const f=c!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return m.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new m.Point(this.width,this.height)}get bearing(){return m.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const f=-c*Math.PI/180;var v,w,M,I,k,L,V,U,q,ne;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(v=new m.ARRAY_TYPE(4),m.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),w=this.rotationMatrix,I=this.angle,k=(M=this.rotationMatrix)[0],L=M[1],V=M[2],U=M[3],q=Math.sin(I),ne=Math.cos(I),w[0]=k*ne+V*q,w[1]=L*ne+U*q,w[2]=k*-q+V*ne,w[3]=L*-q+U*ne)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const f=m.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=m.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const f=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let w=0,M=0;for(let I=0;I<f.length;I++){const k=new m.Point(f[I][0]*this.width,v+f[I][1]*(this.height-v)),L=c.pointCoordinate(k);if(!L)continue;const V=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);w+=L[3]*V,M+=V}return 0===M?NaN:w/M}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*f,w=this._mercatorZfromZoom(c),M=this._mercatorZfromZoom(this._maxZoom),I=Math.max(w-v,M);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let v;v=c.z<this._camera.position[2]?[f.x,f.y,f.z]:[c.x,c.y,c.z];const w=m.length(m.sub([],this._camera.position,v));return m.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let f=!1;if(c.orientation&&!m.exactEquals(c.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(c.orientation)),c.position){const v=[c.position.x,c.position.y,c.position.z];m.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,f=new Mr;return f.position=new m.MercatorCoordinate(c[0],c[1],c[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(c){if(!m.length$1(c))return!1;m.normalize$1(c,c);const f=m.transformQuat([],[0,0,-1],c),v=m.transformQuat([],[0,-1,0],c);if(v[2]<0)return!1;const w=Xa(f,v);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(c){const f=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;c[2]=m.clamp(c[2],w/v,w/f),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,f,v){this._unmodified=!1,this._edgeInsets.interpolate(c,f,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const f=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(c){const f=[new m.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const v=this.pointCoordinate(new m.Point(0,0)),w=this.pointCoordinate(new m.Point(this.width,0)),M=this.pointCoordinate(new m.Point(this.width,this.height)),I=this.pointCoordinate(new m.Point(0,this.height)),k=Math.floor(Math.min(v.x,w.x,M.x,I.x)),L=Math.floor(Math.max(v.x,w.x,M.x,I.x)),V=1;for(let U=k-V;U<=L+V;U++)0!==U&&f.push(new m.UnwrappedTileID(U,c))}return f}coveringTiles(c){let f=this.coveringZoomLevel(c);const v=f,w=this.elevation&&!c.isTerrainDEM,M="mercator"===this.projection.name;if(void 0!==c.minzoom&&f<c.minzoom)return[];void 0!==c.maxzoom&&f>c.maxzoom&&(f=c.maxzoom);const I=this.locationCoordinate(this.center),k=this.center.lat,L=1<<f,V=[L*I.x,L*I.y,0],U="globe"===this.projection.name,q=!U,ne=m.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,q),oe=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ae=L*m.mercatorZfromAltitude(1,this.center.lat),se=this._camera.position[2]/m.mercatorZfromAltitude(1,this.center.lat),le=[L*oe.x,L*oe.y,se*(q?1:ae)],W=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),re=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,fe=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,_e=c.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?Tr(this):1,De=qe=>{const _t=new m.MercatorCoordinate(qe.x+25e-6,qe.y,qe.z),yt=new m.MercatorCoordinate(qe.x,qe.y+25e-6,qe.z),It=qe.toLngLat(),wn=_t.toLngLat(),kn=yt.toLngLat(),ln=this.locationCoordinate(It),Sn=this.locationCoordinate(wn),ui=this.locationCoordinate(kn),li=Math.hypot(Sn.x-ln.x,Sn.y-ln.y),gn=Math.hypot(ui.x-ln.x,ui.y-ln.y);return Math.sqrt(li*gn)*Te/25e-6},Se=qe=>{const ct=fe,_t=_e;return{aabb:m.tileAABB(this,L,0,0,0,qe,_t,ct,this.projection),zoom:0,x:0,y:0,minZ:_t,maxZ:ct,wrap:qe,fullyVisible:!1}},Le=[];let Fe=[];const Ze=f,ht=c.reparseOverscaled?v:f,je=qe=>qe*qe,dt=je((se-this._centerAltitude)*ae),He=qe=>{if(!this._elevation||!qe.tileID||!M)return;const ct=this._elevation.getMinMaxForTile(qe.tileID),_t=qe.aabb;ct?(_t.min[2]=ct.min,_t.max[2]=ct.max,_t.center[2]=(_t.min[2]+_t.max[2])/2):(qe.shouldSplit=Et(qe),qe.shouldSplit||(_t.min[2]=_t.max[2]=_t.center[2]=this._centerAltitude))},Et=qe=>{if(qe.zoom<re)return!0;if(qe.zoom===Ze)return!1;if(null!=qe.shouldSplit)return qe.shouldSplit;const ct=qe.aabb.distanceX(le),_t=qe.aabb.distanceY(le);let yt=dt,It=1;if(U){yt=je(qe.aabb.distanceZ(le));const ln=Math.pow(2,qe.zoom),Sn=m.latFromMercatorY((qe.y+1)/ln),ui=m.latFromMercatorY(qe.y/ln),li=Math.min(Math.max(k,Sn),ui),gn=m.circumferenceAtLatitude(li)/m.circumferenceAtLatitude(k);if(It=li===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,gn/this._mercatorScaleRatio),this.zoom<=m.GLOBE_ZOOM_THRESHOLD_MIN&&qe.zoom===Ze-1&&gn>=.9)return!0}else if(w&&(yt=je(qe.aabb.distanceZ(le)*ae)),this.projection.isReprojectedInTileSpace&&v<=5){const ln=Math.pow(2,qe.zoom),Sn=De(new m.MercatorCoordinate((qe.x+.5)/ln,(qe.y+.5)/ln));It=Sn>.85?1:Sn}const wn=ct*ct+_t*_t+yt;return wn<je((1<<Ze-qe.zoom)*W*It*((ln,Sn)=>{if(Sn*je(.707)<ln)return 1;const ui=Math.sqrt(Sn/ln);return ui/(1.4144271570014144+(Math.pow(1.1,ui-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(yt,dt),wn))};if(this.renderWorldCopies)for(let qe=1;qe<=3;qe++)Le.push(Se(-qe)),Le.push(Se(qe));for(Le.push(Se(0));Le.length>0;){const qe=Le.pop(),ct=qe.x,_t=qe.y;let yt=qe.fullyVisible;if(!yt){const It=qe.aabb.intersects(ne);if(0===It)continue;yt=2===It}if(qe.zoom!==Ze&&Et(qe))for(let It=0;It<4;It++){const wn=(ct<<1)+It%2,kn=(_t<<1)+(It>>1),ln={aabb:M?qe.aabb.quadrant(It):m.tileAABB(this,L,qe.zoom+1,wn,kn,qe.wrap,qe.minZ,qe.maxZ,this.projection),zoom:qe.zoom+1,x:wn,y:kn,wrap:qe.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:qe.minZ,maxZ:qe.maxZ};w&&!U&&(ln.tileID=new m.OverscaledTileID(qe.zoom+1===Ze?ht:qe.zoom+1,qe.wrap,qe.zoom+1,wn,kn),He(ln)),Le.push(ln)}else{const It=qe.zoom===Ze?ht:qe.zoom;if(c.minzoom&&c.minzoom>It)continue;const wn=V[0]-(.5+ct+(qe.wrap<<qe.zoom))*(1<<f-qe.zoom),kn=V[1]-.5-_t,ln=qe.tileID?qe.tileID:new m.OverscaledTileID(It,qe.wrap,qe.zoom,ct,_t);Fe.push({tileID:ln,distanceSq:wn*wn+kn*kn})}}if(this.fogCullDistSq){const qe=this.fogCullDistSq,ct=this.horizonLineFromTop();Fe=Fe.filter(_t=>{const yt=[0,0,0,1],It=[m.EXTENT,m.EXTENT,0,1],wn=this.calculateFogTileMatrix(_t.tileID.toUnwrapped());m.transformMat4$1(yt,yt,wn),m.transformMat4$1(It,It,wn);const kn=m.getAABBPointSquareDist(yt,It);if(0===kn)return!0;let ln=!1;const Sn=this._elevation;if(Sn&&kn>qe&&0!==ct){const ui=this.calculateProjMatrix(_t.tileID.toUnwrapped());let li;c.isTerrainDEM||(li=Sn.getMinMaxForTile(_t.tileID)),li||(li={min:_e,max:fe});const gn=m.furthestTileCorner(this.rotation),Xi=[gn[0]*m.EXTENT,gn[1]*m.EXTENT,li.max];m.transformMat4(Xi,Xi,ui),ln=(1-Xi[1])*this.height*.5<ct}return kn<qe||ln})}return Fe.sort((qe,ct)=>qe.distanceSq-ct.distanceSq).map(qe=>qe.tileID)}resize(c,f){this.width=c,this.height=f,this.pixelsToGLUnits=[2/c,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const f=m.clamp(c.lat,-m.MAX_MERCATOR_LATITUDE,m.MAX_MERCATOR_LATITUDE),v=this.projection.project(c.lng,f);return new m.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/m.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,f){let v,w;const M=this.centerPoint;if("globe"===this.projection.name){const k=this.worldSize;v=(f.x-M.x)/k,w=(f.y-M.y)/k}else{const k=this.pointCoordinate(f),L=this.pointCoordinate(M);v=k.x-L.x,w=k.y-L.y}const I=this.locationCoordinate(c);this.setLocation(new m.MercatorCoordinate(I.x-v,I.y-w))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,f){const v=f?m.mercatorZfromAltitude(f,c.lat):void 0,w=this.projection.project(c.lng,c.lat);return new m.MercatorCoordinate(w.x,w.y,v)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,f){const v=f??this._centerAltitude,w=[c.x,c.y,0,1],M=[c.x,c.y,1,1];m.transformMat4$1(w,w,this.pixelMatrixInverse),m.transformMat4$1(M,M,this.pixelMatrixInverse);const I=M[3];m.scale$1(w,w,1/w[3]),m.scale$1(M,M,1/I);const k=w[2],L=M[2];return{p0:w,p1:M,t:k===L?0:(v-k)/(L-k)}}screenPointToMercatorRay(c){const f=[c.x,c.y,0,1],v=[c.x,c.y,1,1];return m.transformMat4$1(f,f,this.pixelMatrixInverse),m.transformMat4$1(v,v,this.pixelMatrixInverse),m.scale$1(f,f,1/f[3]),m.scale$1(v,v,1/v[3]),f[2]=m.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,v[2]=m.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,m.scale$1(f,f,1/this.worldSize),m.scale$1(v,v,1/this.worldSize),new m.Ray([f[0],f[1],f[2]],m.normalize([],m.sub([],v,f)))}rayIntersectionCoordinate(c){const{p0:f,p1:v,t:w}=c,M=m.mercatorZfromAltitude(f[2],this._center.lat),I=m.mercatorZfromAltitude(v[2],this._center.lat);return new m.MercatorCoordinate(m.number(f[0],v[0],w)/this.worldSize,m.number(f[1],v[1],w)/this.worldSize,m.number(M,I,w))}pointCoordinate(c,f=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,f)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let f=this.projection.pointCoordinate3D(this,c.x,c.y);if(f)return new m.MercatorCoordinate(f[0],f[1],f[2]);let v=0,w=this.horizonLineFromTop();if(c.y>w)return this.pointCoordinate(c);const M=.02*w,I=c.clone();for(let k=0;k<10&&w-v>M;k++){I.y=m.number(v,w,.66);const L=this.projection.pointCoordinate3D(this,I.x,I.y);L?(w=I.y,f=L):v=I.y}return f?new m.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=m.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const f=this.pointCoordinate(c);return f.y>=0&&f.y<=1}_coordinatePoint(c,f){const v=f&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,w=[c.x*this.worldSize,c.y*this.worldSize,v+c.toAltitude(),1];return m.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new m.Point(w[0]/w[3],w[1]/w[3]):new m.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:f}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,M=this.pointLocation3D(new m.Point(f,c)),I=this.pointLocation3D(new m.Point(w,c)),k=this.pointLocation3D(new m.Point(w,v)),L=this.pointLocation3D(new m.Point(f,v));let V=Math.min(M.lng,I.lng,k.lng,L.lng),U=Math.max(M.lng,I.lng,k.lng,L.lng),q=Math.min(M.lat,I.lat,k.lat,L.lat),ne=Math.max(M.lat,I.lat,k.lat,L.lat);const oe=Math.pow(2,-this.zoom)/16*270,ae="globe"===this.projection.name?1:4,se=(le,W,re,fe,_e)=>{const Te=(le+re)/2,De=(W+fe)/2,Se=new m.Point(Te,De),{lng:Le,lat:Fe}=this.pointLocation3D(Se),Ze=Math.max(0,V-Le,q-Fe,Le-U,Fe-ne);V=Math.min(V,Le),U=Math.max(U,Le),q=Math.min(q,Fe),ne=Math.max(ne,Fe),(_e<ae||Ze>oe)&&(se(le,W,Te,De,_e+1),se(Te,De,re,fe,_e+1))};if(se(f,c,w,c,1),se(w,c,w,v,1),se(w,v,f,v,1),se(f,v,f,c,1),"globe"===this.projection.name){const[le,W]=m.polesInViewport(this);le?(ne=90,U=180,V=-180):W&&(q=-90,U=180,V=-180)}return new m.LngLatBounds(new m.LngLat(V,q),new m.LngLat(U,ne))}_getBoundsRectangular(c,f){const{top:v,left:w}=this._edgeInsets,M=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,k=new m.Point(w,v),L=new m.Point(I,v),V=new m.Point(I,M),U=new m.Point(w,M);let q=this.pointCoordinate(k,c),ne=this.pointCoordinate(L,c);const oe=this.pointCoordinate(V,f),ae=this.pointCoordinate(U,f),se=(le,W)=>(W.y-le.y)/(W.x-le.x);return q.y>1&&ne.y>=0?q=new m.MercatorCoordinate((1-ae.y)/se(ae,q)+ae.x,1):q.y<0&&ne.y<=1&&(q=new m.MercatorCoordinate(-ae.y/se(ae,q)+ae.x,0)),ne.y>1&&q.y>=0?ne=new m.MercatorCoordinate((1-oe.y)/se(oe,ne)+oe.x,1):ne.y<0&&q.y<=1&&(ne=new m.MercatorCoordinate(-oe.y/se(oe,ne)+oe.x,0)),(new m.LngLatBounds).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(ae)).extend(this.coordinateLocation(oe))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=c.visibleDemTiles.reduce((v,w)=>{if(w.dem){const M=w.dem.tree;v.min=Math.min(v.min,M.minimums[0]),v.max=Math.max(v.max,M.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*c.exaggeration(),f.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-f*(1-this._horizonShift);return c?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-m.MAX_MERCATOR_LATITUDE,this.maxLat=m.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=m.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=m.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=m.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=m.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,f){return this.projection.createTileMatrix(this,f,c)}calculateDistanceTileData(c){const f=c.key,v=this._distanceTileDataCache;if(v[f])return v[f];const w=c.canonical,M=1/this.height,I=this.cameraWorldSize,k=I/this.zoomScale(w.z),L=(w.x+Math.pow(2,w.z)*c.wrap)*k,V=w.y*k,U=this.point;U.x*=I/this.worldSize,U.y*=I/this.worldSize;const q=this.angle,ne=Math.sin(-q),oe=-Math.cos(-q);return v[f]={bearing:[ne,oe],center:[(U.x-L)*M,(U.y-V)*M],scale:k/m.EXTENT*M},v[f]}calculateFogTileMatrix(c){const f=c.key,v=this._fogTileMatrixCache;if(v[f])return v[f];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return m.multiply(w,this.worldToFogMatrix,w),v[f]=new Float32Array(w),v[f]}calculateProjMatrix(c,f=!1){const v=c.key,w=f?this._alignedProjMatrixCache:this._projMatrixCache;if(w[v])return w[v];const M=this.calculatePosMatrix(c,this.worldSize);return m.multiply(M,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,M),w[v]=new Float32Array(M),w[v]}calculatePixelsToTileUnitsMatrix(c){const f=c.tileID.key,v=this._pixelsToTileUnitsCache;if(v[f])return v[f];const w=function(M,I){const{scale:k}=M.tileTransform,L=k*m.EXTENT/(M.tileSize*Math.pow(2,I.zoom-M.tileID.overscaledZ+M.tileID.canonical.z));return V=new Float32Array(4),ne=(U=I.inverseAdjustmentMatrix)[1],oe=U[2],ae=U[3],le=(q=[L,L])[1],V[0]=U[0]*(se=q[0]),V[1]=ne*se,V[2]=oe*le,V[3]=ae*le,V;var V,U,q,ne,oe,ae,se,le}(c,this);return v[f]=w,v[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,f=m.fromScaling([],[c,c,c]);return m.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const f=m.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),w=this._camera.forward(),M=m.mercatorZfromAltitude(1,this._center.lat);v[2]/=M,w[2]/=M,m.normalize(w,w);const I=c.raycast(v,w,c.exaggeration());if(I){const k=m.scaleAndAdd([],v,w,I),L=new m.MercatorCoordinate(k[0],k[1],m.mercatorZfromAltitude(k[2],m.latFromMercatorY(k[1]))),V=(L.z+m.length([L.x-v[0],L.y-v[1],L.z-v[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const f=this._elevation,v=m.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(v),M=f.getAtPointOrZero(new m.MercatorCoordinate(...w)),I=this.pixelsPerMeter/this.worldSize*M,k=this._minimumHeightOverTerrain(),L=w[2]-I;if(L<=k)if(L<0||c){const V=this.locationCoordinate(this._center,this._centerAltitude),U=[w[0],w[1],V.z-w[2]],q=m.length(U);U[2]-=(k-L)/this._pixelsPerMercatorPixel;const ne=m.length(U);if(0===ne)return;m.scale$2(U,U,q/ne*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],V.z*this._pixelsPerMercatorPixel-U[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const ne=this.center;return ne.lat=m.clamp(ne.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(ne.lng=m.clamp(ne.lng,this.minLng,this.maxLng)),this.center=ne,void(this._constraining=!1)}const f=this._unmodified,{x:v,y:w}=this.point;let M=0,I=v,k=w;const L=this.width/2,V=this.height/2,U=this.worldMinY*this.scale,q=this.worldMaxY*this.scale;if(w-V<U&&(k=U+V),w+V>q&&(k=q-V),q-U<this.height&&(M=Math.max(M,this.height/(q-U)),k=(q+U)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ne=this.worldMinX*this.scale,oe=this.worldMaxX*this.scale,ae=this.worldSize/2-(ne+oe)/2;I=(v+ae+this.worldSize)%this.worldSize-ae,I-L<ne&&(I=ne+L),I+L>oe&&(I=oe-L),oe-ne<this.width&&(M=Math.max(M,this.width/(oe-ne)),I=(oe+ne)/2)}I===v&&k===w||(this.center=this.unproject(new m.Point(I,k))),M&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,f=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=m.mercatorZfromAltitude(1,this.center.lat)/m.mercatorZfromAltitude(1,m.GLOBE_SCALE_MATCH_LATITUDE));const v=So(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w="meters"===this.projection.zAxisUnit?f:1,M=this._camera.getWorldToCamera(this.worldSize,w),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-c.x/this.width,I[9]=2*c.y/this.height;let k=m.mul([],I,M);if(this.projection.isReprojectedInTileSpace){const De=this.locationCoordinate(this.center),Se=m.identity([]);m.translate(Se,Se,[De.x*this.worldSize,De.y*this.worldSize,0]),m.multiply(Se,Se,Bn(this)),m.translate(Se,Se,[-De.x*this.worldSize,-De.y*this.worldSize,0]),m.multiply(k,k,Se),this.inverseAdjustmentMatrix=function(Le){const Fe=Bn(Le,!0);return Gt([],[Fe[0],Fe[1],Fe[4],Fe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=m.scale([],k,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=k,this.invProjMatrix=m.invert(new Float64Array(16),this.projMatrix);const L=m.invert([],I);this.frustumCorners=m.FrustumCorners.fromInvProjectionMatrix(L,this.horizonLineFromTop(),this.height);const V=new Float32Array(16);m.identity(V),m.scale(V,V,[1,-1,1]),m.rotateX(V,V,this._pitch),m.rotateZ(V,V,this.angle);const U=m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-c.x/this.width,U[9]=2*(c.y+q)/this.height,this.skyboxMatrix=m.multiply(V,U,V);const ne=this.point,oe=ne.x,ae=ne.y,se=this.width%2/2,le=this.height%2/2,W=Math.cos(this.angle),re=Math.sin(this.angle),fe=oe-Math.round(oe)+W*se+re*le,_e=ae-Math.round(ae)+W*le+re*se,Te=new Float64Array(k);if(m.translate(Te,Te,[fe>.5?fe-1:fe,_e>.5?_e-1:_e,0]),this.alignedProjMatrix=Te,k=m.create(),m.scale(k,k,[this.width/2,-this.height/2,1]),m.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=m.create(),m.scale(k,k,[1,-1,1]),m.translate(k,k,[-1,-1,0]),m.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},k=m.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=m.calculateGlobeMatrix(this);const De=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=m.transformMat4(De,De,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,v=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,M=[c,c,f];m.scale$2(M,M,w),m.scale$2(v,v,-1),m.multiply$2(v,v,M);const I=m.create();m.translate(I,I,v),m.scale(I,I,M),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,f,w)}_computeCameraPosition(c){const f=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),w=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-c/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-v[0]*M,w.y/this.worldSize-v[1]*M,c/this.worldSize*this._centerAltitude-v[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],w=c[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(M=Math.min((f-v)/w,1)),this._camera.position=m.scaleAndAdd([],this._camera.position,c,M),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,f=this._camera.forward(),{pitch:v,bearing:w}=this._camera.getPitchBearing(),M=m.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(m.degToRad(this._maxPitch)),k=Math.max((c[2]-M)/Math.cos(v),I),L=this._zoomFromMercatorZ(k);m.scaleAndAdd(c,c,f,k),this._pitch=m.clamp(v,m.degToRad(this.minPitch),m.degToRad(this.maxPitch)),this.angle=m.wrap(w,-Math.PI,Math.PI),this._setZoom(m.clamp(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new m.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let f=0,v=m.GLOBE_ZOOM_THRESHOLD_MAX,w=0,M=1/0;for(;v-f>1e-6&&v>f;){const I=f+.5*(v-f),k=this.tileSize*Math.pow(2,I),L=this.getCameraToCenterDistance(this.projection,I,k),V=this.scaleZoom(L/(c*this.tileSize)),U=Math.abs(I-V);U<M&&(M=U,w=I),I<V?f=I:v=I}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(m.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,f){const v=Math.min(c.x,f.x),w=Math.max(c.x,f.x),M=Math.min(c.y,f.y),I=Math.max(c.y,f.y);if(M<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const k=[new m.Point(v,M),new m.Point(w,I),new m.Point(v,I),new m.Point(w,M)],L=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const U of k){const q=this.pointRayIntersection(U);if(q.t<0)return!0;const ne=this.rayIntersectionCoordinate(q);if(ne.x<L||ne.y<0||ne.x>V||ne.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+m.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new m.Point(0,0),new m.Point(this.width,this.height))}zoomDeltaToMovement(c,f){const v=m.length(m.sub([],this._camera.position,c)),w=this._zoomFromMercatorZ(v)+f;return v-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const c=function([f,v,w],M){const I=[f,v,w,1];m.transformMat4$1(I,I,M);const k=I[3]=Math.max(I[3],1e-6);return I[0]/=k,I[1]/=k,I[2]/=k,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new m.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,c))}}getCameraToCenterDistance(c,f=this.zoom,v=this.worldSize){const w=So(c,f,this.width,this.height,1024),M=c.pixelSpaceConversion(this.center.lat,v,w);return.5/Math.tan(.5*this._fov)*this.height*M}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&m.multiply(c,c,this.globeMatrix),c}}function Ml(_,c){let f=!1,v=null;const w=()=>{v=null,f&&(_(),v=setTimeout(w,c),f=!1)};return()=>(f=!0,v||w(),v)}class Mc{constructor(c){this._hashName=c&&encodeURIComponent(c),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ml(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,m.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),m.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const f=Jn(c);if(this._hashName){const v=this._hashName;let w=!1;const M=m.window.location.hash.slice(1).split("&").map(I=>{const k=I.split("=")[0];return k===v?(w=!0,`${k}=${f}`):I}).filter(I=>I);return w||M.push(`${v}=${f}`),`#${M.join("&")}`}return`#${f}`}_getCurrentHash(){const c=m.window.location.hash.replace("#","");if(this._hashName){let f;return c.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(f=v)}),(f&&f[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(v=>isNaN(v))){const v=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(f[3]||0):c.getBearing();return c.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=m.window.location.href.replace(/(#.+)?$/,this.getHashString());m.window.history.replaceState(m.window.history.state,null,c)}}function Jn(_,c){const f=_.getCenter(),v=Math.round(100*_.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,w),I=Math.round(f.lng*M)/M,k=Math.round(f.lat*M)/M,L=_.getBearing(),V=_.getPitch();let U=c?`/${I}/${k}/${v}`:`${v}/${k}/${I}`;return(L||V)&&(U+="/"+Math.round(10*L)/10),V&&(U+=`/${Math.round(V)}`),U}const Tc={linearity:.3,easing:m.bezier(0,0,.3,1)},Qh=m.extend({deceleration:2500,maxSpeed:1400},Tc),Dc=m.extend({deceleration:20,maxSpeed:1400},Tc),Ft=m.extend({deceleration:1e3,maxSpeed:360},Tc),Ps=m.extend({deceleration:1e3,maxSpeed:90},Tc);class ed{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,f=m.exported.now();for(;c.length>0&&f-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)f.zoom+=M.zoomDelta||0,f.bearing+=M.bearingDelta||0,f.pitch+=M.pitchDelta||0,M.panDelta&&f.pan._add(M.panDelta),M.around&&(f.around=M.around),M.pinchAround&&(f.pinchAround=M.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(f.pan.mag()){const M=Sc(f.pan.mag(),v,m.extend({},Qh,c||{}));w.offset=f.pan.mult(M.amount/f.pan.mag()),w.center=this._map.transform.center,ua(w,M)}if(f.zoom){const M=Sc(f.zoom,v,Dc);w.zoom=this._map.transform.zoom+M.amount,ua(w,M)}if(f.bearing){const M=Sc(f.bearing,v,Ft);w.bearing=this._map.transform.bearing+m.clamp(M.amount,-179,179),ua(w,M)}if(f.pitch){const M=Sc(f.pitch,v,Ps);w.pitch=this._map.transform.pitch+M.amount,ua(w,M)}if(w.zoom||w.bearing){const M=void 0===f.pinchAround?f.around:f.pinchAround;w.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function ua(_,c){(!_.duration||_.duration<c.duration)&&(_.duration=c.duration,_.easing=c.easing)}function Sc(_,c,f){const{maxSpeed:v,linearity:w,deceleration:M}=f,I=m.clamp(_*w/(c/1e3),-v,v),k=Math.abs(I)/(M*w);return{easing:f.easing,duration:1e3*k,amount:I*(k/2)}}class Io extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,v,w={}){const M=Ho(f.getCanvasContainer(),v),I=f.unproject(M);super(c,m.extend({point:M,lngLat:I,originalEvent:v},w)),this._defaultPrevented=!1,this.target=f}}class Ya extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,v){const w="touchend"===c?v.changedTouches:v.touches,M=ul(f.getCanvasContainer(),w),I=M.map(L=>f.unproject(L)),k=M.reduce((L,V,U,q)=>L.add(V.div(q.length)),new m.Point(0,0));super(c,{points:M,point:k,lngLats:I,lngLat:f.unproject(k),originalEvent:v}),this._defaultPrevented=!1}}class Ka extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,v){super(c,{originalEvent:v}),this._defaultPrevented=!1}}class eh{constructor(c,f){this._map=c,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Ka(c.type,this._map,c))}mousedown(c,f){return this._mousedownPos=f,this._firePreventable(new Io(c.type,this._map,c))}mouseup(c){this._map.fire(new Io(c.type,this._map,c))}preclick(c){const f=m.extend({},c);f.type="preclick",this._map.fire(new Io(f.type,this._map,f))}click(c,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Io(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Io(c.type,this._map,c))}mouseover(c){this._map.fire(new Io(c.type,this._map,c))}mouseout(c){this._map.fire(new Io(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Ya(c.type,this._map,c))}touchmove(c){this._map.fire(new Ya(c.type,this._map,c))}touchend(c){this._map.fire(new Ya(c.type,this._map,c))}touchcancel(c){this._map.fire(new Ya(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class td{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Io(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Io("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Io(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Si{constructor(c,f){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,f){this.isEnabled()&&c.shiftKey&&0===c.button&&(Eo(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(c,f){if(!this._active)return;const v=f,w=this._startPos,M=this._lastPos;if(!w||!M||M.equals(v)||!this._box&&v.dist(w)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=Pn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const I=Math.min(w.x,v.x),k=Math.max(w.x,v.x),L=Math.min(w.y,v.y),V=Math.max(w.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${L}px)`,this._box.style.width=k-I+"px",this._box.style.height=V-L+"px")})}mouseupWindow(c,f){if(!this._active)return;const v=this._startPos,w=f;if(v&&0===c.button){if(this.reset(),rr(),v.x!==w.x||v.y!==w.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:M=>M.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ul(),delete this._startPos,delete this._lastPos}_fireEvent(c,f){return this._map.fire(new m.Event(c,{originalEvent:f}))}}function Pm(_,c){const f={};for(let v=0;v<_.length;v++)f[_[v].identifier]=c[v];return f}class au{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const M=new m.Point(0,0);for(const I of w)M._add(I);return M.div(w.length)}(f),this.touches=Pm(v,f)))}touchmove(c,f,v){if(this.aborted||!this.centroid)return;const w=Pm(v,f);for(const M in this.touches){const I=w[M];(!I||I.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(c,f,v){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class up{constructor(c){this.singleTap=new au(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,f,v){this.singleTap.touchstart(c,f,v)}touchmove(c,f,v){this.singleTap.touchmove(c,f,v)}touchend(c,f,v){const w=this.singleTap.touchend(c,f,v);if(w){const M=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(w)<30;if(M&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Yl{constructor(){this._zoomIn=new up({numTouches:1,numTaps:2}),this._zoomOut=new up({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,f,v){this._zoomIn.touchstart(c,f,v),this._zoomOut.touchstart(c,f,v)}touchmove(c,f,v){this._zoomIn.touchmove(c,f,v),this._zoomOut.touchmove(c,f,v)}touchend(c,f,v){const w=this._zoomIn.touchend(c,f,v),M=this._zoomOut.touchend(c,f,v);return w?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(w)},{originalEvent:c})}):M?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(M)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Jh={0:1,2:2};class Tl{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,f){return!1}_move(c,f){return{}}mousedown(c,f){if(this._lastPoint)return;const v=dl(c);this._correctButton(c,v)&&(this._lastPoint=f,this._eventButton=v)}mousemoveWindow(c,f){const v=this._lastPoint;if(v)if(c.preventDefault(),null!=this._eventButton&&function(w,M){const I=Jh[M];return void 0===w.buttons||(w.buttons&I)!==I}(c,this._eventButton))this.reset();else if(this._moved||!(f.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(v,f)}mouseupWindow(c){this._lastPoint&&dl(c)===this._eventButton&&(this._moved&&rr(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nd extends Tl{mousedown(c,f){super.mousedown(c,f),this._lastPoint&&(this._active=!0)}_correctButton(c,f){return 0===f&&!c.ctrlKey}_move(c,f){return{around:f,panDelta:f.sub(c)}}}class Ro extends Tl{_correctButton(c,f){return 0===f&&c.ctrlKey||2===f}_move(c,f){const v=.8*(f.x-c.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(c){c.preventDefault()}}class h_ extends Tl{_correctButton(c,f){return 0===f&&c.ctrlKey||2===f}_move(c,f){const v=-.5*(f.y-c.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(c){c.preventDefault()}}class fs{constructor(c,f){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),m.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)}touchstart(c,f,v){return this._calculateTransform(c,f,v)}touchmove(c,f,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===v.length&&!m.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,f,v)}}touchend(c,f,v){this._calculateTransform(c,f,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,f,v){v.length>0&&(this._active=!0);const w=Pm(v,f),M=new m.Point(0,0),I=new m.Point(0,0);let k=0;for(const V in w){const U=w[V],q=this._touches[V];q&&(M._add(U),I._add(U.sub(q)),k++,w[V]=U)}if(this._touches=w,k<this._minTouches||!I.mag())return;const L=I.div(k);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(k),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Lo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,f,v){return{}}touchstart(c,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(c,f,v){const w=this._firstTwoTouches;if(!w)return;c.preventDefault();const[M,I]=w,k=id(v,f,M),L=id(v,f,I);if(!k||!L)return;const V=this._aroundCenter?null:k.add(L).div(2);return this._move([k,L],V,c)}touchend(c,f,v){if(!this._firstTwoTouches)return;const[w,M]=this._firstTwoTouches,I=id(v,f,w),k=id(v,f,M);I&&k||(this._active&&rr(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function id(_,c,f){for(let v=0;v<_.length;v++)if(_[v].identifier===f)return c[v]}function Ic(_,c){return Math.log(_/c)/Math.LN2}class ef extends Lo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,f){const v=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Ic(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ic(this._distance,v),pinchAround:f}}}function Aa(_,c){return 180*_.angleWith(c)/Math.PI}class dp extends Lo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,f){const v=this._vector;if(this._vector=c[0].sub(c[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Aa(this._vector,v),pinchAround:f}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const f=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const w=Aa(c,v);return Math.abs(w)<f}}function lu(_){return Math.abs(_.y)>Math.abs(_.x)}class f_ extends Lo{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,lu(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,f,v){const w=this._lastPoints;if(!w)return;const M=c[0].sub(w[0]),I=c[1].sub(w[1]);return this._map._cooperativeGestures&&!m.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(M,I,v.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(M.y+I.y)/2*-.5})}gestureBeginsVertically(c,f,v){if(void 0!==this._valid)return this._valid;const w=c.mag()>=2,M=f.mag()>=2;if(!w&&!M)return;if(!w||!M)return null==this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const I=c.y>0==f.y>0;return lu(c)&&lu(f)&&I}}const B0={panStep:100,bearingStep:15,pitchStep:10};class U0{constructor(){const c=B0;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let f=0,v=0,w=0,M=0,I=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?v=-1:(c.preventDefault(),M=-1);break;case 39:c.shiftKey?v=1:(c.preventDefault(),M=1);break;case 38:c.shiftKey?w=1:(c.preventDefault(),I=-1);break;case 40:c.shiftKey?w=-1:(c.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:k=>{const L=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:p_,zoom:f?Math.round(L)+f*(c.shiftKey?2:1):L,bearing:k.getBearing()+v*this._bearingStep,pitch:k.getPitch()+w*this._pitchStep,offset:[-M*this._panStep,-I*this._panStep],center:k.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function p_(_){return _*(2-_)}const m_=4.000244140625;class V0{constructor(c,f){this._map=c,this._el=c.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,m.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||m.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=c.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const v=m.exported.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==f&&f%m_==0?this._type="wheel":0!==f&&Math.abs(f)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(w*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),c.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=c,this._delta-=f,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=Ho(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const L="wheel"===this._type&&Math.abs(this._delta)>m_?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&0!==V&&(V=1/V);const U=f(),q=Math.pow(2,U),ne="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(ne*V))),"wheel"===this._type&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:f(),w=this._startZoom,M=this._easing;let I,k=!1;if("wheel"===this._type&&w&&M){const L=Math.min((m.exported.now()-this._lastWheelEventTime)/200,1),V=M(L);I=m.number(w,v,V),L<1?this._frameId||(this._frameId=!0):k=!0}else I=v,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:I-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let f=m.ease;if(this._prevEase){const v=this._prevEase,w=(m.exported.now()-v.start)/v.duration,M=v.easing(w+.01)-v.easing(w),I=.27/Math.sqrt(M*M+1e-4)*.01,k=Math.sqrt(.0729-I*I);f=m.bezier(I,k,.25,1)}return this._prevEase={start:m.exported.now(),duration:c,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(m.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class j0{constructor(c,f){this._clickZoom=c,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Os{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,f){return c.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(c.shiftKey?-1:1),around:v.unproject(f)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class A1{constructor(){this._tap=new up({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,f,v){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=f[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(c,f,v))}touchmove(c,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=f[0],M=w.y-this._swipePoint.y;return this._swipePoint=w,c.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(c,f,v)}touchend(c,f,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(c,f,v)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $0{constructor(c,f,v){this._el=c,this._mousePan=f,this._touchPan=v}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class P1{constructor(c,f,v){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=f,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class O1{constructor(c,f,v,w){this._el=c,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Dl=_=>_.zoom||_.drag||_.pitch||_.rotate;class H0 extends m.Event{}class k1{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,f){const v=m.sub([],f,c);this.radius=m.length(v[2]<0?m.div([],v,this.constants):[v[0],v[1],0])}projectRay(c){m.div(c,c,this.constants),m.normalize(c,c),m.mul$1(c,c,this.constants);const f=m.scale$2([],c,this.radius);if(f[2]>0){const v=m.scale$2([],[0,0,1],m.dot(f,[0,0,1])),w=m.scale$2([],m.normalize([],[f[0],f[1],0]),this.radius),M=m.add([],f,m.scale$2([],m.sub([],m.add([],w,v),f),2));f[0]=M[0],f[1]=M[1]}return f}}function Kl(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Sl{constructor(c,f){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ed(c),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new k1,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[m.window,"blur",void 0]];for(const[w,M,I]of this._listeners)w.addEventListener(M,w===m.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[c,f,v]of this._listeners)c.removeEventListener(f,c===m.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(c){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new eh(f,c));const w=f.boxZoom=new Si(f,c);this._add("boxZoom",w);const M=new Yl,I=new Os;f.doubleClickZoom=new j0(I,M),this._add("tapZoom",M),this._add("clickZoom",I);const k=new A1;this._add("tapDragZoom",k);const L=f.touchPitch=new f_(f);this._add("touchPitch",L);const V=new Ro(c),U=new h_(c);f.dragRotate=new P1(c,V,U),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",U,["mouseRotate"]);const q=new nd(c),ne=new fs(f,c);f.dragPan=new $0(v,q,ne),this._add("mousePan",q),this._add("touchPan",ne,["touchZoom","touchRotate"]);const oe=new dp,ae=new ef;f.touchZoomRotate=new O1(v,ae,oe,k),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),this._add("blockableMapEvent",new td(f));const se=f.scrollZoom=new V0(f,this);this._add("scrollZoom",se,["mousePan"]);const le=f.keyboard=new U0;this._add("keyboard",le);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[W]&&f[W].enable(c[W])}_add(c,f,v){this._handlers.push({handlerName:c,handler:f,allowed:v}),this._handlersById[c]=f}stop(c){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Dl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,f,v){for(const w in c)if(w!==v&&(!f||f.indexOf(w)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const f=[];for(const v of c)this._el.contains(v.target)&&f.push(v);return f}handleEvent(c,f){this._updatingCamera=!0;const v="renderFrame"===c.type,w=v?void 0:c,M={needsRenderFrame:!1},I={},k={},L=c.touches?this._getMapTouches(c.touches):void 0,V=L?ul(this._el,L):v?void 0:Ho(this._el,c);for(const{handlerName:ne,handler:oe,allowed:ae}of this._handlers){if(!oe.isEnabled())continue;let se;this._blockedByActive(k,ae,ne)?oe.reset():oe[f||c.type]&&(se=oe[f||c.type](c,V,L),this.mergeHandlerResult(M,I,se,ne,w),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||oe.isActive())&&(k[ne]=oe)}const U={};for(const ne in this._previousActiveHandlers)k[ne]||(U[ne]=w);this._previousActiveHandlers=k,(Object.keys(U).length||Kl(M))&&(this._changes.push([M,I,U]),this._triggerRenderFrame()),(Object.keys(k).length||Kl(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=M;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(c,f,v,w,M){if(!v)return;m.extend(c,v);const I={handlerName:w,originalEvent:v.originalEvent||M};void 0!==v.zoomDelta&&(f.zoom=I),void 0!==v.panDelta&&(f.drag=I),void 0!==v.pitchDelta&&(f.pitch=I),void 0!==v.bearingDelta&&(f.rotate=I)}_applyChanges(){const c={},f={},v={};for(const[w,M,I]of this._changes)w.panDelta&&(c.panDelta=(c.panDelta||new m.Point(0,0))._add(w.panDelta)),w.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(c.around=w.around),void 0!==w.aroundCoord&&(c.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(c.pinchAround=w.pinchAround),w.noInertia&&(c.noInertia=w.noInertia),m.extend(f,M),m.extend(v,I);this._updateMapTransform(c,f,v),this._changes=[]}_updateMapTransform(c,f,v){const w=this._map,M=w.transform,I=re=>[re.x,re.y,re.z];if((re=>{const fe=this._eventsInProgress.drag;return fe&&!this._handlersById[fe.handlerName].isActive()})()&&!Kl(c)){const re=M.zoom;M.cameraElevationReference="sea",M.recenterOnTerrain(),M.cameraElevationReference="ground",re!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&w._stop(!0),!Kl(c))return void this._fireEvents(f,v,!0);let{panDelta:k,zoomDelta:L,bearingDelta:V,pitchDelta:U,around:q,aroundCoord:ne,pinchAround:oe}=c;M._isCameraConstrained&&(L>0&&(L=0),M._isCameraConstrained=!1),void 0!==oe&&(q=oe),(L||(re=>f.drag&&!this._eventsInProgress.drag)())&&q&&(this._dragOrigin=I(M.pointCoordinate3D(q)),this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",w._stop(!0),q=q||w.transform.centerPoint,V&&(M.bearing+=V),U&&(M.pitch+=U),M._updateCameraState();const ae=[0,0,0];if(k)if("mercator"===M.projection.name){const re=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(q).dir),fe=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(q.sub(k)).dir);ae[0]=fe[0]-re[0],ae[1]=fe[1]-re[1]}else{const re=M.pointCoordinate(q);if("globe"===M.projection.name){k=k.rotate(-M.angle);const fe=M._pixelsPerMercatorPixel/M.worldSize;ae[0]=-k.x*m.mercatorScale(m.latFromMercatorY(re.y))*fe,ae[1]=-k.y*m.mercatorScale(M.center.lat)*fe}else{const fe=M.pointCoordinate(q.sub(k));re&&fe&&(ae[0]=fe.x-re.x,ae[1]=fe.y-re.y)}}const se=M.zoom,le=[0,0,0];if(L){const re=I(ne||M.pointCoordinate3D(q)),fe={dir:m.normalize([],m.sub([],re,M._camera.position))};if(fe.dir[2]<0){const _e=M.zoomDeltaToMovement(re,L);m.scale$2(le,fe.dir,_e)}}const W=m.add(ae,ae,le);M._translateCameraConstrained(W),L&&Math.abs(M.zoom-se)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(f,v,!0)}_fireEvents(c,f,v){const w=Dl(this._eventsInProgress),M=Dl(c),I={};for(const U in c){const{originalEvent:q}=c[U];this._eventsInProgress[U]||(I[`${U}start`]=q),this._eventsInProgress[U]=c[U]}!w&&M&&this._fireEvent("movestart",M.originalEvent);for(const U in I)this._fireEvent(U,I[U]);M&&this._fireEvent("move",M.originalEvent);for(const U in c){const{originalEvent:q}=c[U];this._fireEvent(U,q)}const k={};let L;for(const U in this._eventsInProgress){const{handlerName:q,originalEvent:ne}=this._eventsInProgress[U];this._handlersById[q].isActive()||(delete this._eventsInProgress[U],L=f[q]||ne,k[`${U}end`]=L)}for(const U in k)this._fireEvent(U,k[U]);const V=Dl(this._eventsInProgress);if(v&&(w||M)&&!V){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=ne=>0!==ne&&-this._bearingSnap<ne&&ne<this._bearingSnap;U?(q(U.bearing||this._map.getBearing())&&(U.bearing=0),this._map.easeTo(U,{originalEvent:L})):(this._map.fire(new m.Event("moveend",{originalEvent:L})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,f){this._map.fire(new m.Event(c,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new H0("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const cu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Om extends m.Evented{constructor(c,f){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=!1!==f.respectPrefersReducedMotion,m.bindAll(["_renderFrameCallback"],this)}getCenter(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,f){return this.jumpTo({center:c},f)}panBy(c,f,v){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},f),v)}panTo(c,f,v){return this.easeTo(m.extend({center:c},f),v)}getZoom(){return this.transform.zoom}setZoom(c,f){return this.jumpTo({zoom:c},f),this}zoomTo(c,f,v){return this.easeTo(m.extend({zoom:c},f),v)}zoomIn(c,f){return this.zoomTo(this.getZoom()+1,c,f),this}zoomOut(c,f){return this.zoomTo(this.getZoom()-1,c,f),this}getBearing(){return this.transform.bearing}setBearing(c,f){return this.jumpTo({bearing:c},f),this}getPadding(){return this.transform.padding}setPadding(c,f){return this.jumpTo({padding:c},f),this}rotateTo(c,f,v){return this.easeTo(m.extend({bearing:c},f),v)}resetNorth(c,f){return this.rotateTo(0,m.extend({duration:1e3},c),f),this}resetNorthPitch(c,f){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),f),this}snapToNorth(c,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,f):this}getPitch(){return this.transform.pitch}setPitch(c,f){return this.jumpTo({pitch:c},f),this}cameraForBounds(c,f){c=m.LngLatBounds.convert(c);const v=f&&f.bearing||0,w=f&&f.pitch||0,M=c.getNorthWest(),I=c.getSouthEast();return this._cameraForBounds(this.transform,M,I,v,w,f)}_extendCameraOptions(c){const f={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=m.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const v=c.padding;c.padding={top:v,bottom:v,right:v,left:v}}return c.padding=m.extend(f,c.padding),c}_minimumAABBFrustumDistance(c,f){const v=f.max[0]-f.min[0],w=f.max[1]-f.min[1];return v/w>c.aspect?v/(2*Math.tan(.5*c.fovX)*c.aspect):w/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,f,v,w,M,I){const k=c.clone(),L=this._extendCameraOptions(I);k.bearing=w,k.pitch=M;const V=m.LngLat.convert(f),U=m.LngLat.convert(v),q=.5*(V.lat+U.lat),ne=.5*(V.lng+U.lng),oe=m.latLngToECEF(q,ne),ae=m.normalize([],oe),se=m.normalize([],m.cross([],ae,[0,1,0])),le=m.cross([],se,ae),W=[se[0],se[1],se[2],0,le[0],le[1],le[2],0,ae[0],ae[1],ae[2],0,0,0,0,1],re=[oe,m.latLngToECEF(V.lat,V.lng),m.latLngToECEF(U.lat,V.lng),m.latLngToECEF(U.lat,U.lng),m.latLngToECEF(V.lat,U.lng),m.latLngToECEF(q,V.lng),m.latLngToECEF(q,U.lng),m.latLngToECEF(V.lat,ne),m.latLngToECEF(U.lat,ne)];let fe=m.Aabb.fromPoints(re.map(yt=>[m.dot(se,yt),m.dot(le,yt),m.dot(ae,yt)]));const _e=m.transformMat4([],fe.center,W);0===m.squaredLength(_e)&&m.set(_e,0,0,1),m.normalize(_e,_e),m.scale$2(_e,_e,m.GLOBE_RADIUS),k.center=m.ecefToLatLng(_e);const Te=k.getWorldToCameraMatrix(),De=m.invert(new Float64Array(16),Te);fe=m.Aabb.applyTransform(fe,m.multiply([],Te,W)),m.transformMat4(_e,_e,Te);const Se=.5*(fe.max[2]-fe.min[2]),Le=this._minimumAABBFrustumDistance(k,fe),Fe=m.scale$2([],[0,0,1],Se),Ze=m.add(Fe,_e,Fe),ht=Le+(0===k.pitch?0:m.distance(_e,Ze)),je=k.globeCenterInViewSpace,dt=m.sub([],_e,[je[0],je[1],je[2]]);m.normalize(dt,dt),m.scale$2(dt,dt,ht);const He=m.add([],_e,dt);m.transformMat4(He,He,De);const Et=m.earthRadius/m.GLOBE_RADIUS,qe=m.length(He),ct=m.mercatorZfromAltitude(Math.max(qe*Et-m.earthRadius,Number.EPSILON),0),_t=Math.min(k.zoomFromMercatorZAdjusted(ct),L.maxZoom);return _t>.5*(m.GLOBE_ZOOM_THRESHOLD_MIN+m.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"mercator"}),k.zoom=_t,this._cameraForBounds(k,f,v,w,M,I)):{center:k.center,zoom:_t,bearing:w,pitch:M}}queryTerrainElevation(c,f){const v=this.transform.elevation;return v?(f=m.extend({},{exaggerated:!0},f),v.getAtPoint(m.MercatorCoordinate.fromLngLat(c),null,f.exaggerated)):null}_cameraForBounds(c,f,v,w,M,I){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,f,v,w,M,I);const k=c.clone(),L=this._extendCameraOptions(I),V=k.padding;k.bearing=w,k.pitch=M;const U=m.LngLat.convert(f),q=m.LngLat.convert(v),ne=new m.LngLat(U.lng,q.lat),oe=new m.LngLat(q.lng,U.lat),ae=k.project(U),se=k.project(q),le=this.queryTerrainElevation(U),W=this.queryTerrainElevation(q),re=this.queryTerrainElevation(ne),fe=this.queryTerrainElevation(oe),_e=[[ae.x,ae.y,Math.min(le||0,W||0,re||0,fe||0)],[se.x,se.y,Math.max(le||0,W||0,re||0,fe||0)]];let Te=m.Aabb.fromPoints(_e);const De=k.getWorldToCameraMatrix(),Se=m.invert(new Float64Array(16),De);Te=m.Aabb.applyTransform(Te,De);const Le=m.sub([],Te.max,Te.min),Fe=V.left||0,Ze=V.right||0,ht=V.bottom||0,je=V.top||0,{left:dt,right:He,top:Et,bottom:qe}=L.padding,ct=.5*(Fe+Ze),_t=.5*(je+ht),yt=Math.min(k.scaleZoom(k.scale*Math.min((k.width-(Fe+Ze+dt+He))/Le[0],(k.height-(ht+je+qe+Et))/Le[1])),L.maxZoom),It=k.scale/k.zoomScale(yt);Te=new m.Aabb([Te.min[0]-(dt+ct)*It,Te.min[1]-(qe+_t)*It,Te.min[2]],[Te.max[0]+(He+ct)*It,Te.max[1]+(Et+_t)*It,Te.max[2]]);const wn=.5*Le[2],kn=this._minimumAABBFrustumDistance(k,Te),ln=[0,0,1,0];m.transformMat4$1(ln,ln,De),m.normalize$2(ln,ln);const Sn=m.scale$2([],ln,kn+wn),ui=m.add([],Te.center,Sn),li=("number"==typeof L.offset.x&&"number"==typeof L.offset.y?new m.Point(L.offset.x,L.offset.y):m.Point.convert(L.offset)).rotate(-m.degToRad(w));Te.center[0]-=li.x*It,Te.center[1]+=li.y*It,m.transformMat4(Te.center,Te.center,Se),m.transformMat4(ui,ui,Se);const gn=[Te.center[0],Te.center[1],ui[2]*k.pixelsPerMeter];m.scale$2(gn,gn,1/k.worldSize);const Xi=m.lngFromMercatorX(gn[0]),cn=m.latFromMercatorY(gn[1]),lr=Math.min(k._zoomFromMercatorZ(gn[2]),L.maxZoom),vr=new m.LngLat(Xi,cn);return k.mercatorFromTransition&&lr<.5*(m.GLOBE_ZOOM_THRESHOLD_MIN+m.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"globe"}),k.zoom=lr,this._cameraForBounds(k,f,v,w,M,I)):{center:vr,zoom:lr,bearing:w,pitch:M}}fitBounds(c,f,v){const w=this.cameraForBounds(c,f);return this._fitInternal(w,f,v)}fitScreenCoordinates(c,f,v,w,M){const I=m.Point.convert(c),k=m.Point.convert(f),L=new m.Point(Math.min(I.x,k.x),Math.min(I.y,k.y)),V=new m.Point(Math.max(I.x,k.x),Math.max(I.y,k.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,k))return this;const U=this.transform.pointLocation3D(L),q=this.transform.pointLocation3D(V),ne=this.transform.pointLocation3D(new m.Point(L.x,V.y)),oe=this.transform.pointLocation3D(new m.Point(V.x,L.y)),ae=[Math.min(U.lng,q.lng,ne.lng,oe.lng),Math.min(U.lat,q.lat,ne.lat,oe.lat)],se=[Math.max(U.lng,q.lng,ne.lng,oe.lng),Math.max(U.lat,q.lat,ne.lat,oe.lat)],le=w&&w.pitch?w.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,ae,se,v,le,w);return this._fitInternal(W,w,M)}_fitInternal(c,f,v){return c?(delete(f=m.extend(c,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(c,f){this.stop();const v=c.preloadOnly?this.transform.clone():this.transform;let w=!1,M=!1,I=!1;return"zoom"in c&&v.zoom!==+c.zoom&&(w=!0,v.zoom=+c.zoom),void 0!==c.center&&(v.center=m.LngLat.convert(c.center)),"bearing"in c&&v.bearing!==+c.bearing&&(M=!0,v.bearing=+c.bearing),"pitch"in c&&v.pitch!==+c.pitch&&(I=!0,v.pitch=+c.pitch),null==c.padding||v.isPaddingEqual(c.padding)||(v.padding=c.padding),c.preloadOnly?(this._preloadTiles(v),this):(this.fire(new m.Event("movestart",f)).fire(new m.Event("move",f)),w&&this.fire(new m.Event("zoomstart",f)).fire(new m.Event("zoom",f)).fire(new m.Event("zoomend",f)),M&&this.fire(new m.Event("rotatestart",f)).fire(new m.Event("rotate",f)).fire(new m.Event("rotateend",f)),I&&this.fire(new m.Event("pitchstart",f)).fire(new m.Event("pitch",f)).fire(new m.Event("pitchend",f)),this.fire(new m.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||m.warnOnce(cu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,f){const v=this.transform;if(!v.projection.supportsFreeCamera)return m.warnOnce(cu),this;this.stop();const w=v.zoom,M=v.pitch,I=v.bearing;v.setFreeCameraOptions(c);const k=w!==v.zoom,L=M!==v.pitch,V=I!==v.bearing;return this.fire(new m.Event("movestart",f)).fire(new m.Event("move",f)),k&&this.fire(new m.Event("zoomstart",f)).fire(new m.Event("zoom",f)).fire(new m.Event("zoomend",f)),V&&this.fire(new m.Event("rotatestart",f)).fire(new m.Event("rotate",f)).fire(new m.Event("rotateend",f)),L&&this.fire(new m.Event("pitchstart",f)).fire(new m.Event("pitch",f)).fire(new m.Event("pitchend",f)),this.fire(new m.Event("moveend",f)),this}easeTo(c,f){this._stop(!1,c.easeId),(!1===(c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const v=this.transform,w=this.getZoom(),M=this.getBearing(),I=this.getPitch(),k=this.getPadding(),L="zoom"in c?+c.zoom:w,V="bearing"in c?this._normalizeBearing(c.bearing,M):M,U="pitch"in c?+c.pitch:I,q="padding"in c?c.padding:v.padding,ne=m.Point.convert(c.offset);let oe,ae,se;if("globe"===v.projection.name){const Fe=m.MercatorCoordinate.fromLngLat(v.center),Ze=ne.rotate(-v.angle);Fe.x+=Ze.x/v.worldSize,Fe.y+=Ze.y/v.worldSize;const ht=Fe.toLngLat(),je=m.LngLat.convert(c.center||ht);this._normalizeCenter(je),oe=v.centerPoint.add(Ze),ae=new m.Point(Fe.x,Fe.y).mult(v.worldSize),se=new m.Point(m.mercatorXfromLng(je.lng),m.mercatorYfromLat(je.lat)).mult(v.worldSize).sub(ae)}else{oe=v.centerPoint.add(ne);const Fe=v.pointLocation(oe),Ze=m.LngLat.convert(c.center||Fe);this._normalizeCenter(Ze),ae=v.project(Fe),se=v.project(Ze).sub(ae)}const le=v.zoomScale(L-w);let W,re;c.around&&(W=m.LngLat.convert(c.around),re=v.locationPoint(W));const fe=this._zooming||L!==w,_e=this._rotating||M!==V,Te=this._pitching||U!==I,De=!v.isPaddingEqual(q),Se=Fe=>Ze=>{if(fe&&(Fe.zoom=m.number(w,L,Ze)),_e&&(Fe.bearing=m.number(M,V,Ze)),Te&&(Fe.pitch=m.number(I,U,Ze)),De&&(Fe.interpolatePadding(k,q,Ze),oe=Fe.centerPoint.add(ne)),W)Fe.setLocationAtPoint(W,re);else{const ht=Fe.zoomScale(Fe.zoom-w),je=L>w?Math.min(2,le):Math.max(.5,le),dt=Math.pow(je,1-Ze),He=Fe.unproject(ae.add(se.mult(Ze*dt)).mult(ht));Fe.setLocationAtPoint(Fe.renderWorldCopies?He.wrap():He,oe)}return c.preloadOnly||this._fireMoveEvents(f),Fe};if(c.preloadOnly){const Fe=this._emulate(Se,c.duration,v);return this._preloadTiles(Fe),this}const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=_e,this._pitching=Te,this._padding=De,this._easeId=c.easeId,this._prepareEase(f,c.noMoveStart,Le),this._ease(Se(v),Fe=>{v.recenterOnTerrain(),this._afterEase(f,Fe)},c),this}_prepareEase(c,f,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||v.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!v.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!v.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!v.pitching&&this.fire(new m.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))}_afterEase(c,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,w=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),M&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}flyTo(c,f){if(this._prefersReducedMotion(c)){const yt=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(yt,f)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);const v=this.transform,w=this.getZoom(),M=this.getBearing(),I=this.getPitch(),k=this.getPadding(),L="zoom"in c?m.clamp(+c.zoom,v.minZoom,v.maxZoom):w,V="bearing"in c?this._normalizeBearing(c.bearing,M):M,U="pitch"in c?+c.pitch:I,q="padding"in c?c.padding:v.padding,ne=v.zoomScale(L-w),oe=m.Point.convert(c.offset);let ae=v.centerPoint.add(oe);const se=v.pointLocation(ae),le=m.LngLat.convert(c.center||se);this._normalizeCenter(le);const W=v.project(se),re=v.project(le).sub(W);let fe=c.curve;const _e=Math.max(v.width,v.height),Te=_e/ne,De=re.mag();if("minZoom"in c){const yt=m.clamp(Math.min(c.minZoom,w,L),v.minZoom,v.maxZoom),It=_e/v.zoomScale(yt-w);fe=Math.sqrt(It/De*2)}const Se=fe*fe;function Le(yt){const It=(Te*Te-_e*_e+(yt?-1:1)*Se*Se*De*De)/(2*(yt?Te:_e)*Se*De);return Math.log(Math.sqrt(It*It+1)-It)}function Fe(yt){return(Math.exp(yt)-Math.exp(-yt))/2}function Ze(yt){return(Math.exp(yt)+Math.exp(-yt))/2}const ht=Le(0);let je=function(yt){return Ze(ht)/Ze(ht+fe*yt)},dt=function(yt){return _e*((Ze(ht)*(Fe(It=ht+fe*yt)/Ze(It))-Fe(ht))/Se)/De;var It},He=(Le(1)-ht)/fe;if(Math.abs(De)<1e-6||!isFinite(He)){if(Math.abs(_e-Te)<1e-6)return this.easeTo(c,f);const yt=Te<_e?-1:1;He=Math.abs(Math.log(Te/_e))/fe,dt=function(){return 0},je=function(It){return Math.exp(yt*fe*It)}}c.duration="duration"in c?+c.duration:1e3*He/("screenSpeed"in c?+c.screenSpeed/fe:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const Et=M!==V,qe=U!==I,ct=!v.isPaddingEqual(q),_t=yt=>It=>{const wn=It*He,kn=1/je(wn);yt.zoom=1===It?L:w+yt.scaleZoom(kn),Et&&(yt.bearing=m.number(M,V,It)),qe&&(yt.pitch=m.number(I,U,It)),ct&&(yt.interpolatePadding(k,q,It),ae=yt.centerPoint.add(oe));const ln=1===It?le:yt.unproject(W.add(re.mult(dt(wn))).mult(kn));return yt.setLocationAtPoint(yt.renderWorldCopies?ln.wrap():ln,ae),yt._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(f),yt};if(c.preloadOnly){const yt=this._emulate(_t,c.duration,v);return this._preloadTiles(yt),this}return this._zooming=!0,this._rotating=Et,this._pitching=qe,this._padding=ct,this._prepareEase(f,!1),this._ease(_t(v),()=>this._afterEase(f),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,f)}if(!c){const v=this.handlers;v&&v.stop(!1)}return this}_ease(c,f,v){!1===v.animate||0===v.duration?(c(1),f()):(this._easeStart=m.exported.now(),this._easeOptions=v,this._onEaseFrame=c,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((m.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,f){c=m.wrap(c,-180,180);const v=Math.abs(c-f);return Math.abs(c-360-f)<v&&(c-=360),Math.abs(c+360-f)<v&&(c+=360),c}_normalizeCenter(c){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const v=c.lng-f.center.lng;c.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&m.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,f,v){const w=Math.ceil(15*f/1e3),M=[],I=c(v.clone());for(let k=0;k<=w;k++){const L=I(k/w);M.push(L.clone())}return M}}class an{constructor(c={}){this.options=c,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const f=this.options&&this.options.compact;return this._map=c,this._container=Pn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Pn("button","mapboxgl-ctrl-attrib-button",this._container),Pn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Pn("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===f&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,f){const v=this._map._getUIString(`AttributionControl.${f}`);c.setAttribute("aria-label",v),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(c){const v=f.reduce((w,M,I)=>(M.value&&(w+=`${M.key}=${M.value}${I<f.length-1?"&":""}`),w),"?");c.href=`${m.config.FEEDBACK_URL}/${v}#${Jn(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const f=this._map.style._sourceCaches;for(const w in f){const M=f[w];if(M.used){const I=M.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c.sort((w,M)=>w.length-M.length),c=c.filter((w,M)=>{for(let I=M+1;I<c.length;I++)if(c[I].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const v=c.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,c.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class g_{constructor(){m.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Pn("div","mapboxgl-ctrl");const f=Pn("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const f in c){const v=c[f].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const f=c[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class Ac{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const f=++this._id;return this._queue.push({callback:c,id:f,cancelled:!1}),f}remove(c){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const w of v)if(w.id===c)return void(w.cancelled=!0)}run(c=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function rd(_,c,f){if(_=new m.LngLat(_.lng,_.lat),c){const v=new m.LngLat(_.lng-360,_.lat),w=new m.LngLat(_.lng+360,_.lat),M=360*Math.ceil(Math.abs(_.lng-f.center.lng)/360),I=f.locationPoint(_).distSqr(c),k=c.x<0||c.y<0||c.x>f.width||c.y>f.height;f.locationPoint(v).distSqr(c)<I&&(k||Math.abs(v.lng-f.center.lng)<M)?_=v:f.locationPoint(w).distSqr(c)<I&&(k||Math.abs(w.lng-f.center.lng)<M)&&(_=w)}for(;Math.abs(_.lng-f.center.lng)>180;){const v=f.locationPoint(_);if(v.x>=0&&v.y>=0&&v.x<=f.width&&v.y<=f.height)break;_.lng>f.center.lng?_.lng-=360:_.lng+=360}return _}const th={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Qt extends m.Evented{constructor(c,f){if(super(),(c instanceof m.window.HTMLElement||f)&&(c=m.extend({element:c},f)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Pn("div");const w=41,M=27,I=di("svg",{display:"block",height:w*this._scale+"px",width:M*this._scale+"px",viewBox:`0 0 ${M} ${w}`},this._element),k=di("radialGradient",{id:"shadowGradient"},di("defs",{},I));di("stop",{offset:"10%","stop-opacity":.4},k),di("stop",{offset:"100%","stop-opacity":.05},k),di("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),di("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),di("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),di("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const v=this._element.classList;for(const w in th)v.remove(`mapboxgl-marker-anchor-${w}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const f=c.code,v=c.charCode||c.keyCode;"Space"!==f&&"Enter"!==f&&32!==v&&13!==v||this.togglePopup()}_onMapClick(c){const f=c.originalEvent.target,v=this._element;this._popup&&(f===v||v.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,f=this._pos;if(!c||!f)return!1;const v=c.unproject(f),w=c.getFreeCameraOptions();if(!w.position)return!1;const M=w.position.toLngLat();return M.distanceTo(v)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const f=this._pos;if(!f||f.x<0||f.x>c.transform.width||f.y<0||f.y>c.transform.height)return void this._clearFadeTimer();const v=c.unproject(f);let w;c._showingGlobe()&&m.isLngLatBehindGlobe(c.transform,this._lngLat)?w=0:(w=1-c._queryFogOpacity(v),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${th[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${f.x}px,${f.y}px)\n        `}_calculateXYTransform(){const c=this._pos,f=this._map,v=this.getPitchAlignment();if(!f||!c||"map"!==v)return"";if(!f._showingGlobe()){const L=f.getPitch();return L?`rotateX(${L}deg)`:""}const w=m.radToDeg(m.globeTiltAtLngLat(f.transform,this._lngLat)),M=c.sub(m.globeCenterToScreenPoint(f.transform)),I=Math.abs(M.x)+Math.abs(M.y);if(0===I)return"";const k=w/I;return`rotateX(${-M.y*k}deg) rotateY(${M.x*k}deg)`}_calculateZTransform(){const c=this._pos,f=this._map;if(!f||!c)return"";let v=0;const w=this.getRotationAlignment();if("map"===w)if(f._showingGlobe()){const M=f.project(new m.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=f.project(new m.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(M);v=m.radToDeg(Math.atan2(I.y,I.x))-90}else v=-f.getBearing();else if("horizon"===w){const M=m.smoothstep(4,6,f.getZoom()),I=m.globeCenterToScreenPoint(f.transform);I.y+=M*f.transform.height;const k=c.sub(I),L=m.radToDeg(Math.atan2(k.y,k.x));v=(L>90?L-270:L+90)*(1-M)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(c){m.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=rd(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),!0===c?this._updateFrameId=m.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=m.Point.convert(c),this._update(),this}_onMove(c){const f=this._map;if(!f)return;const v=this._pointerdownPos,w=this._positionDelta;if(v&&w){if(!this._isDragging){const M=this._clickTolerance||f._clickTolerance;if(c.point.dist(v)<M)return;this._isDragging=!0}this._pos=c.point.sub(w),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new m.Event("dragend")),this._state="inactive"}_addDragHandler(c){const f=this._map,v=this._pos;f&&v&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(v),this._pointerdownPos=c.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const f=this._map;return f&&(c?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const hp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},G0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function __(_=new m.Point(0,0),c="bottom"){if("number"==typeof _){const f=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(c){case"top":return new m.Point(0,_);case"top-left":return new m.Point(f,f);case"top-right":return new m.Point(-f,f);case"bottom":return new m.Point(0,-_);case"bottom-left":return new m.Point(f,-f);case"bottom-right":return new m.Point(-f,-f);case"left":return new m.Point(_,0);case"right":return new m.Point(-_,0)}return new m.Point(0,0)}return _ instanceof m.Point||Array.isArray(_)?m.Point.convert(_):m.Point.convert(_[c]||[0,0])}class km{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const f=m.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,f,v){this._start=this.getValue(f),this._end=c,this._startTime=f,this._endTime=f+v}}const q0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},y_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Ql={showCompass:!0,showZoom:!0,visualizePitch:!1};class fp{constructor(c,f,v=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new Ro({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,v&&(this.mousePitch=new h_({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(c,f){this.mouseRotate.mousedown(c,f),this.mousePitch&&this.mousePitch.mousedown(c,f),Eo()}move(c,f){const v=this.map,w=this.mouseRotate.mousemoveWindow(c,f),M=w&&w.bearingDelta;if(M&&v.setBearing(v.getBearing()+M),this.mousePitch){const I=this.mousePitch.mousemoveWindow(c,f),k=I&&I.pitchDelta;k&&v.setPitch(v.getPitch()+k)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ul(),m.window.removeEventListener("mousemove",this.mousemove),m.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(m.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),Ho(this.element,c)),m.window.addEventListener("mousemove",this.mousemove),m.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,Ho(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=ul(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=ul(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const bo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},pp={maxWidth:100,unit:"metric"},v_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},uu={version:m.version,supported:Xs,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:class extends Om{constructor(_){if(m.LivePerformanceUtils.mark(m.PerformanceMarkers.create),null!=(_=m.extend({},y_,_)).minZoom&&null!=_.maxZoom&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=_.minPitch&&null!=_.maxPitch&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=_.minPitch&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=_.maxPitch&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&m.isSafariWithAntialiasingBug(m.window)&&(_.antialias=!1,m.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new mr(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._useWebGL2=_.useWebGL2,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new Ac,this._domRenderTaskQueue=new Ac,this._controls=[],this._markers=[],this._popups=[],this._mapId=m.uniqueId(),this._locale=m.extend({},q0,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new km(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new m.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,"string"==typeof _.container){if(this._container=m.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof m.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&m.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==m.window&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1),m.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),m.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Sl(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this._hash=_.hash&&new Mc("string"==typeof _.hash&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,m.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),_.attributionControl&&this.addControl(new an({customAttribution:_.customAttribution})),this._logoControl=new g_,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new m.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new m.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(_,c){if(void 0===c&&(c=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=_.onAdd(this);this._controls.push(_);const v=this._controlPositions[c];return-1!==c.indexOf("bottom")?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(_);return c>-1&&this._controls.splice(c,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new m.Event("movestart",_)).fire(new m.Event("move",_)),this.fire(new m.Event("resize",_)),c&&this.fire(new m.Event("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(m.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new m.Event("zoomstart")).fire(new m.Event("zoom")).fire(new m.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new m.Event("zoomstart")).fire(new m.Event("zoom")).fire(new m.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new m.Event("pitchstart")).fire(new m.Event("pitch")).fire(new m.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new m.Event("pitchstart")).fire(new m.Event("pitch")).fire(new m.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return"auto"===_?m.window.navigator.language:Array.isArray(_)?0===_.length?void 0:_.map(c=>"auto"===c?m.window.navigator.language:c):_}setLanguage(_){const c=this._parseLanguage(_);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(_){return this._lazyInitEmptyStyle(),_?"string"==typeof _&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const _=this.transform,c=_.projection.name;let f;"globe"===c&&_.zoom>=m.GLOBE_ZOOM_THRESHOLD_MAX?(_.setMercatorFromTransition(),f=!0):"mercator"===c&&_.zoom<m.GLOBE_ZOOM_THRESHOLD_MAX&&(_.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,c){return this._updateProjection(_||c||{name:"mercator"})}_updateProjection(_){let c;if(c="globe"===_.name&&this.transform.zoom>=m.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(_){return this.transform.locationPoint3D(m.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(m.Point.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,c,f){if("mouseenter"===_||"mouseover"===_){let v=!1;const w=I=>{const k=c.filter(V=>this.getLayer(V)),L=k.length?this.queryRenderedFeatures(I.point,{layers:k}):[];L.length?v||(v=!0,f.call(this,new Io(_,this,I.originalEvent,{features:L}))):v=!1},M=()=>{v=!1};return{layers:new Set(c),listener:f,delegates:{mousemove:w,mouseout:M}}}if("mouseleave"===_||"mouseout"===_){let v=!1;const w=I=>{const k=c.filter(L=>this.getLayer(L));(k.length?this.queryRenderedFeatures(I.point,{layers:k}):[]).length?v=!0:v&&(v=!1,f.call(this,new Io(_,this,I.originalEvent)))},M=I=>{v&&(v=!1,f.call(this,new Io(_,this,I.originalEvent)))};return{layers:new Set(c),listener:f,delegates:{mousemove:w,mouseout:M}}}{const v=w=>{const M=c.filter(k=>this.getLayer(k)),I=M.length?this.queryRenderedFeatures(w.point,{layers:M}):[];I.length&&(w.features=I,f.call(this,w),delete w.features)};return{layers:new Set(c),listener:f,delegates:{[_]:v}}}}on(_,c,f){if(void 0===f)return super.on(_,c);Array.isArray(c)||(c=[c]);const v=this._createDelegatedListener(_,c,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(_,c,f){if(void 0===f)return super.once(_,c);Array.isArray(c)||(c=[c]);const v=this._createDelegatedListener(_,c,f);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(_,c,f){if(void 0===f)return super.off(_,c);c=new Set(Array.isArray(c)?c:[c]);const v=(M,I)=>{if(M.size!==I.size)return!1;for(const k of M)if(!I.has(k))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[_]:void 0;return w&&(M=>{for(let I=0;I<M.length;I++){const k=M[I];if(k.listener===f&&v(k.layers,c)){for(const L in k.delegates)this.off(L,k.delegates[L]);return M.splice(I,1),this}}})(w),this}queryRenderedFeatures(_,c){return this.style?(void 0!==c||void 0===_||_ instanceof m.Point||Array.isArray(_)||(c=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(_,c){return this.style.querySourceFeatures(_,c)}isPointOnSurface(_){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&m.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(m.Point.convert(_))}setStyle(_,c){return!1!==(c=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(_,c))}_getUIString(_){const c=this._locale[_];if(null==c)throw new Error(`Missing UI string '${_}'`);return c}_updateStyle(_,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_&&(this.style=new Ga(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof _?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ga(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,c){if("string"==typeof _){const f=this._requestManager.normalizeStyleURL(_),v=this._requestManager.transformRequest(f,m.ResourceType.Style);m.getJSON(v,(w,M)=>{w?this.fire(new m.ErrorEvent(w)):M&&this._updateDiff(M,c)})}else"object"==typeof _&&this._updateDiff(_,c)}_updateDiff(_,c){try{this.style.setState(_)&&this._update(!0)}catch(f){m.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(_,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(m.warnOnce("There is no style added to the map."),!1)}addSource(_,c){return this._lazyInitEmptyStyle(),this.style.addSource(_,c),this._update(!0)}isSourceLoaded(_){return!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const c in _){const f=_[c]._tiles;for(const v in f){const w=f[v];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}addSourceType(_,c,f){this._lazyInitEmptyStyle(),this.style.addSourceType(_,c,f)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,c,{pixelRatio:f=1,sdf:v=!1,stretchX:w,stretchY:M,content:I}={}){if(this._lazyInitEmptyStyle(),c instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&c instanceof m.window.ImageBitmap){const{width:k,height:L,data:V}=m.exported.getImageData(c);this.style.addImage(_,{data:new m.RGBAImage({width:k,height:L},V),pixelRatio:f,stretchX:w,stretchY:M,content:I,sdf:v,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:L}=c,V=c;this.style.addImage(_,{data:new m.RGBAImage({width:k,height:L},new Uint8Array(V.data)),pixelRatio:f,stretchX:w,stretchY:M,content:I,sdf:v,version:0,userImage:V}),V.onAdd&&V.onAdd(this,_)}}updateImage(_,c){const f=this.style.getImage(_);if(!f)return void this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=c instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&c instanceof m.window.ImageBitmap?m.exported.getImageData(c):c,{width:w,height:M}=v;void 0!==w&&void 0!==M?w===f.data.width&&M===f.data.height?(f.data.replace(v.data,!(c instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&c instanceof m.window.ImageBitmap)),this.style.updateImage(_,f)):this.fire(new m.ErrorEvent(new Error(`The width and height of the updated image (${w}, ${M})\n                must be that same as the previous version of the image\n                (${f.data.width}, ${f.data.height})`))):this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,c){m.getImage(this._requestManager.transformRequest(_,m.ResourceType.Image),(f,v)=>{c(f,v instanceof m.window.HTMLImageElement?m.exported.getImageData(v):v)})}listImages(){return this.style.listImages()}addLayer(_,c){return this._lazyInitEmptyStyle(),this.style.addLayer(_,c),this._update(!0)}moveLayer(_,c){return this.style.moveLayer(_,c),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,c,f){return this.style.setLayerZoomRange(_,c,f),this._update(!0)}setFilter(_,c,f={}){return this.style.setFilter(_,c,f),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,c,f,v={}){return this.style.setPaintProperty(_,c,f,v),this._update(!0)}getPaintProperty(_,c){return this.style.getPaintProperty(_,c)}setLayoutProperty(_,c,f,v={}){return this.style.setLayoutProperty(_,c,f,v),this._update(!0)}getLayoutProperty(_,c){return this.style.getLayoutProperty(_,c)}setLight(_,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(m.LngLat.convert(_),this.transform):0}setFeatureState(_,c){return this.style.setFeatureState(_,c),this._update()}removeFeatureState(_,c){return this.style.removeFeatureState(_,c),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let f,v,w,M=this._container;for(;M&&(!v||!w);){const I=m.window.getComputedStyle(M).transform;I&&"none"!==I&&(f=I.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&"0"!==f[0]&&"1"!==f[0]&&(v=f[0]),f[3]&&"0"!==f[3]&&"1"!==f[3]&&(w=f[3])),M=M.parentElement}this._containerWidth=v?Math.abs(_/v):_,this._containerHeight=w?Math.abs(c/w):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=Pn("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Pn("div","mapboxgl-canvas-container",_);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Pn("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=Pn("div","mapboxgl-control-container",_),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{v[w]=Pn("div",`mapboxgl-ctrl-${w}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,c){const f=m.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(_),this._canvas.height=f*Math.ceil(c),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${c}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const c=this._markers.indexOf(_);-1!==c&&this._markers.splice(c,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const c=this._popups.indexOf(_);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const _=m.extend({},Xs.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",_),f=c||this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);f?(this._useWebGL2&&!c&&m.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),m.storeAuthState(f,!0),this.painter=new es(f,this.transform,!!c),this.on("data",v=>{"source"===v.dataType&&this.painter.setTileLoadedFlag(!0)}),m.exported$1.testSupport(f)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let c;const f=this.painter.context.extTimerQuery,v=m.exported.now();if(this.listens("gpu-timing-frame")&&(c=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],m.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],m.window.performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,L=this.transform.pitch,V=m.exported.now(),U=new m.EvaluationParameters(k,{now:V,fadeDuration:w,pitch:L,transition:this.style.getTransition()});this.style.update(U)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const k=m.exported.now()-v;f.endQueryEXT(f.TIME_ELAPSED_EXT,c),setTimeout(()=>{const L=f.getQueryObjectEXT(c,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(c),this.fire(new m.Event("gpu-timing-frame",{cpuTime:k,gpuTime:L})),m.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:L}})},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(k);this.fire(new m.Event("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(k);this.fire(new m.Event("gpu-timing-deferred-render",{gpuTime:L}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(I||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(M=this._updateAverageElevation(v,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new m.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new m.Event("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,m.LivePerformanceUtils.mark(m.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&m.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const c of this._markers)_&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!_||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(_,c=!1){const f=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&f(0);if((c||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),M=!1;this.transform.elevation&&(M=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=_;const I=Math.abs(v-w);if(I>1){if(this._isInitialLoad||M)return this._averageElevation.jumpTo(w),f(w);this._averageElevation.easeTo(w,_,300)}else if(I>1e-4)return this._averageElevation.jumpTo(w),f(w)}return!!this._averageElevation.isEasing(_)&&f(this._averageElevation.getValue(_))}_authenticate(){m.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===m.AUTH_ERR_MSG||401===_.status)){const c=this.painter.context.gl;m.storeAuthState(c,!1),this._logoControl instanceof g_&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new m.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),m.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const f=this.painter.context.gl,v=f.createFramebuffer();function w(M){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,M,0);const I=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,I),I}return f.bindFramebuffer(f.FRAMEBUFFER,v),this._canvasPixelComparison(w(_),c.canvasCopies.map(w),c.timeStamps)}_canvasPixelComparison(_,c,f){let v=f[1]-f[0];const w=_.length/4;for(let M=0;M<c.length;M++){const I=c[M];let k=0;for(let L=0;L<I.length;L+=4)I[L]===_[L]&&I[L+1]===_[L+1]&&I[L+2]===_[L+2]&&I[L+3]===_[L+3]&&(k+=1);v+=(f[M+2]-f[M+1])*(1-k/w)}return v}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==m.window&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1),m.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),m.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new m.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=m.exported.frame(c=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(c)}))}_preloadTiles(_){const c=this.style?Object.values(this.style._sourceCaches):[];return m.asyncAll(c,(f,v)=>f._preloadTiles(_,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){"hidden"===m.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,_&&this._update())}_setCacheLimits(_,c){m.setCacheLimits(_,c)}get version(){return m.version}},NavigationControl:class{constructor(_){this.options=m.extend({},Ql,_),this._container=Pn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Pn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Pn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:c}):f.resetNorth({},{originalEvent:c}))}),this._compassIcon=Pn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const c=_.getZoom(),f=c===_.getMaxZoom(),v=c===_.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fp(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,c){const f=Pn("button",_,this._container);return f.type="button",f.addEventListener("click",c),f}_setButtonTitle(_,c){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${c}`);_.setAttribute("aria-label",f),_.firstElementChild&&_.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends m.Evented{constructor(_){super(),this.options=m.extend({geolocation:m.window.navigator.geolocation},bo,_),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ml(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=Pn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const c=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,_(f)};void 0!==this._supportsGeolocation?_(this._supportsGeolocation):void 0!==m.window.navigator.permissions?m.window.navigator.permissions.query({name:"geolocation"}).then(f=>c("denied"!==f.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(_){const c=this._map.getMaxBounds(),f=_.coords;return!!c&&(f.longitude<c.getWest()||f.longitude>c.getEast()||f.latitude<c.getSouth()||f.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(_),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",_)),this._finish()}}_updateCamera(_){const c=new m.LngLat(_.coords.longitude,_.coords.latitude),f=_.coords.accuracy,v=this._map.getBearing(),w=m.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(f),w,{geolocateSource:!0})}_updateMarker(_){if(_){const c=new m.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,c=m.mercatorZfromAltitude(1,_._center.lat)*_.worldSize,f=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(1===_.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===_.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Pn("button","mapboxgl-ctrl-geolocate",this._container),Pn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===_){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Pn("div","mapboxgl-user-location"),this._dotElement.appendChild(Pn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Pn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Qt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Pn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new m.Event("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:!0===_.absolute&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{m.window.addEventListener("ondeviceorientationabsolute"in m.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==m.window.DeviceMotionEvent&&"function"==typeof m.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),m.window.removeEventListener("deviceorientation",this._onDeviceOrientation),m.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:an,ScaleControl:class{constructor(_){this.options=m.extend({},pp,_),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),m.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,c=this._map,f=c._containerHeight/2,v=c._containerWidth/2-_/2,w=c.unproject([v,f]),M=c.unproject([v+_,f]),I=w.distanceTo(M);if("imperial"===this.options.unit){const k=3.2808*I;k>5280?this._setScale(_,k/5280,"mile"):this._setScale(_,k,"foot")}else"nautical"===this.options.unit?this._setScale(_,I/1852,"nautical-mile"):I>=1e3?this._setScale(_,I/1e3,"kilometer"):this._setScale(_,I,"meter")}_setScale(_,c,f){this._map._requestDomTask(()=>{const v=function(M){const I=Math.pow(10,`${Math.floor(M)}`.length-1);let k=M/I;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(L){const V=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*V)/V}(k),I*k}(c),w=v/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==f?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(v):`${v}&nbsp;${v_[f]}`,this._container.style.width=_*w+"px"})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=Pn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof m.window.HTMLElement?this._container=_.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in m.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=Pn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!m.window.document.fullscreenEnabled&&!m.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=Pn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Pn("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(m.window.document.fullscreenElement||m.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends m.Evented{constructor(_){super(),this.options=m.extend(Object.create(hp),_),m.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new m.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new m.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=m.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(m.window.document.createTextNode(_))}setHTML(_){const c=m.window.document.createDocumentFragment(),f=m.window.document.createElement("body");let v;for(f.innerHTML=_;v=f.firstChild,v;)c.appendChild(v);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Pn("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(_),this.options.closeButton){const f=this._closeButton=Pn("button","mapboxgl-popup-close-button",c);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let c;return this._classList.delete(_)?c=!1:(this._classList.add(_),c=!0),this._updateClassList(),c}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const c=this._map,f=this._container,v=this._pos;if(!c||!f||!v)return"bottom";const w=f.offsetWidth,M=f.offsetHeight,I=v.x<w/2,k=v.x>c.transform.width-w/2;if(v.y+_<M)return I?"top-left":k?"top-right":"top";if(v.y>c.transform.height-M){if(I)return"bottom-left";if(k)return"bottom-right"}return I?"left":k?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),_.className=c.join(" ")}_update(_){const c=this._map,f=this._content;if(!c||!this._lngLat&&!this._trackPointer||!f)return;let v=this._container;if(v||(v=this._container=Pn("div","mapboxgl-popup",c.getContainer()),this._tip=Pn("div","mapboxgl-popup-tip",v),v.appendChild(f)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=rd(this._lngLat,this._pos,c.transform)),!this._trackPointer||_){const w=this._pos=this._trackPointer&&_?_:c.project(this._lngLat),M=__(this.options.offset),I=this._anchor=this._getAnchor(M.y),k=__(this.options.offset,I),L=w.add(k).round();c._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${th[I]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&c._showingGlobe()){const w=m.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(G0);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:Qt,Style:Ga,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,FreeCameraOptions:Mr,Evented:m.Evented,config:m.config,prewarm:function(){nu().acquire(ja)},clearPrewarmedResources:function(){const _=er;_&&(_.isPreloaded()&&1===_.numActive()?(_.release(ja),er=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(_){m.config.ACCESS_TOKEN=_},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(_){m.config.API_URL=_},get workerCount(){return yo.workerCount},set workerCount(_){yo.workerCount=_},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){m.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){m.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:m.exported.setNow,restoreNow:m.exported.restoreNow};return uu}),Ri}()}},Dm=>{Dm(Dm.s=13)}]);